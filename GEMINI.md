# Gemini CLI Agent Instructions

This document guides the agent's interaction with the project.

### Core Principles
- Prioritize simplicity, performance, and security.
- Avoid over-engineering.
- Ask for clarification instead of guessing.
- Use the `@refactor-directive` to refactor JavaScript code to be concise, modern, and functional while maintaining the same output.
- everything can run without root. Use standard web development tools like Vite and Cloudflare Wrangler.
- do not rename variables without asking.
- **Service Verification:** Each time you restart a service, you MUST check the logs immediately to verify it is running correctly. Do not assume a successful command means a successful startup.

### Project Commands
- **Run Application (Local Dev):** Use `./run-local.sh`. This script uses `systemd --user` to manage background processes for the Vite frontend and Cloudflare Worker backend.
- **Stop Application:** Use `systemctl --user stop ntn-frontend ntn-backend`.
- **View Logs:** 
  - Frontend: `journalctl --user -u ntn-frontend -f`
  - Backend: `journalctl --user -u ntn-backend -f`
- **Build for Production:** Use `npm run build`. Assets are generated in the `www/` directory for deployment to Cloudflare Pages.

### Testing Workflow
- **Running Playwright Tests:**
  1. Ensure the local services are running using `./run-local.sh`.
  2. All Playwright tests MUST be run using the `run_single_test.sh` script to minimize output and focus on individual test results.
      - **Usage:** `./run_single_test.sh <test_file_path> <test_name_regex>`
      - **Example:** `./run_single_test.sh tests/ui.spec.js "should load the main page"`
  - **Important:** Running Playwright tests directly via `npx playwright test` is NOT allowed due to potentially large output. Always use `run_single_test.sh`.
- **Analyzing Test Results:**
  1. Test results (screenshots, traces, logs) generated by Playwright will be saved locally on your host machine in the `test-results/` directory.
  2. Review these artifacts for test failures or unexpected behavior.

### Workflow Management
- **Issues:** Log new issues in `issues.md`. Work through them one by one. Resolved issues should be moved to `tasks-completed.md`.
- **Current Task:** Move an issue from `issues.md` to `current-task.md` to begin work. This file should track progress and problems.
- **Completing Tasks:**
  1. When a task is complete, move its contents from `current-task.md` to `tasks-completed.md`.
  2. Before starting a new task, `git add` and `git commit` all changes from the completed task with a clear message.

### Mitigation for Blockages
If you get stuck:
1. Document the problem in `current-task.md`, including what you tried and why it failed.
2. Propose alternative solutions.
3. Seek user input, providing all relevant context.
