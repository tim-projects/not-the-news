<!DOCTYPE html>
<html lang="en" x-data="rssApp()" x-init="init()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Not The News</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/rss-parser@3.13.0/dist/rss-parser.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
  <div id="loading-screen" x-show="loading">Loading...</div>

  <div id="header">
    <h2>Not The News</h2>
    <!-- Theme toggle -->
    <button id="theme-toggle" aria-label="Toggle theme" style="margin-left:1rem;font-size:1.2rem;">ðŸŒ“</button>
  </div>

  <main id="items">
  <template x-for="(entry, idx) in entries" :key="idx">
      <div class="item" x-show="!hiddenSet.has(entry.link)" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform" x-transition:leave-end="opacity-0 transform -translate-y-4">
        <div class="itemtitle">
          <a :href="entry.link" target="_blank" x-text="entry.title"></a>
          <button class="close" @click="hide(entry.link)">âœ•</button>
        </div>
        <div class="itemfrom">
          <p x-text="entry.pubDate"></p>
        </div>
        <div class="itemdescription">
          <span x-text="entry.description"></span>
        </div>
      </div>
    </template>
  </main>

  <button id="scroll-to-top-button" @click="scrollToTop()">â†‘</button>

  <script>
    function rssApp() {
      return {
        entries: [],
        hiddenSet: new Set(),
        loading: true,
        init() {
          const stored = JSON.parse(localStorage.getItem('hidden') || '[]');
          this.hiddenSet = new Set(stored);

          const parser = new RSSParser();

          fetch('https://news.loveopenly.net/feed.xml')
            .then(response => response.text())
            .then(str => parser.parseString(str))
            .then(feed => {
              this.loading = false;
              this.entries = feed.items.map(item => {
                const rawDescription = item.content || item.contentSnippet || item.summary || item.description || '';
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = rawDescription;
                const cleanText = tempDiv.textContent || tempDiv.innerText || '';
                return {
                  title: item.title,
                  link: item.link,
                  pubDate: item.pubDate || item.isoDate || 'Unknown date',
                  description: cleanText.trim()
                };
              });
            })
            .catch(err => {
              this.loading = false;
              console.error('RSS fetch/parse error:', err);
            });
        },
        hide(link) {
          this.hiddenSet.add(link);
          localStorage.setItem('hidden', JSON.stringify([...this.hiddenSet]));
        },
        scrollToTop() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }
    }
  </script>
    <!-- Theme toggle script -->
  <script>
    (function() {
      const html = document.documentElement;
      const toggle = document.getElementById('theme-toggle');
      // Determine initial theme
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || stored === 'light') {
        html.classList.add(stored);
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        html.classList.add('dark');
      } else {
        html.classList.add('light');
      }
      // Toggle on click
      toggle.addEventListener('click', () => {
        if (html.classList.contains('dark')) {
          html.classList.replace('dark','light');
          localStorage.setItem('theme','light');
        } else {
          html.classList.replace('light','dark');
          localStorage.setItem('theme','dark');
        }
      });
    })();
  </script>
</body>
</html>

