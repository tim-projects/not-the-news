<!DOCTYPE html>
<html lang="en" x-data="rssApp()" x-init="init()">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Not The News</title>
  <!-- Existing CSS -->
  <link rel="stylesheet" href="style.css">
  <!-- RSS Parser for the browser -->
  <script defer src="https://cdn.jsdelivr.net/npm/rss-parser@3.13.0/dist/rss-parser.min.js"></script>
  <!-- Alpine.js for reactivity -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>
  <!-- Loading screen -->
  <div id="loading-screen" x-show="loading">Loading...</div>

  <!-- Header -->
  <div id="header">
    <h2>Not The News</h2>
  </div>

  <!-- RSS Entries -->
  <main id="items">
    <template x-for="(entry, index) in entries" :key="index">
      <div class="item" x-show="!hiddenSet.has(entry.link)">
        <div class="itemtitle">
          <a :href="entry.link" target="_blank" x-text="entry.title"></a>
          <button class="close" @click="hide(entry.link)">✕</button>
        </div>
        <div class="itemfrom">
          <p x-text="entry.pubDate"></p>
        </div>
        <div class="itemdescription">
          <span x-html="entry.contentSnippet"></span>
        </div>
      </div>
    </template>
  </main>

  <!-- Scroll-to-top button -->
  <button id="scroll-to-top-button" @click="scrollToTop()">↑</button>

  <script>
    function rssApp() {
      return {
        entries: [],
        hiddenSet: new Set(),
        loading: true,
        init() {
          // Load hidden entries from localStorage
          const stored = JSON.parse(localStorage.getItem('hidden') || '[]');
          this.hiddenSet = new Set(stored);

          const parser = new RSSParser();

          // Fetch and parse the feed manually to avoid browser issues with parseURL
          fetch('https://news.loveopenly.net/feed.xml')
            .then(response => response.text())
            .then(str => parser.parseString(str))
            .then(feed => {
              this.loading = false;
              this.entries = feed.items.map(item => ({
                title: item.title,
                link: item.link,
                pubDate: new Date(item.isoDate || item.pubDate).toLocaleString(),
                contentSnippet: item.contentSnippet || item.content || ''
              }));
            })
            .catch(err => {
              this.loading = false;
              console.error('RSS fetch/parse error:', err);
            });
        },
        hide(link) {
          this.hiddenSet.add(link);
          localStorage.setItem('hidden', JSON.stringify([...this.hiddenSet]));
        },
        scrollToTop() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }
    }
  </script>
</body>
</html>

