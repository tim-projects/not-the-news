/* empty css              */(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const kr="modulepreload",Er=function(t){return"/"+t},An={},$=function(n,s,r){let i=Promise.resolve();if(s&&s.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=c(s.map(u=>{if(u=Er(u),u in An)return;An[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":kr,d||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),d)return new Promise((w,b)=>{g.addEventListener("load",w),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return n().catch(o)})};var xt=!1,Ot=!1,ue=[],Ct=-1;function Ar(t){Ir(t)}function Ir(t){ue.includes(t)||ue.push(t),Or()}function xr(t){let n=ue.indexOf(t);n!==-1&&n>Ct&&ue.splice(n,1)}function Or(){!Ot&&!xt&&(xt=!0,queueMicrotask(Cr))}function Cr(){xt=!1,Ot=!0;for(let t=0;t<ue.length;t++)ue[t](),Ct=t;ue.length=0,Ct=-1,Ot=!1}var ve,pe,De,Wn,Tt=!0;function Tr(t){Tt=!1,t(),Tt=!0}function Mr(t){ve=t.reactive,De=t.release,pe=n=>t.effect(n,{scheduler:s=>{Tt?Ar(s):s()}}),Wn=t.raw}function In(t){pe=t}function $r(t){let n=()=>{};return[r=>{let i=pe(r);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach(o=>o())}),t._x_effects.add(i),n=()=>{i!==void 0&&(t._x_effects.delete(i),De(i))},i},()=>{n()}]}function qn(t,n){let s=!0,r,i=pe(()=>{let o=t();JSON.stringify(o),s?r=o:queueMicrotask(()=>{n(o,r),r=o}),s=!1});return()=>De(i)}var Jn=[],Yn=[],Qn=[];function Pr(t){Qn.push(t)}function Xt(t,n){typeof n=="function"?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(n)):(n=t,Yn.push(n))}function Xn(t){Jn.push(t)}function Zn(t,n,s){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[n]||(t._x_attributeCleanups[n]=[]),t._x_attributeCleanups[n].push(s)}function es(t,n){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach(([s,r])=>{(n===void 0||n.includes(s))&&(r.forEach(i=>i()),delete t._x_attributeCleanups[s])})}function Rr(t){for(t._x_effects?.forEach(xr);t._x_cleanups?.length;)t._x_cleanups.pop()()}var Zt=new MutationObserver(sn),en=!1;function tn(){Zt.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),en=!0}function ts(){Br(),Zt.disconnect(),en=!1}var Ie=[];function Br(){let t=Zt.takeRecords();Ie.push(()=>t.length>0&&sn(t));let n=Ie.length;queueMicrotask(()=>{if(Ie.length===n)for(;Ie.length>0;)Ie.shift()()})}function x(t){if(!en)return t();ts();let n=t();return tn(),n}var nn=!1,Ye=[];function Lr(){nn=!0}function Gr(){nn=!1,sn(Ye),Ye=[]}function sn(t){if(nn){Ye=Ye.concat(t);return}let n=[],s=new Set,r=new Map,i=new Map;for(let o=0;o<t.length;o++)if(!t[o].target._x_ignoreMutationObserver&&(t[o].type==="childList"&&(t[o].removedNodes.forEach(a=>{a.nodeType===1&&a._x_marker&&s.add(a)}),t[o].addedNodes.forEach(a=>{if(a.nodeType===1){if(s.has(a)){s.delete(a);return}a._x_marker||n.push(a)}})),t[o].type==="attributes")){let a=t[o].target,l=t[o].attributeName,c=t[o].oldValue,u=()=>{r.has(a)||r.set(a,[]),r.get(a).push({name:l,value:a.getAttribute(l)})},d=()=>{i.has(a)||i.set(a,[]),i.get(a).push(l)};a.hasAttribute(l)&&c===null?u():a.hasAttribute(l)?(d(),u()):d()}i.forEach((o,a)=>{es(a,o)}),r.forEach((o,a)=>{Jn.forEach(l=>l(a,o))});for(let o of s)n.some(a=>a.contains(o))||Yn.forEach(a=>a(o));for(let o of n)o.isConnected&&Qn.forEach(a=>a(o));n=null,s=null,r=null,i=null}function ns(t){return Be(_e(t))}function Re(t,n,s){return t._x_dataStack=[n,..._e(s||t)],()=>{t._x_dataStack=t._x_dataStack.filter(r=>r!==n)}}function _e(t){return t._x_dataStack?t._x_dataStack:typeof ShadowRoot=="function"&&t instanceof ShadowRoot?_e(t.host):t.parentNode?_e(t.parentNode):[]}function Be(t){return new Proxy({objects:t},Fr)}var Fr={ownKeys({objects:t}){return Array.from(new Set(t.flatMap(n=>Object.keys(n))))},has({objects:t},n){return n==Symbol.unscopables?!1:t.some(s=>Object.prototype.hasOwnProperty.call(s,n)||Reflect.has(s,n))},get({objects:t},n,s){return n=="toJSON"?jr:Reflect.get(t.find(r=>Reflect.has(r,n))||{},n,s)},set({objects:t},n,s,r){const i=t.find(a=>Object.prototype.hasOwnProperty.call(a,n))||t[t.length-1],o=Object.getOwnPropertyDescriptor(i,n);return o?.set&&o?.get?o.set.call(r,s)||!0:Reflect.set(i,n,s)}};function jr(){return Reflect.ownKeys(this).reduce((n,s)=>(n[s]=Reflect.get(this,s),n),{})}function ss(t){let n=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,s=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([o,{value:a,enumerable:l}])=>{if(l===!1||a===void 0||typeof a=="object"&&a!==null&&a.__v_skip)return;let c=i===""?o:`${i}.${o}`;typeof a=="object"&&a!==null&&a._x_interceptor?r[o]=a.initialize(t,c,o):n(a)&&a!==r&&!(a instanceof Element)&&s(a,c)})};return s(t)}function rs(t,n=()=>{}){let s={initialValue:void 0,_x_interceptor:!0,initialize(r,i,o){return t(this.initialValue,()=>Nr(r,i),a=>Mt(r,i,a),i,o)}};return n(s),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=s.initialize.bind(s);s.initialize=(o,a,l)=>{let c=r.initialize(o,a,l);return s.initialValue=c,i(o,a,l)}}else s.initialValue=r;return s}}function Nr(t,n){return n.split(".").reduce((s,r)=>s[r],t)}function Mt(t,n,s){if(typeof n=="string"&&(n=n.split(".")),n.length===1)t[n[0]]=s;else{if(n.length===0)throw error;return t[n[0]]||(t[n[0]]={}),Mt(t[n[0]],n.slice(1),s)}}var is={};function z(t,n){is[t]=n}function $t(t,n){let s=Ur(n);return Object.entries(is).forEach(([r,i])=>{Object.defineProperty(t,`$${r}`,{get(){return i(n,s)},enumerable:!1})}),t}function Ur(t){let[n,s]=ds(t),r={interceptor:rs,...n};return Xt(t,s),r}function zr(t,n,s,...r){try{return s(...r)}catch(i){$e(i,t,n)}}function $e(t,n,s=void 0){t=Object.assign(t??{message:"No error message given."},{el:n,expression:s}),console.warn(`Alpine Expression Error: ${t.message}

${s?'Expression: "'+s+`"

`:""}`,n),setTimeout(()=>{throw t},0)}var He=!0;function os(t){let n=He;He=!1;let s=t();return He=n,s}function de(t,n,s={}){let r;return P(t,n)(i=>r=i,s),r}function P(...t){return as(...t)}var as=ls;function Vr(t){as=t}function ls(t,n){let s={};$t(s,t);let r=[s,..._e(t)],i=typeof n=="function"?Kr(r,n):Wr(r,n,t);return zr.bind(null,t,n,i)}function Kr(t,n){return(s=()=>{},{scope:r={},params:i=[]}={})=>{let o=n.apply(Be([r,...t]),i);Qe(s,o)}}var ht={};function Hr(t,n){if(ht[t])return ht[t];let s=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t,o=(()=>{try{let a=new s(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(a,"name",{value:`[Alpine] ${t}`}),a}catch(a){return $e(a,n,t),Promise.resolve()}})();return ht[t]=o,o}function Wr(t,n,s){let r=Hr(n,s);return(i=()=>{},{scope:o={},params:a=[]}={})=>{r.result=void 0,r.finished=!1;let l=Be([o,...t]);if(typeof r=="function"){let c=r(r,l).catch(u=>$e(u,s,n));r.finished?(Qe(i,r.result,l,a,s),r.result=void 0):c.then(u=>{Qe(i,u,l,a,s)}).catch(u=>$e(u,s,n)).finally(()=>r.result=void 0)}}}function Qe(t,n,s,r,i){if(He&&typeof n=="function"){let o=n.apply(s,r);o instanceof Promise?o.then(a=>Qe(t,a,s,r)).catch(a=>$e(a,i,n)):t(o)}else typeof n=="object"&&n instanceof Promise?n.then(o=>t(o)):t(n)}var rn="x-";function ke(t=""){return rn+t}function qr(t){rn=t}var Xe={};function C(t,n){return Xe[t]=n,{before(s){if(!Xe[s]){console.warn(String.raw`Cannot find directive \`${s}\`. \`${t}\` will use the default order of execution`);return}const r=ce.indexOf(s);ce.splice(r>=0?r:ce.indexOf("DEFAULT"),0,t)}}}function Jr(t){return Object.keys(Xe).includes(t)}function on(t,n,s){if(n=Array.from(n),t._x_virtualDirectives){let o=Object.entries(t._x_virtualDirectives).map(([l,c])=>({name:l,value:c})),a=cs(o);o=o.map(l=>a.find(c=>c.name===l.name)?{name:`x-bind:${l.name}`,value:`"${l.value}"`}:l),n=n.concat(o)}let r={};return n.map(gs((o,a)=>r[o]=a)).filter(ms).map(Xr(r,s)).sort(Zr).map(o=>Qr(t,o))}function cs(t){return Array.from(t).map(gs()).filter(n=>!ms(n))}var Pt=!1,Ce=new Map,us=Symbol();function Yr(t){Pt=!0;let n=Symbol();us=n,Ce.set(n,[]);let s=()=>{for(;Ce.get(n).length;)Ce.get(n).shift()();Ce.delete(n)},r=()=>{Pt=!1,s()};t(s),r()}function ds(t){let n=[],s=l=>n.push(l),[r,i]=$r(t);return n.push(i),[{Alpine:Le,effect:r,cleanup:s,evaluateLater:P.bind(P,t),evaluate:de.bind(de,t)},()=>n.forEach(l=>l())]}function Qr(t,n){let s=()=>{},r=Xe[n.type]||s,[i,o]=ds(t);Zn(t,n.original,o);let a=()=>{t._x_ignore||t._x_ignoreSelf||(r.inline&&r.inline(t,n,i),r=r.bind(r,t,n,i),Pt?Ce.get(us).push(r):r())};return a.runCleanups=o,a}var fs=(t,n)=>({name:s,value:r})=>(s.startsWith(t)&&(s=s.replace(t,n)),{name:s,value:r}),hs=t=>t;function gs(t=()=>{}){return({name:n,value:s})=>{let{name:r,value:i}=ps.reduce((o,a)=>a(o),{name:n,value:s});return r!==n&&t(r,n),{name:r,value:i}}}var ps=[];function an(t){ps.push(t)}function ms({name:t}){return ys().test(t)}var ys=()=>new RegExp(`^${rn}([^:^.]+)\\b`);function Xr(t,n){return({name:s,value:r})=>{let i=s.match(ys()),o=s.match(/:([a-zA-Z0-9\-_:]+)/),a=s.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],l=n||t[s]||s;return{type:i?i[1]:null,value:o?o[1]:null,modifiers:a.map(c=>c.replace(".","")),expression:r,original:l}}}var Rt="DEFAULT",ce=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Rt,"teleport"];function Zr(t,n){let s=ce.indexOf(t.type)===-1?Rt:t.type,r=ce.indexOf(n.type)===-1?Rt:n.type;return ce.indexOf(s)-ce.indexOf(r)}function Te(t,n,s={}){t.dispatchEvent(new CustomEvent(n,{detail:s,bubbles:!0,composed:!0,cancelable:!0}))}function ge(t,n){if(typeof ShadowRoot=="function"&&t instanceof ShadowRoot){Array.from(t.children).forEach(i=>ge(i,n));return}let s=!1;if(n(t,()=>s=!0),s)return;let r=t.firstElementChild;for(;r;)ge(r,n),r=r.nextElementSibling}function L(t,...n){console.warn(`Alpine Warning: ${t}`,...n)}var xn=!1;function ei(){xn&&L("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),xn=!0,document.body||L("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Te(document,"alpine:init"),Te(document,"alpine:initializing"),tn(),Pr(n=>Y(n,ge)),Xt(n=>Ae(n)),Xn((n,s)=>{on(n,s).forEach(r=>r())});let t=n=>!st(n.parentElement,!0);Array.from(document.querySelectorAll(_s().join(","))).filter(t).forEach(n=>{Y(n)}),Te(document,"alpine:initialized"),setTimeout(()=>{ri()})}var ln=[],ws=[];function Ss(){return ln.map(t=>t())}function _s(){return ln.concat(ws).map(t=>t())}function bs(t){ln.push(t)}function vs(t){ws.push(t)}function st(t,n=!1){return Ee(t,s=>{if((n?_s():Ss()).some(i=>s.matches(i)))return!0})}function Ee(t,n){if(t){if(n(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),!!t.parentElement)return Ee(t.parentElement,n)}}function ti(t){return Ss().some(n=>t.matches(n))}var Ds=[];function ni(t){Ds.push(t)}var si=1;function Y(t,n=ge,s=()=>{}){Ee(t,r=>r._x_ignore)||Yr(()=>{n(t,(r,i)=>{r._x_marker||(s(r,i),Ds.forEach(o=>o(r,i)),on(r,r.attributes).forEach(o=>o()),r._x_ignore||(r._x_marker=si++),r._x_ignore&&i())})})}function Ae(t,n=ge){n(t,s=>{Rr(s),es(s),delete s._x_marker})}function ri(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([n,s,r])=>{Jr(s)||r.some(i=>{if(document.querySelector(i))return L(`found "${i}", but missing ${n} plugin`),!0})})}var Bt=[],cn=!1;function un(t=()=>{}){return queueMicrotask(()=>{cn||setTimeout(()=>{Lt()})}),new Promise(n=>{Bt.push(()=>{t(),n()})})}function Lt(){for(cn=!1;Bt.length;)Bt.shift()()}function ii(){cn=!0}function dn(t,n){return Array.isArray(n)?On(t,n.join(" ")):typeof n=="object"&&n!==null?oi(t,n):typeof n=="function"?dn(t,n()):On(t,n)}function On(t,n){let s=i=>i.split(" ").filter(o=>!t.classList.contains(o)).filter(Boolean),r=i=>(t.classList.add(...i),()=>{t.classList.remove(...i)});return n=n===!0?n="":n||"",r(s(n))}function oi(t,n){let s=l=>l.split(" ").filter(Boolean),r=Object.entries(n).flatMap(([l,c])=>c?s(l):!1).filter(Boolean),i=Object.entries(n).flatMap(([l,c])=>c?!1:s(l)).filter(Boolean),o=[],a=[];return i.forEach(l=>{t.classList.contains(l)&&(t.classList.remove(l),a.push(l))}),r.forEach(l=>{t.classList.contains(l)||(t.classList.add(l),o.push(l))}),()=>{a.forEach(l=>t.classList.add(l)),o.forEach(l=>t.classList.remove(l))}}function rt(t,n){return typeof n=="object"&&n!==null?ai(t,n):li(t,n)}function ai(t,n){let s={};return Object.entries(n).forEach(([r,i])=>{s[r]=t.style[r],r.startsWith("--")||(r=ci(r)),t.style.setProperty(r,i)}),setTimeout(()=>{t.style.length===0&&t.removeAttribute("style")}),()=>{rt(t,s)}}function li(t,n){let s=t.getAttribute("style",n);return t.setAttribute("style",n),()=>{t.setAttribute("style",s||"")}}function ci(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Gt(t,n=()=>{}){let s=!1;return function(){s?n.apply(this,arguments):(s=!0,t.apply(this,arguments))}}C("transition",(t,{value:n,modifiers:s,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?di(t,s,n):ui(t,r,n))});function ui(t,n,s){ks(t,dn,""),{enter:i=>{t._x_transition.enter.during=i},"enter-start":i=>{t._x_transition.enter.start=i},"enter-end":i=>{t._x_transition.enter.end=i},leave:i=>{t._x_transition.leave.during=i},"leave-start":i=>{t._x_transition.leave.start=i},"leave-end":i=>{t._x_transition.leave.end=i}}[s](n)}function di(t,n,s){ks(t,rt);let r=!n.includes("in")&&!n.includes("out")&&!s,i=r||n.includes("in")||["enter"].includes(s),o=r||n.includes("out")||["leave"].includes(s);n.includes("in")&&!r&&(n=n.filter((p,m)=>m<n.indexOf("out"))),n.includes("out")&&!r&&(n=n.filter((p,m)=>m>n.indexOf("out")));let a=!n.includes("opacity")&&!n.includes("scale"),l=a||n.includes("opacity"),c=a||n.includes("scale"),u=l?0:1,d=c?xe(n,"scale",95)/100:1,h=xe(n,"delay",0)/1e3,g=xe(n,"origin","center"),w="opacity, transform",b=xe(n,"duration",150)/1e3,S=xe(n,"duration",75)/1e3,f="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(t._x_transition.enter.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:w,transitionDuration:`${b}s`,transitionTimingFunction:f},t._x_transition.enter.start={opacity:u,transform:`scale(${d})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"}),o&&(t._x_transition.leave.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:w,transitionDuration:`${S}s`,transitionTimingFunction:f},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:u,transform:`scale(${d})`})}function ks(t,n,s={}){t._x_transition||(t._x_transition={enter:{during:s,start:s,end:s},leave:{during:s,start:s,end:s},in(r=()=>{},i=()=>{}){Ft(t,n,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){Ft(t,n,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,n,s,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let o=()=>i(s);if(n){t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(s):o():t._x_transition?t._x_transition.in(s):o();return}t._x_hidePromise=t._x_transition?new Promise((a,l)=>{t._x_transition.out(()=>{},()=>a(r)),t._x_transitioning&&t._x_transitioning.beforeCancel(()=>l({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let a=Es(t);a?(a._x_hideChildren||(a._x_hideChildren=[]),a._x_hideChildren.push(t)):i(()=>{let l=c=>{let u=Promise.all([c._x_hidePromise,...(c._x_hideChildren||[]).map(l)]).then(([d])=>d?.());return delete c._x_hidePromise,delete c._x_hideChildren,u};l(t).catch(c=>{if(!c.isFromCancelledTransition)throw c})})})};function Es(t){let n=t.parentNode;if(n)return n._x_hidePromise?n:Es(n)}function Ft(t,n,{during:s,start:r,end:i}={},o=()=>{},a=()=>{}){if(t._x_transitioning&&t._x_transitioning.cancel(),Object.keys(s).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){o(),a();return}let l,c,u;fi(t,{start(){l=n(t,r)},during(){c=n(t,s)},before:o,end(){l(),u=n(t,i)},after:a,cleanup(){c(),u()}})}function fi(t,n){let s,r,i,o=Gt(()=>{x(()=>{s=!0,r||n.before(),i||(n.end(),Lt()),n.after(),t.isConnected&&n.cleanup(),delete t._x_transitioning})});t._x_transitioning={beforeCancels:[],beforeCancel(a){this.beforeCancels.push(a)},cancel:Gt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()}),finish:o},x(()=>{n.start(),n.during()}),ii(),requestAnimationFrame(()=>{if(s)return;let a=Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,l=Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;a===0&&(a=Number(getComputedStyle(t).animationDuration.replace("s",""))*1e3),x(()=>{n.before()}),r=!0,requestAnimationFrame(()=>{s||(x(()=>{n.end()}),Lt(),setTimeout(t._x_transitioning.finish,a+l),i=!0)})})}function xe(t,n,s){if(t.indexOf(n)===-1)return s;const r=t[t.indexOf(n)+1];if(!r||n==="scale"&&isNaN(r))return s;if(n==="duration"||n==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return n==="origin"&&["top","right","left","center","bottom"].includes(t[t.indexOf(n)+2])?[r,t[t.indexOf(n)+2]].join(" "):r}var ne=!1;function ie(t,n=()=>{}){return(...s)=>ne?n(...s):t(...s)}function hi(t){return(...n)=>ne&&t(...n)}var As=[];function it(t){As.push(t)}function gi(t,n){As.forEach(s=>s(t,n)),ne=!0,Is(()=>{Y(n,(s,r)=>{r(s,()=>{})})}),ne=!1}var jt=!1;function pi(t,n){n._x_dataStack||(n._x_dataStack=t._x_dataStack),ne=!0,jt=!0,Is(()=>{mi(n)}),ne=!1,jt=!1}function mi(t){let n=!1;Y(t,(r,i)=>{ge(r,(o,a)=>{if(n&&ti(o))return a();n=!0,i(o,a)})})}function Is(t){let n=pe;In((s,r)=>{let i=n(s);return De(i),()=>{}}),t(),In(n)}function xs(t,n,s,r=[]){switch(t._x_bindings||(t._x_bindings=ve({})),t._x_bindings[n]=s,n=r.includes("camel")?ki(n):n,n){case"value":yi(t,s);break;case"style":Si(t,s);break;case"class":wi(t,s);break;case"selected":case"checked":_i(t,n,s);break;default:Os(t,n,s);break}}function yi(t,n){if(Ms(t))t.attributes.value===void 0&&(t.value=n),window.fromModel&&(typeof n=="boolean"?t.checked=We(t.value)===n:t.checked=Cn(t.value,n));else if(fn(t))Number.isInteger(n)?t.value=n:!Array.isArray(n)&&typeof n!="boolean"&&![null,void 0].includes(n)?t.value=String(n):Array.isArray(n)?t.checked=n.some(s=>Cn(s,t.value)):t.checked=!!n;else if(t.tagName==="SELECT")Di(t,n);else{if(t.value===n)return;t.value=n===void 0?"":n}}function wi(t,n){t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedClasses=dn(t,n)}function Si(t,n){t._x_undoAddedStyles&&t._x_undoAddedStyles(),t._x_undoAddedStyles=rt(t,n)}function _i(t,n,s){Os(t,n,s),vi(t,n,s)}function Os(t,n,s){[null,void 0,!1].includes(s)&&Ai(n)?t.removeAttribute(n):(Cs(n)&&(s=n),bi(t,n,s))}function bi(t,n,s){t.getAttribute(n)!=s&&t.setAttribute(n,s)}function vi(t,n,s){t[n]!==s&&(t[n]=s)}function Di(t,n){const s=[].concat(n).map(r=>r+"");Array.from(t.options).forEach(r=>{r.selected=s.includes(r.value)})}function ki(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function Cn(t,n){return t==n}function We(t){return[1,"1","true","on","yes",!0].includes(t)?!0:[0,"0","false","off","no",!1].includes(t)?!1:t?!!t:null}var Ei=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Cs(t){return Ei.has(t)}function Ai(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}function Ii(t,n,s){return t._x_bindings&&t._x_bindings[n]!==void 0?t._x_bindings[n]:Ts(t,n,s)}function xi(t,n,s,r=!0){if(t._x_bindings&&t._x_bindings[n]!==void 0)return t._x_bindings[n];if(t._x_inlineBindings&&t._x_inlineBindings[n]!==void 0){let i=t._x_inlineBindings[n];return i.extract=r,os(()=>de(t,i.expression))}return Ts(t,n,s)}function Ts(t,n,s){let r=t.getAttribute(n);return r===null?typeof s=="function"?s():s:r===""?!0:Cs(n)?!![n,"true"].includes(r):r}function fn(t){return t.type==="checkbox"||t.localName==="ui-checkbox"||t.localName==="ui-switch"}function Ms(t){return t.type==="radio"||t.localName==="ui-radio"}function $s(t,n){var s;return function(){var r=this,i=arguments,o=function(){s=null,t.apply(r,i)};clearTimeout(s),s=setTimeout(o,n)}}function Ps(t,n){let s;return function(){let r=this,i=arguments;s||(t.apply(r,i),s=!0,setTimeout(()=>s=!1,n))}}function Rs({get:t,set:n},{get:s,set:r}){let i=!0,o,a=pe(()=>{let l=t(),c=s();if(i)r(gt(l)),i=!1;else{let u=JSON.stringify(l),d=JSON.stringify(c);u!==o?r(gt(l)):u!==d&&n(gt(c))}o=JSON.stringify(t()),JSON.stringify(s())});return()=>{De(a)}}function gt(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t}function Oi(t){(Array.isArray(t)?t:[t]).forEach(s=>s(Le))}var ae={},Tn=!1;function Ci(t,n){if(Tn||(ae=ve(ae),Tn=!0),n===void 0)return ae[t];ae[t]=n,ss(ae[t]),typeof n=="object"&&n!==null&&n.hasOwnProperty("init")&&typeof n.init=="function"&&ae[t].init()}function Ti(){return ae}var Bs={};function Mi(t,n){let s=typeof n!="function"?()=>n:n;return t instanceof Element?Ls(t,s()):(Bs[t]=s,()=>{})}function $i(t){return Object.entries(Bs).forEach(([n,s])=>{Object.defineProperty(t,n,{get(){return(...r)=>s(...r)}})}),t}function Ls(t,n,s){let r=[];for(;r.length;)r.pop()();let i=Object.entries(n).map(([a,l])=>({name:a,value:l})),o=cs(i);return i=i.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),on(t,i,s).map(a=>{r.push(a.runCleanups),a()}),()=>{for(;r.length;)r.pop()()}}var Gs={};function Pi(t,n){Gs[t]=n}function Ri(t,n){return Object.entries(Gs).forEach(([s,r])=>{Object.defineProperty(t,s,{get(){return(...i)=>r.bind(n)(...i)},enumerable:!1})}),t}var Bi={get reactive(){return ve},get release(){return De},get effect(){return pe},get raw(){return Wn},version:"3.14.9",flushAndStopDeferringMutations:Gr,dontAutoEvaluateFunctions:os,disableEffectScheduling:Tr,startObservingMutations:tn,stopObservingMutations:ts,setReactivityEngine:Mr,onAttributeRemoved:Zn,onAttributesAdded:Xn,closestDataStack:_e,skipDuringClone:ie,onlyDuringClone:hi,addRootSelector:bs,addInitSelector:vs,interceptClone:it,addScopeToNode:Re,deferMutations:Lr,mapAttributes:an,evaluateLater:P,interceptInit:ni,setEvaluator:Vr,mergeProxies:Be,extractProp:xi,findClosest:Ee,onElRemoved:Xt,closestRoot:st,destroyTree:Ae,interceptor:rs,transition:Ft,setStyles:rt,mutateDom:x,directive:C,entangle:Rs,throttle:Ps,debounce:$s,evaluate:de,initTree:Y,nextTick:un,prefixed:ke,prefix:qr,plugin:Oi,magic:z,store:Ci,start:ei,clone:pi,cloneNode:gi,bound:Ii,$data:ns,watch:qn,walk:ge,data:Pi,bind:Mi},Le=Bi;function Li(t,n){const s=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)s[r[i]]=!0;return i=>!!s[i]}var Gi=Object.freeze({}),Fi=Object.prototype.hasOwnProperty,ot=(t,n)=>Fi.call(t,n),fe=Array.isArray,Me=t=>Fs(t)==="[object Map]",ji=t=>typeof t=="string",hn=t=>typeof t=="symbol",at=t=>t!==null&&typeof t=="object",Ni=Object.prototype.toString,Fs=t=>Ni.call(t),js=t=>Fs(t).slice(8,-1),gn=t=>ji(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Ui=t=>{const n=Object.create(null);return s=>n[s]||(n[s]=t(s))},zi=Ui(t=>t.charAt(0).toUpperCase()+t.slice(1)),Ns=(t,n)=>t!==n&&(t===t||n===n),Nt=new WeakMap,Oe=[],H,he=Symbol("iterate"),Ut=Symbol("Map key iterate");function Vi(t){return t&&t._isEffect===!0}function Ki(t,n=Gi){Vi(t)&&(t=t.raw);const s=qi(t,n);return n.lazy||s(),s}function Hi(t){t.active&&(Us(t),t.options.onStop&&t.options.onStop(),t.active=!1)}var Wi=0;function qi(t,n){const s=function(){if(!s.active)return t();if(!Oe.includes(s)){Us(s);try{return Yi(),Oe.push(s),H=s,t()}finally{Oe.pop(),zs(),H=Oe[Oe.length-1]}}};return s.id=Wi++,s.allowRecurse=!!n.allowRecurse,s._isEffect=!0,s.active=!0,s.raw=t,s.deps=[],s.options=n,s}function Us(t){const{deps:n}=t;if(n.length){for(let s=0;s<n.length;s++)n[s].delete(t);n.length=0}}var be=!0,pn=[];function Ji(){pn.push(be),be=!1}function Yi(){pn.push(be),be=!0}function zs(){const t=pn.pop();be=t===void 0?!0:t}function N(t,n,s){if(!be||H===void 0)return;let r=Nt.get(t);r||Nt.set(t,r=new Map);let i=r.get(s);i||r.set(s,i=new Set),i.has(H)||(i.add(H),H.deps.push(i),H.options.onTrack&&H.options.onTrack({effect:H,target:t,type:n,key:s}))}function se(t,n,s,r,i,o){const a=Nt.get(t);if(!a)return;const l=new Set,c=d=>{d&&d.forEach(h=>{(h!==H||h.allowRecurse)&&l.add(h)})};if(n==="clear")a.forEach(c);else if(s==="length"&&fe(t))a.forEach((d,h)=>{(h==="length"||h>=r)&&c(d)});else switch(s!==void 0&&c(a.get(s)),n){case"add":fe(t)?gn(s)&&c(a.get("length")):(c(a.get(he)),Me(t)&&c(a.get(Ut)));break;case"delete":fe(t)||(c(a.get(he)),Me(t)&&c(a.get(Ut)));break;case"set":Me(t)&&c(a.get(he));break}const u=d=>{d.options.onTrigger&&d.options.onTrigger({effect:d,target:t,key:s,type:n,newValue:r,oldValue:i,oldTarget:o}),d.options.scheduler?d.options.scheduler(d):d()};l.forEach(u)}var Qi=Li("__proto__,__v_isRef,__isVue"),Vs=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(hn)),Xi=Ks(),Zi=Ks(!0),Mn=eo();function eo(){const t={};return["includes","indexOf","lastIndexOf"].forEach(n=>{t[n]=function(...s){const r=E(this);for(let o=0,a=this.length;o<a;o++)N(r,"get",o+"");const i=r[n](...s);return i===-1||i===!1?r[n](...s.map(E)):i}}),["push","pop","shift","unshift","splice"].forEach(n=>{t[n]=function(...s){Ji();const r=E(this)[n].apply(this,s);return zs(),r}}),t}function Ks(t=!1,n=!1){return function(r,i,o){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_raw"&&o===(t?n?po:Js:n?go:qs).get(r))return r;const a=fe(r);if(!t&&a&&ot(Mn,i))return Reflect.get(Mn,i,o);const l=Reflect.get(r,i,o);return(hn(i)?Vs.has(i):Qi(i))||(t||N(r,"get",i),n)?l:zt(l)?!a||!gn(i)?l.value:l:at(l)?t?Ys(l):Sn(l):l}}var to=no();function no(t=!1){return function(s,r,i,o){let a=s[r];if(!t&&(i=E(i),a=E(a),!fe(s)&&zt(a)&&!zt(i)))return a.value=i,!0;const l=fe(s)&&gn(r)?Number(r)<s.length:ot(s,r),c=Reflect.set(s,r,i,o);return s===E(o)&&(l?Ns(i,a)&&se(s,"set",r,i,a):se(s,"add",r,i)),c}}function so(t,n){const s=ot(t,n),r=t[n],i=Reflect.deleteProperty(t,n);return i&&s&&se(t,"delete",n,void 0,r),i}function ro(t,n){const s=Reflect.has(t,n);return(!hn(n)||!Vs.has(n))&&N(t,"has",n),s}function io(t){return N(t,"iterate",fe(t)?"length":he),Reflect.ownKeys(t)}var oo={get:Xi,set:to,deleteProperty:so,has:ro,ownKeys:io},ao={get:Zi,set(t,n){return console.warn(`Set operation on key "${String(n)}" failed: target is readonly.`,t),!0},deleteProperty(t,n){return console.warn(`Delete operation on key "${String(n)}" failed: target is readonly.`,t),!0}},mn=t=>at(t)?Sn(t):t,yn=t=>at(t)?Ys(t):t,wn=t=>t,lt=t=>Reflect.getPrototypeOf(t);function Fe(t,n,s=!1,r=!1){t=t.__v_raw;const i=E(t),o=E(n);n!==o&&!s&&N(i,"get",n),!s&&N(i,"get",o);const{has:a}=lt(i),l=r?wn:s?yn:mn;if(a.call(i,n))return l(t.get(n));if(a.call(i,o))return l(t.get(o));t!==i&&t.get(n)}function je(t,n=!1){const s=this.__v_raw,r=E(s),i=E(t);return t!==i&&!n&&N(r,"has",t),!n&&N(r,"has",i),t===i?s.has(t):s.has(t)||s.has(i)}function Ne(t,n=!1){return t=t.__v_raw,!n&&N(E(t),"iterate",he),Reflect.get(t,"size",t)}function $n(t){t=E(t);const n=E(this);return lt(n).has.call(n,t)||(n.add(t),se(n,"add",t,t)),this}function Pn(t,n){n=E(n);const s=E(this),{has:r,get:i}=lt(s);let o=r.call(s,t);o?Ws(s,r,t):(t=E(t),o=r.call(s,t));const a=i.call(s,t);return s.set(t,n),o?Ns(n,a)&&se(s,"set",t,n,a):se(s,"add",t,n),this}function Rn(t){const n=E(this),{has:s,get:r}=lt(n);let i=s.call(n,t);i?Ws(n,s,t):(t=E(t),i=s.call(n,t));const o=r?r.call(n,t):void 0,a=n.delete(t);return i&&se(n,"delete",t,void 0,o),a}function Bn(){const t=E(this),n=t.size!==0,s=Me(t)?new Map(t):new Set(t),r=t.clear();return n&&se(t,"clear",void 0,void 0,s),r}function Ue(t,n){return function(r,i){const o=this,a=o.__v_raw,l=E(a),c=n?wn:t?yn:mn;return!t&&N(l,"iterate",he),a.forEach((u,d)=>r.call(i,c(u),c(d),o))}}function ze(t,n,s){return function(...r){const i=this.__v_raw,o=E(i),a=Me(o),l=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,u=i[t](...r),d=s?wn:n?yn:mn;return!n&&N(o,"iterate",c?Ut:he),{next(){const{value:h,done:g}=u.next();return g?{value:h,done:g}:{value:l?[d(h[0]),d(h[1])]:d(h),done:g}},[Symbol.iterator](){return this}}}}function Z(t){return function(...n){{const s=n[0]?`on key "${n[0]}" `:"";console.warn(`${zi(t)} operation ${s}failed: target is readonly.`,E(this))}return t==="delete"?!1:this}}function lo(){const t={get(o){return Fe(this,o)},get size(){return Ne(this)},has:je,add:$n,set:Pn,delete:Rn,clear:Bn,forEach:Ue(!1,!1)},n={get(o){return Fe(this,o,!1,!0)},get size(){return Ne(this)},has:je,add:$n,set:Pn,delete:Rn,clear:Bn,forEach:Ue(!1,!0)},s={get(o){return Fe(this,o,!0)},get size(){return Ne(this,!0)},has(o){return je.call(this,o,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Ue(!0,!1)},r={get(o){return Fe(this,o,!0,!0)},get size(){return Ne(this,!0)},has(o){return je.call(this,o,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Ue(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=ze(o,!1,!1),s[o]=ze(o,!0,!1),n[o]=ze(o,!1,!0),r[o]=ze(o,!0,!0)}),[t,s,n,r]}var[co,uo,_a,ba]=lo();function Hs(t,n){const s=t?uo:co;return(r,i,o)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(ot(s,i)&&i in r?s:r,i,o)}var fo={get:Hs(!1)},ho={get:Hs(!0)};function Ws(t,n,s){const r=E(s);if(r!==s&&n.call(t,r)){const i=js(t);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var qs=new WeakMap,go=new WeakMap,Js=new WeakMap,po=new WeakMap;function mo(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function yo(t){return t.__v_skip||!Object.isExtensible(t)?0:mo(js(t))}function Sn(t){return t&&t.__v_isReadonly?t:Qs(t,!1,oo,fo,qs)}function Ys(t){return Qs(t,!0,ao,ho,Js)}function Qs(t,n,s,r,i){if(!at(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&!(n&&t.__v_isReactive))return t;const o=i.get(t);if(o)return o;const a=yo(t);if(a===0)return t;const l=new Proxy(t,a===2?r:s);return i.set(t,l),l}function E(t){return t&&E(t.__v_raw)||t}function zt(t){return!!(t&&t.__v_isRef===!0)}z("nextTick",()=>un);z("dispatch",t=>Te.bind(Te,t));z("watch",(t,{evaluateLater:n,cleanup:s})=>(r,i)=>{let o=n(r),l=qn(()=>{let c;return o(u=>c=u),c},i);s(l)});z("store",Ti);z("data",t=>ns(t));z("root",t=>st(t));z("refs",t=>(t._x_refs_proxy||(t._x_refs_proxy=Be(wo(t))),t._x_refs_proxy));function wo(t){let n=[];return Ee(t,s=>{s._x_refs&&n.push(s._x_refs)}),n}var pt={};function Xs(t){return pt[t]||(pt[t]=0),++pt[t]}function So(t,n){return Ee(t,s=>{if(s._x_ids&&s._x_ids[n])return!0})}function _o(t,n){t._x_ids||(t._x_ids={}),t._x_ids[n]||(t._x_ids[n]=Xs(n))}z("id",(t,{cleanup:n})=>(s,r=null)=>{let i=`${s}${r?`-${r}`:""}`;return bo(t,i,n,()=>{let o=So(t,s),a=o?o._x_ids[s]:Xs(s);return r?`${s}-${a}-${r}`:`${s}-${a}`})});it((t,n)=>{t._x_id&&(n._x_id=t._x_id)});function bo(t,n,s,r){if(t._x_id||(t._x_id={}),t._x_id[n])return t._x_id[n];let i=r();return t._x_id[n]=i,s(()=>{delete t._x_id[n]}),i}z("el",t=>t);Zs("Focus","focus","focus");Zs("Persist","persist","persist");function Zs(t,n,s){z(n,r=>L(`You can't use [$${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}C("modelable",(t,{expression:n},{effect:s,evaluateLater:r,cleanup:i})=>{let o=r(n),a=()=>{let d;return o(h=>d=h),d},l=r(`${n} = __placeholder`),c=d=>l(()=>{},{scope:{__placeholder:d}}),u=a();c(u),queueMicrotask(()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let d=t._x_model.get,h=t._x_model.set,g=Rs({get(){return d()},set(w){h(w)}},{get(){return a()},set(w){c(w)}});i(g)})});C("teleport",(t,{modifiers:n,expression:s},{cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-teleport can only be used on a <template> tag",t);let i=Ln(s),o=t.content.cloneNode(!0).firstElementChild;t._x_teleport=o,o._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach(l=>{o.addEventListener(l,c=>{c.stopPropagation(),t.dispatchEvent(new c.constructor(c.type,c))})}),Re(o,{},t);let a=(l,c,u)=>{u.includes("prepend")?c.parentNode.insertBefore(l,c):u.includes("append")?c.parentNode.insertBefore(l,c.nextSibling):c.appendChild(l)};x(()=>{a(o,i,n),ie(()=>{Y(o)})()}),t._x_teleportPutBack=()=>{let l=Ln(s);x(()=>{a(t._x_teleport,l,n)})},r(()=>x(()=>{o.remove(),Ae(o)}))});var vo=document.createElement("div");function Ln(t){let n=ie(()=>document.querySelector(t),()=>vo)();return n||L(`Cannot find x-teleport element for selector: "${t}"`),n}var er=()=>{};er.inline=(t,{modifiers:n},{cleanup:s})=>{n.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,s(()=>{n.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore})};C("ignore",er);C("effect",ie((t,{expression:n},{effect:s})=>{s(P(t,n))}));function Vt(t,n,s,r){let i=t,o=c=>r(c),a={},l=(c,u)=>d=>u(c,d);if(s.includes("dot")&&(n=Do(n)),s.includes("camel")&&(n=ko(n)),s.includes("passive")&&(a.passive=!0),s.includes("capture")&&(a.capture=!0),s.includes("window")&&(i=window),s.includes("document")&&(i=document),s.includes("debounce")){let c=s[s.indexOf("debounce")+1]||"invalid-wait",u=Ze(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=$s(o,u)}if(s.includes("throttle")){let c=s[s.indexOf("throttle")+1]||"invalid-wait",u=Ze(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Ps(o,u)}return s.includes("prevent")&&(o=l(o,(c,u)=>{u.preventDefault(),c(u)})),s.includes("stop")&&(o=l(o,(c,u)=>{u.stopPropagation(),c(u)})),s.includes("once")&&(o=l(o,(c,u)=>{c(u),i.removeEventListener(n,o,a)})),(s.includes("away")||s.includes("outside"))&&(i=document,o=l(o,(c,u)=>{t.contains(u.target)||u.target.isConnected!==!1&&(t.offsetWidth<1&&t.offsetHeight<1||t._x_isShown!==!1&&c(u))})),s.includes("self")&&(o=l(o,(c,u)=>{u.target===t&&c(u)})),(Ao(n)||tr(n))&&(o=l(o,(c,u)=>{Io(u,s)||c(u)})),i.addEventListener(n,o,a),()=>{i.removeEventListener(n,o,a)}}function Do(t){return t.replace(/-/g,".")}function ko(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function Ze(t){return!Array.isArray(t)&&!isNaN(t)}function Eo(t){return[" ","_"].includes(t)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Ao(t){return["keydown","keyup"].includes(t)}function tr(t){return["contextmenu","click","mouse"].some(n=>t.includes(n))}function Io(t,n){let s=n.filter(o=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(o));if(s.includes("debounce")){let o=s.indexOf("debounce");s.splice(o,Ze((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.includes("throttle")){let o=s.indexOf("throttle");s.splice(o,Ze((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.length===0||s.length===1&&Gn(t.key).includes(s[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(o=>s.includes(o));return s=s.filter(o=>!i.includes(o)),!(i.length>0&&i.filter(a=>((a==="cmd"||a==="super")&&(a="meta"),t[`${a}Key`])).length===i.length&&(tr(t.type)||Gn(t.key).includes(s[0])))}function Gn(t){if(!t)return[];t=Eo(t);let n={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return n[t]=t,Object.keys(n).map(s=>{if(n[s]===t)return s}).filter(s=>s)}C("model",(t,{modifiers:n,expression:s},{effect:r,cleanup:i})=>{let o=t;n.includes("parent")&&(o=t.parentNode);let a=P(o,s),l;typeof s=="string"?l=P(o,`${s} = __placeholder`):typeof s=="function"&&typeof s()=="string"?l=P(o,`${s()} = __placeholder`):l=()=>{};let c=()=>{let g;return a(w=>g=w),Fn(g)?g.get():g},u=g=>{let w;a(b=>w=b),Fn(w)?w.set(g):l(()=>{},{scope:{__placeholder:g}})};typeof s=="string"&&t.type==="radio"&&x(()=>{t.hasAttribute("name")||t.setAttribute("name",s)});var d=t.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(t.type)||n.includes("lazy")?"change":"input";let h=ne?()=>{}:Vt(t,d,n,g=>{u(mt(t,n,g,c()))});if(n.includes("fill")&&([void 0,null,""].includes(c())||fn(t)&&Array.isArray(c())||t.tagName.toLowerCase()==="select"&&t.multiple)&&u(mt(t,n,{target:t},c())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=h,i(()=>t._x_removeModelListeners.default()),t.form){let g=Vt(t.form,"reset",[],w=>{un(()=>t._x_model&&t._x_model.set(mt(t,n,{target:t},c())))});i(()=>g())}t._x_model={get(){return c()},set(g){u(g)}},t._x_forceModelUpdate=g=>{g===void 0&&typeof s=="string"&&s.match(/\./)&&(g=""),window.fromModel=!0,x(()=>xs(t,"value",g)),delete window.fromModel},r(()=>{let g=c();n.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate(g)})});function mt(t,n,s,r){return x(()=>{if(s instanceof CustomEvent&&s.detail!==void 0)return s.detail!==null&&s.detail!==void 0?s.detail:s.target.value;if(fn(t))if(Array.isArray(r)){let i=null;return n.includes("number")?i=yt(s.target.value):n.includes("boolean")?i=We(s.target.value):i=s.target.value,s.target.checked?r.includes(i)?r:r.concat([i]):r.filter(o=>!xo(o,i))}else return s.target.checked;else{if(t.tagName.toLowerCase()==="select"&&t.multiple)return n.includes("number")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return yt(o)}):n.includes("boolean")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return We(o)}):Array.from(s.target.selectedOptions).map(i=>i.value||i.text);{let i;return Ms(t)?s.target.checked?i=s.target.value:i=r:i=s.target.value,n.includes("number")?yt(i):n.includes("boolean")?We(i):n.includes("trim")?i.trim():i}}})}function yt(t){let n=t?parseFloat(t):null;return Oo(n)?n:t}function xo(t,n){return t==n}function Oo(t){return!Array.isArray(t)&&!isNaN(t)}function Fn(t){return t!==null&&typeof t=="object"&&typeof t.get=="function"&&typeof t.set=="function"}C("cloak",t=>queueMicrotask(()=>x(()=>t.removeAttribute(ke("cloak")))));vs(()=>`[${ke("init")}]`);C("init",ie((t,{expression:n},{evaluate:s})=>typeof n=="string"?!!n.trim()&&s(n,{},!1):s(n,{},!1)));C("text",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.textContent=o})})})});C("html",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.innerHTML=o,t._x_ignoreSelf=!0,Y(t),delete t._x_ignoreSelf})})})});an(fs(":",hs(ke("bind:"))));var nr=(t,{value:n,modifiers:s,expression:r,original:i},{effect:o,cleanup:a})=>{if(!n){let c={};$i(c),P(t,r)(d=>{Ls(t,d,i)},{scope:c});return}if(n==="key")return Co(t,r);if(t._x_inlineBindings&&t._x_inlineBindings[n]&&t._x_inlineBindings[n].extract)return;let l=P(t,r);o(()=>l(c=>{c===void 0&&typeof r=="string"&&r.match(/\./)&&(c=""),x(()=>xs(t,n,c,s))})),a(()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()})};nr.inline=(t,{value:n,modifiers:s,expression:r})=>{n&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[n]={expression:r,extract:!1})};C("bind",nr);function Co(t,n){t._x_keyExpression=n}bs(()=>`[${ke("data")}]`);C("data",(t,{expression:n},{cleanup:s})=>{if(To(t))return;n=n===""?"{}":n;let r={};$t(r,t);let i={};Ri(i,r);let o=de(t,n,{scope:i});(o===void 0||o===!0)&&(o={}),$t(o,t);let a=ve(o);ss(a);let l=Re(t,a);a.init&&de(t,a.init),s(()=>{a.destroy&&de(t,a.destroy),l()})});it((t,n)=>{t._x_dataStack&&(n._x_dataStack=t._x_dataStack,n.setAttribute("data-has-alpine-state",!0))});function To(t){return ne?jt?!0:t.hasAttribute("data-has-alpine-state"):!1}C("show",(t,{modifiers:n,expression:s},{effect:r})=>{let i=P(t,s);t._x_doHide||(t._x_doHide=()=>{x(()=>{t.style.setProperty("display","none",n.includes("important")?"important":void 0)})}),t._x_doShow||(t._x_doShow=()=>{x(()=>{t.style.length===1&&t.style.display==="none"?t.removeAttribute("style"):t.style.removeProperty("display")})});let o=()=>{t._x_doHide(),t._x_isShown=!1},a=()=>{t._x_doShow(),t._x_isShown=!0},l=()=>setTimeout(a),c=Gt(h=>h?a():o(),h=>{typeof t._x_toggleAndCascadeWithTransitions=="function"?t._x_toggleAndCascadeWithTransitions(t,h,a,o):h?l():o()}),u,d=!0;r(()=>i(h=>{!d&&h===u||(n.includes("immediate")&&(h?l():o()),c(h),u=h,d=!1)}))});C("for",(t,{expression:n},{effect:s,cleanup:r})=>{let i=$o(n),o=P(t,i.items),a=P(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},s(()=>Mo(t,i,o,a)),r(()=>{Object.values(t._x_lookup).forEach(l=>x(()=>{Ae(l),l.remove()})),delete t._x_prevKeys,delete t._x_lookup})});function Mo(t,n,s,r){let i=a=>typeof a=="object"&&!Array.isArray(a),o=t;s(a=>{Po(a)&&a>=0&&(a=Array.from(Array(a).keys(),f=>f+1)),a===void 0&&(a=[]);let l=t._x_lookup,c=t._x_prevKeys,u=[],d=[];if(i(a))a=Object.entries(a).map(([f,p])=>{let m=jn(n,p,f,a);r(_=>{d.includes(_)&&L("Duplicate key on x-for",t),d.push(_)},{scope:{index:f,...m}}),u.push(m)});else for(let f=0;f<a.length;f++){let p=jn(n,a[f],f,a);r(m=>{d.includes(m)&&L("Duplicate key on x-for",t),d.push(m)},{scope:{index:f,...p}}),u.push(p)}let h=[],g=[],w=[],b=[];for(let f=0;f<c.length;f++){let p=c[f];d.indexOf(p)===-1&&w.push(p)}c=c.filter(f=>!w.includes(f));let S="template";for(let f=0;f<d.length;f++){let p=d[f],m=c.indexOf(p);if(m===-1)c.splice(f,0,p),h.push([S,f]);else if(m!==f){let _=c.splice(f,1)[0],O=c.splice(m-1,1)[0];c.splice(f,0,O),c.splice(m,0,_),g.push([_,O])}else b.push(p);S=p}for(let f=0;f<w.length;f++){let p=w[f];p in l&&(x(()=>{Ae(l[p]),l[p].remove()}),delete l[p])}for(let f=0;f<g.length;f++){let[p,m]=g[f],_=l[p],O=l[m],T=document.createElement("div");x(()=>{O||L('x-for ":key" is undefined or invalid',o,m,l),O.after(T),_.after(O),O._x_currentIfEl&&O.after(O._x_currentIfEl),T.before(_),_._x_currentIfEl&&_.after(_._x_currentIfEl),T.remove()}),O._x_refreshXForScope(u[d.indexOf(m)])}for(let f=0;f<h.length;f++){let[p,m]=h[f],_=p==="template"?o:l[p];_._x_currentIfEl&&(_=_._x_currentIfEl);let O=u[m],T=d[m],F=document.importNode(o.content,!0).firstElementChild,Q=ve(O);Re(F,Q,o),F._x_refreshXForScope=V=>{Object.entries(V).forEach(([y,B])=>{Q[y]=B})},x(()=>{_.after(F),ie(()=>Y(F))()}),typeof T=="object"&&L("x-for key cannot be an object, it must be a string or an integer",o),l[T]=F}for(let f=0;f<b.length;f++)l[b[f]]._x_refreshXForScope(u[d.indexOf(b[f])]);o._x_prevKeys=d})}function $o(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,s=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(r);if(!i)return;let o={};o.items=i[2].trim();let a=i[1].replace(s,"").trim(),l=a.match(n);return l?(o.item=a.replace(n,"").trim(),o.index=l[1].trim(),l[2]&&(o.collection=l[2].trim())):o.item=a,o}function jn(t,n,s,r){let i={};return/^\[.*\]$/.test(t.item)&&Array.isArray(n)?t.item.replace("[","").replace("]","").split(",").map(a=>a.trim()).forEach((a,l)=>{i[a]=n[l]}):/^\{.*\}$/.test(t.item)&&!Array.isArray(n)&&typeof n=="object"?t.item.replace("{","").replace("}","").split(",").map(a=>a.trim()).forEach(a=>{i[a]=n[a]}):i[t.item]=n,t.index&&(i[t.index]=s),t.collection&&(i[t.collection]=r),i}function Po(t){return!Array.isArray(t)&&!isNaN(t)}function sr(){}sr.inline=(t,{expression:n},{cleanup:s})=>{let r=st(t);r._x_refs||(r._x_refs={}),r._x_refs[n]=t,s(()=>delete r._x_refs[n])};C("ref",sr);C("if",(t,{expression:n},{effect:s,cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-if can only be used on a <template> tag",t);let i=P(t,n),o=()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let l=t.content.cloneNode(!0).firstElementChild;return Re(l,{},t),x(()=>{t.after(l),ie(()=>Y(l))()}),t._x_currentIfEl=l,t._x_undoIf=()=>{x(()=>{Ae(l),l.remove()}),delete t._x_currentIfEl},l},a=()=>{t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)};s(()=>i(l=>{l?o():a()})),r(()=>t._x_undoIf&&t._x_undoIf())});C("id",(t,{expression:n},{evaluate:s})=>{s(n).forEach(i=>_o(t,i))});it((t,n)=>{t._x_ids&&(n._x_ids=t._x_ids)});an(fs("@",hs(ke("on:"))));C("on",ie((t,{value:n,modifiers:s,expression:r},{cleanup:i})=>{let o=r?P(t,r):()=>{};t.tagName.toLowerCase()==="template"&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(n)||t._x_forwardEvents.push(n));let a=Vt(t,n,s,l=>{o(()=>{},{scope:{$event:l},params:[l]})});i(()=>a())}));ct("Collapse","collapse","collapse");ct("Intersect","intersect","intersect");ct("Focus","trap","focus");ct("Mask","mask","mask");function ct(t,n,s){C(n,r=>L(`You can't use [x-${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}Le.setEvaluator(ls);Le.setReactivityEngine({reactive:Sn,effect:Ki,release:Hi,raw:E});var Ro=Le,et=Ro;const Bo=(t,n)=>n.some(s=>t instanceof s);let Nn,Un;function Lo(){return Nn||(Nn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Go(){return Un||(Un=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rr=new WeakMap,Kt=new WeakMap,ir=new WeakMap,wt=new WeakMap,_n=new WeakMap;function Fo(t){const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",a)},o=()=>{s(te(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",a)});return n.then(s=>{s instanceof IDBCursor&&rr.set(s,t)}).catch(()=>{}),_n.set(n,t),n}function jo(t){if(Kt.has(t))return;const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",a),t.removeEventListener("abort",a)},o=()=>{s(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",a),t.addEventListener("abort",a)});Kt.set(t,n)}let Ht={get(t,n,s){if(t instanceof IDBTransaction){if(n==="done")return Kt.get(t);if(n==="objectStoreNames")return t.objectStoreNames||ir.get(t);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return te(t[n])},set(t,n,s){return t[n]=s,!0},has(t,n){return t instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in t}};function No(t){Ht=t(Ht)}function Uo(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...s){const r=t.call(St(this),n,...s);return ir.set(r,n.sort?n.sort():[n]),te(r)}:Go().includes(t)?function(...n){return t.apply(St(this),n),te(rr.get(this))}:function(...n){return te(t.apply(St(this),n))}}function zo(t){return typeof t=="function"?Uo(t):(t instanceof IDBTransaction&&jo(t),Bo(t,Lo())?new Proxy(t,Ht):t)}function te(t){if(t instanceof IDBRequest)return Fo(t);if(wt.has(t))return wt.get(t);const n=zo(t);return n!==t&&(wt.set(t,n),_n.set(n,t)),n}const St=t=>_n.get(t);function Vo(t,n,{blocked:s,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(t,n),l=te(a);return r&&a.addEventListener("upgradeneeded",c=>{r(te(a.result),c.oldVersion,c.newVersion,te(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{o&&c.addEventListener("close",()=>o()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const Ko=["get","getKey","getAll","getAllKeys","count"],Ho=["put","add","delete","clear"],_t=new Map;function zn(t,n){if(!(t instanceof IDBDatabase&&!(n in t)&&typeof n=="string"))return;if(_t.get(n))return _t.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,i=Ho.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Ko.includes(s)))return;const o=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&c.done]))[0]};return _t.set(n,o),o}No(t=>({...t,get:(n,s,r)=>zn(n,s)||t.get(n,s,r),has:(n,s)=>!!zn(n,s)||t.has(n,s)}));const bt="not-the-news-db",vt=29;let ee=null,ye=null;const Wo=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function tt(){if(ee)return ee;if(ye)return ye;ye=Vo(bt,vt,{upgrade(t,n){console.log(`[DB] Upgrading database from version ${n} to ${vt}`);const s=new Set(t.objectStoreNames);Wo.forEach(r=>{let i;s.has(r.name)&&t.deleteObjectStore(r.name),i=t.createObjectStore(r.name,{keyPath:r.keyPath,...r.options||{}}),console.log(`[DB] Created/Recreated store: ${r.name}`),r.indexes&&r.indexes.forEach(o=>{i.createIndex(o.name,o.keyPath,o.options||{}),console.log(`[DB] Created index '${o.name}' on store '${r.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return ee=await ye,console.log(`[DB] Opened '${bt}', version ${vt}`),ee}catch(t){throw console.error(`[DB] Failed to open database '${bt}':`,t),ee=null,ye=null,t}}async function or(){ee&&(ee.close(),ee=null,ye=null,console.log("[DB] Database connection closed."))}async function M(t){let n=await tt();return t(n)}const J=()=>navigator.onLine,Pe=window.location.origin;async function Ge(t,n,s){return M(async r=>{try{const i=s||new Date().toISOString();await r.put("userSettings",{key:t,value:n,lastModified:i})}catch(i){console.error(`[DB] Failed to save sync metadata for key '${t}':`,i)}})}async function qo(t){return M(async n=>{const s={...t};s.id&&delete s.id;try{const r=n.transaction("pendingOperations","readwrite"),i=await r.store.add(s);return await r.done,i}catch(r){throw console.error("[DB] Error buffering operation:",r),r}})}async function j(t){if(!t||typeof t.type!="string"||t.type==="simpleUpdate"&&(t.value===null||t.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",t);return}try{const n=await qo(t);console.log(`[DB] Operation buffered with ID: ${n}`,t);const{value:s}=await k("syncEnabled");if(J()&&s){console.log(`[DB] Attempting immediate sync for ${t.type} (ID: ${n}).`);const r=[{...t,id:n}],i=await fetch(`${Pe}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){const l=await i.text();throw new Error(`HTTP error ${i.status} for immediate sync. Details: ${l}`)}const o=await i.json(),a=o.results?.find(l=>l.id===n);a?.status==="success"?(await M(l=>l.delete("pendingOperations",n)),console.log(`[DB] Successfully synced and removed immediate op ${n} (${t.type}).`),o.serverTime&&await Ge("lastStateSync",o.serverTime),q()):console.warn(`[DB] Immediate sync for op ${n} reported non-success by server:`,a)}else console.log(`[DB] ${J()?"Sync is disabled.":"Offline."} Buffering op ${n} for later batch sync.`)}catch(n){console.error(`[DB] Network error during immediate sync for ${t.type}. Will retry with batch sync.`,n)}}async function le(){const{value:t}=await k("syncEnabled");if(!J()||!t){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const n=await M(s=>s.getAll("pendingOperations")).catch(s=>(console.error("[DB] Error fetching pending operations:",s),null));if(!n||n.length===0){n&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${n.length} batched operations to /api/user-state.`);try{const s=await fetch(`${Pe}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP error ${s.status}. Details: ${await s.text()}`);const r=await s.json();console.log("[DB] Batch sync successful. Server response:",r),r.results&&Array.isArray(r.results)?await M(async i=>{const o=i.transaction("pendingOperations","readwrite");for(const a of r.results)a.status==="success"&&a.id!==void 0?await o.store.delete(a.id):console.warn(`[DB] Op ${a.id??"N/A"} (${a.opType}) ${a.status}: ${a.reason||"N/A"}`);await o.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),r.serverTime&&await Ge("lastStateSync",r.serverTime),q()}catch(s){console.error("[DB] Error during batch synchronization:",s)}}let Dt=!1,Vn=0;const Jo=500;async function Kn(t,n,s=!1){if(!s&&(await M(u=>u.getAll("pendingOperations")).catch(()=>[])).some(u=>u.key===t||u.type==="starDelta"&&t==="starred"||u.type==="readDelta"&&t==="read"||u.type==="simpleUpdate"&&u.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${t}' because local changes are pending synchronization.`),{key:t,status:"skipped_pending"};const{value:r,lastModified:i}=n.type==="array"?await re(n.store):await k(t,n.store),o=i||"",a={"Content-Type":"application/json"};o&&!s&&(a["If-None-Match"]=o);try{const l=await fetch(`${Pe}/api/user-state/${t}`,{method:"GET",headers:a});if(l.status===304&&!s)return{key:t,status:304,timestamp:o};if(!l.ok)return console.error(`[DB] HTTP error for ${t}: ${l.status}`),{key:t,status:l.status};const c=await l.json();if(console.log(`[DB Sync] Received data for ${t}:`,c.value),n.type==="array"){const u=c.value||[],d=r||[],h=new Set(u.map(S=>S.guid)),g=new Set(d.map(S=>S.guid)),w=s?u:u.filter(S=>!g.has(S.guid)),b=s?[]:d.filter(S=>!h.has(S.guid));(w.length>0||b.length>0||s)&&await M(async S=>{const f=S.transaction(n.store,"readwrite");s&&await f.store.clear();for(const p of w)await f.store.put(p);for(const p of b)s||await f.store.delete(p.id);await f.done})}else await Ge(t,c.value,c.lastModified);return{key:t,status:200,timestamp:c.lastModified}}catch(l){return console.error(`[DB] Failed to pull ${t}:`,l),{key:t,status:"error"}}}async function q(t=!1){if(!J())return;let{value:n}=await k("syncEnabled");if(!n&&!t){console.log("[DB] Sync is disabled locally. Checking for remote status...");const r=U.syncEnabled;(await Kn("syncEnabled",r,!1)).status===200&&(n=(await k("syncEnabled")).value)}if(!n&&!t||Dt&&!t)return;const s=Date.now();if(!(!t&&s-Vn<Jo)){Vn=s,Dt=!0,console.log(`[DB] Pulling user state (force=${t})...`);try{const r=Object.entries(U).filter(([a,l])=>!l.localOnly&&a!=="syncEnabled"),o=(await Promise.all(r.map(([a,l])=>Kn(a,l,t)))).reduce((a,l)=>l?.timestamp&&l.timestamp>a?l.timestamp:a,"");o&&await Ge("lastStateSync",o)}catch(r){console.error("[DB] User state pull failed:",r)}finally{Dt=!1,console.log("[DB] User state pull completed.")}}}async function bn(){return M(t=>t.getAll("feedItems")).catch(t=>(console.error("Failed to get all feed items:",t),[]))}async function we(t){const{value:n}=await k("syncEnabled");if(!J()||!n)return n&&console.log("[DB] Offline. Skipping feed sync."),!0;console.log("[DB] Fetching feed items from server.");try{const{value:s}=await k("lastFeedSync"),r=await fetch(`${Pe}/api/feed-guids?since=${s||""}`);if(r.status===304)return console.log("[DB] Feed not modified."),!0;if(!r.ok)throw new Error(`HTTP error ${r.status} for /api/feed-guids`);const i=await r.json();console.log("[DB] /api/feed-guids response:",i);const{guids:o,serverTime:a}=i,l=new Set(o),c=await bn(),u=new Set(c.map(b=>b.guid)),d=[...l].filter(b=>!u.has(b));console.log(`[DB] GUIDs to fetch: ${d.length}`,d);const h=[...u].filter(b=>!l.has(b));console.log(`[DB] New GUIDs: ${d.length}, Deleting: ${h.length}`);const g=d.length;let w=0;if(d.length>0){const S=[];for(let f=0;f<d.length;f+=50){const p=d.slice(f,f+50),m=await fetch(`${Pe}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:p})});if(m.ok){const _=await m.json();console.log(`[DB] Fetched batch of ${_.length} items:`,_),S.push(..._),w+=_.length,t&&(t.progressMessage=`Fetching feed content... (${w}/${g})`)}else return console.error(`[DB] Failed to fetch a batch of feed items. Status: ${m.status}`),!1}await M(async f=>{const p=f.transaction("feedItems","readwrite");for(const m of S)m.guid&&await p.store.put(m);await p.done})}if(h.length>0){const b=new Map(c.map(S=>[S.guid,S.id]));await M(async S=>{const f=S.transaction("feedItems","readwrite");for(const p of h){const m=b.get(p);m!==void 0&&await f.store.delete(m)}await f.done})}return a&&await Ge("lastFeedSync",a),t?.loadFeedItemsFromDB?.(),t?.loadAndDisplayDeck?.(),t?.updateCounts?.(),!0}catch(s){return console.error("[DB] Failed to synchronize feed:",s),!1}}async function vn(t){const{value:n}=await k("syncEnabled");if(!J()||!n)return!0;console.log("[DB] Full sync initiated.");try{return await le(),await q(),await we(t)}catch(s){return console.error("[DB] Full sync failed:",s),!1}}const U={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},syncEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},theme:{store:"userSettings",type:"simple",localOnly:!1,default:"dark"},themeStyle:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleLight:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleDark:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},customCss:{store:"userSettings",type:"simple",localOnly:!1,default:""},fontSize:{store:"userSettings",type:"simple",localOnly:!0,default:100},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0},rssFeeds:{store:"userSettings",type:"simple",localOnly:!1,default:{}},keywordBlacklist:{store:"userSettings",type:"simple",localOnly:!1,default:[]},shuffleCount:{store:"userSettings",type:"simple",localOnly:!1,default:2},lastShuffleResetDate:{store:"userSettings",type:"simple",localOnly:!1,default:null},shadowsEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},pregeneratedOnlineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null},pregeneratedOfflineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null}};async function k(t,n="userSettings"){return M(async s=>{try{const r=await s.get(n,t);return{value:r?r.value:U[t]?.default||null,lastModified:r?.lastModified||null}}catch(r){return console.error(`Failed to load simple state for key '${t}':`,r),{value:U[t]?.default||null,lastModified:null}}})}async function G(t,n,s="userSettings"){await M(i=>i.put(s,{key:t,value:n,lastModified:new Date().toISOString()}));const r=U[t];r&&!r.localOnly&&await j({type:"simpleUpdate",key:t,value:n,timestamp:new Date().toISOString()})}const ar=t=>{switch(t){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function re(t){return console.log(`ENTERING loadArrayState for ${t}`),M(async n=>{try{const s=await n.getAll(t);if(s.length>0&&(typeof s[0]=="string"||s[0].id===void 0)){console.log(`[DB] Migration required for '${t}'.`);const i=ar(t),o=new Date().toISOString(),a=new Map;s.forEach(d=>{const h=typeof d=="string"?d:d.guid;h&&!a.has(h)&&a.set(h,d)});const c=Array.from(a.values()).map(d=>({guid:typeof d=="string"?d:d.guid,[i]:o})),u=n.transaction(t,"readwrite");await u.store.clear();for(const d of c)await u.store.put(d);return await u.done,console.log(`[DB] Migration complete for '${t}'.`),{value:await n.getAll(t)}}return{value:s||U[t]?.default||[]}}catch(s){return console.error(`Failed to load array state from store '${t}':`,s),{value:U[t]?.default||[]}}})}async function lr(t,n){return M(s=>s.getFromIndex(t,"guid",n)).catch(s=>{console.error(`Error finding item by GUID '${n}' in store '${t}':`,s)})}async function Dn(t,n,s){await M(async i=>{const o=i.transaction(t,"readwrite");if(!n||!n.guid){console.error("[DB] updateArrayState requires an item with a guid property.",n);return}const a=o.objectStore(t);if(s)await a.put(n);else{const l=await a.index("guid").get(n.guid);l?.id!==void 0&&await a.delete(l.id)}await o.done});const r=Object.entries(U).find(([,i])=>i.store===t);if(r&&!r[1].localOnly){let i="";t==="starred"&&(i="starDelta"),t==="read"&&(i="readDelta"),i&&await j({type:i,guid:n.guid,action:s?"add":"remove",timestamp:n[ar(t)]||new Date().toISOString()})}}async function ut(t,n){const{value:s}=await re(t),r=new Set(s.map(u=>u.guid));await me(t,n);const i=new Set(n.map(u=>u.guid)),o=[...r].filter(u=>!i.has(u)),a=[...i].filter(u=>!i.has(u)),l=Object.entries(U).find(([,u])=>u.store===t);if(!l||l[1].localOnly)return;let c="";if(t==="starred"&&(c="starDelta"),t==="read"&&(c="readDelta"),!c){await j({type:"simpleUpdate",key:l[0],value:n,timestamp:new Date().toISOString()});return}if(o.length>0){console.log(`[DB] Queuing ${o.length} 'remove' operations for '${t}'.`);for(const u of o)await j({type:c,guid:u,action:"remove",timestamp:new Date().toISOString()})}if(a.length>0){console.log(`[DB] Queuing ${a.length} 'add' operations for '${t}'.`);for(const u of a)await j({type:c,guid:u,action:"add",timestamp:new Date().toISOString()})}}async function cr(t,n){if(!Array.isArray(t)||!Array.isArray(n)){console.warn("[DB] pruneStaleReadItems skipped due to invalid input.");return}const s=new Set(n.map(a=>a.guid)),r=720*60*60*1e3,i=Date.now(),o=t.filter(a=>{if(s.has(a.guid))return!0;const l=new Date(a.readAt).getTime();return i-l<r});if(o.length<t.length){const a=t.length-o.length;console.log(`[DB] Pruning ${a} stale read items.`),await ut("read",o)}else console.log("[DB] No stale read items to prune.")}async function me(t,n){return M(async s=>{const r=s.transaction(t,"readwrite");await r.store.clear();for(const i of n){const o=JSON.parse(JSON.stringify(i));delete o.id,await r.store.put(o)}await r.done})}const W=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,findByGuid:lr,loadArrayState:re,loadSimpleState:k,overwriteArrayAndSyncChanges:ut,pruneStaleReadItems:cr,queueAndAttemptSyncOperation:j,saveArrayState:me,saveSimpleState:G,updateArrayState:Dn},Symbol.toStringTag,{value:"Module"})),Yo=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,closeDb:or,findByGuid:lr,getAllFeedItems:bn,initDb:tt,loadArrayState:re,loadSimpleState:k,overwriteArrayAndSyncChanges:ut,performFeedSync:we,performFullSync:vn,processPendingOperations:le,pruneStaleReadItems:cr,pullUserState:q,queueAndAttemptSyncOperation:j,saveArrayState:me,saveSimpleState:G,updateArrayState:Dn,withDb:M},Symbol.toStringTag,{value:"Module"}));function Wt(t){const n=new Date,s=new Date(t),r=Math.floor((n.getTime()-s.getTime())/1e3),i=336*60*60;if(r>i)return s.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const o=Math.floor(r/60),a=Math.floor(o/60),l=Math.floor(a/24);if(r<60)return"Just now";if(o<60)return`${o} minute${o!==1?"s":""} ago`;if(a<24)return`${a} hour${a!==1?"s":""} ago`;if(l<7)return`${l} day${l!==1?"s":""} ago`;const c=Math.floor(l/7);return`${c} week${c!==1?"s":""} ago`}function qt(t){for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}return t}function qe(t){const n=[];if(!t)return n;if(Array.isArray(t))t.forEach(s=>{typeof s=="string"&&s.trim()?n.push(s.trim()):s&&typeof s=="object"&&s.url&&n.push(s.url.trim())});else if(typeof t=="object")for(const s in t){const r=t[s];if(r&&typeof r=="object")for(const i in r){const o=r[i];Array.isArray(o)&&o.forEach(a=>{a&&a.url&&n.push(a.url.trim())})}}return n}function kn(t,n){if(!t)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const r=new DOMParser().parseFromString(t.description||"","text/html"),i=r.querySelectorAll("img");let o="";if(i.length===1){const d=i[0];d.classList.add("title-image"),o=d.src||"",d.remove()}else i.forEach(d=>{d.setAttribute("loading","lazy"),d.setAttribute("onload","this.classList.add('loaded')")});let a="";const l=r.querySelector(".source-url")||r.querySelector("a");l?(a=l.textContent?.trim()||"",l.remove()):a=t.link?new URL(t.link).hostname:"";const c=r.body.innerHTML.trim(),u=Date.parse(t.pubDate)||0;return{guid:t.guid,image:o,title:t.title,link:t.link,pubDate:n(t.pubDate||""),description:c,source:a,timestamp:u}}function ur(t,n){if(console.log(`ENTERING mapRawItems. rawList length: ${t.length}`),!Array.isArray(t))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const s=t.map(r=>kn(r,n)).filter(r=>r!==null).sort((r,i)=>i.timestamp-r.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${s.length}`),s}async function dr(t,n,s,r,i){console.log("ENTERING generateNewDeck with filterMode:",i),console.log("generateNewDeck: allFeedItems count:",t.length),console.log("generateNewDeck: readItems count:",n.length);try{const a=f=>{if(!Array.isArray(f))return new Set;const p=f.map(m=>typeof m=="object"&&"guid"in m&&m.guid?m.guid:m);return new Set(p.filter(m=>typeof m=="string"&&!!m))},l=new Set(t.map(f=>f.guid)),c=new Set([...a(n)].filter(f=>l.has(f))),u=new Set([...a(s)].filter(f=>l.has(f))),d=new Set([...a(r)].filter(f=>l.has(f)));console.log(`[generateNewDeck] readGuidsSet size: ${c.size}`),console.log(`[generateNewDeck] shuffledOutGuidsSet size: ${d.size}`);let h=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${h.length}`),i){case"read":h=t.filter(f=>c.has(f.guid));break;case"starred":h=t.filter(f=>u.has(f.guid));break;default:h=t.filter(f=>!c.has(f.guid)&&!d.has(f.guid)),h.length===0&&(console.log("generateNewDeck: No unread/unshuffled items found, trying all unshuffled items."),h=t.filter(f=>!d.has(f.guid))),h.length===0&&(console.log("generateNewDeck: No unshuffled items found, trying all unread items."),h=t.filter(f=>!c.has(f.guid))),h.length===0&&(console.log("generateNewDeck: Absolutely no filter matches, using all items."),h=[...t]);break}if(console.log("generateNewDeck: Final filteredItems count:",h.length),i==="read"||i==="starred")return h.sort((f,p)=>p.timestamp-f.timestamp),console.log(`[generateNewDeck] Filtered items for ${i}: ${h.length}`),h;let g=[];const w=new Set,b=f=>g.length<10&&f&&!w.has(f.guid)?(g.push(f),w.add(f.guid),!0):!1,S=(f,p)=>{let m=0;for(const _ of f){if(m>=p||g.length>=10)break;b(_)&&m++}};if(navigator.onLine){const f=Date.now(),p=I=>/<a\s+href=/i.test(I.description),m=I=>I.title?.includes("?"),_=I=>I.description?.length>=150&&I.description.substring(0,150).includes("?"),O=I=>{const R=I.description;return R?.length>=150&&R.substring(R.length-150).includes("?")},T=I=>I.image!=="",F=I=>I.description?.length>=750,Q=I=>I.description?.length<750,V=h.filter(I=>f-I.timestamp<=1440*60*1e3);S(V,2),console.log(`[generateNewDeck] After recentItems: ${g.length}`);const y=h.filter(p);S(y,1),console.log(`[generateNewDeck] After itemsWithLinks: ${g.length}`);const B=h.filter(m);S(B,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${g.length}`);const A=h.filter(_);S(A,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${g.length}`);const K=h.filter(O);S(K,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${g.length}`);const D=h.filter(T);S(D,1),console.log(`[generateNewDeck] After itemsWithImages: ${g.length}`);const ft=h.filter(F);S(ft,1),console.log(`[generateNewDeck] After longItems: ${g.length}`);const oe=h.filter(Q);S(oe,1),console.log(`[generateNewDeck] After shortItems: ${g.length}`);const br=h.filter(I=>!w.has(I.guid)),vr=qt([...br]);for(const I of vr){if(g.length>=10)break;b(I)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${g.length}`),g.length<10){const I=t.filter(R=>d.has(R.guid)&&!c.has(R.guid)&&!w.has(R.guid));I.sort((R,X)=>R.timestamp-X.timestamp);for(const R of I){if(g.length>=10)break;b(R)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${g.length}`),g.length<10){const R=t.filter(X=>!w.has(X.guid));R.sort((X,Dr)=>X.timestamp-Dr.timestamp);for(const X of R){if(g.length>=10)break;g.push(X),w.add(X.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${g.length}`)}}}else{let f=[...h];const p=y=>y.title?.includes("?"),m=y=>y.description?.length>=150&&y.description.substring(0,150).includes("?"),_=y=>{const B=y.description;return B?.length>=150&&B.substring(B.length-150).includes("?")},O=y=>/<a\s+href=/i.test(y.description),T=y=>y.image!=="";if(f=f.filter(y=>!p(y)),f=f.filter(y=>!(y.description&&m(y))),f=f.filter(y=>!(y.description&&_(y))),f=f.filter(y=>!O(y)),f=f.filter(y=>!T(y)),f.length<10){let y=h.filter(A=>!f.includes(A));const B=[A=>T(A),A=>O(A),A=>A.description&&_(A),A=>A.description&&m(A),A=>p(A)];for(const A of B){for(;f.length<10;){const K=y.find(A);if(K)f.push(K),y=y.filter(D=>D!==K);else break}if(f.length>=10)break}for(;f.length<10&&y.length>0;)f.push(y.shift())}const F=Date.now();g=f.filter(y=>F-y.timestamp<=1440*60*1e3).slice(0,2);const V=f.filter(y=>!g.includes(y));g=g.concat(V.slice(0,10-g.length))}return qt([...g])}catch(o){return console.error("An error occurred during deck generation:",o),[]}}const Qo=Object.freeze(Object.defineProperty({__proto__:null,formatDate:Wt,generateNewDeck:dr,mapRawItem:kn,mapRawItems:ur,parseRssFeedsConfig:qe,shuffleArray:qt},Symbol.toStringTag,{value:"Module"}));function Jt(t){if(typeof structuredClone=="function")try{return structuredClone(t)}catch(s){console.error("structuredClone failed, falling back to manual sanitization.",s)}const n={};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s];typeof r=="object"&&r!==null?Array.isArray(r)?n[s]=r.map(i=>Jt(i)):n[s]=Jt(r):typeof r!="function"&&(n[s]=r)}return n}async function Yt(t,n,s){const i=t[s].some(u=>u.guid===n)?"remove":"add",o=new Date().toISOString(),a=s==="read"?{guid:n,readAt:o}:{guid:n,starredAt:o};await Dn(s,a,i==="add"),i==="add"?s==="read"?t.read=[...t.read,a]:t.starred=[...t.starred,a]:s==="read"?t.read=t.read.filter(u=>u.guid!==n):t.starred=t.starred.filter(u=>u.guid!==n),typeof t.updateCounts=="function"&&t.updateCounts();const c={type:`${s}Delta`,guid:n,action:i,timestamp:o};await j(c)}async function fr(t,n,s){if(!Array.isArray(n))return[];if(!Array.isArray(t)||t.length===0)return n;const r=new Set(t.filter(o=>o&&o.guid).map(o=>String(o.guid).trim().toLowerCase())),i=720*60*60*1e3;return n.filter(o=>{if(!o||!o.guid)return!1;const a=String(o.guid).trim().toLowerCase();if(r.has(a))return!0;if(o.readAt){const l=new Date(o.readAt).getTime();if(!isNaN(l))return s-l<i}return!0})}async function hr(t){const{value:n}=await re("read");let s=!1,r=[];if(Array.isArray(n)){const o=new Date().toISOString();for(const a of n)typeof a=="string"&&a?(r.push({guid:a,readAt:o}),s=!0):typeof a=="object"&&a!==null&&typeof a.guid=="string"&&a.guid&&(a.readAt||(a.readAt=o,s=!0),r.push(a))}const i=await fr(t,r,Date.now());if(i.length!==r.length&&(s=!0),s)try{await me("read",i),console.log(`Sanitized, pruned, or migrated read items. Original count: ${n.length}, New count: ${i.length}`)}catch(o){console.error("Error saving pruned read items:",o)}return i}async function gr(){const{value:t}=await re("currentDeckGuids");if(t&&t.length>0&&typeof t[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const s=new Date().toISOString(),r=t.map(i=>({guid:i,addedAt:s}));return await me("currentDeckGuids",r),console.log(`[loadCurrentDeck] Migration complete. Loaded ${r.length} objects.`),r}const n=Array.isArray(t)?t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid):[];return console.log(`[loadCurrentDeck] Loaded ${n.length} deck objects.`),n}async function pr(t){if(!Array.isArray(t)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const n=t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid);n.length!==t.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",n.length,"deck objects.");try{const s=n.map(r=>Jt(r));await ut("currentDeckGuids",s)}catch(s){console.error("[saveCurrentDeck] An error occurred while saving the deck:",s)}}async function mr(){const{value:t}=await k("shuffleCount"),{value:n}=await k("lastShuffleResetDate");return{shuffleCount:typeof t=="number"?t:2,lastShuffleResetDate:n||null}}async function nt(t,n){await G("shuffleCount",t),await G("lastShuffleResetDate",n),await j({type:"simpleUpdate",key:"shuffleCount",value:t,timestamp:new Date().toISOString()}),await j({type:"simpleUpdate",key:"lastShuffleResetDate",value:n,timestamp:new Date().toISOString()})}async function yr(t,n){t.filterMode=n,await G("filterMode",n),await j({type:"simpleUpdate",key:"filterMode",value:n,timestamp:new Date().toISOString()})}async function wr(){const{value:t}=await k("filterMode");return t||"unread"}const Qt=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:hr,loadCurrentDeck:gr,loadFilterMode:wr,loadShuffleState:mr,pruneStaleRead:fr,saveCurrentDeck:pr,saveShuffleState:nt,setFilterMode:yr,toggleItemStateAndSync:Yt},Symbol.toStringTag,{value:"Module"})),Xo=()=>document.getElementById("sync-toggle"),Zo=()=>document.getElementById("images-toggle"),ea=()=>document.getElementById("open-urls-in-new-tab-toggle"),ta=()=>document.getElementById("shadows-toggle"),na=()=>document.getElementById("shuffle-count-display"),sa=()=>document.getElementById("filter-selector"),ra=()=>document.querySelector("#ntn-title h2");function ia(t,n=30){const s=t.split(" ");let r=[],i=[],o=0;for(const a of s){const l=a.length+(r.length>0?1:0);o+l<=n?(r.push(a),o+=l):i.push(a)}return[r.join(" "),i.join(" ")].filter(Boolean)}async function oa(t){const n=ra();if(!n){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const s="NOT THE NEWS",r=ia(t),i=n.style.overflow;n.style.overflow="visible";const o=a=>new Promise(l=>setTimeout(l,a));r.length>0&&(n.textContent=r[0],await o(1500)),r.length>1?(n.textContent=r.join(" "),await o(1500)):r.length===1&&await o(1500),n.textContent=s,n.style.overflow=i}let kt;function v(t,n){console.log(`[Status] ${n}`),kt&&clearTimeout(kt),t.syncStatusMessage=n;const s=()=>{t.showSyncStatus=!0,kt=setTimeout(()=>{t.showSyncStatus=!1,setTimeout(()=>{t.showSyncStatus||(t.syncStatusMessage="")},300)},5e3)};t.$nextTick?t.$nextTick(s):s()}let Et;function aa(t,n,s=null){Et&&clearTimeout(Et),t.undoItemGuid=n,t.undoItemIndex=s,t.showUndo=!0,t.undoTimerActive=!1;const r=()=>{t.undoTimerActive=!0,Et=setTimeout(()=>{t.showUndo=!1,t.undoTimerActive=!1,setTimeout(()=>{t.showUndo||(t.undoItemGuid=null)},500)},5e3)};t.$nextTick?t.$nextTick(r):setTimeout(r,10)}function Hn(t){const n=document.getElementById("main-settings"),s=document.getElementById("rss-settings-block"),r=document.getElementById("keywords-settings-block"),i=document.getElementById("css-settings-block"),o=document.getElementById("advanced-settings-block");if(!n||!s||!r||!i||!o)return console.warn("One or more settings panels not found."),Promise.resolve();switch(n.style.display="none",s.style.display="none",r.style.display="none",i.style.display="none",o.style.display="none",t.modalView){case"main":n.style.display="block";break;case"rss":s.style.display="block";break;case"keywords":r.style.display="block";break;case"css":i.style.display="block";break;case"advanced":o.style.display="block";break;default:console.warn("Unknown modalView:",t.modalView),n.style.display="block"}return Promise.resolve()}async function la(t){if(!t?.entries?.length||!t.read||!t.starred||!t.currentDeckGuids){console.warn("Attempted to update counts with an invalid app object. Skipping.");return}const n=new Set(t.read.map(h=>h.guid)),s=new Set(t.starred.map(h=>h.guid)),r=new Set(t.currentDeckGuids.map(h=>h.guid)),i=t.entries,o=i.length,a=i.filter(h=>n.has(h.guid)).length,l=i.filter(h=>s.has(h.guid)).length,c=i.filter(h=>r.has(h.guid)&&!n.has(h.guid)).length,u=sa();if(!u)return;const d={all:o,read:a,starred:l,unread:c};Array.from(u.options).forEach(h=>{const g=h.text.split(" ")[0];h.text=`${g} (${d[h.value]??0})`})}function Sr(){window.scrollTo({top:0,behavior:"smooth"})}const ca=(()=>{let t,n=0;return(s="scroll-to-top")=>{const r=document.getElementById(s);if(!r)return;const i=()=>{const o=window.scrollY;r.classList.toggle("visible",o<n&&o>0),n=o,clearTimeout(t),t=setTimeout(()=>r.classList.remove("visible"),2e3)};window.addEventListener("scroll",i),r.addEventListener("click",o=>{o.preventDefault(),Sr()})}})();async function At(){let t="",n=0;const s=document.querySelectorAll(".entry[data-guid]"),r=Array.from(s).find(i=>i.getBoundingClientRect().bottom>0);if(r){const i=r.getBoundingClientRect();t=r.dataset.guid||"",n=i.top}await G("lastViewedItemId",t),await G("lastViewedItemOffset",n)}const ua={syncEnabled:"Auto-Sync",imagesEnabled:"Images",openUrlsInNewTabEnabled:"Open in New Tab",shadowsEnabled:"Shadows"};async function dt(t,n,s,r=()=>{}){const i=n();i&&i.addEventListener("change",async()=>{const o=t[s];await G(s,o);const a=ua[s]||s;v(t,`${a} ${o?"Enabled":"Disabled"}.`),r(o)})}async function da(t){await dt(t,Xo,"syncEnabled",async n=>{if(t.updateSyncStatusMessage?.(),n&&(v(t,"Kicking off a new sync"),console.log("Sync enabled, triggering full sync."),await vn(t)?v(t,"Sync complete!"):v(t,"Sync finished with some issues."),!t.currentDeckGuids?.length&&t.entries?.length)){console.log("Deck is empty after sync. Rebuilding from all available items.");const r=new Date().toISOString(),i=new Set(t.read?.map(a=>a.guid)),o=new Set(t.shuffledOutGuids?.map(a=>a.guid));t.currentDeckGuids=t.entries.filter(a=>!i.has(a.guid)&&!o.has(a.guid)).map(a=>({guid:a.guid,addedAt:r})),await me("currentDeckGuids",t.currentDeckGuids),console.log(`Rebuilt deck with ${t.currentDeckGuids.length} items.`)}})}async function fa(t){await dt(t,Zo,"imagesEnabled")}async function ha(t){await dt(t,ta,"shadowsEnabled")}async function ga(t){await dt(t,ea,"openUrlsInNewTabEnabled")}async function pa(t){window.requestAnimationFrame(async()=>{const{value:n}=await k("lastViewedItemId"),{value:s}=await k("lastViewedItemOffset");if(!n||!t.deck?.length)return;if(t.deck.some(i=>i.guid===n)){const i=document.querySelector(`.entry[data-guid="${n}"]`);i&&(i.scrollIntoView({behavior:"auto",block:"start"}),typeof s=="number"&&s!==0&&window.scrollTo({top:window.scrollY-s,behavior:"auto"}))}})}let Ve;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),Ve=t;const n=document.getElementById("install-button");n&&(n.style.display="block",n.addEventListener("click",()=>{Ve.prompt(),Ve.userChoice.then(s=>{s.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),Ve=null})}))});const Ke=2,Se=t=>typeof t=="object"&&t.guid?t.guid:t,Je=async(t,n,s,r,i,o="unread",a=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:t.length,readItemsCount:n.length,starredItemsCount:s.length,shuffledOutItemsCount:r.length,shuffleCount:i,filterMode:o,lastShuffleResetDate:a}),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),!Array.isArray(t)||t.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),console.log("manageDailyDeck: END (skipped)"),{deck:[],currentDeckGuids:[],shuffledOutGuids:Array.isArray(r)?r:[],shuffleCount:typeof i=="number"?i:Ke,lastShuffleResetDate:typeof a=="string"?a:new Date().toDateString()};const l=t,c=Array.isArray(n)?n:[],u=Array.isArray(s)?s:[],d=Array.isArray(r)?r:[],{loadCurrentDeck:h}=await $(async()=>{const{loadCurrentDeck:D}=await Promise.resolve().then(()=>Qt);return{loadCurrentDeck:D}},void 0),g=await h();console.log("manageDailyDeck: Loaded currentDeckItems count:",g.length);const w=new Set(c.map(Se)),b=new Set(u.map(Se)),S=new Set(d.map(Se)),f=new Map(t.map(D=>[D.guid,D]));let p=g.map(D=>f.get(Se(D))).filter(D=>!!D);const m=new Date().toDateString(),_=a!==m,O=!g||g.length===0||p.length===0,T=O||p.every(D=>w.has(D.guid)||S.has(D.guid)),F=!O&&p.every(D=>w.has(D.guid)),Q=!O&&p.every(D=>S.has(D.guid));console.log("manageDailyDeck: Deck Status:",{isDeckEmpty:O,isDeckEffectivelyEmpty:T,allItemsInDeckRead:F,allItemsInDeckShuffled:Q,existingDeckCount:p.length,currentDeckItemsCount:g.length});let V=p,y=g,B=d,A=typeof i=="number"?i:Ke,K=a||m;if(console.log("manageDailyDeck: Condition check:",{isNewDay:_,isDeckEffectivelyEmpty:T,filterModeIsNotUnread:o!=="unread",entriesCount:t.length}),_||T||o!=="unread"||g.length===0&&t.length>0){console.log(`[deckManager] Resetting deck. Reason: New Day (${_}), Deck Effectively Empty (${T}), Filter Mode Changed (${o}), or Initial Load (${g.length===0}).`),!_&&g.length>0&&T&&o==="unread"&&(Q||(console.log("[deckManager] Automatically incrementing (refunding) shuffleCount due to deck cleared by reading."),A++,await nt(A,K)));const D=await dr(l,c,u,d,o);console.log("manageDailyDeck: generateNewDeck returned count:",D.length);const ft=new Date().toISOString();y=(D||[]).map(oe=>({guid:oe.guid,addedAt:ft})),V=(D||[]).map(oe=>({...oe,isRead:w.has(oe.guid),isStarred:b.has(oe.guid)})),await pr(y),_&&(B=[],await me("shuffledOutGuids",[]),A=Ke,await nt(A,m),K=m,await G("lastShuffleResetDate",m))}else V=p.map(D=>({...D,isRead:w.has(D.guid),isStarred:b.has(D.guid)}));return console.log(`[deckManager] Deck management complete. Final deck size: ${V.length}.`),console.log("manageDailyDeck: END"),{deck:V||[],currentDeckGuids:y||[],shuffledOutGuids:B||[],shuffleCount:typeof A=="number"?A:Ke,lastShuffleResetDate:typeof K=="string"?K:new Date().toDateString()}};async function ma(t){if(console.log("[deckManager] processShuffle called."),t.shuffleCount<=0){v(t,"No shuffles left for today!");return}const n=t.deck.map(d=>d.guid);console.log(`[deckManager] processShuffle: Visible GUIDs to shuffle out: ${n.length}`,n);const s=(t.shuffledOutGuids||[]).map(Se).map(d=>({guid:d,shuffledAt:new Date().toISOString()})),r=new Set(s.map(Se)),i=new Set([...r,...n]),o=new Date().toISOString(),a=Array.from(i).map(d=>({guid:d,shuffledAt:o}));t.shuffledOutGuids=a,t.shuffleCount--;const{overwriteArrayAndSyncChanges:l}=await $(async()=>{const{overwriteArrayAndSyncChanges:d}=await Promise.resolve().then(()=>W);return{overwriteArrayAndSyncChanges:d}},void 0);await l("shuffledOutGuids",a),await nt(t.shuffleCount,t.lastShuffleResetDate??new Date().toDateString());const c=na();c&&(c.textContent=t.shuffleCount.toString());const u=await Je(t.entries,t.read,t.starred,t.shuffledOutGuids,t.shuffleCount,t.filterMode,t.lastShuffleResetDate);t.deck=u.deck,t.currentDeckGuids=u.currentDeckGuids,t.shuffledOutGuids=u.shuffledOutGuids,t.shuffleCount=u.shuffleCount,t.lastShuffleResetDate=u.lastShuffleResetDate,oa("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${t.shuffleCount}.`)}async function _r(t,n){const s=t.target;if(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable)return;const i=t.key,o=t.ctrlKey||t.metaKey;if(n.openShortcuts&&i!=="?"&&i!=="Escape"&&!(i==="k"&&o)){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," ","j","k"].includes(i)&&t.preventDefault();return}switch(i){case"j":case"ArrowDown":t.preventDefault(),await It(n,1);break;case"k":o?(t.preventDefault(),n.openShortcuts?n.openShortcuts=!1:n.openShortcuts=!0):(t.preventDefault(),await It(n,-1));break;case"ArrowUp":t.preventDefault(),await It(n,-1);break;case" ":case"n":e.preventDefault(),n.selectedGuid?await n.toggleRead(n.selectedGuid):n.filteredEntries.length>0&&(n.selectedGuid=n.filteredEntries[0].guid,En(n.selectedGuid,n));break;case"s":case"L":n.selectedGuid&&(t.preventDefault(),await n.toggleStar(n.selectedGuid));break;case"i":t.preventDefault(),n.imagesEnabled=!n.imagesEnabled,v(n,`Images ${n.imagesEnabled?"Enabled":"Disabled"}.`),$(()=>Promise.resolve().then(()=>Yo),void 0).then(a=>{a.saveSimpleState("imagesEnabled",n.imagesEnabled)});break;case"o":case"Enter":if(n.selectedGuid){t.preventDefault();const a=n.filteredEntries.find(l=>l.guid===n.selectedGuid);a?.link&&window.open(a.link,"_blank","noopener,noreferrer")}break;case"r":case"m":n.selectedGuid&&(t.preventDefault(),await n.toggleRead(n.selectedGuid));break;case"t":t.preventDefault(),n.scrollToTop();break;case"u":t.preventDefault(),await n.undoMarkRead();break;case"?":t.preventDefault(),n.openShortcuts?n.openShortcuts=!1:n.openShortcuts=!0;break;case"Escape":n.openShortcuts?(t.preventDefault(),n.openShortcuts=!1):n.openSettings?(t.preventDefault(),n.openSettings=!1):n.selectedGuid&&(t.preventDefault(),n.selectedGuid=null);break;case"z":o&&(t.preventDefault(),await n.undoMarkRead());break}}async function It(t,n){const s=t.filteredEntries;if(s.length!==0){if(t.selectedGuid){let i=s.findIndex(o=>o.guid===t.selectedGuid)+n;i>=s.length&&(i=s.length-1),i<0&&(i=0),t.selectedGuid=s[i].guid}else{const r=t.lastSelectedGuid,i=r?s.findIndex(o=>o.guid===r):-1;if(i===-1)t.selectedGuid=s[0].guid;else{let o=i+n;o>=s.length&&(o=s.length-1),o<0&&(o=0),t.selectedGuid=s[o].guid}}En(t.selectedGuid,t)}}function En(t,n){if(t){if(n.filteredEntries.length>0&&n.filteredEntries[0].guid===t){n.scrollToTop();return}setTimeout(()=>{const s=document.querySelector(`.entry[data-guid="${t}"]`);if(s){const r=document.querySelector("#header"),i=r?r.getBoundingClientRect().height:0,a=s.getBoundingClientRect().top+window.pageYOffset-i-20;window.scrollTo({top:a,behavior:"smooth"})}},10)}}const ya=Object.freeze(Object.defineProperty({__proto__:null,handleKeyboardShortcuts:_r,scrollSelectedIntoView:En},Symbol.toStringTag,{value:"Module"}));function wa(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,openShortcuts:!1,modalView:"main",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,openUrlsInNewTabEnabled:!0,shadowsEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutGuids:[],pregeneratedOnlineDeck:null,pregeneratedOfflineDeck:null,errorMessage:"",isOnline:J(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",themeStyle:"original",themeStyleLight:"original",themeStyleDark:"original",customCss:"",fontSize:100,showUndo:!1,undoTimerActive:!1,undoItemGuid:null,undoItemIndex:null,selectedGuid:null,lastSelectedGuid:null,starredGuid:null,readingGuid:null,_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,imageObserver:null,db:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,lastShuffleResetDate:null,initApp:async function(){try{if(this.progressMessage="Connecting to database...",this.db=await tt(),this.progressMessage="Loading settings...",await this._loadInitialState(),this._initImageObserver(),this.isOnline){this.progressMessage="Syncing latest content...",await le(),await q();const t=await we(this);await this._loadAndManageAllData(),t?v(this,"Initial sync complete!"):v(this,"Sync finished with some issues. Check console for details.")}else this.progressMessage="Offline mode. Loading local data...",await this._loadAndManageAllData();this.progressMessage="Applying user preferences...",da(this),fa(this),ha(this),ga(this),ca(),this.$nextTick(()=>{pa(this)}),this.progressMessage="Setting up app watchers...",this._setupWatchers(),this._setupEventListeners(),this._startPeriodicSync(),this._initScrollObserver(),this._initObservers(),this.deck.length===0&&(this.entries.length>0?this.progressMessage="Fetching and building your feed...":this.progressMessage="No feed items found. Please configure your RSS feeds.",await new Promise(t=>setTimeout(t,1e3))),this.loading=!1,await this.updateSyncStatusMessage()}catch(t){console.error("Initialization failed:",t),this.errorMessage=`Could not load feed: ${t.message}`,this.progressMessage=`Error: ${t.message}`,v(this,`Could not load feed: ${t.message}`)}},performBackgroundSync:async function(){if(!(!this.syncEnabled||!this.isOnline)){console.log("Performing immediate background sync..."),this.progressMessage="Syncing...",this.loading=!0;try{await le();const t=await we(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,this.progressMessage="",this.loading=!1,console.log("Immediate background sync complete."),t?v(this,"Sync complete!"):v(this,"Sync finished with errors.")}catch(t){console.error("Immediate background sync failed:",t),this.progressMessage="Sync Failed!",this.loading=!1,v(this,`Sync failed: ${t.message}`)}}},updateSyncStatusMessage:async function(){J()?this.syncEnabled?(this.showSyncStatus=!1,this.syncStatusMessage=""):(this.syncStatusMessage="Sync is disabled.",this.showSyncStatus=!0):(this.syncStatusMessage="Offline.",this.showSyncStatus=!0)},loadAndDisplayDeck:async function(){let t=this.currentDeckGuids;Array.isArray(t)||(t=[]),console.log(`[loadAndDisplayDeck] Processing ${t.length} GUIDs for display`),console.log(`[loadAndDisplayDeck] feedItems contains ${Object.keys(this.feedItems).length} items`);const n=[],s=new Set(this.read.map(l=>l.guid)),r=new Set(this.starred.map(l=>l.guid)),i=new Set;let o=0,a=0;for(const l of t){const c=l.guid;if(typeof c!="string"||!c)continue;const u=this.feedItems[c];if(u&&u.guid&&!i.has(u.guid)){const d=kn(u,Wt);d&&(d.isRead=s.has(d.guid),d.isStarred=r.has(d.guid),n.push(d),i.add(d.guid),o++)}else a++,a<=3&&console.log(`[loadAndDisplayDeck] MISSING: GUID ${c} not found in feedItems`)}console.log(`[loadAndDisplayDeck] Found ${o} items, Missing ${a} items`),this.deck=Array.isArray(n)?n:[],console.log(`[loadAndDisplayDeck] Final deck size: ${this.deck.length}`)},loadFeedItemsFromDB:async function(){if(!this.db){this.entries=[],this.feedItems={};return}const t=await bn();this.feedItems={};const n=[],s=new Set;t.forEach(r=>{r&&r.guid&&!s.has(r.guid)&&(this.feedItems[r.guid]=r,n.push(r),s.add(r.guid))}),this.entries=ur(n,Wt)||[]},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const t=this.deck.length>0?this.deck[0].guid.substring(0,8):"empty",n=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}-${t}`;if(this.entries.length>0&&n===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let s=[];const r=new Map(this.read.map(a=>[a.guid,a.readAt])),i=new Map(this.starred.map(a=>[a.guid,a.starredAt]));switch(this.filterMode){case"unread":s=this.deck.filter(a=>!r.has(a.guid));break;case"all":s=this.entries;break;case"read":s=this.entries.filter(a=>r.has(a.guid)).sort((a,l)=>new Date(r.get(l.guid)||0).getTime()-new Date(r.get(a.guid)||0).getTime());break;case"starred":s=this.entries.filter(a=>i.has(a.guid)).sort((a,l)=>new Date(i.get(l.guid)||0).getTime()-new Date(i.get(a.guid)||0).getTime());break}s=s.map(a=>({...a,isRead:r.has(a.guid),isStarred:i.has(a.guid)}));const o=(this.keywordBlacklistInput??"").split(/\r?\n/).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0);return o.length>0&&(s=s.filter(a=>{const l=`${a.title} ${a.description}`.toLowerCase();return!o.some(c=>l.includes(c))})),this._cachedFilteredEntries=s,this._lastFilterHash=n,s},isStarred:function(t){return this.starred.some(n=>n.guid===t)},isRead:function(t){return this.read.some(n=>n.guid===t)},toggleStar:async function(t){!this.starred.some(s=>s.guid===t)&&(this.starredGuid=t,setTimeout(()=>{this.starredGuid===t&&(this.starredGuid=null)},1e3)),await Yt(this,t,"starred")},toggleRead:async function(t){const n=this.isRead(t),s=this.selectedGuid===t;let r=null;if(!n&&s&&this.filterMode==="unread"){const o=this.filteredEntries.findIndex(a=>a.guid===t);o!==-1&&o<this.filteredEntries.length-1&&(r=this.filteredEntries[o+1].guid)}n||(this.readingGuid=t,await new Promise(o=>setTimeout(o,500)),this.readingGuid=null);let i=null;if(await Yt(this,t,"read"),this.deck=this.deck.map(o=>o.guid===t?{...o,isRead:!n}:o),this.entries=this.entries.map(o=>o.guid===t?{...o,isRead:!n}:o),this.filterMode==="unread"&&!n){i=this.currentDeckGuids.findIndex(a=>a.guid===t),i===-1&&(i=null),this.deck=this.deck.filter(a=>a.guid!==t),this.currentDeckGuids=this.currentDeckGuids.filter(a=>a.guid!==t);const{saveCurrentDeck:o}=await $(async()=>{const{saveCurrentDeck:a}=await Promise.resolve().then(()=>Qt);return{saveCurrentDeck:a}},void 0);await o(this.currentDeckGuids),r?this.$nextTick(()=>{this.selectItem(r)}):s&&(this.selectedGuid=null)}else if(this.filterMode==="unread"&&n&&!this.currentDeckGuids.some(o=>o.guid===t)){const o={guid:t,addedAt:new Date().toISOString()};this.undoItemIndex!==null&&this.undoItemIndex>=0?this.currentDeckGuids.splice(this.undoItemIndex,0,o):this.currentDeckGuids.push(o);const{saveCurrentDeck:a}=await $(async()=>{const{saveCurrentDeck:l}=await Promise.resolve().then(()=>Qt);return{saveCurrentDeck:l}},void 0);await a(this.currentDeckGuids)}if(this.updateCounts(),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage(),!n&&this.filterMode!=="all"&&aa(this,t,i),this.filterMode==="unread"&&this.deck.length===0){console.log("[toggleRead] Deck is empty, initiating refresh process."),this.progressMessage="Generating new deck...",this.loading=!0;try{await this._loadAndManageAllData(),this.deck=[...this.deck]}catch(o){console.error("[toggleRead] Error during deck refresh:",o)}finally{this.loading=!1,this.progressMessage=""}console.log("[toggleRead] Deck refresh process completed. Deck size:",this.deck.length)}},undoMarkRead:async function(){if(!this.undoItemGuid)return;const t=this.undoItemGuid;this.showUndo=!1,await this.toggleRead(t),this.undoItemGuid=null,this.undoItemIndex=null},selectItem:function(t){if(this.selectedGuid===t){this.openShortcuts&&(this.openShortcuts=!1);return}this.selectedGuid=t,this.openShortcuts&&(this.openShortcuts=!1),$(()=>Promise.resolve().then(()=>ya),void 0).then(n=>{n.scrollSelectedIntoView(t,this)})},processShuffle:async function(){await ma(this),this.updateCounts()},loadRssFeeds:async function(){try{const t=await k("rssFeeds");this.rssFeedsInput=qe(t.value).join(`
`)}catch(t){console.error("Error loading RSS feeds:",t)}},loadKeywordBlacklist:async function(){const{loadSimpleState:t}=await $(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>W);return{loadSimpleState:s}},void 0),{value:n}=await t("keywordBlacklist");this.keywordBlacklistInput=Array.isArray(n)?n.join(`
`):""},loadCustomCss:async function(){const{loadSimpleState:t}=await $(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>W);return{loadSimpleState:s}},void 0),{value:n}=await t("customCss");this.customCss=typeof n=="string"&&n.trim()!==""?n:this.generateCustomCssTemplate(),this.applyCustomCss()},saveRssFeeds:async function(){const t=this.rssFeedsInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean);try{await G("rssFeeds",t),this.rssFeedsInput=t.join(`
`),v(this,"RSS Feeds saved!"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...";const n=await vn(this);await this.loadFeedItemsFromDB();const s=await Je(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=s.deck,this.currentDeckGuids=s.currentDeckGuids,this.shuffledOutGuids=s.shuffledOutGuids,this.shuffleCount=s.shuffleCount,this.lastShuffleResetDate=s.lastShuffleResetDate,await this.loadAndDisplayDeck(),this.progressMessage="",this.loading=!1,n||v(this,"Feeds saved, but sync finished with errors.")}catch(n){console.error("Error saving RSS feeds:",n),v(this,`Failed to save RSS feeds: ${n.message}`),this.loading=!1}},saveKeywordBlacklist:async function(){const t=this.keywordBlacklistInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean).sort();try{await G("keywordBlacklist",t),this.keywordBlacklistInput=t.join(`
`),v(this,"Keyword Blacklist saved!"),this.updateCounts()}catch(n){console.error("Error saving keyword blacklist:",n),v(this,`Failed to save keyword blacklist: ${n.message}`)}},saveCustomCss:async function(){try{await G("customCss",this.customCss),this.applyCustomCss(),v(this,"Custom CSS saved!")}catch(t){console.error("Error saving custom CSS:",t),v(this,`Failed to save custom CSS: ${t.message}`)}},resetCustomCss:async function(){confirm("Reset Custom CSS to default template? This will overwrite your current customizations.")&&(this.customCss=this.generateCustomCssTemplate(),await this.saveCustomCss(),v(this,"Custom CSS reset to template!"))},generateCustomCssTemplate:function(){const t=getComputedStyle(document.documentElement),n=["--bg","--fg","--primary","--secondary","--card-bg","--card-border","--card-shadow-color","--fg-muted","--border-radius"];let s=`/* Custom CSS Template - Current theme: ${this.theme} ${this.themeStyle} */
:root {
`;return n.forEach(r=>{const i=t.getPropertyValue(r).trim();i&&(s+=`  ${r}: ${i};
`)}),s+=`}

/* Add custom styles below */
`,s},applyCustomCss:function(){let t=document.getElementById("custom-user-css");t||(t=document.createElement("style"),t.id="custom-user-css",document.head.appendChild(t)),t.textContent=this.customCss},loadThemeStyle:async function(){const{loadSimpleState:t}=await $(async()=>{const{loadSimpleState:r}=await Promise.resolve().then(()=>W);return{loadSimpleState:r}},void 0),[,n,s]=await Promise.all([t("themeStyle"),t("themeStyleLight"),t("themeStyleDark")]);this.themeStyleLight=typeof n.value=="string"?n.value:"original",this.themeStyleDark=typeof s.value=="string"?s.value:"original",this.theme==="light"?this.themeStyle=this.themeStyleLight:this.themeStyle=this.themeStyleDark,this.applyThemeStyle()},updateThemeAndStyle:async function(t,n){console.log(`Updating theme to ${n} and style to ${t}`),this.theme=n,this.themeStyle=t;const s=document.documentElement;s.classList.remove("light","dark"),s.classList.add(n),localStorage.setItem("theme",n);const{saveSimpleState:r}=await $(async()=>{const{saveSimpleState:i}=await Promise.resolve().then(()=>W);return{saveSimpleState:i}},void 0);await r("theme",n),n==="light"?(this.themeStyleLight=t,await r("themeStyleLight",t)):(this.themeStyleDark=t,await r("themeStyleDark",t)),await r("themeStyle",t),this.applyThemeStyle(),v(this,`Theme set to ${n} (${t}).`)},saveThemeStyle:async function(){const{saveSimpleState:t}=await $(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>W);return{saveSimpleState:n}},void 0);this.theme==="light"?(this.themeStyleLight=this.themeStyle,await t("themeStyleLight",this.themeStyleLight)):(this.themeStyleDark=this.themeStyle,await t("themeStyleDark",this.themeStyleDark)),await t("themeStyle",this.themeStyle),this.applyThemeStyle()},applyThemeStyle:function(){const t=document.documentElement;t.classList.remove("light","dark"),t.classList.add(this.theme);const n=Array.from(t.classList).filter(s=>s.startsWith("theme-"));t.classList.remove(...n),this.themeStyle!=="original"&&t.classList.add(`theme-${this.themeStyle}`)},loadFontSize:async function(){const{loadSimpleState:t}=await $(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>W);return{loadSimpleState:s}},void 0),{value:n}=await t("fontSize");this.fontSize=typeof n=="number"?n:100,this.applyFontSize()},saveFontSize:async function(){const{saveSimpleState:t}=await $(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>W);return{saveSimpleState:n}},void 0);await t("fontSize",this.fontSize),this.applyFontSize()},applyFontSize:function(){document.documentElement.style.setProperty("--font-scale",(this.fontSize/100).toString())},updateCounts:async function(){la(this)},scrollToTop:function(){Sr()},observeImage:function(t){this.imageObserver&&this.imageObserver.observe(t)},_initImageObserver:function(){this.imageObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(n.isIntersecting){const s=n.target;s.dataset.src&&(s.src=s.dataset.src,this.imageObserver?.unobserve(s))}})},{root:null,rootMargin:"50% 0px",threshold:.01})},resetApplicationData:async function(){console.log("resetApplicationData called.");const t=confirm("Are you sure you want to reset the application? This will clear all local data, cache, and unregister the service worker.");if(console.log("User confirmed reset:",t),!t){console.log("Reset cancelled by user.");return}this.loading=!0,this.progressMessage="Resetting application data...";try{if(console.log("Closing database connection..."),await or(),console.log("Unregistering service workers..."),"serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations();for(const r of s)await r.unregister(),console.log("Service Worker unregistered:",r.scope)}console.log("Service workers unregistered."),console.log("Clearing feed and progress IndexedDB object stores...");try{const s=await tt(),r=["read","starred","currentDeckGuids","shuffledOutGuids","feedItems","pendingOperations"],i=s.transaction([...r,"userSettings"],"readwrite");await Promise.all(r.map(a=>(console.log(`Clearing object store: ${a}`),i.objectStore(a).clear()))),console.log("Clearing sync metadata from userSettings...");const o=i.objectStore("userSettings");await Promise.all([o.delete("lastFeedSync"),o.delete("lastStateSync")]),await i.done,console.log("Specific IndexedDB object stores and sync metadata cleared.")}catch(s){console.error("Error clearing IndexedDB stores:",s)}console.log("localStorage is preserved."),console.log("DEBUG: About to make fetch call to /api/admin/reset-app");const n=await fetch("/api/admin/reset-app",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to reset backend data.")}console.log("Backend application data reset successfully."),v(this,"Application reset complete! Reloading..."),await q(!0),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error during application reset:",n),this.errorMessage=`Failed to reset application: ${n.message}`,v(this,`Failed to reset application: ${n.message}`),this.loading=!1}},backupConfig:async function(){console.log("backupConfig called.");try{this.progressMessage="Fetching configuration for backup...",console.log("Fetching config for backup from:","/api/admin/config-backup");const t=await fetch("/api/admin/config-backup",{method:"GET",credentials:"include"});if(!t.ok){const o=await t.json();throw new Error(o.message||"Failed to fetch config for backup.")}const n=await t.json(),s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`not-the-news-config-backup-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),v(this,"Configuration backed up successfully!")}catch(t){console.error("Error during config backup:",t),v(this,`Failed to backup configuration: ${t.message}`)}finally{this.progressMessage=""}},restoreConfig:async function(t){if(!confirm("Are you sure you want to restore configuration? This will overwrite your current settings and reload the application."))return;const n=t.target.files?.[0];if(!n){v(this,"No file selected for restoration.");return}this.loading=!0,this.progressMessage="Restoring configuration...";try{const s=await new Promise((o,a)=>{const l=new FileReader;l.onload=c=>o(c.target?.result),l.onerror=c=>a(c),l.readAsText(n)}),r=JSON.parse(s),i=await fetch("/api/admin/config-restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"});if(!i.ok){const o=await i.json();throw new Error(o.message||"Failed to restore backend data.")}console.log("Backend configuration restored successfully."),v(this,"Configuration restored successfully! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(s){console.error("Error during config restoration:",s),v(this,`Failed to restore configuration: ${s.message}`),this.loading=!1}finally{t.target.value=""}},_loadInitialState:async function(){try{const[t,n,s,r,i]=await Promise.all([k("syncEnabled"),k("imagesEnabled"),k("openUrlsInNewTabEnabled"),wr(),k("theme")]);this.syncEnabled=t.value??!0,this.imagesEnabled=n.value??!0,this.openUrlsInNewTabEnabled=s.value??!0,this.filterMode=r,this.theme=i.value??"dark",localStorage.setItem("theme",this.theme),this.isOnline=J();const[o,a]=await Promise.all([k("rssFeeds"),k("keywordBlacklist")]);this.rssFeedsInput=qe(o.value).join(`
`),this.keywordBlacklistInput=Array.isArray(a.value)?a.value.join(`
`):"",await this.loadCustomCss(),await this.loadThemeStyle(),await this.loadFontSize();const[l,c]=await Promise.all([k("pregeneratedOnlineDeck"),k("pregeneratedOfflineDeck")]);this.pregeneratedOnlineDeck=l.value,this.pregeneratedOfflineDeck=c.value}catch(t){console.error("Error loading initial state:",t),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){console.log("_loadAndManageAllData: START"),this.progressMessage="Loading saved feed items...",await this.loadFeedItemsFromDB(),console.log(`_loadAndManageAllData: After loadFeedItemsFromDB. Entries: ${this.entries.length}`),this.progressMessage="Loading user state from storage...";const[t,n,s,r]=await Promise.all([re("starred"),re("shuffledOutGuids"),gr(),mr()]);console.log("_loadAndManageAllData: Loaded starred state:",t.value),this.starred=Array.isArray(t.value)?t.value:[],this.shuffledOutGuids=Array.isArray(n.value)?n.value:[],this.currentDeckGuids=Array.isArray(s)?s:[],console.log("_loadAndManageAllData: Loaded currentDeckGuids:",this.currentDeckGuids.slice(0,3),typeof this.currentDeckGuids[0]),this.shuffleCount=r.shuffleCount,this.lastShuffleResetDate=r.lastShuffleResetDate,this.progressMessage="Pruning read items...",this.read=await hr(Object.values(this.feedItems)),console.log(`_loadAndManageAllData: After loadAndPruneReadItems. Read count: ${this.read.length}`),console.log("[deckManager] Starting deck management with all data loaded."),this.progressMessage="Organizing your deck...",console.log("_loadAndManageAllData: Before manageDailyDeck",{readCount:this.read.length,currentDeckGuidsCount:this.currentDeckGuids.length,shuffleCount:this.shuffleCount});const i=await Je(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=i.deck,this.currentDeckGuids=i.currentDeckGuids,this.shuffledOutGuids=i.shuffledOutGuids,this.shuffleCount=i.shuffleCount,this.lastShuffleResetDate=i.lastShuffleResetDate,console.log("_loadAndManageAllData: After manageDailyDeck. Deck size:",this.deck.length),this.progressMessage="Displaying your feed...",await this.loadAndDisplayDeck(),console.log("_loadAndManageAllData: After loadAndDisplayDeck. Final Deck size:",this.deck.length),this.updateAllUI(),console.log("_loadAndManageAllData: END")},updateAllUI:async function(){await this.updateCounts()},_reconcileAndRefreshUI:async function(){console.log("[UI] _reconcileAndRefreshUI: Initiating UI reconciliation and refresh."),await this.loadAndDisplayDeck(),this.updateAllUI(),console.log("[UI] _reconcileAndRefreshUI: Completed UI reconciliation and refresh.")},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(!n.isIntersecting){const s=n.target.dataset.guid;console.log(`[Observer] Stale item ${s} is off-screen. Removing.`),this.deck=this.deck.filter(r=>r.guid!==s),this.staleItemObserver?.unobserve(n.target)}})},{root:null,threshold:0})},_setupWatchers:function(){this.$watch("openShortcuts",async t=>{const n=window.innerWidth<1024;t?(n||document.body.classList.add("no-scroll"),await At()):(document.body.classList.remove("no-scroll"),document.body.style.overflow="")}),this.$watch("openSettings",async t=>{if(t){this.modalView="main",await Hn(this);const[n,s]=await Promise.all([k("rssFeeds"),k("keywordBlacklist")]);this.rssFeedsInput=qe(n.value).join(`
`),Array.isArray(s.value)?this.keywordBlacklistInput=s.value.filter(Boolean).sort().join(`
`):typeof s.value=="string"?this.keywordBlacklistInput=s.value.split(/\r?\n/).filter(Boolean).sort().join(`
`):this.keywordBlacklistInput=""}else await At()}),this.$watch("openUrlsInNewTabEnabled",()=>{document.querySelectorAll(".itemdescription").forEach(t=>this.handleEntryLinks(t))}),this.$watch("modalView",async()=>Hn(this)),this.$watch("filterMode",async t=>{await yr(this,t),t==="unread"&&await Je(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate),this.scrollToTop()}),this.$watch("shadowsEnabled",t=>{document.body.classList.toggle("no-shadows",!t)}),document.body.classList.toggle("no-shadows",!this.shadowsEnabled),this.$watch("entries",()=>this.updateCounts()),this.$watch("read",()=>this.updateCounts()),this.$watch("starred",()=>this.updateCounts()),this.$watch("currentDeckGuids",()=>this.updateCounts()),this.$watch("selectedGuid",t=>{t&&(this.lastSelectedGuid=t)})},_setupEventListeners:function(){const t=async()=>{if(!this.syncEnabled||!this.isOnline)return;console.log("Performing periodic background sync..."),await le();const s=await we(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Background sync complete. Success: ${s}`)};window.addEventListener("online",async()=>{if(this.isOnline=!0,await this.updateSyncStatusMessage(),this.syncEnabled)try{await le(),await t()}catch(s){console.error("Error handling online event:",s)}}),window.addEventListener("offline",async()=>{this.isOnline=!1,await this.updateSyncStatusMessage()});let n;window.addEventListener("scroll",()=>{clearTimeout(n),n=setTimeout(()=>{At()},1e3)},{passive:!0}),window.addEventListener("keydown",s=>{_r(s,this)})},_startPeriodicSync:function(){let t=Date.now();const n=()=>t=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(i=>{document.addEventListener(i,n,!0),i==="focus"&&window.addEventListener(i,n,!0),i==="visibilitychange"&&document.addEventListener(i,n,!0)});const s=300*1e3,r=60*1e3;setInterval(async()=>{const i=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||i-t>r)){console.log("Starting scheduled background sync...");try{await le();const o=await we(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Scheduled sync complete. Success: ${o}`),await this.pregenerateDecks()}catch(o){console.error("Periodic sync failed:",o)}}},s)},_initScrollObserver:function(){const t=new IntersectionObserver(async()=>{},{root:document.querySelector("#feed-container"),rootMargin:"0px",threshold:.1}),n=document.querySelector("#feed-container");if(!n)return;const s=()=>{n.querySelectorAll("[data-guid]").forEach(i=>{t.observe(i)})};s(),new MutationObserver(()=>{t.disconnect(),s()}).observe(n,{childList:!0,subtree:!0}),this.scrollObserver=t},handleEntryLinks:function(t){t&&t.querySelectorAll("a").forEach(n=>{n.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer")):n.removeAttribute("target"))})},pregenerateDecks:async function(){if(!this._isPregenerating){this._isPregenerating=!0,console.log("[Background] Starting pre-generation of decks...");try{await this._generateAndSavePregeneratedDeck(!0),await this._generateAndSavePregeneratedDeck(!1),console.log("[Background] Deck pre-generation completed.")}catch(t){console.error("[Background] Deck pre-generation failed:",t)}finally{this._isPregenerating=!1}}},_generateAndSavePregeneratedDeck:async function(t){const{generateNewDeck:n}=await $(async()=>{const{generateNewDeck:l}=await Promise.resolve().then(()=>Qo);return{generateNewDeck:l}},void 0),{saveSimpleState:s}=await $(async()=>{const{saveSimpleState:l}=await Promise.resolve().then(()=>W);return{saveSimpleState:l}},void 0),r=await n(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,"unread",t),i=new Date().toISOString(),o=(r||[]).map(l=>({guid:l.guid,addedAt:i})),a=t?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck";this[a]=o,await s(a,o),console.log(`[Background] Pregenerated ${t?"ONLINE":"OFFLINE"} deck saved. Size: ${o.length}`)},$nextTick:function(t){return et.nextTick(t)},$watch:function(t,n){return et.watch(this,t,n)}}}et.data("rssApp",wa);et.start();
