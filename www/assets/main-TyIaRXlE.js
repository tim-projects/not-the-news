/* empty css              */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const br="modulepreload",vr=function(e){return"/"+e},vn={},R=function(t,n,s){let r=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");r=l(n.map(c=>{if(c=vr(c),c in vn)return;vn[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":br,u||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((y,_)=>{h.addEventListener("load",y),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})};var It=!1,xt=!1,ce=[],Ot=-1;function Dr(e){kr(e)}function kr(e){ce.includes(e)||ce.push(e),Ar()}function Er(e){let t=ce.indexOf(e);t!==-1&&t>Ot&&ce.splice(t,1)}function Ar(){!xt&&!It&&(It=!0,queueMicrotask(Ir))}function Ir(){It=!1,xt=!0;for(let e=0;e<ce.length;e++)ce[e](),Ot=e;ce.length=0,Ot=-1,xt=!1}var be,ge,ve,Kn,Ct=!0;function xr(e){Ct=!1,e(),Ct=!0}function Or(e){be=e.reactive,ve=e.release,ge=t=>e.effect(t,{scheduler:n=>{Ct?Dr(n):n()}}),Kn=e.raw}function Dn(e){ge=e}function Cr(e){let t=()=>{};return[s=>{let r=ge(s);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(i=>i())}),e._x_effects.add(r),t=()=>{r!==void 0&&(e._x_effects.delete(r),ve(r))},r},()=>{t()}]}function Hn(e,t){let n=!0,s,r=ge(()=>{let i=e();JSON.stringify(i),n?s=i:queueMicrotask(()=>{t(i,s),s=i}),n=!1});return()=>ve(r)}var Wn=[],qn=[],Jn=[];function Tr(e){Jn.push(e)}function Jt(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,qn.push(t))}function Yn(e){Wn.push(e)}function Qn(e,t,n){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(n)}function Xn(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([n,s])=>{(t===void 0||t.includes(n))&&(s.forEach(r=>r()),delete e._x_attributeCleanups[n])})}function Mr(e){for(e._x_effects?.forEach(Er);e._x_cleanups?.length;)e._x_cleanups.pop()()}var Yt=new MutationObserver(en),Qt=!1;function Xt(){Yt.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),Qt=!0}function Zn(){$r(),Yt.disconnect(),Qt=!1}var Ae=[];function $r(){let e=Yt.takeRecords();Ae.push(()=>e.length>0&&en(e));let t=Ae.length;queueMicrotask(()=>{if(Ae.length===t)for(;Ae.length>0;)Ae.shift()()})}function I(e){if(!Qt)return e();Zn();let t=e();return Xt(),t}var Zt=!1,Je=[];function Rr(){Zt=!0}function Pr(){Zt=!1,en(Je),Je=[]}function en(e){if(Zt){Je=Je.concat(e);return}let t=[],n=new Set,s=new Map,r=new Map;for(let i=0;i<e.length;i++)if(!e[i].target._x_ignoreMutationObserver&&(e[i].type==="childList"&&(e[i].removedNodes.forEach(o=>{o.nodeType===1&&o._x_marker&&n.add(o)}),e[i].addedNodes.forEach(o=>{if(o.nodeType===1){if(n.has(o)){n.delete(o);return}o._x_marker||t.push(o)}})),e[i].type==="attributes")){let o=e[i].target,a=e[i].attributeName,l=e[i].oldValue,c=()=>{s.has(o)||s.set(o,[]),s.get(o).push({name:a,value:o.getAttribute(a)})},u=()=>{r.has(o)||r.set(o,[]),r.get(o).push(a)};o.hasAttribute(a)&&l===null?c():o.hasAttribute(a)?(u(),c()):u()}r.forEach((i,o)=>{Xn(o,i)}),s.forEach((i,o)=>{Wn.forEach(a=>a(o,i))});for(let i of n)t.some(o=>o.contains(i))||qn.forEach(o=>o(i));for(let i of t)i.isConnected&&Jn.forEach(o=>o(i));t=null,n=null,s=null,r=null}function es(e){return Pe(Se(e))}function Re(e,t,n){return e._x_dataStack=[t,...Se(n||e)],()=>{e._x_dataStack=e._x_dataStack.filter(s=>s!==t)}}function Se(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?Se(e.host):e.parentNode?Se(e.parentNode):[]}function Pe(e){return new Proxy({objects:e},Br)}var Br={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(n=>Object.prototype.hasOwnProperty.call(n,t)||Reflect.has(n,t))},get({objects:e},t,n){return t=="toJSON"?Lr:Reflect.get(e.find(s=>Reflect.has(s,t))||{},t,n)},set({objects:e},t,n,s){const r=e.find(o=>Object.prototype.hasOwnProperty.call(o,t))||e[e.length-1],i=Object.getOwnPropertyDescriptor(r,t);return i?.set&&i?.get?i.set.call(s,n)||!0:Reflect.set(r,t,n)}};function Lr(){return Reflect.ownKeys(this).reduce((t,n)=>(t[n]=Reflect.get(this,n),t),{})}function ts(e){let t=s=>typeof s=="object"&&!Array.isArray(s)&&s!==null,n=(s,r="")=>{Object.entries(Object.getOwnPropertyDescriptors(s)).forEach(([i,{value:o,enumerable:a}])=>{if(a===!1||o===void 0||typeof o=="object"&&o!==null&&o.__v_skip)return;let l=r===""?i:`${r}.${i}`;typeof o=="object"&&o!==null&&o._x_interceptor?s[i]=o.initialize(e,l,i):t(o)&&o!==s&&!(o instanceof Element)&&n(o,l)})};return n(e)}function ns(e,t=()=>{}){let n={initialValue:void 0,_x_interceptor:!0,initialize(s,r,i){return e(this.initialValue,()=>Gr(s,r),o=>Tt(s,r,o),r,i)}};return t(n),s=>{if(typeof s=="object"&&s!==null&&s._x_interceptor){let r=n.initialize.bind(n);n.initialize=(i,o,a)=>{let l=s.initialize(i,o,a);return n.initialValue=l,r(i,o,a)}}else n.initialValue=s;return n}}function Gr(e,t){return t.split(".").reduce((n,s)=>n[s],e)}function Tt(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=n;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),Tt(e[t[0]],t.slice(1),n)}}var ss={};function z(e,t){ss[e]=t}function Mt(e,t){let n=Fr(t);return Object.entries(ss).forEach(([s,r])=>{Object.defineProperty(e,`$${s}`,{get(){return r(t,n)},enumerable:!1})}),e}function Fr(e){let[t,n]=cs(e),s={interceptor:ns,...t};return Jt(e,n),s}function jr(e,t,n,...s){try{return n(...s)}catch(r){Me(r,e,t)}}function Me(e,t,n=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:n}),console.warn(`Alpine Expression Error: ${e.message}

${n?'Expression: "'+n+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var He=!0;function rs(e){let t=He;He=!1;let n=e();return He=t,n}function ue(e,t,n={}){let s;return T(e,t)(r=>s=r,n),s}function T(...e){return is(...e)}var is=os;function Nr(e){is=e}function os(e,t){let n={};Mt(n,e);let s=[n,...Se(e)],r=typeof t=="function"?Ur(s,t):Vr(s,t,e);return jr.bind(null,e,t,r)}function Ur(e,t){return(n=()=>{},{scope:s={},params:r=[]}={})=>{let i=t.apply(Pe([s,...e]),r);Ye(n,i)}}var ft={};function zr(e,t){if(ft[e])return ft[e];let n=Object.getPrototypeOf(async function(){}).constructor,s=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,i=(()=>{try{let o=new n(["__self","scope"],`with (scope) { __self.result = ${s} }; __self.finished = true; return __self.result;`);return Object.defineProperty(o,"name",{value:`[Alpine] ${e}`}),o}catch(o){return Me(o,t,e),Promise.resolve()}})();return ft[e]=i,i}function Vr(e,t,n){let s=zr(t,n);return(r=()=>{},{scope:i={},params:o=[]}={})=>{s.result=void 0,s.finished=!1;let a=Pe([i,...e]);if(typeof s=="function"){let l=s(s,a).catch(c=>Me(c,n,t));s.finished?(Ye(r,s.result,a,o,n),s.result=void 0):l.then(c=>{Ye(r,c,a,o,n)}).catch(c=>Me(c,n,t)).finally(()=>s.result=void 0)}}}function Ye(e,t,n,s,r){if(He&&typeof t=="function"){let i=t.apply(n,s);i instanceof Promise?i.then(o=>Ye(e,o,n,s)).catch(o=>Me(o,r,t)):e(i)}else typeof t=="object"&&t instanceof Promise?t.then(i=>e(i)):e(t)}var tn="x-";function De(e=""){return tn+e}function Kr(e){tn=e}var Qe={};function O(e,t){return Qe[e]=t,{before(n){if(!Qe[n]){console.warn(String.raw`Cannot find directive \`${n}\`. \`${e}\` will use the default order of execution`);return}const s=le.indexOf(n);le.splice(s>=0?s:le.indexOf("DEFAULT"),0,e)}}}function Hr(e){return Object.keys(Qe).includes(e)}function nn(e,t,n){if(t=Array.from(t),e._x_virtualDirectives){let i=Object.entries(e._x_virtualDirectives).map(([a,l])=>({name:a,value:l})),o=as(i);i=i.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(i)}let s={};return t.map(fs((i,o)=>s[i]=o)).filter(gs).map(Jr(s,n)).sort(Yr).map(i=>qr(e,i))}function as(e){return Array.from(e).map(fs()).filter(t=>!gs(t))}var $t=!1,Oe=new Map,ls=Symbol();function Wr(e){$t=!0;let t=Symbol();ls=t,Oe.set(t,[]);let n=()=>{for(;Oe.get(t).length;)Oe.get(t).shift()();Oe.delete(t)},s=()=>{$t=!1,n()};e(n),s()}function cs(e){let t=[],n=a=>t.push(a),[s,r]=Cr(e);return t.push(r),[{Alpine:Be,effect:s,cleanup:n,evaluateLater:T.bind(T,e),evaluate:ue.bind(ue,e)},()=>t.forEach(a=>a())]}function qr(e,t){let n=()=>{},s=Qe[t.type]||n,[r,i]=cs(e);Qn(e,t.original,i);let o=()=>{e._x_ignore||e._x_ignoreSelf||(s.inline&&s.inline(e,t,r),s=s.bind(s,e,t,r),$t?Oe.get(ls).push(s):s())};return o.runCleanups=i,o}var us=(e,t)=>({name:n,value:s})=>(n.startsWith(e)&&(n=n.replace(e,t)),{name:n,value:s}),ds=e=>e;function fs(e=()=>{}){return({name:t,value:n})=>{let{name:s,value:r}=hs.reduce((i,o)=>o(i),{name:t,value:n});return s!==t&&e(s,t),{name:s,value:r}}}var hs=[];function sn(e){hs.push(e)}function gs({name:e}){return ps().test(e)}var ps=()=>new RegExp(`^${tn}([^:^.]+)\\b`);function Jr(e,t){return({name:n,value:s})=>{let r=n.match(ps()),i=n.match(/:([a-zA-Z0-9\-_:]+)/),o=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[n]||n;return{type:r?r[1]:null,value:i?i[1]:null,modifiers:o.map(l=>l.replace(".","")),expression:s,original:a}}}var Rt="DEFAULT",le=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Rt,"teleport"];function Yr(e,t){let n=le.indexOf(e.type)===-1?Rt:e.type,s=le.indexOf(t.type)===-1?Rt:t.type;return le.indexOf(n)-le.indexOf(s)}function Ce(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function he(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(r=>he(r,t));return}let n=!1;if(t(e,()=>n=!0),n)return;let s=e.firstElementChild;for(;s;)he(s,t),s=s.nextElementSibling}function L(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var kn=!1;function Qr(){kn&&L("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),kn=!0,document.body||L("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Ce(document,"alpine:init"),Ce(document,"alpine:initializing"),Xt(),Tr(t=>J(t,he)),Jt(t=>Ee(t)),Yn((t,n)=>{nn(t,n).forEach(s=>s())});let e=t=>!nt(t.parentElement,!0);Array.from(document.querySelectorAll(ws().join(","))).filter(e).forEach(t=>{J(t)}),Ce(document,"alpine:initialized"),setTimeout(()=>{ti()})}var rn=[],ms=[];function ys(){return rn.map(e=>e())}function ws(){return rn.concat(ms).map(e=>e())}function Ss(e){rn.push(e)}function _s(e){ms.push(e)}function nt(e,t=!1){return ke(e,n=>{if((t?ws():ys()).some(r=>n.matches(r)))return!0})}function ke(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),!!e.parentElement)return ke(e.parentElement,t)}}function Xr(e){return ys().some(t=>e.matches(t))}var bs=[];function Zr(e){bs.push(e)}var ei=1;function J(e,t=he,n=()=>{}){ke(e,s=>s._x_ignore)||Wr(()=>{t(e,(s,r)=>{s._x_marker||(n(s,r),bs.forEach(i=>i(s,r)),nn(s,s.attributes).forEach(i=>i()),s._x_ignore||(s._x_marker=ei++),s._x_ignore&&r())})})}function Ee(e,t=he){t(e,n=>{Mr(n),Xn(n),delete n._x_marker})}function ti(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,n,s])=>{Hr(n)||s.some(r=>{if(document.querySelector(r))return L(`found "${r}", but missing ${t} plugin`),!0})})}var Pt=[],on=!1;function an(e=()=>{}){return queueMicrotask(()=>{on||setTimeout(()=>{Bt()})}),new Promise(t=>{Pt.push(()=>{e(),t()})})}function Bt(){for(on=!1;Pt.length;)Pt.shift()()}function ni(){on=!0}function ln(e,t){return Array.isArray(t)?En(e,t.join(" ")):typeof t=="object"&&t!==null?si(e,t):typeof t=="function"?ln(e,t()):En(e,t)}function En(e,t){let n=r=>r.split(" ").filter(i=>!e.classList.contains(i)).filter(Boolean),s=r=>(e.classList.add(...r),()=>{e.classList.remove(...r)});return t=t===!0?t="":t||"",s(n(t))}function si(e,t){let n=a=>a.split(" ").filter(Boolean),s=Object.entries(t).flatMap(([a,l])=>l?n(a):!1).filter(Boolean),r=Object.entries(t).flatMap(([a,l])=>l?!1:n(a)).filter(Boolean),i=[],o=[];return r.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),o.push(a))}),s.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),i.push(a))}),()=>{o.forEach(a=>e.classList.add(a)),i.forEach(a=>e.classList.remove(a))}}function st(e,t){return typeof t=="object"&&t!==null?ri(e,t):ii(e,t)}function ri(e,t){let n={};return Object.entries(t).forEach(([s,r])=>{n[s]=e.style[s],s.startsWith("--")||(s=oi(s)),e.style.setProperty(s,r)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{st(e,n)}}function ii(e,t){let n=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",n||"")}}function oi(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Lt(e,t=()=>{}){let n=!1;return function(){n?t.apply(this,arguments):(n=!0,e.apply(this,arguments))}}O("transition",(e,{value:t,modifiers:n,expression:s},{evaluate:r})=>{typeof s=="function"&&(s=r(s)),s!==!1&&(!s||typeof s=="boolean"?li(e,n,t):ai(e,s,t))});function ai(e,t,n){vs(e,ln,""),{enter:r=>{e._x_transition.enter.during=r},"enter-start":r=>{e._x_transition.enter.start=r},"enter-end":r=>{e._x_transition.enter.end=r},leave:r=>{e._x_transition.leave.during=r},"leave-start":r=>{e._x_transition.leave.start=r},"leave-end":r=>{e._x_transition.leave.end=r}}[n](t)}function li(e,t,n){vs(e,st);let s=!t.includes("in")&&!t.includes("out")&&!n,r=s||t.includes("in")||["enter"].includes(n),i=s||t.includes("out")||["leave"].includes(n);t.includes("in")&&!s&&(t=t.filter((p,g)=>g<t.indexOf("out"))),t.includes("out")&&!s&&(t=t.filter((p,g)=>g>t.indexOf("out")));let o=!t.includes("opacity")&&!t.includes("scale"),a=o||t.includes("opacity"),l=o||t.includes("scale"),c=a?0:1,u=l?Ie(t,"scale",95)/100:1,f=Ie(t,"delay",0)/1e3,h=Ie(t,"origin","center"),y="opacity, transform",_=Ie(t,"duration",150)/1e3,S=Ie(t,"duration",75)/1e3,d="cubic-bezier(0.4, 0.0, 0.2, 1)";r&&(e._x_transition.enter.during={transformOrigin:h,transitionDelay:`${f}s`,transitionProperty:y,transitionDuration:`${_}s`,transitionTimingFunction:d},e._x_transition.enter.start={opacity:c,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),i&&(e._x_transition.leave.during={transformOrigin:h,transitionDelay:`${f}s`,transitionProperty:y,transitionDuration:`${S}s`,transitionTimingFunction:d},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:c,transform:`scale(${u})`})}function vs(e,t,n={}){e._x_transition||(e._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(s=()=>{},r=()=>{}){Gt(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},s,r)},out(s=()=>{},r=()=>{}){Gt(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},s,r)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,n,s){const r=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let i=()=>r(n);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(n):i():e._x_transition?e._x_transition.in(n):i();return}e._x_hidePromise=e._x_transition?new Promise((o,a)=>{e._x_transition.out(()=>{},()=>o(s)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(s),queueMicrotask(()=>{let o=Ds(e);o?(o._x_hideChildren||(o._x_hideChildren=[]),o._x_hideChildren.push(e)):r(()=>{let a=l=>{let c=Promise.all([l._x_hidePromise,...(l._x_hideChildren||[]).map(a)]).then(([u])=>u?.());return delete l._x_hidePromise,delete l._x_hideChildren,c};a(e).catch(l=>{if(!l.isFromCancelledTransition)throw l})})})};function Ds(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Ds(t)}function Gt(e,t,{during:n,start:s,end:r}={},i=()=>{},o=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(n).length===0&&Object.keys(s).length===0&&Object.keys(r).length===0){i(),o();return}let a,l,c;ci(e,{start(){a=t(e,s)},during(){l=t(e,n)},before:i,end(){a(),c=t(e,r)},after:o,cleanup(){l(),c()}})}function ci(e,t){let n,s,r,i=Lt(()=>{I(()=>{n=!0,s||t.before(),r||(t.end(),Bt()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(o){this.beforeCancels.push(o)},cancel:Lt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();i()}),finish:i},I(()=>{t.start(),t.during()}),ni(),requestAnimationFrame(()=>{if(n)return;let o=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;o===0&&(o=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),I(()=>{t.before()}),s=!0,requestAnimationFrame(()=>{n||(I(()=>{t.end()}),Bt(),setTimeout(e._x_transitioning.finish,o+a),r=!0)})})}function Ie(e,t,n){if(e.indexOf(t)===-1)return n;const s=e[e.indexOf(t)+1];if(!s||t==="scale"&&isNaN(s))return n;if(t==="duration"||t==="delay"){let r=s.match(/([0-9]+)ms/);if(r)return r[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[s,e[e.indexOf(t)+2]].join(" "):s}var te=!1;function re(e,t=()=>{}){return(...n)=>te?t(...n):e(...n)}function ui(e){return(...t)=>te&&e(...t)}var ks=[];function rt(e){ks.push(e)}function di(e,t){ks.forEach(n=>n(e,t)),te=!0,Es(()=>{J(t,(n,s)=>{s(n,()=>{})})}),te=!1}var Ft=!1;function fi(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),te=!0,Ft=!0,Es(()=>{hi(t)}),te=!1,Ft=!1}function hi(e){let t=!1;J(e,(s,r)=>{he(s,(i,o)=>{if(t&&Xr(i))return o();t=!0,r(i,o)})})}function Es(e){let t=ge;Dn((n,s)=>{let r=t(n);return ve(r),()=>{}}),e(),Dn(t)}function As(e,t,n,s=[]){switch(e._x_bindings||(e._x_bindings=be({})),e._x_bindings[t]=n,t=s.includes("camel")?bi(t):t,t){case"value":gi(e,n);break;case"style":mi(e,n);break;case"class":pi(e,n);break;case"selected":case"checked":yi(e,t,n);break;default:Is(e,t,n);break}}function gi(e,t){if(Cs(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=We(e.value)===t:e.checked=An(e.value,t));else if(cn(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(n=>An(n,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")_i(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function pi(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=ln(e,t)}function mi(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=st(e,t)}function yi(e,t,n){Is(e,t,n),Si(e,t,n)}function Is(e,t,n){[null,void 0,!1].includes(n)&&Di(t)?e.removeAttribute(t):(xs(t)&&(n=t),wi(e,t,n))}function wi(e,t,n){e.getAttribute(t)!=n&&e.setAttribute(t,n)}function Si(e,t,n){e[t]!==n&&(e[t]=n)}function _i(e,t){const n=[].concat(t).map(s=>s+"");Array.from(e.options).forEach(s=>{s.selected=n.includes(s.value)})}function bi(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function An(e,t){return e==t}function We(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?!!e:null}var vi=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function xs(e){return vi.has(e)}function Di(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function ki(e,t,n){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:Os(e,t,n)}function Ei(e,t,n,s=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let r=e._x_inlineBindings[t];return r.extract=s,rs(()=>ue(e,r.expression))}return Os(e,t,n)}function Os(e,t,n){let s=e.getAttribute(t);return s===null?typeof n=="function"?n():n:s===""?!0:xs(t)?!![t,"true"].includes(s):s}function cn(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function Cs(e){return e.type==="radio"||e.localName==="ui-radio"}function Ts(e,t){var n;return function(){var s=this,r=arguments,i=function(){n=null,e.apply(s,r)};clearTimeout(n),n=setTimeout(i,t)}}function Ms(e,t){let n;return function(){let s=this,r=arguments;n||(e.apply(s,r),n=!0,setTimeout(()=>n=!1,t))}}function $s({get:e,set:t},{get:n,set:s}){let r=!0,i,o=ge(()=>{let a=e(),l=n();if(r)s(ht(a)),r=!1;else{let c=JSON.stringify(a),u=JSON.stringify(l);c!==i?s(ht(a)):c!==u&&t(ht(l))}i=JSON.stringify(e()),JSON.stringify(n())});return()=>{ve(o)}}function ht(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function Ai(e){(Array.isArray(e)?e:[e]).forEach(n=>n(Be))}var oe={},In=!1;function Ii(e,t){if(In||(oe=be(oe),In=!0),t===void 0)return oe[e];oe[e]=t,ts(oe[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&oe[e].init()}function xi(){return oe}var Rs={};function Oi(e,t){let n=typeof t!="function"?()=>t:t;return e instanceof Element?Ps(e,n()):(Rs[e]=n,()=>{})}function Ci(e){return Object.entries(Rs).forEach(([t,n])=>{Object.defineProperty(e,t,{get(){return(...s)=>n(...s)}})}),e}function Ps(e,t,n){let s=[];for(;s.length;)s.pop()();let r=Object.entries(t).map(([o,a])=>({name:o,value:a})),i=as(r);return r=r.map(o=>i.find(a=>a.name===o.name)?{name:`x-bind:${o.name}`,value:`"${o.value}"`}:o),nn(e,r,n).map(o=>{s.push(o.runCleanups),o()}),()=>{for(;s.length;)s.pop()()}}var Bs={};function Ti(e,t){Bs[e]=t}function Mi(e,t){return Object.entries(Bs).forEach(([n,s])=>{Object.defineProperty(e,n,{get(){return(...r)=>s.bind(t)(...r)},enumerable:!1})}),e}var $i={get reactive(){return be},get release(){return ve},get effect(){return ge},get raw(){return Kn},version:"3.14.9",flushAndStopDeferringMutations:Pr,dontAutoEvaluateFunctions:rs,disableEffectScheduling:xr,startObservingMutations:Xt,stopObservingMutations:Zn,setReactivityEngine:Or,onAttributeRemoved:Qn,onAttributesAdded:Yn,closestDataStack:Se,skipDuringClone:re,onlyDuringClone:ui,addRootSelector:Ss,addInitSelector:_s,interceptClone:rt,addScopeToNode:Re,deferMutations:Rr,mapAttributes:sn,evaluateLater:T,interceptInit:Zr,setEvaluator:Nr,mergeProxies:Pe,extractProp:Ei,findClosest:ke,onElRemoved:Jt,closestRoot:nt,destroyTree:Ee,interceptor:ns,transition:Gt,setStyles:st,mutateDom:I,directive:O,entangle:$s,throttle:Ms,debounce:Ts,evaluate:ue,initTree:J,nextTick:an,prefixed:De,prefix:Kr,plugin:Ai,magic:z,store:Ii,start:Qr,clone:fi,cloneNode:di,bound:ki,$data:es,watch:Hn,walk:he,data:Ti,bind:Oi},Be=$i;function Ri(e,t){const n=Object.create(null),s=e.split(",");for(let r=0;r<s.length;r++)n[s[r]]=!0;return r=>!!n[r]}var Pi=Object.freeze({}),Bi=Object.prototype.hasOwnProperty,it=(e,t)=>Bi.call(e,t),de=Array.isArray,Te=e=>Ls(e)==="[object Map]",Li=e=>typeof e=="string",un=e=>typeof e=="symbol",ot=e=>e!==null&&typeof e=="object",Gi=Object.prototype.toString,Ls=e=>Gi.call(e),Gs=e=>Ls(e).slice(8,-1),dn=e=>Li(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Fi=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},ji=Fi(e=>e.charAt(0).toUpperCase()+e.slice(1)),Fs=(e,t)=>e!==t&&(e===e||t===t),jt=new WeakMap,xe=[],H,fe=Symbol("iterate"),Nt=Symbol("Map key iterate");function Ni(e){return e&&e._isEffect===!0}function Ui(e,t=Pi){Ni(e)&&(e=e.raw);const n=Ki(e,t);return t.lazy||n(),n}function zi(e){e.active&&(js(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var Vi=0;function Ki(e,t){const n=function(){if(!n.active)return e();if(!xe.includes(n)){js(n);try{return Wi(),xe.push(n),H=n,e()}finally{xe.pop(),Ns(),H=xe[xe.length-1]}}};return n.id=Vi++,n.allowRecurse=!!t.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}function js(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}var _e=!0,fn=[];function Hi(){fn.push(_e),_e=!1}function Wi(){fn.push(_e),_e=!0}function Ns(){const e=fn.pop();_e=e===void 0?!0:e}function N(e,t,n){if(!_e||H===void 0)return;let s=jt.get(e);s||jt.set(e,s=new Map);let r=s.get(n);r||s.set(n,r=new Set),r.has(H)||(r.add(H),H.deps.push(r),H.options.onTrack&&H.options.onTrack({effect:H,target:e,type:t,key:n}))}function ne(e,t,n,s,r,i){const o=jt.get(e);if(!o)return;const a=new Set,l=u=>{u&&u.forEach(f=>{(f!==H||f.allowRecurse)&&a.add(f)})};if(t==="clear")o.forEach(l);else if(n==="length"&&de(e))o.forEach((u,f)=>{(f==="length"||f>=s)&&l(u)});else switch(n!==void 0&&l(o.get(n)),t){case"add":de(e)?dn(n)&&l(o.get("length")):(l(o.get(fe)),Te(e)&&l(o.get(Nt)));break;case"delete":de(e)||(l(o.get(fe)),Te(e)&&l(o.get(Nt)));break;case"set":Te(e)&&l(o.get(fe));break}const c=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:n,type:t,newValue:s,oldValue:r,oldTarget:i}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(c)}var qi=Ri("__proto__,__v_isRef,__isVue"),Us=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(un)),Ji=zs(),Yi=zs(!0),xn=Qi();function Qi(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const s=v(this);for(let i=0,o=this.length;i<o;i++)N(s,"get",i+"");const r=s[t](...n);return r===-1||r===!1?s[t](...n.map(v)):r}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){Hi();const s=v(this)[t].apply(this,n);return Ns(),s}}),e}function zs(e=!1,t=!1){return function(s,r,i){if(r==="__v_isReactive")return!e;if(r==="__v_isReadonly")return e;if(r==="__v_raw"&&i===(e?t?fo:Ws:t?uo:Hs).get(s))return s;const o=de(s);if(!e&&o&&it(xn,r))return Reflect.get(xn,r,i);const a=Reflect.get(s,r,i);return(un(r)?Us.has(r):qi(r))||(e||N(s,"get",r),t)?a:Ut(a)?!o||!dn(r)?a.value:a:ot(a)?e?qs(a):mn(a):a}}var Xi=Zi();function Zi(e=!1){return function(n,s,r,i){let o=n[s];if(!e&&(r=v(r),o=v(o),!de(n)&&Ut(o)&&!Ut(r)))return o.value=r,!0;const a=de(n)&&dn(s)?Number(s)<n.length:it(n,s),l=Reflect.set(n,s,r,i);return n===v(i)&&(a?Fs(r,o)&&ne(n,"set",s,r,o):ne(n,"add",s,r)),l}}function eo(e,t){const n=it(e,t),s=e[t],r=Reflect.deleteProperty(e,t);return r&&n&&ne(e,"delete",t,void 0,s),r}function to(e,t){const n=Reflect.has(e,t);return(!un(t)||!Us.has(t))&&N(e,"has",t),n}function no(e){return N(e,"iterate",de(e)?"length":fe),Reflect.ownKeys(e)}var so={get:Ji,set:Xi,deleteProperty:eo,has:to,ownKeys:no},ro={get:Yi,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},hn=e=>ot(e)?mn(e):e,gn=e=>ot(e)?qs(e):e,pn=e=>e,at=e=>Reflect.getPrototypeOf(e);function Ge(e,t,n=!1,s=!1){e=e.__v_raw;const r=v(e),i=v(t);t!==i&&!n&&N(r,"get",t),!n&&N(r,"get",i);const{has:o}=at(r),a=s?pn:n?gn:hn;if(o.call(r,t))return a(e.get(t));if(o.call(r,i))return a(e.get(i));e!==r&&e.get(t)}function Fe(e,t=!1){const n=this.__v_raw,s=v(n),r=v(e);return e!==r&&!t&&N(s,"has",e),!t&&N(s,"has",r),e===r?n.has(e):n.has(e)||n.has(r)}function je(e,t=!1){return e=e.__v_raw,!t&&N(v(e),"iterate",fe),Reflect.get(e,"size",e)}function On(e){e=v(e);const t=v(this);return at(t).has.call(t,e)||(t.add(e),ne(t,"add",e,e)),this}function Cn(e,t){t=v(t);const n=v(this),{has:s,get:r}=at(n);let i=s.call(n,e);i?Ks(n,s,e):(e=v(e),i=s.call(n,e));const o=r.call(n,e);return n.set(e,t),i?Fs(t,o)&&ne(n,"set",e,t,o):ne(n,"add",e,t),this}function Tn(e){const t=v(this),{has:n,get:s}=at(t);let r=n.call(t,e);r?Ks(t,n,e):(e=v(e),r=n.call(t,e));const i=s?s.call(t,e):void 0,o=t.delete(e);return r&&ne(t,"delete",e,void 0,i),o}function Mn(){const e=v(this),t=e.size!==0,n=Te(e)?new Map(e):new Set(e),s=e.clear();return t&&ne(e,"clear",void 0,void 0,n),s}function Ne(e,t){return function(s,r){const i=this,o=i.__v_raw,a=v(o),l=t?pn:e?gn:hn;return!e&&N(a,"iterate",fe),o.forEach((c,u)=>s.call(r,l(c),l(u),i))}}function Ue(e,t,n){return function(...s){const r=this.__v_raw,i=v(r),o=Te(i),a=e==="entries"||e===Symbol.iterator&&o,l=e==="keys"&&o,c=r[e](...s),u=n?pn:t?gn:hn;return!t&&N(i,"iterate",l?Nt:fe),{next(){const{value:f,done:h}=c.next();return h?{value:f,done:h}:{value:a?[u(f[0]),u(f[1])]:u(f),done:h}},[Symbol.iterator](){return this}}}}function Q(e){return function(...t){{const n=t[0]?`on key "${t[0]}" `:"";console.warn(`${ji(e)} operation ${n}failed: target is readonly.`,v(this))}return e==="delete"?!1:this}}function io(){const e={get(i){return Ge(this,i)},get size(){return je(this)},has:Fe,add:On,set:Cn,delete:Tn,clear:Mn,forEach:Ne(!1,!1)},t={get(i){return Ge(this,i,!1,!0)},get size(){return je(this)},has:Fe,add:On,set:Cn,delete:Tn,clear:Mn,forEach:Ne(!1,!0)},n={get(i){return Ge(this,i,!0)},get size(){return je(this,!0)},has(i){return Fe.call(this,i,!0)},add:Q("add"),set:Q("set"),delete:Q("delete"),clear:Q("clear"),forEach:Ne(!0,!1)},s={get(i){return Ge(this,i,!0,!0)},get size(){return je(this,!0)},has(i){return Fe.call(this,i,!0)},add:Q("add"),set:Q("set"),delete:Q("delete"),clear:Q("clear"),forEach:Ne(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=Ue(i,!1,!1),n[i]=Ue(i,!0,!1),t[i]=Ue(i,!1,!0),s[i]=Ue(i,!0,!0)}),[e,n,t,s]}var[oo,ao,wa,Sa]=io();function Vs(e,t){const n=e?ao:oo;return(s,r,i)=>r==="__v_isReactive"?!e:r==="__v_isReadonly"?e:r==="__v_raw"?s:Reflect.get(it(n,r)&&r in s?n:s,r,i)}var lo={get:Vs(!1)},co={get:Vs(!0)};function Ks(e,t,n){const s=v(n);if(s!==n&&t.call(e,s)){const r=Gs(e);console.warn(`Reactive ${r} contains both the raw and reactive versions of the same object${r==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Hs=new WeakMap,uo=new WeakMap,Ws=new WeakMap,fo=new WeakMap;function ho(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function go(e){return e.__v_skip||!Object.isExtensible(e)?0:ho(Gs(e))}function mn(e){return e&&e.__v_isReadonly?e:Js(e,!1,so,lo,Hs)}function qs(e){return Js(e,!0,ro,co,Ws)}function Js(e,t,n,s,r){if(!ot(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=r.get(e);if(i)return i;const o=go(e);if(o===0)return e;const a=new Proxy(e,o===2?s:n);return r.set(e,a),a}function v(e){return e&&v(e.__v_raw)||e}function Ut(e){return!!(e&&e.__v_isRef===!0)}z("nextTick",()=>an);z("dispatch",e=>Ce.bind(Ce,e));z("watch",(e,{evaluateLater:t,cleanup:n})=>(s,r)=>{let i=t(s),a=Hn(()=>{let l;return i(c=>l=c),l},r);n(a)});z("store",xi);z("data",e=>es(e));z("root",e=>nt(e));z("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=Pe(po(e))),e._x_refs_proxy));function po(e){let t=[];return ke(e,n=>{n._x_refs&&t.push(n._x_refs)}),t}var gt={};function Ys(e){return gt[e]||(gt[e]=0),++gt[e]}function mo(e,t){return ke(e,n=>{if(n._x_ids&&n._x_ids[t])return!0})}function yo(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=Ys(t))}z("id",(e,{cleanup:t})=>(n,s=null)=>{let r=`${n}${s?`-${s}`:""}`;return wo(e,r,t,()=>{let i=mo(e,n),o=i?i._x_ids[n]:Ys(n);return s?`${n}-${o}-${s}`:`${n}-${o}`})});rt((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function wo(e,t,n,s){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let r=s();return e._x_id[t]=r,n(()=>{delete e._x_id[t]}),r}z("el",e=>e);Qs("Focus","focus","focus");Qs("Persist","persist","persist");function Qs(e,t,n){z(t,s=>L(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,s))}O("modelable",(e,{expression:t},{effect:n,evaluateLater:s,cleanup:r})=>{let i=s(t),o=()=>{let u;return i(f=>u=f),u},a=s(`${t} = __placeholder`),l=u=>a(()=>{},{scope:{__placeholder:u}}),c=o();l(c),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,f=e._x_model.set,h=$s({get(){return u()},set(y){f(y)}},{get(){return o()},set(y){l(y)}});r(h)})});O("teleport",(e,{modifiers:t,expression:n},{cleanup:s})=>{e.tagName.toLowerCase()!=="template"&&L("x-teleport can only be used on a <template> tag",e);let r=$n(n),i=e.content.cloneNode(!0).firstElementChild;e._x_teleport=i,i._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),i.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{i.addEventListener(a,l=>{l.stopPropagation(),e.dispatchEvent(new l.constructor(l.type,l))})}),Re(i,{},e);let o=(a,l,c)=>{c.includes("prepend")?l.parentNode.insertBefore(a,l):c.includes("append")?l.parentNode.insertBefore(a,l.nextSibling):l.appendChild(a)};I(()=>{o(i,r,t),re(()=>{J(i)})()}),e._x_teleportPutBack=()=>{let a=$n(n);I(()=>{o(e._x_teleport,a,t)})},s(()=>I(()=>{i.remove(),Ee(i)}))});var So=document.createElement("div");function $n(e){let t=re(()=>document.querySelector(e),()=>So)();return t||L(`Cannot find x-teleport element for selector: "${e}"`),t}var Xs=()=>{};Xs.inline=(e,{modifiers:t},{cleanup:n})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,n(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};O("ignore",Xs);O("effect",re((e,{expression:t},{effect:n})=>{n(T(e,t))}));function zt(e,t,n,s){let r=e,i=l=>s(l),o={},a=(l,c)=>u=>c(l,u);if(n.includes("dot")&&(t=_o(t)),n.includes("camel")&&(t=bo(t)),n.includes("passive")&&(o.passive=!0),n.includes("capture")&&(o.capture=!0),n.includes("window")&&(r=window),n.includes("document")&&(r=document),n.includes("debounce")){let l=n[n.indexOf("debounce")+1]||"invalid-wait",c=Xe(l.split("ms")[0])?Number(l.split("ms")[0]):250;i=Ts(i,c)}if(n.includes("throttle")){let l=n[n.indexOf("throttle")+1]||"invalid-wait",c=Xe(l.split("ms")[0])?Number(l.split("ms")[0]):250;i=Ms(i,c)}return n.includes("prevent")&&(i=a(i,(l,c)=>{c.preventDefault(),l(c)})),n.includes("stop")&&(i=a(i,(l,c)=>{c.stopPropagation(),l(c)})),n.includes("once")&&(i=a(i,(l,c)=>{l(c),r.removeEventListener(t,i,o)})),(n.includes("away")||n.includes("outside"))&&(r=document,i=a(i,(l,c)=>{e.contains(c.target)||c.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&l(c))})),n.includes("self")&&(i=a(i,(l,c)=>{c.target===e&&l(c)})),(Do(t)||Zs(t))&&(i=a(i,(l,c)=>{ko(c,n)||l(c)})),r.addEventListener(t,i,o),()=>{r.removeEventListener(t,i,o)}}function _o(e){return e.replace(/-/g,".")}function bo(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function Xe(e){return!Array.isArray(e)&&!isNaN(e)}function vo(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Do(e){return["keydown","keyup"].includes(e)}function Zs(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function ko(e,t){let n=t.filter(i=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(i));if(n.includes("debounce")){let i=n.indexOf("debounce");n.splice(i,Xe((n[i+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let i=n.indexOf("throttle");n.splice(i,Xe((n[i+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.length===0||n.length===1&&Rn(e.key).includes(n[0]))return!1;const r=["ctrl","shift","alt","meta","cmd","super"].filter(i=>n.includes(i));return n=n.filter(i=>!r.includes(i)),!(r.length>0&&r.filter(o=>((o==="cmd"||o==="super")&&(o="meta"),e[`${o}Key`])).length===r.length&&(Zs(e.type)||Rn(e.key).includes(n[0])))}function Rn(e){if(!e)return[];e=vo(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(n=>{if(t[n]===e)return n}).filter(n=>n)}O("model",(e,{modifiers:t,expression:n},{effect:s,cleanup:r})=>{let i=e;t.includes("parent")&&(i=e.parentNode);let o=T(i,n),a;typeof n=="string"?a=T(i,`${n} = __placeholder`):typeof n=="function"&&typeof n()=="string"?a=T(i,`${n()} = __placeholder`):a=()=>{};let l=()=>{let h;return o(y=>h=y),Pn(h)?h.get():h},c=h=>{let y;o(_=>y=_),Pn(y)?y.set(h):a(()=>{},{scope:{__placeholder:h}})};typeof n=="string"&&e.type==="radio"&&I(()=>{e.hasAttribute("name")||e.setAttribute("name",n)});var u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let f=te?()=>{}:zt(e,u,t,h=>{c(pt(e,t,h,l()))});if(t.includes("fill")&&([void 0,null,""].includes(l())||cn(e)&&Array.isArray(l())||e.tagName.toLowerCase()==="select"&&e.multiple)&&c(pt(e,t,{target:e},l())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=f,r(()=>e._x_removeModelListeners.default()),e.form){let h=zt(e.form,"reset",[],y=>{an(()=>e._x_model&&e._x_model.set(pt(e,t,{target:e},l())))});r(()=>h())}e._x_model={get(){return l()},set(h){c(h)}},e._x_forceModelUpdate=h=>{h===void 0&&typeof n=="string"&&n.match(/\./)&&(h=""),window.fromModel=!0,I(()=>As(e,"value",h)),delete window.fromModel},s(()=>{let h=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(h)})});function pt(e,t,n,s){return I(()=>{if(n instanceof CustomEvent&&n.detail!==void 0)return n.detail!==null&&n.detail!==void 0?n.detail:n.target.value;if(cn(e))if(Array.isArray(s)){let r=null;return t.includes("number")?r=mt(n.target.value):t.includes("boolean")?r=We(n.target.value):r=n.target.value,n.target.checked?s.includes(r)?s:s.concat([r]):s.filter(i=>!Eo(i,r))}else return n.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(n.target.selectedOptions).map(r=>{let i=r.value||r.text;return mt(i)}):t.includes("boolean")?Array.from(n.target.selectedOptions).map(r=>{let i=r.value||r.text;return We(i)}):Array.from(n.target.selectedOptions).map(r=>r.value||r.text);{let r;return Cs(e)?n.target.checked?r=n.target.value:r=s:r=n.target.value,t.includes("number")?mt(r):t.includes("boolean")?We(r):t.includes("trim")?r.trim():r}}})}function mt(e){let t=e?parseFloat(e):null;return Ao(t)?t:e}function Eo(e,t){return e==t}function Ao(e){return!Array.isArray(e)&&!isNaN(e)}function Pn(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}O("cloak",e=>queueMicrotask(()=>I(()=>e.removeAttribute(De("cloak")))));_s(()=>`[${De("init")}]`);O("init",re((e,{expression:t},{evaluate:n})=>typeof t=="string"?!!t.trim()&&n(t,{},!1):n(t,{},!1)));O("text",(e,{expression:t},{effect:n,evaluateLater:s})=>{let r=s(t);n(()=>{r(i=>{I(()=>{e.textContent=i})})})});O("html",(e,{expression:t},{effect:n,evaluateLater:s})=>{let r=s(t);n(()=>{r(i=>{I(()=>{e.innerHTML=i,e._x_ignoreSelf=!0,J(e),delete e._x_ignoreSelf})})})});sn(us(":",ds(De("bind:"))));var er=(e,{value:t,modifiers:n,expression:s,original:r},{effect:i,cleanup:o})=>{if(!t){let l={};Ci(l),T(e,s)(u=>{Ps(e,u,r)},{scope:l});return}if(t==="key")return Io(e,s);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=T(e,s);i(()=>a(l=>{l===void 0&&typeof s=="string"&&s.match(/\./)&&(l=""),I(()=>As(e,t,l,n))})),o(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};er.inline=(e,{value:t,modifiers:n,expression:s})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:s,extract:!1})};O("bind",er);function Io(e,t){e._x_keyExpression=t}Ss(()=>`[${De("data")}]`);O("data",(e,{expression:t},{cleanup:n})=>{if(xo(e))return;t=t===""?"{}":t;let s={};Mt(s,e);let r={};Mi(r,s);let i=ue(e,t,{scope:r});(i===void 0||i===!0)&&(i={}),Mt(i,e);let o=be(i);ts(o);let a=Re(e,o);o.init&&ue(e,o.init),n(()=>{o.destroy&&ue(e,o.destroy),a()})});rt((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function xo(e){return te?Ft?!0:e.hasAttribute("data-has-alpine-state"):!1}O("show",(e,{modifiers:t,expression:n},{effect:s})=>{let r=T(e,n);e._x_doHide||(e._x_doHide=()=>{I(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{I(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let i=()=>{e._x_doHide(),e._x_isShown=!1},o=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(o),l=Lt(f=>f?o():i(),f=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,f,o,i):f?a():i()}),c,u=!0;s(()=>r(f=>{!u&&f===c||(t.includes("immediate")&&(f?a():i()),l(f),c=f,u=!1)}))});O("for",(e,{expression:t},{effect:n,cleanup:s})=>{let r=Co(t),i=T(e,r.items),o=T(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},n(()=>Oo(e,r,i,o)),s(()=>{Object.values(e._x_lookup).forEach(a=>I(()=>{Ee(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function Oo(e,t,n,s){let r=o=>typeof o=="object"&&!Array.isArray(o),i=e;n(o=>{To(o)&&o>=0&&(o=Array.from(Array(o).keys(),d=>d+1)),o===void 0&&(o=[]);let a=e._x_lookup,l=e._x_prevKeys,c=[],u=[];if(r(o))o=Object.entries(o).map(([d,p])=>{let g=Bn(t,p,d,o);s(w=>{u.includes(w)&&L("Duplicate key on x-for",e),u.push(w)},{scope:{index:d,...g}}),c.push(g)});else for(let d=0;d<o.length;d++){let p=Bn(t,o[d],d,o);s(g=>{u.includes(g)&&L("Duplicate key on x-for",e),u.push(g)},{scope:{index:d,...p}}),c.push(p)}let f=[],h=[],y=[],_=[];for(let d=0;d<l.length;d++){let p=l[d];u.indexOf(p)===-1&&y.push(p)}l=l.filter(d=>!y.includes(d));let S="template";for(let d=0;d<u.length;d++){let p=u[d],g=l.indexOf(p);if(g===-1)l.splice(d,0,p),f.push([S,d]);else if(g!==d){let w=l.splice(d,1)[0],x=l.splice(g-1,1)[0];l.splice(d,0,x),l.splice(g,0,w),h.push([w,x])}else _.push(p);S=p}for(let d=0;d<y.length;d++){let p=y[d];p in a&&(I(()=>{Ee(a[p]),a[p].remove()}),delete a[p])}for(let d=0;d<h.length;d++){let[p,g]=h[d],w=a[p],x=a[g],M=document.createElement("div");I(()=>{x||L('x-for ":key" is undefined or invalid',i,g,a),x.after(M),w.after(x),x._x_currentIfEl&&x.after(x._x_currentIfEl),M.before(w),w._x_currentIfEl&&w.after(w._x_currentIfEl),M.remove()}),x._x_refreshXForScope(c[u.indexOf(g)])}for(let d=0;d<f.length;d++){let[p,g]=f[d],w=p==="template"?i:a[p];w._x_currentIfEl&&(w=w._x_currentIfEl);let x=c[g],M=u[g],P=document.importNode(i.content,!0).firstElementChild,F=be(x);Re(P,F,i),P._x_refreshXForScope=V=>{Object.entries(V).forEach(([m,B])=>{F[m]=B})},I(()=>{w.after(P),re(()=>J(P))()}),typeof M=="object"&&L("x-for key cannot be an object, it must be a string or an integer",i),a[M]=P}for(let d=0;d<_.length;d++)a[_[d]]._x_refreshXForScope(c[u.indexOf(_[d])]);i._x_prevKeys=u})}function Co(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,s=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,r=e.match(s);if(!r)return;let i={};i.items=r[2].trim();let o=r[1].replace(n,"").trim(),a=o.match(t);return a?(i.item=o.replace(t,"").trim(),i.index=a[1].trim(),a[2]&&(i.collection=a[2].trim())):i.item=o,i}function Bn(e,t,n,s){let r={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(o=>o.trim()).forEach((o,a)=>{r[o]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(o=>o.trim()).forEach(o=>{r[o]=t[o]}):r[e.item]=t,e.index&&(r[e.index]=n),e.collection&&(r[e.collection]=s),r}function To(e){return!Array.isArray(e)&&!isNaN(e)}function tr(){}tr.inline=(e,{expression:t},{cleanup:n})=>{let s=nt(e);s._x_refs||(s._x_refs={}),s._x_refs[t]=e,n(()=>delete s._x_refs[t])};O("ref",tr);O("if",(e,{expression:t},{effect:n,cleanup:s})=>{e.tagName.toLowerCase()!=="template"&&L("x-if can only be used on a <template> tag",e);let r=T(e,t),i=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return Re(a,{},e),I(()=>{e.after(a),re(()=>J(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{I(()=>{Ee(a),a.remove()}),delete e._x_currentIfEl},a},o=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};n(()=>r(a=>{a?i():o()})),s(()=>e._x_undoIf&&e._x_undoIf())});O("id",(e,{expression:t},{evaluate:n})=>{n(t).forEach(r=>yo(e,r))});rt((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});sn(us("@",ds(De("on:"))));O("on",re((e,{value:t,modifiers:n,expression:s},{cleanup:r})=>{let i=s?T(e,s):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let o=zt(e,t,n,a=>{i(()=>{},{scope:{$event:a},params:[a]})});r(()=>o())}));lt("Collapse","collapse","collapse");lt("Intersect","intersect","intersect");lt("Focus","trap","focus");lt("Mask","mask","mask");function lt(e,t,n){O(t,s=>L(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,s))}Be.setEvaluator(os);Be.setReactivityEngine({reactive:mn,effect:Ui,release:zi,raw:v});var Mo=Be,Ze=Mo;const $o=(e,t)=>t.some(n=>e instanceof n);let Ln,Gn;function Ro(){return Ln||(Ln=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Po(){return Gn||(Gn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nr=new WeakMap,Vt=new WeakMap,sr=new WeakMap,yt=new WeakMap,yn=new WeakMap;function Bo(e){const t=new Promise((n,s)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{n(ee(e.result)),r()},o=()=>{s(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&nr.set(n,e)}).catch(()=>{}),yn.set(t,e),t}function Lo(e){if(Vt.has(e))return;const t=new Promise((n,s)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});Vt.set(e,t)}let Kt={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Vt.get(e);if(t==="objectStoreNames")return e.objectStoreNames||sr.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ee(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Go(e){Kt=e(Kt)}function Fo(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(wt(this),t,...n);return sr.set(s,t.sort?t.sort():[t]),ee(s)}:Po().includes(e)?function(...t){return e.apply(wt(this),t),ee(nr.get(this))}:function(...t){return ee(e.apply(wt(this),t))}}function jo(e){return typeof e=="function"?Fo(e):(e instanceof IDBTransaction&&Lo(e),$o(e,Ro())?new Proxy(e,Kt):e)}function ee(e){if(e instanceof IDBRequest)return Bo(e);if(yt.has(e))return yt.get(e);const t=jo(e);return t!==e&&(yt.set(e,t),yn.set(t,e)),t}const wt=e=>yn.get(e);function No(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=ee(o);return s&&o.addEventListener("upgradeneeded",l=>{s(ee(o.result),l.oldVersion,l.newVersion,ee(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Uo=["get","getKey","getAll","getAllKeys","count"],zo=["put","add","delete","clear"],St=new Map;function Fn(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(St.get(t))return St.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=zo.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Uo.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return St.set(t,i),i}Go(e=>({...e,get:(t,n,s)=>Fn(t,n)||e.get(t,n,s),has:(t,n)=>!!Fn(t,n)||e.has(t,n)}));const _t="not-the-news-db",bt=29;let Z=null,me=null;const Vo=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function et(){if(Z)return Z;if(me)return me;me=No(_t,bt,{upgrade(e,t){console.log(`[DB] Upgrading database from version ${t} to ${bt}`);const n=new Set(e.objectStoreNames);Vo.forEach(s=>{let r;n.has(s.name)&&e.deleteObjectStore(s.name),r=e.createObjectStore(s.name,{keyPath:s.keyPath,...s.options||{}}),console.log(`[DB] Created/Recreated store: ${s.name}`),s.indexes&&s.indexes.forEach(i=>{r.createIndex(i.name,i.keyPath,i.options||{}),console.log(`[DB] Created index '${i.name}' on store '${s.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return Z=await me,console.log(`[DB] Opened '${_t}', version ${bt}`),Z}catch(e){throw console.error(`[DB] Failed to open database '${_t}':`,e),Z=null,me=null,e}}async function rr(){Z&&(Z.close(),Z=null,me=null,console.log("[DB] Database connection closed."))}async function C(e){let t=await et();return e(t)}const q=()=>navigator.onLine,$e=window.location.origin;async function Le(e,t,n){return C(async s=>{try{const r=n||new Date().toISOString();await s.put("userSettings",{key:e,value:t,lastModified:r})}catch(r){console.error(`[DB] Failed to save sync metadata for key '${e}':`,r)}})}async function Ko(e){return C(async t=>{const n={...e};n.id&&delete n.id;try{const s=t.transaction("pendingOperations","readwrite"),r=await s.store.add(n);return await s.done,r}catch(s){throw console.error("[DB] Error buffering operation:",s),s}})}async function j(e){if(!e||typeof e.type!="string"||e.type==="simpleUpdate"&&(e.value===null||e.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",e);return}try{const t=await Ko(e);console.log(`[DB] Operation buffered with ID: ${t}`,e);const{value:n}=await E("syncEnabled");if(q()&&n){console.log(`[DB] Attempting immediate sync for ${e.type} (ID: ${t}).`);const s=[{...e,id:t}],r=await fetch(`${$e}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const a=await r.text();throw new Error(`HTTP error ${r.status} for immediate sync. Details: ${a}`)}const i=await r.json(),o=i.results?.find(a=>a.id===t);o?.status==="success"?(await C(a=>a.delete("pendingOperations",t)),console.log(`[DB] Successfully synced and removed immediate op ${t} (${e.type}).`),i.serverTime&&await Le("lastStateSync",i.serverTime),W()):console.warn(`[DB] Immediate sync for op ${t} reported non-success by server:`,o)}else console.log(`[DB] ${q()?"Sync is disabled.":"Offline."} Buffering op ${t} for later batch sync.`)}catch(t){console.error(`[DB] Network error during immediate sync for ${e.type}. Will retry with batch sync.`,t)}}async function ae(){const{value:e}=await E("syncEnabled");if(!q()||!e){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const t=await C(n=>n.getAll("pendingOperations")).catch(n=>(console.error("[DB] Error fetching pending operations:",n),null));if(!t||t.length===0){t&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${t.length} batched operations to /api/user-state.`);try{const n=await fetch(`${$e}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error ${n.status}. Details: ${await n.text()}`);const s=await n.json();console.log("[DB] Batch sync successful. Server response:",s),s.results&&Array.isArray(s.results)?await C(async r=>{const i=r.transaction("pendingOperations","readwrite");for(const o of s.results)o.status==="success"&&o.id!==void 0?await i.store.delete(o.id):console.warn(`[DB] Op ${o.id??"N/A"} (${o.opType}) ${o.status}: ${o.reason||"N/A"}`);await i.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),s.serverTime&&await Le("lastStateSync",s.serverTime),W()}catch(n){console.error("[DB] Error during batch synchronization:",n)}}let vt=!1,jn=0;const Ho=500;async function Nn(e,t,n=!1){if(!n&&(await C(c=>c.getAll("pendingOperations")).catch(()=>[])).some(c=>c.key===e||c.type==="starDelta"&&e==="starred"||c.type==="readDelta"&&e==="read"||c.type==="simpleUpdate"&&c.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${e}' because local changes are pending synchronization.`),{key:e,status:"skipped_pending"};const{value:s,lastModified:r}=t.type==="array"?await se(t.store):await E(e,t.store),i=r||"",o={"Content-Type":"application/json"};i&&!n&&(o["If-None-Match"]=i);try{const a=await fetch(`${$e}/api/user-state/${e}`,{method:"GET",headers:o});if(a.status===304&&!n)return{key:e,status:304,timestamp:i};if(!a.ok)return console.error(`[DB] HTTP error for ${e}: ${a.status}`),{key:e,status:a.status};const l=await a.json();if(console.log(`[DB Sync] Received data for ${e}:`,l.value),t.type==="array"){const c=l.value||[],u=s||[],f=new Set(c.map(S=>S.guid)),h=new Set(u.map(S=>S.guid)),y=n?c:c.filter(S=>!h.has(S.guid)),_=n?[]:u.filter(S=>!f.has(S.guid));(y.length>0||_.length>0||n)&&await C(async S=>{const d=S.transaction(t.store,"readwrite");n&&await d.store.clear();for(const p of y)await d.store.put(p);for(const p of _)n||await d.store.delete(p.id);await d.done})}else await Le(e,l.value,l.lastModified);return{key:e,status:200,timestamp:l.lastModified}}catch(a){return console.error(`[DB] Failed to pull ${e}:`,a),{key:e,status:"error"}}}async function W(e=!1){if(!q())return;let{value:t}=await E("syncEnabled");if(!t&&!e){console.log("[DB] Sync is disabled locally. Checking for remote status...");const s=U.syncEnabled;(await Nn("syncEnabled",s,!1)).status===200&&(t=(await E("syncEnabled")).value)}if(!t&&!e||vt&&!e)return;const n=Date.now();if(!(!e&&n-jn<Ho)){jn=n,vt=!0,console.log(`[DB] Pulling user state (force=${e})...`);try{const s=Object.entries(U).filter(([o,a])=>!a.localOnly&&o!=="syncEnabled"),i=(await Promise.all(s.map(([o,a])=>Nn(o,a,e)))).reduce((o,a)=>a?.timestamp&&a.timestamp>o?a.timestamp:o,"");i&&await Le("lastStateSync",i)}catch(s){console.error("[DB] User state pull failed:",s)}finally{vt=!1,console.log("[DB] User state pull completed.")}}}async function wn(){return C(e=>e.getAll("feedItems")).catch(e=>(console.error("Failed to get all feed items:",e),[]))}async function ye(e){const{value:t}=await E("syncEnabled");if(!q()||!t)return t&&console.log("[DB] Offline. Skipping feed sync."),!0;console.log("[DB] Fetching feed items from server.");try{const{value:n}=await E("lastFeedSync"),s=await fetch(`${$e}/api/feed-guids?since=${n||""}`);if(s.status===304)return console.log("[DB] Feed not modified."),!0;if(!s.ok)throw new Error(`HTTP error ${s.status} for /api/feed-guids`);const r=await s.json();console.log("[DB] /api/feed-guids response:",r);const{guids:i,serverTime:o}=r,a=new Set(i),l=await wn(),c=new Set(l.map(_=>_.guid)),u=[...a].filter(_=>!c.has(_));console.log(`[DB] GUIDs to fetch: ${u.length}`,u);const f=[...c].filter(_=>!a.has(_));console.log(`[DB] New GUIDs: ${u.length}, Deleting: ${f.length}`);const h=u.length;let y=0;if(u.length>0){const S=[];for(let d=0;d<u.length;d+=50){const p=u.slice(d,d+50),g=await fetch(`${$e}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:p})});if(g.ok){const w=await g.json();console.log(`[DB] Fetched batch of ${w.length} items:`,w),S.push(...w),y+=w.length,e&&(e.progressMessage=`Fetching feed content... (${y}/${h})`)}else return console.error(`[DB] Failed to fetch a batch of feed items. Status: ${g.status}`),!1}await C(async d=>{const p=d.transaction("feedItems","readwrite");for(const g of S)g.guid&&await p.store.put(g);await p.done})}if(f.length>0){const _=new Map(l.map(S=>[S.guid,S.id]));await C(async S=>{const d=S.transaction("feedItems","readwrite");for(const p of f){const g=_.get(p);g!==void 0&&await d.store.delete(g)}await d.done})}return o&&await Le("lastFeedSync",o),e?.loadFeedItemsFromDB?.(),e?.loadAndDisplayDeck?.(),e?.updateCounts?.(),!0}catch(n){return console.error("[DB] Failed to synchronize feed:",n),!1}}async function Sn(e){const{value:t}=await E("syncEnabled");if(!q()||!t)return!0;console.log("[DB] Full sync initiated.");try{return await ae(),await W(),await ye(e)}catch(n){return console.error("[DB] Full sync failed:",n),!1}}const U={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},syncEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},theme:{store:"userSettings",type:"simple",localOnly:!1,default:"dark"},themeStyle:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleLight:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleDark:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},customCss:{store:"userSettings",type:"simple",localOnly:!1,default:""},fontSize:{store:"userSettings",type:"simple",localOnly:!0,default:100},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0},rssFeeds:{store:"userSettings",type:"simple",localOnly:!1,default:{}},keywordBlacklist:{store:"userSettings",type:"simple",localOnly:!1,default:[]},shuffleCount:{store:"userSettings",type:"simple",localOnly:!1,default:2},lastShuffleResetDate:{store:"userSettings",type:"simple",localOnly:!1,default:null},shadowsEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0}};async function E(e,t="userSettings"){return C(async n=>{try{const s=await n.get(t,e);return{value:s?s.value:U[e]?.default||null,lastModified:s?.lastModified||null}}catch(s){return console.error(`Failed to load simple state for key '${e}':`,s),{value:U[e]?.default||null,lastModified:null}}})}async function G(e,t,n="userSettings"){await C(r=>r.put(n,{key:e,value:t,lastModified:new Date().toISOString()}));const s=U[e];s&&!s.localOnly&&await j({type:"simpleUpdate",key:e,value:t,timestamp:new Date().toISOString()})}const ir=e=>{switch(e){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function se(e){return console.log(`ENTERING loadArrayState for ${e}`),C(async t=>{try{const n=await t.getAll(e);if(n.length>0&&(typeof n[0]=="string"||n[0].id===void 0)){console.log(`[DB] Migration required for '${e}'.`);const r=ir(e),i=new Date().toISOString(),o=new Map;n.forEach(u=>{const f=typeof u=="string"?u:u.guid;f&&!o.has(f)&&o.set(f,u)});const l=Array.from(o.values()).map(u=>({guid:typeof u=="string"?u:u.guid,[r]:i})),c=t.transaction(e,"readwrite");await c.store.clear();for(const u of l)await c.store.put(u);return await c.done,console.log(`[DB] Migration complete for '${e}'.`),{value:await t.getAll(e)}}return{value:n||U[e]?.default||[]}}catch(n){return console.error(`Failed to load array state from store '${e}':`,n),{value:U[e]?.default||[]}}})}async function or(e,t){return C(n=>n.getFromIndex(e,"guid",t)).catch(n=>{console.error(`Error finding item by GUID '${t}' in store '${e}':`,n)})}async function _n(e,t,n){await C(async r=>{const i=r.transaction(e,"readwrite");if(!t||!t.guid){console.error("[DB] updateArrayState requires an item with a guid property.",t);return}const o=i.objectStore(e);if(n)await o.put(t);else{const a=await o.index("guid").get(t.guid);a?.id!==void 0&&await o.delete(a.id)}await i.done});const s=Object.entries(U).find(([,r])=>r.store===e);if(s&&!s[1].localOnly){let r="";e==="starred"&&(r="starDelta"),e==="read"&&(r="readDelta"),r&&await j({type:r,guid:t.guid,action:n?"add":"remove",timestamp:t[ir(e)]||new Date().toISOString()})}}async function ct(e,t){const{value:n}=await se(e),s=new Set(n.map(c=>c.guid));await pe(e,t);const r=new Set(t.map(c=>c.guid)),i=[...s].filter(c=>!r.has(c)),o=[...r].filter(c=>!r.has(c)),a=Object.entries(U).find(([,c])=>c.store===e);if(!a||a[1].localOnly)return;let l="";if(e==="starred"&&(l="starDelta"),e==="read"&&(l="readDelta"),!l){await j({type:"simpleUpdate",key:a[0],value:t,timestamp:new Date().toISOString()});return}if(i.length>0){console.log(`[DB] Queuing ${i.length} 'remove' operations for '${e}'.`);for(const c of i)await j({type:l,guid:c,action:"remove",timestamp:new Date().toISOString()})}if(o.length>0){console.log(`[DB] Queuing ${o.length} 'add' operations for '${e}'.`);for(const c of o)await j({type:l,guid:c,action:"add",timestamp:new Date().toISOString()})}}async function ar(e,t){if(!Array.isArray(e)||!Array.isArray(t)){console.warn("[DB] pruneStaleReadItems skipped due to invalid input.");return}const n=new Set(t.map(o=>o.guid)),s=720*60*60*1e3,r=Date.now(),i=e.filter(o=>{if(n.has(o.guid))return!0;const a=new Date(o.readAt).getTime();return r-a<s});if(i.length<e.length){const o=e.length-i.length;console.log(`[DB] Pruning ${o} stale read items.`),await ct("read",i)}else console.log("[DB] No stale read items to prune.")}async function pe(e,t){return C(async n=>{const s=n.transaction(e,"readwrite");await s.store.clear();for(const r of t){const i=JSON.parse(JSON.stringify(r));delete i.id,await s.store.put(i)}await s.done})}const X=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,findByGuid:or,loadArrayState:se,loadSimpleState:E,overwriteArrayAndSyncChanges:ct,pruneStaleReadItems:ar,queueAndAttemptSyncOperation:j,saveArrayState:pe,saveSimpleState:G,updateArrayState:_n},Symbol.toStringTag,{value:"Module"})),Wo=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,closeDb:rr,findByGuid:or,getAllFeedItems:wn,initDb:et,loadArrayState:se,loadSimpleState:E,overwriteArrayAndSyncChanges:ct,performFeedSync:ye,performFullSync:Sn,processPendingOperations:ae,pruneStaleReadItems:ar,pullUserState:W,queueAndAttemptSyncOperation:j,saveArrayState:pe,saveSimpleState:G,updateArrayState:_n,withDb:C},Symbol.toStringTag,{value:"Module"}));function Un(e){const t=new Date,n=new Date(e),s=Math.floor((t.getTime()-n.getTime())/1e3),r=336*60*60;if(s>r)return n.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const i=Math.floor(s/60),o=Math.floor(i/60),a=Math.floor(o/24);if(s<60)return"Just now";if(i<60)return`${i} minute${i!==1?"s":""} ago`;if(o<24)return`${o} hour${o!==1?"s":""} ago`;if(a<7)return`${a} day${a!==1?"s":""} ago`;const l=Math.floor(a/7);return`${l} week${l!==1?"s":""} ago`}function zn(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function Dt(e){const t=[];if(!e)return t;if(Array.isArray(e))e.forEach(n=>{typeof n=="string"&&n.trim()?t.push(n.trim()):n&&typeof n=="object"&&n.url&&t.push(n.url.trim())});else if(typeof e=="object")for(const n in e){const s=e[n];if(s&&typeof s=="object")for(const r in s){const i=s[r];Array.isArray(i)&&i.forEach(o=>{o&&o.url&&t.push(o.url.trim())})}}return t}function lr(e,t){if(!e)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const s=new DOMParser().parseFromString(e.description||"","text/html"),r=s.querySelectorAll("img");let i="";if(r.length===1){const u=r[0];u.classList.add("title-image"),i=u.src||"",u.remove()}else r.forEach(u=>{u.setAttribute("loading","lazy"),u.setAttribute("onload","this.classList.add('loaded')")});let o="";const a=s.querySelector(".source-url")||s.querySelector("a");a?(o=a.textContent?.trim()||"",a.remove()):o=e.link?new URL(e.link).hostname:"";const l=s.body.innerHTML.trim(),c=Date.parse(e.pubDate)||0;return{guid:e.guid,image:i,title:e.title,link:e.link,pubDate:t(e.pubDate||""),description:l,source:o,timestamp:c}}function qo(e,t){if(console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),!Array.isArray(e))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const n=e.map(s=>lr(s,t)).filter(s=>s!==null).sort((s,r)=>r.timestamp-s.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${n.length}`),n}async function Jo(e,t,n,s,r){console.log("ENTERING generateNewDeck with filterMode:",r),console.log("generateNewDeck: allFeedItems count:",e.length),console.log("generateNewDeck: readItems count:",t.length);try{const o=d=>{if(!Array.isArray(d))return new Set;const p=d.map(g=>typeof g=="object"&&"guid"in g&&g.guid?g.guid:g);return new Set(p.filter(g=>typeof g=="string"&&!!g))},a=new Set(e.map(d=>d.guid)),l=new Set([...o(t)].filter(d=>a.has(d))),c=new Set([...o(n)].filter(d=>a.has(d))),u=new Set([...o(s)].filter(d=>a.has(d)));console.log(`[generateNewDeck] readGuidsSet size: ${l.size}`),console.log(`[generateNewDeck] shuffledOutGuidsSet size: ${u.size}`);let f=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${f.length}`),r){case"read":f=e.filter(d=>l.has(d.guid));break;case"starred":f=e.filter(d=>c.has(d.guid));break;default:f=e.filter(d=>!l.has(d.guid)&&!u.has(d.guid)),f.length===0&&(console.log("generateNewDeck: No unread/unshuffled items found, trying all unshuffled items."),f=e.filter(d=>!u.has(d.guid))),f.length===0&&(console.log("generateNewDeck: No unshuffled items found, trying all unread items."),f=e.filter(d=>!l.has(d.guid))),f.length===0&&(console.log("generateNewDeck: Absolutely no filter matches, using all items."),f=[...e]);break}if(console.log("generateNewDeck: Final filteredItems count:",f.length),r==="read"||r==="starred")return f.sort((d,p)=>p.timestamp-d.timestamp),console.log(`[generateNewDeck] Filtered items for ${r}: ${f.length}`),f;let h=[];const y=new Set,_=d=>h.length<10&&d&&!y.has(d.guid)?(h.push(d),y.add(d.guid),!0):!1,S=(d,p)=>{let g=0;for(const w of d){if(g>=p||h.length>=10)break;_(w)&&g++}};if(navigator.onLine){const d=Date.now(),p=A=>/<a\s+href=/i.test(A.description),g=A=>A.title?.includes("?"),w=A=>A.description?.length>=150&&A.description.substring(0,150).includes("?"),x=A=>{const $=A.description;return $?.length>=150&&$.substring($.length-150).includes("?")},M=A=>A.image!=="",P=A=>A.description?.length>=750,F=A=>A.description?.length<750,V=f.filter(A=>d-A.timestamp<=1440*60*1e3);S(V,2),console.log(`[generateNewDeck] After recentItems: ${h.length}`);const m=f.filter(p);S(m,1),console.log(`[generateNewDeck] After itemsWithLinks: ${h.length}`);const B=f.filter(g);S(B,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${h.length}`);const D=f.filter(w);S(D,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${h.length}`);const K=f.filter(x);S(K,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${h.length}`);const k=f.filter(M);S(k,1),console.log(`[generateNewDeck] After itemsWithImages: ${h.length}`);const dt=f.filter(P);S(dt,1),console.log(`[generateNewDeck] After longItems: ${h.length}`);const ie=f.filter(F);S(ie,1),console.log(`[generateNewDeck] After shortItems: ${h.length}`);const wr=f.filter(A=>!y.has(A.guid)),Sr=zn([...wr]);for(const A of Sr){if(h.length>=10)break;_(A)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${h.length}`),h.length<10){const A=e.filter($=>u.has($.guid)&&!l.has($.guid)&&!y.has($.guid));A.sort(($,Y)=>$.timestamp-Y.timestamp);for(const $ of A){if(h.length>=10)break;_($)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${h.length}`),h.length<10){const $=e.filter(Y=>!y.has(Y.guid));$.sort((Y,_r)=>Y.timestamp-_r.timestamp);for(const Y of $){if(h.length>=10)break;h.push(Y),y.add(Y.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${h.length}`)}}}else{let d=[...f];const p=m=>m.title?.includes("?"),g=m=>m.description?.length>=150&&m.description.substring(0,150).includes("?"),w=m=>{const B=m.description;return B?.length>=150&&B.substring(B.length-150).includes("?")},x=m=>/<a\s+href=/i.test(m.description),M=m=>m.image!=="";if(d=d.filter(m=>!p(m)),d=d.filter(m=>!(m.description&&g(m))),d=d.filter(m=>!(m.description&&w(m))),d=d.filter(m=>!x(m)),d=d.filter(m=>!M(m)),d.length<10){let m=f.filter(D=>!d.includes(D));const B=[D=>M(D),D=>x(D),D=>D.description&&w(D),D=>D.description&&g(D),D=>p(D)];for(const D of B){for(;d.length<10;){const K=m.find(D);if(K)d.push(K),m=m.filter(k=>k!==K);else break}if(d.length>=10)break}for(;d.length<10&&m.length>0;)d.push(m.shift())}const P=Date.now();h=d.filter(m=>P-m.timestamp<=1440*60*1e3).slice(0,2);const V=d.filter(m=>!h.includes(m));h=h.concat(V.slice(0,10-h.length))}return zn([...h])}catch(i){return console.error("An error occurred during deck generation:",i),[]}}function Ht(e){if(typeof structuredClone=="function")try{return structuredClone(e)}catch(n){console.error("structuredClone failed, falling back to manual sanitization.",n)}const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const s=e[n];typeof s=="object"&&s!==null?Array.isArray(s)?t[n]=s.map(r=>Ht(r)):t[n]=Ht(s):typeof s!="function"&&(t[n]=s)}return t}async function Wt(e,t,n){const r=e[n].some(c=>c.guid===t)?"remove":"add",i=new Date().toISOString(),o=n==="read"?{guid:t,readAt:i}:{guid:t,starredAt:i};await _n(n,o,r==="add"),r==="add"?n==="read"?e.read=[...e.read,o]:e.starred=[...e.starred,o]:n==="read"?e.read=e.read.filter(c=>c.guid!==t):e.starred=e.starred.filter(c=>c.guid!==t),typeof e.updateCounts=="function"&&e.updateCounts();const l={type:`${n}Delta`,guid:t,action:r,timestamp:i};await j(l)}async function cr(e,t,n){if(!Array.isArray(t))return[];if(!Array.isArray(e)||e.length===0)return t;const s=new Set(e.filter(i=>i&&i.guid).map(i=>String(i.guid).trim().toLowerCase())),r=720*60*60*1e3;return t.filter(i=>{if(!i||!i.guid)return!1;const o=String(i.guid).trim().toLowerCase();if(s.has(o))return!0;if(i.readAt){const a=new Date(i.readAt).getTime();if(!isNaN(a))return n-a<r}return!0})}async function ur(e){const{value:t}=await se("read");let n=!1,s=[];if(Array.isArray(t)){const i=new Date().toISOString();for(const o of t)typeof o=="string"&&o?(s.push({guid:o,readAt:i}),n=!0):typeof o=="object"&&o!==null&&typeof o.guid=="string"&&o.guid&&(o.readAt||(o.readAt=i,n=!0),s.push(o))}const r=await cr(e,s,Date.now());if(r.length!==s.length&&(n=!0),n)try{await pe("read",r),console.log(`Sanitized, pruned, or migrated read items. Original count: ${t.length}, New count: ${r.length}`)}catch(i){console.error("Error saving pruned read items:",i)}return r}async function dr(){const{value:e}=await se("currentDeckGuids");if(e&&e.length>0&&typeof e[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const n=new Date().toISOString(),s=e.map(r=>({guid:r,addedAt:n}));return await pe("currentDeckGuids",s),console.log(`[loadCurrentDeck] Migration complete. Loaded ${s.length} objects.`),s}const t=Array.isArray(e)?e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid):[];return console.log(`[loadCurrentDeck] Loaded ${t.length} deck objects.`),t}async function fr(e){if(!Array.isArray(e)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const t=e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid);t.length!==e.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",t.length,"deck objects.");try{const n=t.map(s=>Ht(s));await ct("currentDeckGuids",n)}catch(n){console.error("[saveCurrentDeck] An error occurred while saving the deck:",n)}}async function hr(){const{value:e}=await E("shuffleCount"),{value:t}=await E("lastShuffleResetDate");return{shuffleCount:typeof e=="number"?e:2,lastShuffleResetDate:t||null}}async function tt(e,t){await G("shuffleCount",e),await G("lastShuffleResetDate",t),await j({type:"simpleUpdate",key:"shuffleCount",value:e,timestamp:new Date().toISOString()}),await j({type:"simpleUpdate",key:"lastShuffleResetDate",value:t,timestamp:new Date().toISOString()})}async function gr(e,t){e.filterMode=t,await G("filterMode",t),await j({type:"simpleUpdate",key:"filterMode",value:t,timestamp:new Date().toISOString()})}async function pr(){const{value:e}=await E("filterMode");return e||"unread"}const qt=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:ur,loadCurrentDeck:dr,loadFilterMode:pr,loadShuffleState:hr,pruneStaleRead:cr,saveCurrentDeck:fr,saveShuffleState:tt,setFilterMode:gr,toggleItemStateAndSync:Wt},Symbol.toStringTag,{value:"Module"})),Yo=()=>document.getElementById("sync-toggle"),Qo=()=>document.getElementById("images-toggle"),Xo=()=>document.getElementById("open-urls-in-new-tab-toggle"),Zo=()=>document.getElementById("shadows-toggle"),ea=()=>document.getElementById("shuffle-count-display"),ta=()=>document.getElementById("filter-selector"),na=()=>document.querySelector("#ntn-title h2");function sa(e,t=30){const n=e.split(" ");let s=[],r=[],i=0;for(const o of n){const a=o.length+(s.length>0?1:0);i+a<=t?(s.push(o),i+=a):r.push(o)}return[s.join(" "),r.join(" ")].filter(Boolean)}async function ra(e){const t=na();if(!t){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const n="NOT THE NEWS",s=sa(e),r=t.style.overflow;t.style.overflow="visible";const i=o=>new Promise(a=>setTimeout(a,o));s.length>0&&(t.textContent=s[0],await i(1500)),s.length>1?(t.textContent=s.join(" "),await i(1500)):s.length===1&&await i(1500),t.textContent=n,t.style.overflow=r}let kt;function b(e,t){console.log(`[Status] ${t}`),kt&&clearTimeout(kt),e.syncStatusMessage=t;const n=()=>{e.showSyncStatus=!0,kt=setTimeout(()=>{e.showSyncStatus=!1,setTimeout(()=>{e.showSyncStatus||(e.syncStatusMessage="")},300)},5e3)};e.$nextTick?e.$nextTick(n):n()}let Et;function ia(e,t,n=null){Et&&clearTimeout(Et),e.undoItemGuid=t,e.undoItemIndex=n,e.showUndo=!0,e.undoTimerActive=!1;const s=()=>{e.undoTimerActive=!0,Et=setTimeout(()=>{e.showUndo=!1,e.undoTimerActive=!1,setTimeout(()=>{e.showUndo||(e.undoItemGuid=null)},500)},5e3)};e.$nextTick?e.$nextTick(s):setTimeout(s,10)}function Vn(e){const t=document.getElementById("main-settings"),n=document.getElementById("rss-settings-block"),s=document.getElementById("keywords-settings-block"),r=document.getElementById("css-settings-block"),i=document.getElementById("advanced-settings-block");if(!t||!n||!s||!r||!i)return console.warn("One or more settings panels not found."),Promise.resolve();switch(t.style.display="none",n.style.display="none",s.style.display="none",r.style.display="none",i.style.display="none",e.modalView){case"main":t.style.display="block";break;case"rss":n.style.display="block";break;case"keywords":s.style.display="block";break;case"css":r.style.display="block";break;case"advanced":i.style.display="block";break;default:console.warn("Unknown modalView:",e.modalView),t.style.display="block"}return Promise.resolve()}async function oa(e){if(!e?.entries?.length||!e.read||!e.starred||!e.currentDeckGuids){console.warn("Attempted to update counts with an invalid app object. Skipping.");return}const t=new Set(e.read.map(f=>f.guid)),n=new Set(e.starred.map(f=>f.guid)),s=new Set(e.currentDeckGuids.map(f=>f.guid)),r=e.entries,i=r.length,o=r.filter(f=>t.has(f.guid)).length,a=r.filter(f=>n.has(f.guid)).length,l=r.filter(f=>s.has(f.guid)&&!t.has(f.guid)).length,c=ta();if(!c)return;const u={all:i,read:o,starred:a,unread:l};Array.from(c.options).forEach(f=>{const h=f.text.split(" ")[0];f.text=`${h} (${u[f.value]??0})`})}function mr(){window.scrollTo({top:0,behavior:"smooth"})}const aa=(()=>{let e,t=0;return(n="scroll-to-top")=>{const s=document.getElementById(n);if(!s)return;const r=()=>{const i=window.scrollY;s.classList.toggle("visible",i<t&&i>0),t=i,clearTimeout(e),e=setTimeout(()=>s.classList.remove("visible"),2e3)};window.addEventListener("scroll",r),s.addEventListener("click",i=>{i.preventDefault(),mr()})}})();async function At(){let e="",t=0;const n=document.querySelectorAll(".entry[data-guid]"),s=Array.from(n).find(r=>r.getBoundingClientRect().bottom>0);if(s){const r=s.getBoundingClientRect();e=s.dataset.guid||"",t=r.top}await G("lastViewedItemId",e),await G("lastViewedItemOffset",t)}const la={syncEnabled:"Auto-Sync",imagesEnabled:"Images",openUrlsInNewTabEnabled:"Open in New Tab",shadowsEnabled:"Shadows"};async function ut(e,t,n,s=()=>{}){const r=t();r&&r.addEventListener("change",async()=>{const i=e[n];await G(n,i);const o=la[n]||n;b(e,`${o} ${i?"Enabled":"Disabled"}.`),s(i)})}async function ca(e){await ut(e,Yo,"syncEnabled",async t=>{if(e.updateSyncStatusMessage?.(),t&&(b(e,"Kicking off a new sync"),console.log("Sync enabled, triggering full sync."),await Sn(e)?b(e,"Sync complete!"):b(e,"Sync finished with some issues."),!e.currentDeckGuids?.length&&e.entries?.length)){console.log("Deck is empty after sync. Rebuilding from all available items.");const s=new Date().toISOString(),r=new Set(e.read?.map(o=>o.guid)),i=new Set(e.shuffledOutGuids?.map(o=>o.guid));e.currentDeckGuids=e.entries.filter(o=>!r.has(o.guid)&&!i.has(o.guid)).map(o=>({guid:o.guid,addedAt:s})),await pe("currentDeckGuids",e.currentDeckGuids),console.log(`Rebuilt deck with ${e.currentDeckGuids.length} items.`)}})}async function ua(e){await ut(e,Qo,"imagesEnabled")}async function da(e){await ut(e,Zo,"shadowsEnabled")}async function fa(e){await ut(e,Xo,"openUrlsInNewTabEnabled")}async function ha(e){window.requestAnimationFrame(async()=>{const{value:t}=await E("lastViewedItemId"),{value:n}=await E("lastViewedItemOffset");if(!t||!e.deck?.length)return;if(e.deck.some(r=>r.guid===t)){const r=document.querySelector(`.entry[data-guid="${t}"]`);r&&(r.scrollIntoView({behavior:"auto",block:"start"}),typeof n=="number"&&n!==0&&window.scrollTo({top:window.scrollY-n,behavior:"auto"}))}})}let ze;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),ze=e;const t=document.getElementById("install-button");t&&(t.style.display="block",t.addEventListener("click",()=>{ze.prompt(),ze.userChoice.then(n=>{n.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),ze=null})}))});const Ve=2,we=e=>typeof e=="object"&&e.guid?e.guid:e,qe=async(e,t,n,s,r,i="unread",o=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:e.length,readItemsCount:t.length,starredItemsCount:n.length,shuffledOutItemsCount:s.length,shuffleCount:r,filterMode:i,lastShuffleResetDate:o}),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(e),"entries.length:",e.length),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(e),"entries.length:",e.length),!Array.isArray(e)||e.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),console.log("manageDailyDeck: END (skipped)"),{deck:[],currentDeckGuids:[],shuffledOutGuids:Array.isArray(s)?s:[],shuffleCount:typeof r=="number"?r:Ve,lastShuffleResetDate:typeof o=="string"?o:new Date().toDateString()};const a=e,l=Array.isArray(t)?t:[],c=Array.isArray(n)?n:[],u=Array.isArray(s)?s:[],{loadCurrentDeck:f}=await R(async()=>{const{loadCurrentDeck:k}=await Promise.resolve().then(()=>qt);return{loadCurrentDeck:k}},void 0),h=await f();console.log("manageDailyDeck: Loaded currentDeckItems count:",h.length);const y=new Set(l.map(we)),_=new Set(c.map(we)),S=new Set(u.map(we)),d=new Map(e.map(k=>[k.guid,k]));let p=h.map(k=>d.get(we(k))).filter(k=>!!k);const g=new Date().toDateString(),w=o!==g,x=!h||h.length===0||p.length===0,M=!x&&p.every(k=>y.has(k.guid)),P=!x&&p.every(k=>S.has(k.guid)),F=x||M||P;console.log("manageDailyDeck: Deck Status:",{isDeckEmpty:x,allItemsInDeckRead:M,allItemsInDeckShuffled:P,isDeckEffectivelyEmpty:F,existingDeckCount:p.length,currentDeckItemsCount:h.length});let V=p,m=h,B=u,D=typeof r=="number"?r:Ve,K=o||g;if(console.log("manageDailyDeck: Condition check:",{isNewDay:w,isDeckEffectivelyEmpty:F,filterModeIsNotUnread:i!=="unread",entriesCount:e.length}),w||F||i!=="unread"||h.length===0&&e.length>0){console.log(`[deckManager] Resetting deck. Reason: New Day (${w}), Deck Effectively Empty (${F}), Filter Mode Changed (${i}), or Initial Load (${h.length===0}).`),!w&&h.length>0&&F&&i==="unread"&&(console.log("[deckManager] Automatically incrementing shuffleCount due to empty deck."),D++,await tt(D,K));const k=await Jo(a,l,c,u,i);console.log("manageDailyDeck: generateNewDeck returned count:",k.length);const dt=new Date().toISOString();m=(k||[]).map(ie=>({guid:ie.guid,addedAt:dt})),V=(k||[]).map(ie=>({...ie,isRead:y.has(ie.guid),isStarred:_.has(ie.guid)})),await fr(m),w&&(B=[],await pe("shuffledOutGuids",[]),D=Ve,await tt(D,g),K=g,await G("lastShuffleResetDate",g))}else V=p.map(k=>({...k,isRead:y.has(k.guid),isStarred:_.has(k.guid)}));return console.log(`[deckManager] Deck management complete. Final deck size: ${V.length}.`),console.log("manageDailyDeck: END"),{deck:V||[],currentDeckGuids:m||[],shuffledOutGuids:B||[],shuffleCount:typeof D=="number"?D:Ve,lastShuffleResetDate:typeof K=="string"?K:new Date().toDateString()}};async function ga(e){if(console.log("[deckManager] processShuffle called."),e.shuffleCount<=0){b(e,"No shuffles left for today!");return}const t=e.deck.map(u=>u.guid);console.log(`[deckManager] processShuffle: Visible GUIDs to shuffle out: ${t.length}`,t);const n=(e.shuffledOutGuids||[]).map(we).map(u=>({guid:u,shuffledAt:new Date().toISOString()})),s=new Set(n.map(we)),r=new Set([...s,...t]),i=new Date().toISOString(),o=Array.from(r).map(u=>({guid:u,shuffledAt:i}));e.shuffledOutGuids=o,e.shuffleCount--;const{overwriteArrayAndSyncChanges:a}=await R(async()=>{const{overwriteArrayAndSyncChanges:u}=await Promise.resolve().then(()=>X);return{overwriteArrayAndSyncChanges:u}},void 0);await a("shuffledOutGuids",o),await tt(e.shuffleCount,e.lastShuffleResetDate??new Date().toDateString());const l=ea();l&&(l.textContent=e.shuffleCount.toString());const c=await qe(e.entries,e.read,e.starred,e.shuffledOutGuids,e.shuffleCount,e.filterMode,e.lastShuffleResetDate);e.deck=c.deck,e.currentDeckGuids=c.currentDeckGuids,e.shuffledOutGuids=c.shuffledOutGuids,e.shuffleCount=c.shuffleCount,e.lastShuffleResetDate=c.lastShuffleResetDate,ra("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${e.shuffleCount}.`)}async function yr(e,t){const n=e.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable)return;const r=e.key,i=e.ctrlKey||e.metaKey;if(t.openShortcuts&&r!=="?"&&r!=="Escape"&&!(r==="k"&&i)){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," ","j","k"].includes(r)&&e.preventDefault();return}switch(r){case"j":case"ArrowDown":e.preventDefault(),await Ke(t,1);break;case"k":i?(e.preventDefault(),t.openShortcuts?t.openShortcuts=!1:t.openShortcuts=!0):(e.preventDefault(),await Ke(t,-1));break;case"ArrowUp":e.preventDefault(),await Ke(t,-1);break;case" ":case"n":if(e.preventDefault(),t.selectedGuid){const o=t.selectedGuid;await Ke(t,1),await t.toggleRead(o)}else t.filteredEntries.length>0&&(t.selectedGuid=t.filteredEntries[0].guid,bn(t.selectedGuid,t));break;case"s":case"L":t.selectedGuid&&(e.preventDefault(),await t.toggleStar(t.selectedGuid));break;case"i":e.preventDefault(),t.imagesEnabled=!t.imagesEnabled,b(t,`Images ${t.imagesEnabled?"Enabled":"Disabled"}.`),R(()=>Promise.resolve().then(()=>Wo),void 0).then(o=>{o.saveSimpleState("imagesEnabled",t.imagesEnabled)});break;case"o":case"Enter":if(t.selectedGuid){e.preventDefault();const o=t.filteredEntries.find(a=>a.guid===t.selectedGuid);o?.link&&window.open(o.link,"_blank","noopener,noreferrer")}break;case"r":case"m":t.selectedGuid&&(e.preventDefault(),await t.toggleRead(t.selectedGuid));break;case"t":e.preventDefault(),t.scrollToTop();break;case"u":e.preventDefault(),await t.undoMarkRead();break;case"?":e.preventDefault(),t.openShortcuts?t.openShortcuts=!1:t.openShortcuts=!0;break;case"Escape":t.openShortcuts?(e.preventDefault(),t.openShortcuts=!1):t.openSettings?(e.preventDefault(),t.openSettings=!1):t.selectedGuid&&(e.preventDefault(),t.selectedGuid=null);break;case"z":i&&(e.preventDefault(),await t.undoMarkRead());break}}async function Ke(e,t){const n=e.filteredEntries;if(n.length!==0){if(e.selectedGuid){let r=n.findIndex(i=>i.guid===e.selectedGuid)+t;r>=n.length&&(r=n.length-1),r<0&&(r=0),e.selectedGuid=n[r].guid}else{const s=e.lastSelectedGuid,r=s?n.findIndex(i=>i.guid===s):-1;if(r===-1)e.selectedGuid=n[0].guid;else{let i=r+t;i>=n.length&&(i=n.length-1),i<0&&(i=0),e.selectedGuid=n[i].guid}}bn(e.selectedGuid,e)}}function bn(e,t){if(e){if(t.filteredEntries.length>0&&t.filteredEntries[0].guid===e){t.scrollToTop();return}setTimeout(()=>{const n=document.querySelector(`.entry[data-guid="${e}"]`);if(n){const s=document.querySelector("#header"),r=s?s.getBoundingClientRect().height:0,o=n.getBoundingClientRect().top+window.pageYOffset-r-20;window.scrollTo({top:o,behavior:"smooth"})}},10)}}const pa=Object.freeze(Object.defineProperty({__proto__:null,handleKeyboardShortcuts:yr,scrollSelectedIntoView:bn},Symbol.toStringTag,{value:"Module"}));function ma(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,openShortcuts:!1,modalView:"main",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,openUrlsInNewTabEnabled:!0,shadowsEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutGuids:[],errorMessage:"",isOnline:q(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",themeStyle:"original",themeStyleLight:"original",themeStyleDark:"original",customCss:"",fontSize:100,showUndo:!1,undoTimerActive:!1,undoItemGuid:null,undoItemIndex:null,selectedGuid:null,lastSelectedGuid:null,starredGuid:null,readingGuid:null,_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,imageObserver:null,db:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,lastShuffleResetDate:null,initApp:async function(){try{if(this.progressMessage="Connecting to database...",this.db=await et(),this.progressMessage="Loading settings...",await this._loadInitialState(),this._initImageObserver(),this.isOnline){this.progressMessage="Syncing latest content...",await ae(),await W();const e=await ye(this);await this._loadAndManageAllData(),e?b(this,"Initial sync complete!"):b(this,"Sync finished with some issues. Check console for details.")}else this.progressMessage="Offline mode. Loading local data...",await this._loadAndManageAllData();this.progressMessage="Applying user preferences...",ca(this),ua(this),da(this),fa(this),aa(),this.$nextTick(()=>{ha(this)}),this.progressMessage="Setting up app watchers...",this._setupWatchers(),this._setupEventListeners(),this._startPeriodicSync(),this._initScrollObserver(),this._initObservers(),this.deck.length===0&&(this.entries.length>0?this.progressMessage="Fetching and building your feed...":this.progressMessage="No feed items found. Please configure your RSS feeds.",await new Promise(e=>setTimeout(e,1e3))),this.loading=!1,await this.updateSyncStatusMessage()}catch(e){console.error("Initialization failed:",e),this.errorMessage=`Could not load feed: ${e.message}`,this.progressMessage=`Error: ${e.message}`,b(this,`Could not load feed: ${e.message}`)}},performBackgroundSync:async function(){if(!(!this.syncEnabled||!this.isOnline)){console.log("Performing immediate background sync..."),this.progressMessage="Syncing...",this.loading=!0;try{await ae();const e=await ye(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,this.progressMessage="",this.loading=!1,console.log("Immediate background sync complete."),e?b(this,"Sync complete!"):b(this,"Sync finished with errors.")}catch(e){console.error("Immediate background sync failed:",e),this.progressMessage="Sync Failed!",this.loading=!1,b(this,`Sync failed: ${e.message}`)}}},updateSyncStatusMessage:async function(){q()?this.syncEnabled?(this.showSyncStatus=!1,this.syncStatusMessage=""):(this.syncStatusMessage="Sync is disabled.",this.showSyncStatus=!0):(this.syncStatusMessage="Offline.",this.showSyncStatus=!0)},loadAndDisplayDeck:async function(){let e=this.currentDeckGuids;Array.isArray(e)||(e=[]),console.log(`[loadAndDisplayDeck] Processing ${e.length} GUIDs for display`),console.log(`[loadAndDisplayDeck] feedItems contains ${Object.keys(this.feedItems).length} items`);const t=[],n=new Set(this.read.map(a=>a.guid)),s=new Set(this.starred.map(a=>a.guid)),r=new Set;let i=0,o=0;for(const a of e){const l=a.guid;if(typeof l!="string"||!l)continue;const c=this.feedItems[l];if(c&&c.guid&&!r.has(c.guid)){const u=lr(c,Un);u&&(u.isRead=n.has(u.guid),u.isStarred=s.has(u.guid),t.push(u),r.add(u.guid),i++)}else o++,o<=3&&console.log(`[loadAndDisplayDeck] MISSING: GUID ${l} not found in feedItems`)}console.log(`[loadAndDisplayDeck] Found ${i} items, Missing ${o} items`),this.deck=Array.isArray(t)?t:[],console.log(`[loadAndDisplayDeck] Final deck size: ${this.deck.length}`)},loadFeedItemsFromDB:async function(){if(!this.db){this.entries=[],this.feedItems={};return}const e=await wn();this.feedItems={};const t=[],n=new Set;e.forEach(s=>{s&&s.guid&&!n.has(s.guid)&&(this.feedItems[s.guid]=s,t.push(s),n.add(s.guid))}),this.entries=qo(t,Un)||[]},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const e=this.deck.length>0?this.deck[0].guid.substring(0,8):"empty",t=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}-${e}`;if(this.entries.length>0&&t===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let n=[];const s=new Map(this.read.map(o=>[o.guid,o.readAt])),r=new Map(this.starred.map(o=>[o.guid,o.starredAt]));switch(this.filterMode){case"unread":n=this.deck.filter(o=>!s.has(o.guid));break;case"all":n=this.entries;break;case"read":n=this.entries.filter(o=>s.has(o.guid)).sort((o,a)=>new Date(s.get(a.guid)||0).getTime()-new Date(s.get(o.guid)||0).getTime());break;case"starred":n=this.entries.filter(o=>r.has(o.guid)).sort((o,a)=>new Date(r.get(a.guid)||0).getTime()-new Date(r.get(o.guid)||0).getTime());break}n=n.map(o=>({...o,isRead:s.has(o.guid),isStarred:r.has(o.guid)}));const i=(this.keywordBlacklistInput??"").split(/\r?\n/).map(o=>o.trim().toLowerCase()).filter(o=>o.length>0);return i.length>0&&(n=n.filter(o=>{const a=`${o.title} ${o.description}`.toLowerCase();return!i.some(l=>a.includes(l))})),this._cachedFilteredEntries=n,this._lastFilterHash=t,n},isStarred:function(e){return this.starred.some(t=>t.guid===e)},isRead:function(e){return this.read.some(t=>t.guid===e)},toggleStar:async function(e){!this.starred.some(n=>n.guid===e)&&(this.starredGuid=e,setTimeout(()=>{this.starredGuid===e&&(this.starredGuid=null)},1e3)),await Wt(this,e,"starred")},toggleRead:async function(e){const t=this.isRead(e),n=this.selectedGuid===e;let s=null;if(!t&&n&&this.filterMode==="unread"){const i=this.filteredEntries.findIndex(o=>o.guid===e);i!==-1&&i<this.filteredEntries.length-1&&(s=this.filteredEntries[i+1].guid)}t||(this.readingGuid=e,await new Promise(i=>setTimeout(i,500)),this.readingGuid=null);let r=null;if(await Wt(this,e,"read"),this.deck=this.deck.map(i=>i.guid===e?{...i,isRead:!t}:i),this.entries=this.entries.map(i=>i.guid===e?{...i,isRead:!t}:i),this.filterMode==="unread"&&!t){r=this.currentDeckGuids.findIndex(o=>o.guid===e),r===-1&&(r=null),this.deck=this.deck.filter(o=>o.guid!==e),this.currentDeckGuids=this.currentDeckGuids.filter(o=>o.guid!==e);const{saveCurrentDeck:i}=await R(async()=>{const{saveCurrentDeck:o}=await Promise.resolve().then(()=>qt);return{saveCurrentDeck:o}},void 0);await i(this.currentDeckGuids),s?this.selectItem(s):n&&(this.selectedGuid=null)}else if(this.filterMode==="unread"&&t&&!this.currentDeckGuids.some(i=>i.guid===e)){const i={guid:e,addedAt:new Date().toISOString()};this.undoItemIndex!==null&&this.undoItemIndex>=0?this.currentDeckGuids.splice(this.undoItemIndex,0,i):this.currentDeckGuids.push(i);const{saveCurrentDeck:o}=await R(async()=>{const{saveCurrentDeck:a}=await Promise.resolve().then(()=>qt);return{saveCurrentDeck:a}},void 0);await o(this.currentDeckGuids)}if(this.updateCounts(),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage(),!t&&this.filterMode!=="all"&&ia(this,e,r),this.filterMode==="unread"&&this.deck.length===0){console.log("[toggleRead] Deck is empty, initiating refresh process."),this.progressMessage="Generating new deck...",this.loading=!0;try{await this._loadAndManageAllData(),this.deck=[...this.deck]}catch(i){console.error("[toggleRead] Error during deck refresh:",i)}finally{this.loading=!1,this.progressMessage=""}console.log("[toggleRead] Deck refresh process completed. Deck size:",this.deck.length)}},undoMarkRead:async function(){if(!this.undoItemGuid)return;const e=this.undoItemGuid;this.showUndo=!1,await this.toggleRead(e),this.undoItemGuid=null,this.undoItemIndex=null},selectItem:function(e){if(this.selectedGuid===e){this.openShortcuts&&(this.openShortcuts=!1);return}this.selectedGuid=e,this.openShortcuts&&(this.openShortcuts=!1),R(()=>Promise.resolve().then(()=>pa),void 0).then(t=>{t.scrollSelectedIntoView(e,this)})},processShuffle:async function(){await ga(this),this.updateCounts()},loadRssFeeds:async function(){try{const e=await E("rssFeeds");this.rssFeedsInput=Dt(e.value).join(`
`)}catch(e){console.error("Error loading RSS feeds:",e)}},loadKeywordBlacklist:async function(){const{loadSimpleState:e}=await R(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>X);return{loadSimpleState:n}},void 0),{value:t}=await e("keywordBlacklist");this.keywordBlacklistInput=Array.isArray(t)?t.join(`
`):""},loadCustomCss:async function(){const{loadSimpleState:e}=await R(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>X);return{loadSimpleState:n}},void 0),{value:t}=await e("customCss");this.customCss=typeof t=="string"&&t.trim()!==""?t:this.generateCustomCssTemplate(),this.applyCustomCss()},saveRssFeeds:async function(){const e=this.rssFeedsInput.split(/\r?\n/).map(t=>t.trim()).filter(Boolean);try{await G("rssFeeds",e),this.rssFeedsInput=e.join(`
`),b(this,"RSS Feeds saved!"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...";const t=await Sn(this);await this.loadFeedItemsFromDB();const n=await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=n.deck,this.currentDeckGuids=n.currentDeckGuids,this.shuffledOutGuids=n.shuffledOutGuids,this.shuffleCount=n.shuffleCount,this.lastShuffleResetDate=n.lastShuffleResetDate,await this.loadAndDisplayDeck(),this.progressMessage="",this.loading=!1,t||b(this,"Feeds saved, but sync finished with errors.")}catch(t){console.error("Error saving RSS feeds:",t),b(this,`Failed to save RSS feeds: ${t.message}`),this.loading=!1}},saveKeywordBlacklist:async function(){const e=this.keywordBlacklistInput.split(/\r?\n/).map(t=>t.trim()).filter(Boolean).sort();try{await G("keywordBlacklist",e),this.keywordBlacklistInput=e.join(`
`),b(this,"Keyword Blacklist saved!"),this.updateCounts()}catch(t){console.error("Error saving keyword blacklist:",t),b(this,`Failed to save keyword blacklist: ${t.message}`)}},saveCustomCss:async function(){try{await G("customCss",this.customCss),this.applyCustomCss(),b(this,"Custom CSS saved!")}catch(e){console.error("Error saving custom CSS:",e),b(this,`Failed to save custom CSS: ${e.message}`)}},resetCustomCss:async function(){confirm("Reset Custom CSS to default template? This will overwrite your current customizations.")&&(this.customCss=this.generateCustomCssTemplate(),await this.saveCustomCss(),b(this,"Custom CSS reset to template!"))},generateCustomCssTemplate:function(){const e=getComputedStyle(document.documentElement),t=["--bg","--fg","--primary","--secondary","--card-bg","--card-border","--card-shadow-color","--fg-muted","--border-radius"];let n=`/* Custom CSS Template - Current theme: ${this.theme} ${this.themeStyle} */
:root {
`;return t.forEach(s=>{const r=e.getPropertyValue(s).trim();r&&(n+=`  ${s}: ${r};
`)}),n+=`}

/* Add custom styles below */
`,n},applyCustomCss:function(){let e=document.getElementById("custom-user-css");e||(e=document.createElement("style"),e.id="custom-user-css",document.head.appendChild(e)),e.textContent=this.customCss},loadThemeStyle:async function(){const{loadSimpleState:e}=await R(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>X);return{loadSimpleState:s}},void 0),[,t,n]=await Promise.all([e("themeStyle"),e("themeStyleLight"),e("themeStyleDark")]);this.themeStyleLight=typeof t.value=="string"?t.value:"original",this.themeStyleDark=typeof n.value=="string"?n.value:"original",this.theme==="light"?this.themeStyle=this.themeStyleLight:this.themeStyle=this.themeStyleDark,this.applyThemeStyle()},updateThemeAndStyle:async function(e,t){console.log(`Updating theme to ${t} and style to ${e}`),this.theme=t,this.themeStyle=e;const n=document.documentElement;n.classList.remove("light","dark"),n.classList.add(t),localStorage.setItem("theme",t);const{saveSimpleState:s}=await R(async()=>{const{saveSimpleState:r}=await Promise.resolve().then(()=>X);return{saveSimpleState:r}},void 0);await s("theme",t),t==="light"?(this.themeStyleLight=e,await s("themeStyleLight",e)):(this.themeStyleDark=e,await s("themeStyleDark",e)),await s("themeStyle",e),this.applyThemeStyle(),b(this,`Theme set to ${t} (${e}).`)},saveThemeStyle:async function(){const{saveSimpleState:e}=await R(async()=>{const{saveSimpleState:t}=await Promise.resolve().then(()=>X);return{saveSimpleState:t}},void 0);this.theme==="light"?(this.themeStyleLight=this.themeStyle,await e("themeStyleLight",this.themeStyleLight)):(this.themeStyleDark=this.themeStyle,await e("themeStyleDark",this.themeStyleDark)),await e("themeStyle",this.themeStyle),this.applyThemeStyle()},applyThemeStyle:function(){const e=document.documentElement;e.classList.remove("light","dark"),e.classList.add(this.theme);const t=Array.from(e.classList).filter(n=>n.startsWith("theme-"));e.classList.remove(...t),this.themeStyle!=="original"&&e.classList.add(`theme-${this.themeStyle}`)},loadFontSize:async function(){const{loadSimpleState:e}=await R(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>X);return{loadSimpleState:n}},void 0),{value:t}=await e("fontSize");this.fontSize=typeof t=="number"?t:100,this.applyFontSize()},saveFontSize:async function(){const{saveSimpleState:e}=await R(async()=>{const{saveSimpleState:t}=await Promise.resolve().then(()=>X);return{saveSimpleState:t}},void 0);await e("fontSize",this.fontSize),this.applyFontSize()},applyFontSize:function(){document.documentElement.style.setProperty("--font-scale",(this.fontSize/100).toString())},updateCounts:async function(){oa(this)},scrollToTop:function(){mr()},observeImage:function(e){this.imageObserver&&this.imageObserver.observe(e)},_initImageObserver:function(){this.imageObserver=new IntersectionObserver(e=>{e.forEach(t=>{if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,this.imageObserver?.unobserve(n))}})},{root:null,rootMargin:"50% 0px",threshold:.01})},resetApplicationData:async function(){console.log("resetApplicationData called.");const e=confirm("Are you sure you want to reset the application? This will clear all local data, cache, and unregister the service worker.");if(console.log("User confirmed reset:",e),!e){console.log("Reset cancelled by user.");return}this.loading=!0,this.progressMessage="Resetting application data...";try{if(console.log("Closing database connection..."),await rr(),console.log("Unregistering service workers..."),"serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();for(const s of n)await s.unregister(),console.log("Service Worker unregistered:",s.scope)}console.log("Service workers unregistered."),console.log("Clearing feed and progress IndexedDB object stores...");try{const n=await et(),s=["read","starred","currentDeckGuids","shuffledOutGuids","feedItems","pendingOperations"],r=n.transaction([...s,"userSettings"],"readwrite");await Promise.all(s.map(o=>(console.log(`Clearing object store: ${o}`),r.objectStore(o).clear()))),console.log("Clearing sync metadata from userSettings...");const i=r.objectStore("userSettings");await Promise.all([i.delete("lastFeedSync"),i.delete("lastStateSync")]),await r.done,console.log("Specific IndexedDB object stores and sync metadata cleared.")}catch(n){console.error("Error clearing IndexedDB stores:",n)}console.log("localStorage is preserved."),console.log("DEBUG: About to make fetch call to /api/admin/reset-app");const t=await fetch("/api/admin/reset-app",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to reset backend data.")}console.log("Backend application data reset successfully."),b(this,"Application reset complete! Reloading..."),await W(!0),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.error("Error during application reset:",t),this.errorMessage=`Failed to reset application: ${t.message}`,b(this,`Failed to reset application: ${t.message}`),this.loading=!1}},backupConfig:async function(){console.log("backupConfig called.");try{this.progressMessage="Fetching configuration for backup...",console.log("Fetching config for backup from:","/api/admin/config-backup");const e=await fetch("/api/admin/config-backup",{method:"GET",credentials:"include"});if(!e.ok){const i=await e.json();throw new Error(i.message||"Failed to fetch config for backup.")}const t=await e.json(),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=`not-the-news-config-backup-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s),b(this,"Configuration backed up successfully!")}catch(e){console.error("Error during config backup:",e),b(this,`Failed to backup configuration: ${e.message}`)}finally{this.progressMessage=""}},restoreConfig:async function(e){if(!confirm("Are you sure you want to restore configuration? This will overwrite your current settings and reload the application."))return;const t=e.target.files?.[0];if(!t){b(this,"No file selected for restoration.");return}this.loading=!0,this.progressMessage="Restoring configuration...";try{const n=await new Promise((i,o)=>{const a=new FileReader;a.onload=l=>i(l.target?.result),a.onerror=l=>o(l),a.readAsText(t)}),s=JSON.parse(n),r=await fetch("/api/admin/config-restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to restore backend data.")}console.log("Backend configuration restored successfully."),b(this,"Configuration restored successfully! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error during config restoration:",n),b(this,`Failed to restore configuration: ${n.message}`),this.loading=!1}finally{e.target.value=""}},_loadInitialState:async function(){try{const[e,t,n,s,r]=await Promise.all([E("syncEnabled"),E("imagesEnabled"),E("openUrlsInNewTabEnabled"),pr(),E("theme")]);this.syncEnabled=e.value??!0,this.imagesEnabled=t.value??!0,this.openUrlsInNewTabEnabled=n.value??!0,this.filterMode=s,this.theme=r.value??"dark",localStorage.setItem("theme",this.theme),this.isOnline=q();const[i,o]=await Promise.all([E("rssFeeds"),E("keywordBlacklist")]);this.rssFeedsInput=Dt(i.value).join(`
`),this.keywordBlacklistInput=Array.isArray(o.value)?o.value.join(`
`):"",await this.loadCustomCss(),await this.loadThemeStyle(),await this.loadFontSize()}catch(e){console.error("Error loading initial state:",e),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){console.log("_loadAndManageAllData: START"),this.progressMessage="Loading saved feed items...",await this.loadFeedItemsFromDB(),console.log(`_loadAndManageAllData: After loadFeedItemsFromDB. Entries: ${this.entries.length}`),this.progressMessage="Loading user state from storage...";const[e,t,n,s]=await Promise.all([se("starred"),se("shuffledOutGuids"),dr(),hr()]);console.log("_loadAndManageAllData: Loaded starred state:",e.value),this.starred=Array.isArray(e.value)?e.value:[],this.shuffledOutGuids=Array.isArray(t.value)?t.value:[],this.currentDeckGuids=Array.isArray(n)?n:[],console.log("_loadAndManageAllData: Loaded currentDeckGuids:",this.currentDeckGuids.slice(0,3),typeof this.currentDeckGuids[0]),this.shuffleCount=s.shuffleCount,this.lastShuffleResetDate=s.lastShuffleResetDate,this.progressMessage="Pruning read items...",this.read=await ur(Object.values(this.feedItems)),console.log(`_loadAndManageAllData: After loadAndPruneReadItems. Read count: ${this.read.length}`),console.log("[deckManager] Starting deck management with all data loaded."),this.progressMessage="Organizing your deck...",console.log("_loadAndManageAllData: Before manageDailyDeck",{readCount:this.read.length,currentDeckGuidsCount:this.currentDeckGuids.length,shuffleCount:this.shuffleCount});const r=await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=r.deck,this.currentDeckGuids=r.currentDeckGuids,this.shuffledOutGuids=r.shuffledOutGuids,this.shuffleCount=r.shuffleCount,this.lastShuffleResetDate=r.lastShuffleResetDate,console.log("_loadAndManageAllData: After manageDailyDeck. Deck size:",this.deck.length),this.progressMessage="Displaying your feed...",await this.loadAndDisplayDeck(),console.log("_loadAndManageAllData: After loadAndDisplayDeck. Final Deck size:",this.deck.length),this.updateAllUI(),console.log("_loadAndManageAllData: END")},updateAllUI:async function(){await this.updateCounts()},_reconcileAndRefreshUI:async function(){console.log("[UI] _reconcileAndRefreshUI: Initiating UI reconciliation and refresh."),await this.loadAndDisplayDeck(),this.updateAllUI(),console.log("[UI] _reconcileAndRefreshUI: Completed UI reconciliation and refresh.")},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(e=>{e.forEach(t=>{if(!t.isIntersecting){const n=t.target.dataset.guid;console.log(`[Observer] Stale item ${n} is off-screen. Removing.`),this.deck=this.deck.filter(s=>s.guid!==n),this.staleItemObserver?.unobserve(t.target)}})},{root:null,threshold:0})},_setupWatchers:function(){this.$watch("openShortcuts",async e=>{const t=window.innerWidth<1024;e?(t||document.body.classList.add("no-scroll"),await At()):(document.body.classList.remove("no-scroll"),document.body.style.overflow="")}),this.$watch("openSettings",async e=>{if(e){this.modalView="main",await Vn(this);const[t,n]=await Promise.all([E("rssFeeds"),E("keywordBlacklist")]);this.rssFeedsInput=Dt(t.value).join(`
`),Array.isArray(n.value)?this.keywordBlacklistInput=n.value.filter(Boolean).sort().join(`
`):typeof n.value=="string"?this.keywordBlacklistInput=n.value.split(/\r?\n/).filter(Boolean).sort().join(`
`):this.keywordBlacklistInput=""}else await At()}),this.$watch("openUrlsInNewTabEnabled",()=>{document.querySelectorAll(".itemdescription").forEach(e=>this.handleEntryLinks(e))}),this.$watch("modalView",async()=>Vn(this)),this.$watch("filterMode",async e=>{await gr(this,e),e==="unread"&&await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate),this.scrollToTop()}),this.$watch("shadowsEnabled",e=>{document.body.classList.toggle("no-shadows",!e)}),document.body.classList.toggle("no-shadows",!this.shadowsEnabled),this.$watch("entries",()=>this.updateCounts()),this.$watch("read",()=>this.updateCounts()),this.$watch("starred",()=>this.updateCounts()),this.$watch("currentDeckGuids",()=>this.updateCounts()),this.$watch("selectedGuid",e=>{e&&(this.lastSelectedGuid=e)})},_setupEventListeners:function(){const e=async()=>{if(!this.syncEnabled||!this.isOnline)return;console.log("Performing periodic background sync..."),await ae();const n=await ye(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Background sync complete. Success: ${n}`)};window.addEventListener("online",async()=>{if(this.isOnline=!0,await this.updateSyncStatusMessage(),this.syncEnabled)try{await ae(),await e()}catch(n){console.error("Error handling online event:",n)}}),window.addEventListener("offline",async()=>{this.isOnline=!1,await this.updateSyncStatusMessage()});let t;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{At()},1e3)},{passive:!0}),window.addEventListener("keydown",n=>{yr(n,this)})},_startPeriodicSync:function(){let e=Date.now();const t=()=>e=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(r=>{document.addEventListener(r,t,!0),r==="focus"&&window.addEventListener(r,t,!0),r==="visibilitychange"&&document.addEventListener(r,t,!0)});const n=300*1e3,s=60*1e3;setInterval(async()=>{const r=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||r-e>s)){console.log("Starting scheduled background sync...");try{await ae();const i=await ye(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Scheduled sync complete. Success: ${i}`)}catch(i){console.error("Periodic sync failed:",i)}}},n)},_initScrollObserver:function(){const e=new IntersectionObserver(async()=>{},{root:document.querySelector("#feed-container"),rootMargin:"0px",threshold:.1}),t=document.querySelector("#feed-container");if(!t)return;const n=()=>{t.querySelectorAll("[data-guid]").forEach(r=>{e.observe(r)})};n(),new MutationObserver(()=>{e.disconnect(),n()}).observe(t,{childList:!0,subtree:!0}),this.scrollObserver=e},handleEntryLinks:function(e){if(!e)return;e.querySelectorAll("a").forEach(n=>{n.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer")):n.removeAttribute("target"))})},$nextTick:function(e){return Ze.nextTick(e)},$watch:function(e,t){return Ze.watch(this,e,t)}}}Ze.data("rssApp",ma);Ze.start();
