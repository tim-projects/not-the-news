/* empty css              */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const Ci="modulepreload",Mi=function(e){return"/"+e},xn={},x=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=Mi(c),c in xn)return;xn[c]=!0;const u=c.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Ci,u||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((f,w)=>{d.addEventListener("load",f),d.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var Ot=!1,xt=!1,de=[],Tt=-1;function $i(e){Pi(e)}function Pi(e){de.includes(e)||de.push(e),Bi()}function Ri(e){let t=de.indexOf(e);t!==-1&&t>Tt&&de.splice(t,1)}function Bi(){!xt&&!Ot&&(Ot=!0,queueMicrotask(Li))}function Li(){Ot=!1,xt=!0;for(let e=0;e<de.length;e++)de[e](),Tt=e;de.length=0,Tt=-1,xt=!1}var be,ye,ve,Jn,Ct=!0;function Gi(e){Ct=!1,e(),Ct=!0}function Fi(e){be=e.reactive,ve=e.release,ye=t=>e.effect(t,{scheduler:n=>{Ct?$i(n):n()}}),Jn=e.raw}function Tn(e){ye=e}function ji(e){let t=()=>{};return[s=>{let i=ye(s);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(r=>r())}),e._x_effects.add(i),t=()=>{i!==void 0&&(e._x_effects.delete(i),ve(i))},i},()=>{t()}]}function Qn(e,t){let n=!0,s,i=ye(()=>{let r=e();JSON.stringify(r),n?s=r:queueMicrotask(()=>{t(r,s),s=r}),n=!1});return()=>ve(i)}var Xn=[],Zn=[],es=[];function Ni(e){es.push(e)}function en(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,Zn.push(t))}function ts(e){Xn.push(e)}function ns(e,t,n){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(n)}function ss(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([n,s])=>{(t===void 0||t.includes(n))&&(s.forEach(i=>i()),delete e._x_attributeCleanups[n])})}function Ui(e){for(e._x_effects?.forEach(Ri);e._x_cleanups?.length;)e._x_cleanups.pop()()}var tn=new MutationObserver(on),nn=!1;function sn(){tn.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),nn=!0}function is(){zi(),tn.disconnect(),nn=!1}var Oe=[];function zi(){let e=tn.takeRecords();Oe.push(()=>e.length>0&&on(e));let t=Oe.length;queueMicrotask(()=>{if(Oe.length===t)for(;Oe.length>0;)Oe.shift()()})}function I(e){if(!nn)return e();is();let t=e();return sn(),t}var rn=!1,Ze=[];function Vi(){rn=!0}function Ki(){rn=!1,on(Ze),Ze=[]}function on(e){if(rn){Ze=Ze.concat(e);return}let t=[],n=new Set,s=new Map,i=new Map;for(let r=0;r<e.length;r++)if(!e[r].target._x_ignoreMutationObserver&&(e[r].type==="childList"&&(e[r].removedNodes.forEach(o=>{o.nodeType===1&&o._x_marker&&n.add(o)}),e[r].addedNodes.forEach(o=>{if(o.nodeType===1){if(n.has(o)){n.delete(o);return}o._x_marker||t.push(o)}})),e[r].type==="attributes")){let o=e[r].target,a=e[r].attributeName,l=e[r].oldValue,c=()=>{s.has(o)||s.set(o,[]),s.get(o).push({name:a,value:o.getAttribute(a)})},u=()=>{i.has(o)||i.set(o,[]),i.get(o).push(a)};o.hasAttribute(a)&&l===null?c():o.hasAttribute(a)?(u(),c()):u()}i.forEach((r,o)=>{ss(o,r)}),s.forEach((r,o)=>{Xn.forEach(a=>a(o,r))});for(let r of n)t.some(o=>o.contains(r))||Zn.forEach(o=>o(r));for(let r of t)r.isConnected&&es.forEach(o=>o(r));t=null,n=null,s=null,i=null}function rs(e){return Ge(Se(e))}function Le(e,t,n){return e._x_dataStack=[t,...Se(n||e)],()=>{e._x_dataStack=e._x_dataStack.filter(s=>s!==t)}}function Se(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?Se(e.host):e.parentNode?Se(e.parentNode):[]}function Ge(e){return new Proxy({objects:e},Wi)}var Wi={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(n=>Object.prototype.hasOwnProperty.call(n,t)||Reflect.has(n,t))},get({objects:e},t,n){return t=="toJSON"?Hi:Reflect.get(e.find(s=>Reflect.has(s,t))||{},t,n)},set({objects:e},t,n,s){const i=e.find(o=>Object.prototype.hasOwnProperty.call(o,t))||e[e.length-1],r=Object.getOwnPropertyDescriptor(i,t);return r?.set&&r?.get?r.set.call(s,n)||!0:Reflect.set(i,t,n)}};function Hi(){return Reflect.ownKeys(this).reduce((t,n)=>(t[n]=Reflect.get(this,n),t),{})}function os(e){let t=s=>typeof s=="object"&&!Array.isArray(s)&&s!==null,n=(s,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(s)).forEach(([r,{value:o,enumerable:a}])=>{if(a===!1||o===void 0||typeof o=="object"&&o!==null&&o.__v_skip)return;let l=i===""?r:`${i}.${r}`;typeof o=="object"&&o!==null&&o._x_interceptor?s[r]=o.initialize(e,l,r):t(o)&&o!==s&&!(o instanceof Element)&&n(o,l)})};return n(e)}function as(e,t=()=>{}){let n={initialValue:void 0,_x_interceptor:!0,initialize(s,i,r){return e(this.initialValue,()=>qi(s,i),o=>Mt(s,i,o),i,r)}};return t(n),s=>{if(typeof s=="object"&&s!==null&&s._x_interceptor){let i=n.initialize.bind(n);n.initialize=(r,o,a)=>{let l=s.initialize(r,o,a);return n.initialValue=l,i(r,o,a)}}else n.initialValue=s;return n}}function qi(e,t){return t.split(".").reduce((n,s)=>n[s],e)}function Mt(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=n;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),Mt(e[t[0]],t.slice(1),n)}}var ls={};function W(e,t){ls[e]=t}function $t(e,t){let n=Yi(t);return Object.entries(ls).forEach(([s,i])=>{Object.defineProperty(e,`$${s}`,{get(){return i(t,n)},enumerable:!1})}),e}function Yi(e){let[t,n]=gs(e),s={interceptor:as,...t};return en(e,n),s}function Ji(e,t,n,...s){try{return n(...s)}catch(i){Re(i,e,t)}}function Re(e,t,n=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:n}),console.warn(`Alpine Expression Error: ${e.message}

${n?'Expression: "'+n+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var Ye=!0;function cs(e){let t=Ye;Ye=!1;let n=e();return Ye=t,n}function fe(e,t,n={}){let s;return P(e,t)(i=>s=i,n),s}function P(...e){return us(...e)}var us=ds;function Qi(e){us=e}function ds(e,t){let n={};$t(n,e);let s=[n,...Se(e)],i=typeof t=="function"?Xi(s,t):er(s,t,e);return Ji.bind(null,e,t,i)}function Xi(e,t){return(n=()=>{},{scope:s={},params:i=[]}={})=>{let r=t.apply(Ge([s,...e]),i);et(n,r)}}var gt={};function Zi(e,t){if(gt[e])return gt[e];let n=Object.getPrototypeOf(async function(){}).constructor,s=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,r=(()=>{try{let o=new n(["__self","scope"],`with (scope) { __self.result = ${s} }; __self.finished = true; return __self.result;`);return Object.defineProperty(o,"name",{value:`[Alpine] ${e}`}),o}catch(o){return Re(o,t,e),Promise.resolve()}})();return gt[e]=r,r}function er(e,t,n){let s=Zi(t,n);return(i=()=>{},{scope:r={},params:o=[]}={})=>{s.result=void 0,s.finished=!1;let a=Ge([r,...e]);if(typeof s=="function"){let l=s(s,a).catch(c=>Re(c,n,t));s.finished?(et(i,s.result,a,o,n),s.result=void 0):l.then(c=>{et(i,c,a,o,n)}).catch(c=>Re(c,n,t)).finally(()=>s.result=void 0)}}}function et(e,t,n,s,i){if(Ye&&typeof t=="function"){let r=t.apply(n,s);r instanceof Promise?r.then(o=>et(e,o,n,s)).catch(o=>Re(o,i,t)):e(r)}else typeof t=="object"&&t instanceof Promise?t.then(r=>e(r)):e(t)}var an="x-";function ke(e=""){return an+e}function tr(e){an=e}var tt={};function T(e,t){return tt[e]=t,{before(n){if(!tt[n]){console.warn(String.raw`Cannot find directive \`${n}\`. \`${e}\` will use the default order of execution`);return}const s=ue.indexOf(n);ue.splice(s>=0?s:ue.indexOf("DEFAULT"),0,e)}}}function nr(e){return Object.keys(tt).includes(e)}function ln(e,t,n){if(t=Array.from(t),e._x_virtualDirectives){let r=Object.entries(e._x_virtualDirectives).map(([a,l])=>({name:a,value:l})),o=fs(r);r=r.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(r)}let s={};return t.map(ps((r,o)=>s[r]=o)).filter(Ss).map(rr(s,n)).sort(or).map(r=>ir(e,r))}function fs(e){return Array.from(e).map(ps()).filter(t=>!Ss(t))}var Pt=!1,Ce=new Map,hs=Symbol();function sr(e){Pt=!0;let t=Symbol();hs=t,Ce.set(t,[]);let n=()=>{for(;Ce.get(t).length;)Ce.get(t).shift()();Ce.delete(t)},s=()=>{Pt=!1,n()};e(n),s()}function gs(e){let t=[],n=a=>t.push(a),[s,i]=ji(e);return t.push(i),[{Alpine:Fe,effect:s,cleanup:n,evaluateLater:P.bind(P,e),evaluate:fe.bind(fe,e)},()=>t.forEach(a=>a())]}function ir(e,t){let n=()=>{},s=tt[t.type]||n,[i,r]=gs(e);ns(e,t.original,r);let o=()=>{e._x_ignore||e._x_ignoreSelf||(s.inline&&s.inline(e,t,i),s=s.bind(s,e,t,i),Pt?Ce.get(hs).push(s):s())};return o.runCleanups=r,o}var ms=(e,t)=>({name:n,value:s})=>(n.startsWith(e)&&(n=n.replace(e,t)),{name:n,value:s}),ys=e=>e;function ps(e=()=>{}){return({name:t,value:n})=>{let{name:s,value:i}=ws.reduce((r,o)=>o(r),{name:t,value:n});return s!==t&&e(s,t),{name:s,value:i}}}var ws=[];function cn(e){ws.push(e)}function Ss({name:e}){return _s().test(e)}var _s=()=>new RegExp(`^${an}([^:^.]+)\\b`);function rr(e,t){return({name:n,value:s})=>{let i=n.match(_s()),r=n.match(/:([a-zA-Z0-9\-_:]+)/),o=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[n]||n;return{type:i?i[1]:null,value:r?r[1]:null,modifiers:o.map(l=>l.replace(".","")),expression:s,original:a}}}var Rt="DEFAULT",ue=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Rt,"teleport"];function or(e,t){let n=ue.indexOf(e.type)===-1?Rt:e.type,s=ue.indexOf(t.type)===-1?Rt:t.type;return ue.indexOf(n)-ue.indexOf(s)}function $e(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function me(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(i=>me(i,t));return}let n=!1;if(t(e,()=>n=!0),n)return;let s=e.firstElementChild;for(;s;)me(s,t),s=s.nextElementSibling}function N(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var Cn=!1;function ar(){Cn&&N("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Cn=!0,document.body||N("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),$e(document,"alpine:init"),$e(document,"alpine:initializing"),sn(),Ni(t=>Q(t,me)),en(t=>Ee(t)),ts((t,n)=>{ln(t,n).forEach(s=>s())});let e=t=>!rt(t.parentElement,!0);Array.from(document.querySelectorAll(ks().join(","))).filter(e).forEach(t=>{Q(t)}),$e(document,"alpine:initialized"),setTimeout(()=>{dr()})}var un=[],bs=[];function vs(){return un.map(e=>e())}function ks(){return un.concat(bs).map(e=>e())}function Ds(e){un.push(e)}function Es(e){bs.push(e)}function rt(e,t=!1){return De(e,n=>{if((t?ks():vs()).some(i=>n.matches(i)))return!0})}function De(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),!!e.parentElement)return De(e.parentElement,t)}}function lr(e){return vs().some(t=>e.matches(t))}var As=[];function cr(e){As.push(e)}var ur=1;function Q(e,t=me,n=()=>{}){De(e,s=>s._x_ignore)||sr(()=>{t(e,(s,i)=>{s._x_marker||(n(s,i),As.forEach(r=>r(s,i)),ln(s,s.attributes).forEach(r=>r()),s._x_ignore||(s._x_marker=ur++),s._x_ignore&&i())})})}function Ee(e,t=me){t(e,n=>{Ui(n),ss(n),delete n._x_marker})}function dr(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,n,s])=>{nr(n)||s.some(i=>{if(document.querySelector(i))return N(`found "${i}", but missing ${t} plugin`),!0})})}var Bt=[],dn=!1;function fn(e=()=>{}){return queueMicrotask(()=>{dn||setTimeout(()=>{Lt()})}),new Promise(t=>{Bt.push(()=>{e(),t()})})}function Lt(){for(dn=!1;Bt.length;)Bt.shift()()}function fr(){dn=!0}function hn(e,t){return Array.isArray(t)?Mn(e,t.join(" ")):typeof t=="object"&&t!==null?hr(e,t):typeof t=="function"?hn(e,t()):Mn(e,t)}function Mn(e,t){let n=i=>i.split(" ").filter(r=>!e.classList.contains(r)).filter(Boolean),s=i=>(e.classList.add(...i),()=>{e.classList.remove(...i)});return t=t===!0?t="":t||"",s(n(t))}function hr(e,t){let n=a=>a.split(" ").filter(Boolean),s=Object.entries(t).flatMap(([a,l])=>l?n(a):!1).filter(Boolean),i=Object.entries(t).flatMap(([a,l])=>l?!1:n(a)).filter(Boolean),r=[],o=[];return i.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),o.push(a))}),s.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),r.push(a))}),()=>{o.forEach(a=>e.classList.add(a)),r.forEach(a=>e.classList.remove(a))}}function ot(e,t){return typeof t=="object"&&t!==null?gr(e,t):mr(e,t)}function gr(e,t){let n={};return Object.entries(t).forEach(([s,i])=>{n[s]=e.style[s],s.startsWith("--")||(s=yr(s)),e.style.setProperty(s,i)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{ot(e,n)}}function mr(e,t){let n=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",n||"")}}function yr(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Gt(e,t=()=>{}){let n=!1;return function(){n?t.apply(this,arguments):(n=!0,e.apply(this,arguments))}}T("transition",(e,{value:t,modifiers:n,expression:s},{evaluate:i})=>{typeof s=="function"&&(s=i(s)),s!==!1&&(!s||typeof s=="boolean"?wr(e,n,t):pr(e,s,t))});function pr(e,t,n){Is(e,hn,""),{enter:i=>{e._x_transition.enter.during=i},"enter-start":i=>{e._x_transition.enter.start=i},"enter-end":i=>{e._x_transition.enter.end=i},leave:i=>{e._x_transition.leave.during=i},"leave-start":i=>{e._x_transition.leave.start=i},"leave-end":i=>{e._x_transition.leave.end=i}}[n](t)}function wr(e,t,n){Is(e,ot);let s=!t.includes("in")&&!t.includes("out")&&!n,i=s||t.includes("in")||["enter"].includes(n),r=s||t.includes("out")||["leave"].includes(n);t.includes("in")&&!s&&(t=t.filter((y,h)=>h<t.indexOf("out"))),t.includes("out")&&!s&&(t=t.filter((y,h)=>h>t.indexOf("out")));let o=!t.includes("opacity")&&!t.includes("scale"),a=o||t.includes("opacity"),l=o||t.includes("scale"),c=a?0:1,u=l?xe(t,"scale",95)/100:1,g=xe(t,"delay",0)/1e3,d=xe(t,"origin","center"),f="opacity, transform",w=xe(t,"duration",150)/1e3,D=xe(t,"duration",75)/1e3,m="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(e._x_transition.enter.during={transformOrigin:d,transitionDelay:`${g}s`,transitionProperty:f,transitionDuration:`${w}s`,transitionTimingFunction:m},e._x_transition.enter.start={opacity:c,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),r&&(e._x_transition.leave.during={transformOrigin:d,transitionDelay:`${g}s`,transitionProperty:f,transitionDuration:`${D}s`,transitionTimingFunction:m},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:c,transform:`scale(${u})`})}function Is(e,t,n={}){e._x_transition||(e._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(s=()=>{},i=()=>{}){Ft(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},s,i)},out(s=()=>{},i=()=>{}){Ft(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},s,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,n,s){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let r=()=>i(n);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(n):r():e._x_transition?e._x_transition.in(n):r();return}e._x_hidePromise=e._x_transition?new Promise((o,a)=>{e._x_transition.out(()=>{},()=>o(s)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(s),queueMicrotask(()=>{let o=Os(e);o?(o._x_hideChildren||(o._x_hideChildren=[]),o._x_hideChildren.push(e)):i(()=>{let a=l=>{let c=Promise.all([l._x_hidePromise,...(l._x_hideChildren||[]).map(a)]).then(([u])=>u?.());return delete l._x_hidePromise,delete l._x_hideChildren,c};a(e).catch(l=>{if(!l.isFromCancelledTransition)throw l})})})};function Os(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:Os(t)}function Ft(e,t,{during:n,start:s,end:i}={},r=()=>{},o=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(n).length===0&&Object.keys(s).length===0&&Object.keys(i).length===0){r(),o();return}let a,l,c;Sr(e,{start(){a=t(e,s)},during(){l=t(e,n)},before:r,end(){a(),c=t(e,i)},after:o,cleanup(){l(),c()}})}function Sr(e,t){let n,s,i,r=Gt(()=>{I(()=>{n=!0,s||t.before(),i||(t.end(),Lt()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(o){this.beforeCancels.push(o)},cancel:Gt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();r()}),finish:r},I(()=>{t.start(),t.during()}),fr(),requestAnimationFrame(()=>{if(n)return;let o=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;o===0&&(o=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),I(()=>{t.before()}),s=!0,requestAnimationFrame(()=>{n||(I(()=>{t.end()}),Lt(),setTimeout(e._x_transitioning.finish,o+a),i=!0)})})}function xe(e,t,n){if(e.indexOf(t)===-1)return n;const s=e[e.indexOf(t)+1];if(!s||t==="scale"&&isNaN(s))return n;if(t==="duration"||t==="delay"){let i=s.match(/([0-9]+)ms/);if(i)return i[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[s,e[e.indexOf(t)+2]].join(" "):s}var ne=!1;function re(e,t=()=>{}){return(...n)=>ne?t(...n):e(...n)}function _r(e){return(...t)=>ne&&e(...t)}var xs=[];function at(e){xs.push(e)}function br(e,t){xs.forEach(n=>n(e,t)),ne=!0,Ts(()=>{Q(t,(n,s)=>{s(n,()=>{})})}),ne=!1}var jt=!1;function vr(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),ne=!0,jt=!0,Ts(()=>{kr(t)}),ne=!1,jt=!1}function kr(e){let t=!1;Q(e,(s,i)=>{me(s,(r,o)=>{if(t&&lr(r))return o();t=!0,i(r,o)})})}function Ts(e){let t=ye;Tn((n,s)=>{let i=t(n);return ve(i),()=>{}}),e(),Tn(t)}function Cs(e,t,n,s=[]){switch(e._x_bindings||(e._x_bindings=be({})),e._x_bindings[t]=n,t=s.includes("camel")?Cr(t):t,t){case"value":Dr(e,n);break;case"style":Ar(e,n);break;case"class":Er(e,n);break;case"selected":case"checked":Ir(e,t,n);break;default:Ms(e,t,n);break}}function Dr(e,t){if(Rs(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=Je(e.value)===t:e.checked=$n(e.value,t));else if(gn(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(n=>$n(n,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")Tr(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function Er(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=hn(e,t)}function Ar(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=ot(e,t)}function Ir(e,t,n){Ms(e,t,n),xr(e,t,n)}function Ms(e,t,n){[null,void 0,!1].includes(n)&&$r(t)?e.removeAttribute(t):($s(t)&&(n=t),Or(e,t,n))}function Or(e,t,n){e.getAttribute(t)!=n&&e.setAttribute(t,n)}function xr(e,t,n){e[t]!==n&&(e[t]=n)}function Tr(e,t){const n=[].concat(t).map(s=>s+"");Array.from(e.options).forEach(s=>{s.selected=n.includes(s.value)})}function Cr(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function $n(e,t){return e==t}function Je(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?!!e:null}var Mr=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function $s(e){return Mr.has(e)}function $r(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function Pr(e,t,n){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:Ps(e,t,n)}function Rr(e,t,n,s=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let i=e._x_inlineBindings[t];return i.extract=s,cs(()=>fe(e,i.expression))}return Ps(e,t,n)}function Ps(e,t,n){let s=e.getAttribute(t);return s===null?typeof n=="function"?n():n:s===""?!0:$s(t)?!![t,"true"].includes(s):s}function gn(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function Rs(e){return e.type==="radio"||e.localName==="ui-radio"}function Bs(e,t){var n;return function(){var s=this,i=arguments,r=function(){n=null,e.apply(s,i)};clearTimeout(n),n=setTimeout(r,t)}}function Ls(e,t){let n;return function(){let s=this,i=arguments;n||(e.apply(s,i),n=!0,setTimeout(()=>n=!1,t))}}function Gs({get:e,set:t},{get:n,set:s}){let i=!0,r,o=ye(()=>{let a=e(),l=n();if(i)s(mt(a)),i=!1;else{let c=JSON.stringify(a),u=JSON.stringify(l);c!==r?s(mt(a)):c!==u&&t(mt(l))}r=JSON.stringify(e()),JSON.stringify(n())});return()=>{ve(o)}}function mt(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function Br(e){(Array.isArray(e)?e:[e]).forEach(n=>n(Fe))}var le={},Pn=!1;function Lr(e,t){if(Pn||(le=be(le),Pn=!0),t===void 0)return le[e];le[e]=t,os(le[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&le[e].init()}function Gr(){return le}var Fs={};function Fr(e,t){let n=typeof t!="function"?()=>t:t;return e instanceof Element?js(e,n()):(Fs[e]=n,()=>{})}function jr(e){return Object.entries(Fs).forEach(([t,n])=>{Object.defineProperty(e,t,{get(){return(...s)=>n(...s)}})}),e}function js(e,t,n){let s=[];for(;s.length;)s.pop()();let i=Object.entries(t).map(([o,a])=>({name:o,value:a})),r=fs(i);return i=i.map(o=>r.find(a=>a.name===o.name)?{name:`x-bind:${o.name}`,value:`"${o.value}"`}:o),ln(e,i,n).map(o=>{s.push(o.runCleanups),o()}),()=>{for(;s.length;)s.pop()()}}var Ns={};function Nr(e,t){Ns[e]=t}function Ur(e,t){return Object.entries(Ns).forEach(([n,s])=>{Object.defineProperty(e,n,{get(){return(...i)=>s.bind(t)(...i)},enumerable:!1})}),e}var zr={get reactive(){return be},get release(){return ve},get effect(){return ye},get raw(){return Jn},version:"3.14.9",flushAndStopDeferringMutations:Ki,dontAutoEvaluateFunctions:cs,disableEffectScheduling:Gi,startObservingMutations:sn,stopObservingMutations:is,setReactivityEngine:Fi,onAttributeRemoved:ns,onAttributesAdded:ts,closestDataStack:Se,skipDuringClone:re,onlyDuringClone:_r,addRootSelector:Ds,addInitSelector:Es,interceptClone:at,addScopeToNode:Le,deferMutations:Vi,mapAttributes:cn,evaluateLater:P,interceptInit:cr,setEvaluator:Qi,mergeProxies:Ge,extractProp:Rr,findClosest:De,onElRemoved:en,closestRoot:rt,destroyTree:Ee,interceptor:as,transition:Ft,setStyles:ot,mutateDom:I,directive:T,entangle:Gs,throttle:Ls,debounce:Bs,evaluate:fe,initTree:Q,nextTick:fn,prefixed:ke,prefix:tr,plugin:Br,magic:W,store:Lr,start:ar,clone:vr,cloneNode:br,bound:Pr,$data:rs,watch:Qn,walk:me,data:Nr,bind:Fr},Fe=zr;function Vr(e,t){const n=Object.create(null),s=e.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return i=>!!n[i]}var Kr=Object.freeze({}),Wr=Object.prototype.hasOwnProperty,lt=(e,t)=>Wr.call(e,t),he=Array.isArray,Pe=e=>Us(e)==="[object Map]",Hr=e=>typeof e=="string",mn=e=>typeof e=="symbol",ct=e=>e!==null&&typeof e=="object",qr=Object.prototype.toString,Us=e=>qr.call(e),zs=e=>Us(e).slice(8,-1),yn=e=>Hr(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Yr=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},Jr=Yr(e=>e.charAt(0).toUpperCase()+e.slice(1)),Vs=(e,t)=>e!==t&&(e===e||t===t),Nt=new WeakMap,Te=[],q,ge=Symbol("iterate"),Ut=Symbol("Map key iterate");function Qr(e){return e&&e._isEffect===!0}function Xr(e,t=Kr){Qr(e)&&(e=e.raw);const n=to(e,t);return t.lazy||n(),n}function Zr(e){e.active&&(Ks(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var eo=0;function to(e,t){const n=function(){if(!n.active)return e();if(!Te.includes(n)){Ks(n);try{return so(),Te.push(n),q=n,e()}finally{Te.pop(),Ws(),q=Te[Te.length-1]}}};return n.id=eo++,n.allowRecurse=!!t.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}function Ks(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}var _e=!0,pn=[];function no(){pn.push(_e),_e=!1}function so(){pn.push(_e),_e=!0}function Ws(){const e=pn.pop();_e=e===void 0?!0:e}function V(e,t,n){if(!_e||q===void 0)return;let s=Nt.get(e);s||Nt.set(e,s=new Map);let i=s.get(n);i||s.set(n,i=new Set),i.has(q)||(i.add(q),q.deps.push(i),q.options.onTrack&&q.options.onTrack({effect:q,target:e,type:t,key:n}))}function se(e,t,n,s,i,r){const o=Nt.get(e);if(!o)return;const a=new Set,l=u=>{u&&u.forEach(g=>{(g!==q||g.allowRecurse)&&a.add(g)})};if(t==="clear")o.forEach(l);else if(n==="length"&&he(e))o.forEach((u,g)=>{(g==="length"||g>=s)&&l(u)});else switch(n!==void 0&&l(o.get(n)),t){case"add":he(e)?yn(n)&&l(o.get("length")):(l(o.get(ge)),Pe(e)&&l(o.get(Ut)));break;case"delete":he(e)||(l(o.get(ge)),Pe(e)&&l(o.get(Ut)));break;case"set":Pe(e)&&l(o.get(ge));break}const c=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:n,type:t,newValue:s,oldValue:i,oldTarget:r}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(c)}var io=Vr("__proto__,__v_isRef,__isVue"),Hs=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(mn)),ro=qs(),oo=qs(!0),Rn=ao();function ao(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const s=E(this);for(let r=0,o=this.length;r<o;r++)V(s,"get",r+"");const i=s[t](...n);return i===-1||i===!1?s[t](...n.map(E)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){no();const s=E(this)[t].apply(this,n);return Ws(),s}}),e}function qs(e=!1,t=!1){return function(s,i,r){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_raw"&&r===(e?t?vo:Xs:t?bo:Qs).get(s))return s;const o=he(s);if(!e&&o&&lt(Rn,i))return Reflect.get(Rn,i,r);const a=Reflect.get(s,i,r);return(mn(i)?Hs.has(i):io(i))||(e||V(s,"get",i),t)?a:zt(a)?!o||!yn(i)?a.value:a:ct(a)?e?Zs(a):bn(a):a}}var lo=co();function co(e=!1){return function(n,s,i,r){let o=n[s];if(!e&&(i=E(i),o=E(o),!he(n)&&zt(o)&&!zt(i)))return o.value=i,!0;const a=he(n)&&yn(s)?Number(s)<n.length:lt(n,s),l=Reflect.set(n,s,i,r);return n===E(r)&&(a?Vs(i,o)&&se(n,"set",s,i,o):se(n,"add",s,i)),l}}function uo(e,t){const n=lt(e,t),s=e[t],i=Reflect.deleteProperty(e,t);return i&&n&&se(e,"delete",t,void 0,s),i}function fo(e,t){const n=Reflect.has(e,t);return(!mn(t)||!Hs.has(t))&&V(e,"has",t),n}function ho(e){return V(e,"iterate",he(e)?"length":ge),Reflect.ownKeys(e)}var go={get:ro,set:lo,deleteProperty:uo,has:fo,ownKeys:ho},mo={get:oo,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},wn=e=>ct(e)?bn(e):e,Sn=e=>ct(e)?Zs(e):e,_n=e=>e,ut=e=>Reflect.getPrototypeOf(e);function Ue(e,t,n=!1,s=!1){e=e.__v_raw;const i=E(e),r=E(t);t!==r&&!n&&V(i,"get",t),!n&&V(i,"get",r);const{has:o}=ut(i),a=s?_n:n?Sn:wn;if(o.call(i,t))return a(e.get(t));if(o.call(i,r))return a(e.get(r));e!==i&&e.get(t)}function ze(e,t=!1){const n=this.__v_raw,s=E(n),i=E(e);return e!==i&&!t&&V(s,"has",e),!t&&V(s,"has",i),e===i?n.has(e):n.has(e)||n.has(i)}function Ve(e,t=!1){return e=e.__v_raw,!t&&V(E(e),"iterate",ge),Reflect.get(e,"size",e)}function Bn(e){e=E(e);const t=E(this);return ut(t).has.call(t,e)||(t.add(e),se(t,"add",e,e)),this}function Ln(e,t){t=E(t);const n=E(this),{has:s,get:i}=ut(n);let r=s.call(n,e);r?Js(n,s,e):(e=E(e),r=s.call(n,e));const o=i.call(n,e);return n.set(e,t),r?Vs(t,o)&&se(n,"set",e,t,o):se(n,"add",e,t),this}function Gn(e){const t=E(this),{has:n,get:s}=ut(t);let i=n.call(t,e);i?Js(t,n,e):(e=E(e),i=n.call(t,e));const r=s?s.call(t,e):void 0,o=t.delete(e);return i&&se(t,"delete",e,void 0,r),o}function Fn(){const e=E(this),t=e.size!==0,n=Pe(e)?new Map(e):new Set(e),s=e.clear();return t&&se(e,"clear",void 0,void 0,n),s}function Ke(e,t){return function(s,i){const r=this,o=r.__v_raw,a=E(o),l=t?_n:e?Sn:wn;return!e&&V(a,"iterate",ge),o.forEach((c,u)=>s.call(i,l(c),l(u),r))}}function We(e,t,n){return function(...s){const i=this.__v_raw,r=E(i),o=Pe(r),a=e==="entries"||e===Symbol.iterator&&o,l=e==="keys"&&o,c=i[e](...s),u=n?_n:t?Sn:wn;return!t&&V(r,"iterate",l?Ut:ge),{next(){const{value:g,done:d}=c.next();return d?{value:g,done:d}:{value:a?[u(g[0]),u(g[1])]:u(g),done:d}},[Symbol.iterator](){return this}}}}function Z(e){return function(...t){{const n=t[0]?`on key "${t[0]}" `:"";console.warn(`${Jr(e)} operation ${n}failed: target is readonly.`,E(this))}return e==="delete"?!1:this}}function yo(){const e={get(r){return Ue(this,r)},get size(){return Ve(this)},has:ze,add:Bn,set:Ln,delete:Gn,clear:Fn,forEach:Ke(!1,!1)},t={get(r){return Ue(this,r,!1,!0)},get size(){return Ve(this)},has:ze,add:Bn,set:Ln,delete:Gn,clear:Fn,forEach:Ke(!1,!0)},n={get(r){return Ue(this,r,!0)},get size(){return Ve(this,!0)},has(r){return ze.call(this,r,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Ke(!0,!1)},s={get(r){return Ue(this,r,!0,!0)},get size(){return Ve(this,!0)},has(r){return ze.call(this,r,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Ke(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=We(r,!1,!1),n[r]=We(r,!0,!1),t[r]=We(r,!1,!0),s[r]=We(r,!0,!0)}),[e,n,t,s]}var[po,wo,Ra,Ba]=yo();function Ys(e,t){const n=e?wo:po;return(s,i,r)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?s:Reflect.get(lt(n,i)&&i in s?n:s,i,r)}var So={get:Ys(!1)},_o={get:Ys(!0)};function Js(e,t,n){const s=E(n);if(s!==n&&t.call(e,s)){const i=zs(e);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Qs=new WeakMap,bo=new WeakMap,Xs=new WeakMap,vo=new WeakMap;function ko(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Do(e){return e.__v_skip||!Object.isExtensible(e)?0:ko(zs(e))}function bn(e){return e&&e.__v_isReadonly?e:ei(e,!1,go,So,Qs)}function Zs(e){return ei(e,!0,mo,_o,Xs)}function ei(e,t,n,s,i){if(!ct(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=i.get(e);if(r)return r;const o=Do(e);if(o===0)return e;const a=new Proxy(e,o===2?s:n);return i.set(e,a),a}function E(e){return e&&E(e.__v_raw)||e}function zt(e){return!!(e&&e.__v_isRef===!0)}W("nextTick",()=>fn);W("dispatch",e=>$e.bind($e,e));W("watch",(e,{evaluateLater:t,cleanup:n})=>(s,i)=>{let r=t(s),a=Qn(()=>{let l;return r(c=>l=c),l},i);n(a)});W("store",Gr);W("data",e=>rs(e));W("root",e=>rt(e));W("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=Ge(Eo(e))),e._x_refs_proxy));function Eo(e){let t=[];return De(e,n=>{n._x_refs&&t.push(n._x_refs)}),t}var yt={};function ti(e){return yt[e]||(yt[e]=0),++yt[e]}function Ao(e,t){return De(e,n=>{if(n._x_ids&&n._x_ids[t])return!0})}function Io(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=ti(t))}W("id",(e,{cleanup:t})=>(n,s=null)=>{let i=`${n}${s?`-${s}`:""}`;return Oo(e,i,t,()=>{let r=Ao(e,n),o=r?r._x_ids[n]:ti(n);return s?`${n}-${o}-${s}`:`${n}-${o}`})});at((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function Oo(e,t,n,s){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let i=s();return e._x_id[t]=i,n(()=>{delete e._x_id[t]}),i}W("el",e=>e);ni("Focus","focus","focus");ni("Persist","persist","persist");function ni(e,t,n){W(t,s=>N(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,s))}T("modelable",(e,{expression:t},{effect:n,evaluateLater:s,cleanup:i})=>{let r=s(t),o=()=>{let u;return r(g=>u=g),u},a=s(`${t} = __placeholder`),l=u=>a(()=>{},{scope:{__placeholder:u}}),c=o();l(c),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,g=e._x_model.set,d=Gs({get(){return u()},set(f){g(f)}},{get(){return o()},set(f){l(f)}});i(d)})});T("teleport",(e,{modifiers:t,expression:n},{cleanup:s})=>{e.tagName.toLowerCase()!=="template"&&N("x-teleport can only be used on a <template> tag",e);let i=jn(n),r=e.content.cloneNode(!0).firstElementChild;e._x_teleport=r,r._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),r.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{r.addEventListener(a,l=>{l.stopPropagation(),e.dispatchEvent(new l.constructor(l.type,l))})}),Le(r,{},e);let o=(a,l,c)=>{c.includes("prepend")?l.parentNode.insertBefore(a,l):c.includes("append")?l.parentNode.insertBefore(a,l.nextSibling):l.appendChild(a)};I(()=>{o(r,i,t),re(()=>{Q(r)})()}),e._x_teleportPutBack=()=>{let a=jn(n);I(()=>{o(e._x_teleport,a,t)})},s(()=>I(()=>{r.remove(),Ee(r)}))});var xo=document.createElement("div");function jn(e){let t=re(()=>document.querySelector(e),()=>xo)();return t||N(`Cannot find x-teleport element for selector: "${e}"`),t}var si=()=>{};si.inline=(e,{modifiers:t},{cleanup:n})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,n(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};T("ignore",si);T("effect",re((e,{expression:t},{effect:n})=>{n(P(e,t))}));function Vt(e,t,n,s){let i=e,r=l=>s(l),o={},a=(l,c)=>u=>c(l,u);if(n.includes("dot")&&(t=To(t)),n.includes("camel")&&(t=Co(t)),n.includes("passive")&&(o.passive=!0),n.includes("capture")&&(o.capture=!0),n.includes("window")&&(i=window),n.includes("document")&&(i=document),n.includes("debounce")){let l=n[n.indexOf("debounce")+1]||"invalid-wait",c=nt(l.split("ms")[0])?Number(l.split("ms")[0]):250;r=Bs(r,c)}if(n.includes("throttle")){let l=n[n.indexOf("throttle")+1]||"invalid-wait",c=nt(l.split("ms")[0])?Number(l.split("ms")[0]):250;r=Ls(r,c)}return n.includes("prevent")&&(r=a(r,(l,c)=>{c.preventDefault(),l(c)})),n.includes("stop")&&(r=a(r,(l,c)=>{c.stopPropagation(),l(c)})),n.includes("once")&&(r=a(r,(l,c)=>{l(c),i.removeEventListener(t,r,o)})),(n.includes("away")||n.includes("outside"))&&(i=document,r=a(r,(l,c)=>{e.contains(c.target)||c.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&l(c))})),n.includes("self")&&(r=a(r,(l,c)=>{c.target===e&&l(c)})),($o(t)||ii(t))&&(r=a(r,(l,c)=>{Po(c,n)||l(c)})),i.addEventListener(t,r,o),()=>{i.removeEventListener(t,r,o)}}function To(e){return e.replace(/-/g,".")}function Co(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function nt(e){return!Array.isArray(e)&&!isNaN(e)}function Mo(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function $o(e){return["keydown","keyup"].includes(e)}function ii(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function Po(e,t){let n=t.filter(r=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(r));if(n.includes("debounce")){let r=n.indexOf("debounce");n.splice(r,nt((n[r+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let r=n.indexOf("throttle");n.splice(r,nt((n[r+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.length===0||n.length===1&&Nn(e.key).includes(n[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(r=>n.includes(r));return n=n.filter(r=>!i.includes(r)),!(i.length>0&&i.filter(o=>((o==="cmd"||o==="super")&&(o="meta"),e[`${o}Key`])).length===i.length&&(ii(e.type)||Nn(e.key).includes(n[0])))}function Nn(e){if(!e)return[];e=Mo(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(n=>{if(t[n]===e)return n}).filter(n=>n)}T("model",(e,{modifiers:t,expression:n},{effect:s,cleanup:i})=>{let r=e;t.includes("parent")&&(r=e.parentNode);let o=P(r,n),a;typeof n=="string"?a=P(r,`${n} = __placeholder`):typeof n=="function"&&typeof n()=="string"?a=P(r,`${n()} = __placeholder`):a=()=>{};let l=()=>{let d;return o(f=>d=f),Un(d)?d.get():d},c=d=>{let f;o(w=>f=w),Un(f)?f.set(d):a(()=>{},{scope:{__placeholder:d}})};typeof n=="string"&&e.type==="radio"&&I(()=>{e.hasAttribute("name")||e.setAttribute("name",n)});var u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let g=ne?()=>{}:Vt(e,u,t,d=>{c(pt(e,t,d,l()))});if(t.includes("fill")&&([void 0,null,""].includes(l())||gn(e)&&Array.isArray(l())||e.tagName.toLowerCase()==="select"&&e.multiple)&&c(pt(e,t,{target:e},l())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=g,i(()=>e._x_removeModelListeners.default()),e.form){let d=Vt(e.form,"reset",[],f=>{fn(()=>e._x_model&&e._x_model.set(pt(e,t,{target:e},l())))});i(()=>d())}e._x_model={get(){return l()},set(d){c(d)}},e._x_forceModelUpdate=d=>{d===void 0&&typeof n=="string"&&n.match(/\./)&&(d=""),window.fromModel=!0,I(()=>Cs(e,"value",d)),delete window.fromModel},s(()=>{let d=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(d)})});function pt(e,t,n,s){return I(()=>{if(n instanceof CustomEvent&&n.detail!==void 0)return n.detail!==null&&n.detail!==void 0?n.detail:n.target.value;if(gn(e))if(Array.isArray(s)){let i=null;return t.includes("number")?i=wt(n.target.value):t.includes("boolean")?i=Je(n.target.value):i=n.target.value,n.target.checked?s.includes(i)?s:s.concat([i]):s.filter(r=>!Ro(r,i))}else return n.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(n.target.selectedOptions).map(i=>{let r=i.value||i.text;return wt(r)}):t.includes("boolean")?Array.from(n.target.selectedOptions).map(i=>{let r=i.value||i.text;return Je(r)}):Array.from(n.target.selectedOptions).map(i=>i.value||i.text);{let i;return Rs(e)?n.target.checked?i=n.target.value:i=s:i=n.target.value,t.includes("number")?wt(i):t.includes("boolean")?Je(i):t.includes("trim")?i.trim():i}}})}function wt(e){let t=e?parseFloat(e):null;return Bo(t)?t:e}function Ro(e,t){return e==t}function Bo(e){return!Array.isArray(e)&&!isNaN(e)}function Un(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}T("cloak",e=>queueMicrotask(()=>I(()=>e.removeAttribute(ke("cloak")))));Es(()=>`[${ke("init")}]`);T("init",re((e,{expression:t},{evaluate:n})=>typeof t=="string"?!!t.trim()&&n(t,{},!1):n(t,{},!1)));T("text",(e,{expression:t},{effect:n,evaluateLater:s})=>{let i=s(t);n(()=>{i(r=>{I(()=>{e.textContent=r})})})});T("html",(e,{expression:t},{effect:n,evaluateLater:s})=>{let i=s(t);n(()=>{i(r=>{I(()=>{e.innerHTML=r,e._x_ignoreSelf=!0,Q(e),delete e._x_ignoreSelf})})})});cn(ms(":",ys(ke("bind:"))));var ri=(e,{value:t,modifiers:n,expression:s,original:i},{effect:r,cleanup:o})=>{if(!t){let l={};jr(l),P(e,s)(u=>{js(e,u,i)},{scope:l});return}if(t==="key")return Lo(e,s);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=P(e,s);r(()=>a(l=>{l===void 0&&typeof s=="string"&&s.match(/\./)&&(l=""),I(()=>Cs(e,t,l,n))})),o(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};ri.inline=(e,{value:t,modifiers:n,expression:s})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:s,extract:!1})};T("bind",ri);function Lo(e,t){e._x_keyExpression=t}Ds(()=>`[${ke("data")}]`);T("data",(e,{expression:t},{cleanup:n})=>{if(Go(e))return;t=t===""?"{}":t;let s={};$t(s,e);let i={};Ur(i,s);let r=fe(e,t,{scope:i});(r===void 0||r===!0)&&(r={}),$t(r,e);let o=be(r);os(o);let a=Le(e,o);o.init&&fe(e,o.init),n(()=>{o.destroy&&fe(e,o.destroy),a()})});at((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function Go(e){return ne?jt?!0:e.hasAttribute("data-has-alpine-state"):!1}T("show",(e,{modifiers:t,expression:n},{effect:s})=>{let i=P(e,n);e._x_doHide||(e._x_doHide=()=>{I(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{I(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let r=()=>{e._x_doHide(),e._x_isShown=!1},o=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(o),l=Gt(g=>g?o():r(),g=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,g,o,r):g?a():r()}),c,u=!0;s(()=>i(g=>{!u&&g===c||(t.includes("immediate")&&(g?a():r()),l(g),c=g,u=!1)}))});T("for",(e,{expression:t},{effect:n,cleanup:s})=>{let i=jo(t),r=P(e,i.items),o=P(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},n(()=>Fo(e,i,r,o)),s(()=>{Object.values(e._x_lookup).forEach(a=>I(()=>{Ee(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function Fo(e,t,n,s){let i=o=>typeof o=="object"&&!Array.isArray(o),r=e;n(o=>{No(o)&&o>=0&&(o=Array.from(Array(o).keys(),m=>m+1)),o===void 0&&(o=[]);let a=e._x_lookup,l=e._x_prevKeys,c=[],u=[];if(i(o))o=Object.entries(o).map(([m,y])=>{let h=zn(t,y,m,o);s(S=>{u.includes(S)&&N("Duplicate key on x-for",e),u.push(S)},{scope:{index:m,...h}}),c.push(h)});else for(let m=0;m<o.length;m++){let y=zn(t,o[m],m,o);s(h=>{u.includes(h)&&N("Duplicate key on x-for",e),u.push(h)},{scope:{index:m,...y}}),c.push(y)}let g=[],d=[],f=[],w=[];for(let m=0;m<l.length;m++){let y=l[m];u.indexOf(y)===-1&&f.push(y)}l=l.filter(m=>!f.includes(m));let D="template";for(let m=0;m<u.length;m++){let y=u[m],h=l.indexOf(y);if(h===-1)l.splice(m,0,y),g.push([D,m]);else if(h!==m){let S=l.splice(m,1)[0],_=l.splice(h-1,1)[0];l.splice(m,0,_),l.splice(h,0,S),d.push([S,_])}else w.push(y);D=y}for(let m=0;m<f.length;m++){let y=f[m];y in a&&(I(()=>{Ee(a[y]),a[y].remove()}),delete a[y])}for(let m=0;m<d.length;m++){let[y,h]=d[m],S=a[y],_=a[h],M=document.createElement("div");I(()=>{_||N('x-for ":key" is undefined or invalid',r,h,a),_.after(M),S.after(_),_._x_currentIfEl&&_.after(_._x_currentIfEl),M.before(S),S._x_currentIfEl&&S.after(S._x_currentIfEl),M.remove()}),_._x_refreshXForScope(c[u.indexOf(h)])}for(let m=0;m<g.length;m++){let[y,h]=g[m],S=y==="template"?r:a[y];S._x_currentIfEl&&(S=S._x_currentIfEl);let _=c[h],M=u[h],F=document.importNode(r.content,!0).firstElementChild,U=be(_);Le(F,U,r),F._x_refreshXForScope=Y=>{Object.entries(Y).forEach(([oe,j])=>{U[oe]=j})},I(()=>{S.after(F),re(()=>Q(F))()}),typeof M=="object"&&N("x-for key cannot be an object, it must be a string or an integer",r),a[M]=F}for(let m=0;m<w.length;m++)a[w[m]]._x_refreshXForScope(c[u.indexOf(w[m])]);r._x_prevKeys=u})}function jo(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,s=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=e.match(s);if(!i)return;let r={};r.items=i[2].trim();let o=i[1].replace(n,"").trim(),a=o.match(t);return a?(r.item=o.replace(t,"").trim(),r.index=a[1].trim(),a[2]&&(r.collection=a[2].trim())):r.item=o,r}function zn(e,t,n,s){let i={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(o=>o.trim()).forEach((o,a)=>{i[o]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(o=>o.trim()).forEach(o=>{i[o]=t[o]}):i[e.item]=t,e.index&&(i[e.index]=n),e.collection&&(i[e.collection]=s),i}function No(e){return!Array.isArray(e)&&!isNaN(e)}function oi(){}oi.inline=(e,{expression:t},{cleanup:n})=>{let s=rt(e);s._x_refs||(s._x_refs={}),s._x_refs[t]=e,n(()=>delete s._x_refs[t])};T("ref",oi);T("if",(e,{expression:t},{effect:n,cleanup:s})=>{e.tagName.toLowerCase()!=="template"&&N("x-if can only be used on a <template> tag",e);let i=P(e,t),r=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return Le(a,{},e),I(()=>{e.after(a),re(()=>Q(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{I(()=>{Ee(a),a.remove()}),delete e._x_currentIfEl},a},o=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};n(()=>i(a=>{a?r():o()})),s(()=>e._x_undoIf&&e._x_undoIf())});T("id",(e,{expression:t},{evaluate:n})=>{n(t).forEach(i=>Io(e,i))});at((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});cn(ms("@",ys(ke("on:"))));T("on",re((e,{value:t,modifiers:n,expression:s},{cleanup:i})=>{let r=s?P(e,s):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let o=Vt(e,t,n,a=>{r(()=>{},{scope:{$event:a},params:[a]})});i(()=>o())}));dt("Collapse","collapse","collapse");dt("Intersect","intersect","intersect");dt("Focus","trap","focus");dt("Mask","mask","mask");function dt(e,t,n){T(t,s=>N(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,s))}Fe.setEvaluator(ds);Fe.setReactivityEngine({reactive:bn,effect:Xr,release:Zr,raw:E});var Uo=Fe,Be=Uo;const zo=(e,t)=>t.some(n=>e instanceof n);let Vn,Kn;function Vo(){return Vn||(Vn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ko(){return Kn||(Kn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ai=new WeakMap,Kt=new WeakMap,li=new WeakMap,St=new WeakMap,vn=new WeakMap;function Wo(e){const t=new Promise((n,s)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",o)},r=()=>{n(te(e.result)),i()},o=()=>{s(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&ai.set(n,e)}).catch(()=>{}),vn.set(t,e),t}function Ho(e){if(Kt.has(e))return;const t=new Promise((n,s)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",o),e.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",o),e.addEventListener("abort",o)});Kt.set(e,t)}let Wt={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Kt.get(e);if(t==="objectStoreNames")return e.objectStoreNames||li.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return te(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function qo(e){Wt=e(Wt)}function Yo(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const s=e.call(_t(this),t,...n);return li.set(s,t.sort?t.sort():[t]),te(s)}:Ko().includes(e)?function(...t){return e.apply(_t(this),t),te(ai.get(this))}:function(...t){return te(e.apply(_t(this),t))}}function Jo(e){return typeof e=="function"?Yo(e):(e instanceof IDBTransaction&&Ho(e),zo(e,Vo())?new Proxy(e,Wt):e)}function te(e){if(e instanceof IDBRequest)return Wo(e);if(St.has(e))return St.get(e);const t=Jo(e);return t!==e&&(St.set(e,t),vn.set(t,e)),t}const _t=e=>vn.get(e);function Qo(e,t,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(e,t),a=te(o);return s&&o.addEventListener("upgradeneeded",l=>{s(te(o.result),l.oldVersion,l.newVersion,te(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const Xo=["get","getKey","getAll","getAllKeys","count"],Zo=["put","add","delete","clear"],bt=new Map;function Wn(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(bt.get(t))return bt.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,i=Zo.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Xo.includes(n)))return;const r=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return bt.set(t,r),r}qo(e=>({...e,get:(t,n,s)=>Wn(t,n)||e.get(t,n,s),has:(t,n)=>!!Wn(t,n)||e.has(t,n)}));const vt="not-the-news-db",kt=29;let ee=null,pe=null;const ea=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function st(){if(ee)return ee;if(pe)return pe;pe=Qo(vt,kt,{upgrade(e,t){console.log(`[DB] Upgrading database from version ${t} to ${kt}`);const n=new Set(e.objectStoreNames);ea.forEach(s=>{let i;n.has(s.name)&&e.deleteObjectStore(s.name),i=e.createObjectStore(s.name,{keyPath:s.keyPath,...s.options||{}}),console.log(`[DB] Created/Recreated store: ${s.name}`),s.indexes&&s.indexes.forEach(r=>{i.createIndex(r.name,r.keyPath,r.options||{}),console.log(`[DB] Created index '${r.name}' on store '${s.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return ee=await pe,console.log(`[DB] Opened '${vt}', version ${kt}`),ee}catch(e){throw console.error(`[DB] Failed to open database '${vt}':`,e),ee=null,pe=null,e}}async function ci(){ee&&(ee.close(),ee=null,pe=null,console.log("[DB] Database connection closed."))}async function C(e){let t=await st();return e(t)}const B=()=>navigator.onLine,je=window.location.origin;async function Ne(e,t,n){return C(async s=>{try{const i=n||new Date().toISOString();await s.put("userSettings",{key:e,value:t,lastModified:i})}catch(i){console.error(`[DB] Failed to save sync metadata for key '${e}':`,i)}})}async function ta(e){return C(async t=>{const n={...e};n.id&&delete n.id;try{const s=t.transaction("pendingOperations","readwrite"),i=await s.store.add(n);return await s.done,i}catch(s){throw console.error("[DB] Error buffering operation:",s),s}})}async function z(e){if(!e||typeof e.type!="string"||e.type==="simpleUpdate"&&(e.value===null||e.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",e);return}try{const t=await ta(e);console.log(`[DB] Operation buffered with ID: ${t}`,e);const{value:n}=await k("syncEnabled");if(B()&&n){console.log(`[DB] Attempting immediate sync for ${e.type} (ID: ${t}).`);const s=[{...e,id:t}],i=await fetch(`${je}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok){const a=await i.text();throw new Error(`HTTP error ${i.status} for immediate sync. Details: ${a}`)}const r=await i.json(),o=r.results?.find(a=>a.id===t);if(o?.status==="success"){await C(l=>l.delete("pendingOperations",t)),console.log(`[DB] Successfully synced and removed immediate op ${t} (${e.type}).`),r.serverTime&&await Ne("lastStateSync",r.serverTime);let a=null;e.key?a=e.key:e.type==="readDelta"?a="read":e.type==="starDelta"&&(a="starred"),J(!1,a?[a]:[])}else console.warn(`[DB] Immediate sync for op ${t} reported non-success by server:`,o)}else console.log(`[DB] ${B()?"Sync is disabled.":"Offline."} Buffering op ${t} for later batch sync.`)}catch(t){console.error(`[DB] Network error during immediate sync for ${e.type}. Will retry with batch sync.`,t)}}async function ce(){const{value:e}=await k("syncEnabled");if(!B()||!e){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const t=await C(n=>n.getAll("pendingOperations")).catch(n=>(console.error("[DB] Error fetching pending operations:",n),null));if(!t||t.length===0){t&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${t.length} batched operations to /api/user-state.`);try{const n=await fetch(`${je}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error ${n.status}. Details: ${await n.text()}`);const s=await n.json();console.log("[DB] Batch sync successful. Server response:",s);const i=[];s.results&&Array.isArray(s.results)?await C(async r=>{const o=r.transaction("pendingOperations","readwrite");for(const a of s.results)if(a.status==="success"&&a.id!==void 0){await o.store.delete(a.id);const l=t?.find(c=>c.id===a.id);l&&(l.key?i.push(l.key):l.type==="readDelta"?i.push("read"):l.type==="starDelta"&&i.push("starred"))}else console.warn(`[DB] Op ${a.id??"N/A"} (${a.opType}) ${a.status}: ${a.reason||"N/A"}`);await o.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),s.serverTime&&await Ne("lastStateSync",s.serverTime),J(!1,i)}catch(n){console.error("[DB] Error during batch synchronization:",n)}}let Dt=!1,Hn=0;const na=500;async function qn(e,t,n=!1){if(!n&&(await C(c=>c.getAll("pendingOperations")).catch(()=>[])).some(c=>c.key===e||c.type==="starDelta"&&e==="starred"||c.type==="readDelta"&&e==="read"||c.type==="simpleUpdate"&&c.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${e}' because local changes are pending synchronization.`),{key:e,status:"skipped_pending"};const{value:s,lastModified:i}=t.type==="array"?await ie(t.store):await k(e,t.store),r=i||"",o={"Content-Type":"application/json"};r&&!n&&(o["If-None-Match"]=r);try{const a=await fetch(`${je}/api/user-state/${e}`,{method:"GET",headers:o});if(a.status===304&&!n)return{key:e,status:304,timestamp:r};if(!a.ok)return console.error(`[DB] HTTP error for ${e}: ${a.status}`),{key:e,status:a.status};const l=await a.json();if(console.log(`[DB Sync] Received data for ${e}:`,l.value),t.type==="array"){const c=l.value||[],u=s||[],g=new Set(c.map(D=>D.guid)),d=new Set(u.map(D=>D.guid)),f=n?c:c.filter(D=>!d.has(D.guid)),w=n?[]:u.filter(D=>!g.has(D.guid));(f.length>0||w.length>0||n)&&await C(async D=>{const m=D.transaction(t.store,"readwrite");n&&await m.store.clear();for(const y of f)await m.store.put(y);for(const y of w)n||await m.store.delete(y.id);await m.done})}else await Ne(e,l.value,l.lastModified);return{key:e,status:200,timestamp:l.lastModified}}catch(a){return console.error(`[DB] Failed to pull ${e}:`,a),{key:e,status:"error"}}}async function J(e=!1,t=[]){if(!B())return;let{value:n}=await k("syncEnabled");if(!n&&!e){console.log("[DB] Sync is disabled locally. Checking for remote status...");const i=K.syncEnabled;(await qn("syncEnabled",i,!1)).status===200&&(n=(await k("syncEnabled")).value)}if(!n&&!e||Dt&&!e)return;const s=Date.now();if(!(!e&&s-Hn<na)){Hn=s,Dt=!0,console.log(`[DB] Pulling user state (force=${e}, skip=${t.join(",")})...`);try{const i=Object.entries(K).filter(([a,l])=>!l.localOnly&&a!=="syncEnabled"&&!t.includes(a)),o=(await Promise.all(i.map(([a,l])=>qn(a,l,e)))).reduce((a,l)=>l?.timestamp&&l.timestamp>a?l.timestamp:a,"");o&&await Ne("lastStateSync",o)}catch(i){console.error("[DB] User state pull failed:",i)}finally{Dt=!1,console.log("[DB] User state pull completed.")}}}async function kn(){return C(e=>e.getAll("feedItems")).catch(e=>(console.error("Failed to get all feed items:",e),[]))}async function Yn(e,t,n,s){const r=[];for(let o=0;o<e.length;o+=50){if(!B())return console.warn("[DB] Offline mid-sync. Aborting batch fetch."),null;const a=e.slice(o,o+50),l=await fetch(`${je}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:a})});if(l.ok){const c=await l.json();if(r.push(...c),t){const u=s+r.length;t.progressMessage=`Fetching feed content... (${u}/${n})`}}else return console.error(`[DB] Failed to fetch batch. Status: ${l.status}`),null}return r}async function we(e){const{value:t}=await k("syncEnabled");if(!B()||!t)return t&&console.log("[DB] Offline. Skipping feed sync."),!0;console.log("[DB] Fetching feed items from server.");try{const{value:n}=await k("lastFeedSync"),s=await fetch(`${je}/api/feed-guids?since=${n||""}`);if(s.status===304)return console.log("[DB] Feed not modified."),!0;if(!s.ok)throw new Error(`HTTP error ${s.status} for /api/feed-guids`);const i=await s.json();console.log("[DB] /api/feed-guids response:",i);const{guids:r,serverTime:o}=i,a=new Set(r),l=await kn(),c=new Set(l.map(d=>d.guid)),u=[...a].filter(d=>!c.has(d)),g=[...c].filter(d=>!a.has(d));if(console.log(`[DB] GUIDs to fetch: ${u.length}, Deleting: ${g.length}`),u.length>0){let d=new Set((e.currentDeckGuids||[]).map(y=>y.guid));d.size===0&&(console.log("[DB] No current deck found. Prioritizing first 10 items for initial load."),u.slice(0,10).forEach(h=>d.add(h)));const f=u.filter(y=>d.has(y)),w=u.filter(y=>!d.has(y));console.log(`[DB] Priority sync: ${f.length} items from current deck.`);const D=await Yn(f,e,u.length,0);D?(await C(async y=>{const h=y.transaction("feedItems","readwrite");for(const S of D)S.guid&&await h.store.put(S);await h.done}),e&&e.loadFeedItemsFromDB&&await e.loadFeedItemsFromDB(),e&&e.loadAndDisplayDeck&&await e.loadAndDisplayDeck()):console.warn("[DB] Priority sync failed or was aborted. Continuing with background sync and local data.");const m=D?D.length:0;w.length>0&&(console.log(`[DB] Queuing background sync for ${w.length} remaining items.`),(async()=>{const y=await Yn(w,null,u.length,m);y&&(await C(async h=>{const S=h.transaction("feedItems","readwrite");for(const _ of y)_.guid&&await S.store.put(_);await S.done}),console.log(`[DB] Background sync complete: ${y.length} items saved.`),e.loadFeedItemsFromDB&&await e.loadFeedItemsFromDB(),e.loadAndDisplayDeck&&await e.loadAndDisplayDeck(),e.updateCounts&&e.updateCounts())})())}if(g.length>0){const d=new Map(l.map(f=>[f.guid,f.id]));await C(async f=>{const w=f.transaction("feedItems","readwrite");for(const D of g){const m=d.get(D);m!==void 0&&await w.store.delete(m)}await w.done})}return o&&await Ne("lastFeedSync",o),!0}catch(n){return console.error("[DB] Failed to synchronize feed:",n),!1}}async function Dn(e){if(!B())return console.log("[DB] Skipping full sync: Offline."),!0;const{value:t}=await k("syncEnabled");if(!t)return!0;console.log("[DB] Full sync initiated.");try{return await ce(),await J(),await we(e)}catch(n){return console.error("[DB] Full sync failed:",n),!1}}const K={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},itemButtonMode:{store:"userSettings",type:"simple",localOnly:!1,default:"play"},syncEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},theme:{store:"userSettings",type:"simple",localOnly:!1,default:"dark"},themeStyle:{store:"userSettings",type:"simple",localOnly:!1,default:"originalDark"},themeStyleLight:{store:"userSettings",type:"simple",localOnly:!1,default:"originalLight"},themeStyleDark:{store:"userSettings",type:"simple",localOnly:!1,default:"originalDark"},customCss:{store:"userSettings",type:"simple",localOnly:!1,default:""},fontSize:{store:"userSettings",type:"simple",localOnly:!0,default:100},feedWidth:{store:"userSettings",type:"simple",localOnly:!0,default:50},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0},rssFeeds:{store:"userSettings",type:"simple",localOnly:!1,default:{}},keywordBlacklist:{store:"userSettings",type:"simple",localOnly:!1,default:[]},shuffleCount:{store:"userSettings",type:"simple",localOnly:!1,default:2},lastShuffleResetDate:{store:"userSettings",type:"simple",localOnly:!1,default:null},shadowsEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},curvesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},flickToSelectEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},pregeneratedOnlineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null},pregeneratedOfflineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null}};async function k(e,t="userSettings"){return C(async n=>{try{const s=await n.get(t,e);return{value:s?s.value:K[e]?.default||null,lastModified:s?.lastModified||null}}catch(s){return console.error(`Failed to load simple state for key '${e}':`,s),{value:K[e]?.default||null,lastModified:null}}})}async function G(e,t,n="userSettings"){await C(i=>i.put(n,{key:e,value:t,lastModified:new Date().toISOString()}));const s=K[e];s&&!s.localOnly&&await z({type:"simpleUpdate",key:e,value:t,timestamp:new Date().toISOString()})}const ui=e=>{switch(e){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function ie(e){return console.log(`ENTERING loadArrayState for ${e}`),C(async t=>{try{const n=await t.getAll(e);if(n.length>0&&(typeof n[0]=="string"||n[0].id===void 0)){console.log(`[DB] Migration required for '${e}'.`);const i=ui(e),r=new Date().toISOString(),o=new Map;n.forEach(u=>{const g=typeof u=="string"?u:u.guid;g&&!o.has(g)&&o.set(g,u)});const l=Array.from(o.values()).map(u=>({guid:typeof u=="string"?u:u.guid,[i]:r})),c=t.transaction(e,"readwrite");await c.store.clear();for(const u of l)await c.store.put(u);return await c.done,console.log(`[DB] Migration complete for '${e}'.`),{value:await t.getAll(e)}}return{value:n||K[e]?.default||[]}}catch(n){return console.error(`Failed to load array state from store '${e}':`,n),{value:K[e]?.default||[]}}})}async function di(e,t){return C(n=>n.getFromIndex(e,"guid",t)).catch(n=>{console.error(`Error finding item by GUID '${t}' in store '${e}':`,n)})}async function En(e,t,n){await C(async i=>{const r=i.transaction(e,"readwrite");if(!t||!t.guid){console.error("[DB] updateArrayState requires an item with a guid property.",t);return}const o=r.objectStore(e);if(n)await o.put(t);else{const a=await o.index("guid").get(t.guid);a?.id!==void 0&&await o.delete(a.id)}await r.done});const s=Object.entries(K).find(([,i])=>i.store===e);if(s&&!s[1].localOnly){let i="";e==="starred"&&(i="starDelta"),e==="read"&&(i="readDelta"),i&&await z({type:i,guid:t.guid,action:n?"add":"remove",timestamp:t[ui(e)]||new Date().toISOString()})}}async function ft(e,t){const{value:n}=await ie(e),s=new Set(n.map(c=>c.guid));await Ae(e,t);const i=new Set(t.map(c=>c.guid)),r=[...s].filter(c=>!i.has(c)),o=[...i].filter(c=>!i.has(c)),a=Object.entries(K).find(([,c])=>c.store===e);if(!a||a[1].localOnly)return;let l="";if(e==="starred"&&(l="starDelta"),e==="read"&&(l="readDelta"),!l){await z({type:"simpleUpdate",key:a[0],value:t,timestamp:new Date().toISOString()});return}if(r.length>0){console.log(`[DB] Queuing ${r.length} 'remove' operations for '${e}'.`);for(const c of r)await z({type:l,guid:c,action:"remove",timestamp:new Date().toISOString()})}if(o.length>0){console.log(`[DB] Queuing ${o.length} 'add' operations for '${e}'.`);for(const c of o)await z({type:l,guid:c,action:"add",timestamp:new Date().toISOString()})}}async function fi(e,t){if(!Array.isArray(e)||!Array.isArray(t)){console.warn("[DB] pruneStaleReadItems skipped due to invalid input.");return}const n=new Set(t.map(o=>o.guid)),s=720*60*60*1e3,i=Date.now(),r=e.filter(o=>{if(n.has(o.guid))return!0;const a=new Date(o.readAt).getTime();return i-a<s});if(r.length<e.length){const o=e.length-r.length;console.log(`[DB] Pruning ${o} stale read items.`),await ft("read",r)}else console.log("[DB] No stale read items to prune.")}async function Ae(e,t){return C(async n=>{const s=n.transaction(e,"readwrite");await s.store.clear();for(const i of t){const r=JSON.parse(JSON.stringify(i));delete r.id,await s.store.put(r)}await s.done})}const L=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:K,findByGuid:di,loadArrayState:ie,loadSimpleState:k,overwriteArrayAndSyncChanges:ft,pruneStaleReadItems:fi,queueAndAttemptSyncOperation:z,saveArrayState:Ae,saveSimpleState:G,updateArrayState:En},Symbol.toStringTag,{value:"Module"})),sa=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:K,closeDb:ci,findByGuid:di,getAllFeedItems:kn,initDb:st,loadArrayState:ie,loadSimpleState:k,overwriteArrayAndSyncChanges:ft,performFeedSync:we,performFullSync:Dn,processPendingOperations:ce,pruneStaleReadItems:fi,pullUserState:J,queueAndAttemptSyncOperation:z,saveArrayState:Ae,saveSimpleState:G,updateArrayState:En,withDb:C},Symbol.toStringTag,{value:"Module"}));function Ht(e){const t=new Date,n=new Date(e),s=Math.floor((t.getTime()-n.getTime())/1e3),i=336*60*60;if(s>i)return n.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const r=Math.floor(s/60),o=Math.floor(r/60),a=Math.floor(o/24);if(s<60)return"Just now";if(r<60)return`${r} minute${r!==1?"s":""} ago`;if(o<24)return`${o} hour${o!==1?"s":""} ago`;if(a<7)return`${a} day${a!==1?"s":""} ago`;const l=Math.floor(a/7);return`${l} week${l!==1?"s":""} ago`}function qt(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function Qe(e){const t=[];if(!e)return t;if(Array.isArray(e))e.forEach(n=>{typeof n=="string"?t.push(n):n&&typeof n=="object"&&n.url&&t.push(n.url.trim())});else if(typeof e=="object")for(const n in e){const s=e[n];if(s&&typeof s=="object")for(const i in s){const r=s[i];Array.isArray(r)&&r.forEach(o=>{o&&o.url&&t.push(o.url.trim())})}}return t}function An(e,t){if(!e)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const s=new DOMParser().parseFromString(e.description||"","text/html"),i=s.querySelectorAll("img");let r="";if(i.length===1){const u=i[0];u.classList.add("title-image"),r=u.src||"",u.remove()}else i.forEach(u=>{u.setAttribute("loading","lazy"),u.setAttribute("onload","this.classList.add('loaded')")});let o="";const a=s.querySelector(".source-url")||s.querySelector("a");a?(o=a.textContent?.trim()||"",a.remove()):o=e.link?new URL(e.link).hostname:"";const l=s.body.innerHTML.trim(),c=Date.parse(e.pubDate)||0;return{guid:e.guid,image:r,title:e.title,link:e.link,pubDate:t(e.pubDate||""),description:l,source:o,timestamp:c}}function hi(e,t){if(console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),!Array.isArray(e))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const n=e.map(s=>An(s,t)).filter(s=>s!==null).sort((s,i)=>i.timestamp-s.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${n.length}`),n}async function Yt(e,t,n,s,i,r){console.log("ENTERING generateNewDeck with filterMode:",i,"isOnlineOverride:",r),console.log("generateNewDeck: allFeedItems count:",e.length),console.log("generateNewDeck: readItems count:",t.length);try{const a=h=>{if(!Array.isArray(h))return new Set;const S=h.map(_=>typeof _=="object"&&"guid"in _&&_.guid?_.guid:_);return new Set(S.filter(_=>typeof _=="string"&&!!_))},l=new Set(e.map(h=>h.guid)),c=new Set([...a(t)].filter(h=>l.has(h))),u=new Set([...a(n)].filter(h=>l.has(h))),g=new Set([...a(s)].filter(h=>l.has(h)));console.log(`[generateNewDeck] readGuidsSet size: ${c.size}`),console.log(`[generateNewDeck] shuffledOutGuidsSet size: ${g.size}`);let d=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${d.length}`),i){case"read":d=e.filter(h=>c.has(h.guid));break;case"starred":d=e.filter(h=>u.has(h.guid));break;default:d=e.filter(h=>!c.has(h.guid)&&!g.has(h.guid)),d.length===0&&(console.log("generateNewDeck: No unread/unshuffled items found, trying all unshuffled items."),d=e.filter(h=>!g.has(h.guid))),d.length===0&&(console.log("generateNewDeck: No unshuffled items found, trying all unread items."),d=e.filter(h=>!c.has(h.guid))),d.length===0&&(console.log("generateNewDeck: Absolutely no filter matches, using all items."),d=[...e]);break}if(console.log("generateNewDeck: Final filteredItems count:",d.length),i==="read"||i==="starred")return d.sort((h,S)=>S.timestamp-h.timestamp),console.log(`[generateNewDeck] Filtered items for ${i}: ${d.length}`),d;let f=[];const w=new Set,D=h=>f.length<10&&h&&!w.has(h.guid)?(f.push(h),w.add(h.guid),!0):!1,m=(h,S)=>{let _=0;for(const M of h){if(_>=S||f.length>=10)break;D(M)&&_++}};if(typeof r=="boolean"?r:navigator.onLine){const h=Date.now(),S=A=>/<a\s+href=/i.test(A.description),_=A=>A.title?.includes("?"),M=A=>A.description?.length>=150&&A.description.substring(0,150).includes("?"),F=A=>{const R=A.description;return R?.length>=150&&R.substring(R.length-150).includes("?")},U=A=>A.image!=="",Y=A=>A.description?.length>=750,oe=A=>A.description?.length<750,j=d.filter(A=>h-A.timestamp<=1440*60*1e3);m(j,2),console.log(`[generateNewDeck] After recentItems: ${f.length}`);const p=d.filter(S);m(p,1),console.log(`[generateNewDeck] After itemsWithLinks: ${f.length}`);const b=d.filter(_);m(b,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${f.length}`);const O=d.filter(M);m(O,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${f.length}`);const ae=d.filter(F);m(ae,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${f.length}`);const $=d.filter(U);m($,1),console.log(`[generateNewDeck] After itemsWithImages: ${f.length}`);const ht=d.filter(Y);m(ht,1),console.log(`[generateNewDeck] After longItems: ${f.length}`);const Ii=d.filter(oe);m(Ii,1),console.log(`[generateNewDeck] After shortItems: ${f.length}`);const Oi=d.filter(A=>!w.has(A.guid)),xi=qt([...Oi]);for(const A of xi){if(f.length>=10)break;D(A)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${f.length}`),f.length<10){const A=e.filter(R=>g.has(R.guid)&&!c.has(R.guid)&&!w.has(R.guid));A.sort((R,X)=>R.timestamp-X.timestamp);for(const R of A){if(f.length>=10)break;D(R)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${f.length}`),f.length<10){const R=e.filter(X=>!w.has(X.guid));R.sort((X,Ti)=>X.timestamp-Ti.timestamp);for(const X of R){if(f.length>=10)break;f.push(X),w.add(X.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${f.length}`)}}}else{let h=[...d];const S=p=>p.title?.includes("?"),_=p=>p.description?.length>=150&&p.description.substring(0,150).includes("?"),M=p=>{const b=p.description;return b?.length>=150&&b.substring(b.length-150).includes("?")},F=p=>/<a\s+href=/i.test(p.description),U=p=>p.image!=="";if(h=h.filter(p=>!S(p)),h=h.filter(p=>!(p.description&&_(p))),h=h.filter(p=>!(p.description&&M(p))),h=h.filter(p=>!F(p)),h=h.filter(p=>!U(p)),h.length<10){let p=d.filter(O=>!h.includes(O));const b=[O=>U(O),O=>F(O),O=>O.description&&M(O),O=>O.description&&_(O),O=>S(O)];for(const O of b){for(;h.length<10;){const ae=p.find(O);if(ae)h.push(ae),p=p.filter($=>$!==ae);else break}if(h.length>=10)break}for(;h.length<10&&p.length>0;)h.push(p.shift())}const Y=Date.now();f=h.filter(p=>Y-p.timestamp<=1440*60*1e3).slice(0,2);const j=h.filter(p=>!f.includes(p));f=f.concat(j.slice(0,10-f.length))}return qt([...f])}catch(o){return console.error("An error occurred during deck generation:",o),[]}}const ia=Object.freeze(Object.defineProperty({__proto__:null,formatDate:Ht,generateNewDeck:Yt,mapRawItem:An,mapRawItems:hi,parseRssFeedsConfig:Qe,shuffleArray:qt},Symbol.toStringTag,{value:"Module"}));function Jt(e){if(typeof structuredClone=="function")try{return structuredClone(e)}catch(n){console.error("structuredClone failed, falling back to manual sanitization.",n)}const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const s=e[n];typeof s=="object"&&s!==null?Array.isArray(s)?t[n]=s.map(i=>Jt(i)):t[n]=Jt(s):typeof s!="function"&&(t[n]=s)}return t}async function Qt(e,t,n){const i=e[n].some(c=>c.guid===t)?"remove":"add",r=new Date().toISOString(),o=n==="read"?{guid:t,readAt:r}:{guid:t,starredAt:r};await En(n,o,i==="add"),i==="add"?n==="read"?e.read=[...e.read,o]:e.starred=[...e.starred,o]:n==="read"?e.read=e.read.filter(c=>c.guid!==t):e.starred=e.starred.filter(c=>c.guid!==t),typeof e.updateCounts=="function"&&e.updateCounts();const l={type:`${n}Delta`,guid:t,action:i,timestamp:r};await z(l)}async function gi(e,t,n){if(!Array.isArray(t))return[];if(!Array.isArray(e)||e.length===0)return t;const s=new Set(e.filter(r=>r&&r.guid).map(r=>String(r.guid).trim().toLowerCase())),i=720*60*60*1e3;return t.filter(r=>{if(!r||!r.guid)return!1;const o=String(r.guid).trim().toLowerCase();if(s.has(o))return!0;if(r.readAt){const a=new Date(r.readAt).getTime();if(!isNaN(a))return n-a<i}return!0})}async function mi(e){const{value:t}=await ie("read");let n=!1,s=[];if(Array.isArray(t)){const r=new Date().toISOString();for(const o of t)typeof o=="string"&&o?(s.push({guid:o,readAt:r}),n=!0):typeof o=="object"&&o!==null&&typeof o.guid=="string"&&o.guid&&(o.readAt||(o.readAt=r,n=!0),s.push(o))}const i=await gi(e,s,Date.now());if(i.length!==s.length&&(n=!0),n)try{await Ae("read",i),console.log(`Sanitized, pruned, or migrated read items. Original count: ${t.length}, New count: ${i.length}`)}catch(r){console.error("Error saving pruned read items:",r)}return i}async function yi(){const{value:e}=await ie("currentDeckGuids");if(e&&e.length>0&&typeof e[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const n=new Date().toISOString(),s=e.map(i=>({guid:i,addedAt:n}));return await Ae("currentDeckGuids",s),console.log(`[loadCurrentDeck] Migration complete. Loaded ${s.length} objects.`),s}const t=Array.isArray(e)?e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid):[];return console.log(`[loadCurrentDeck] Loaded ${t.length} deck objects.`),t}async function pi(e){if(!Array.isArray(e)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const t=e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid);t.length!==e.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",t.length,"deck objects.");try{const n=t.map(s=>Jt(s));await ft("currentDeckGuids",n)}catch(n){console.error("[saveCurrentDeck] An error occurred while saving the deck:",n)}}async function wi(){const{value:e}=await k("shuffleCount"),{value:t}=await k("lastShuffleResetDate");return{shuffleCount:typeof e=="number"?e:2,lastShuffleResetDate:t||null}}async function it(e,t){await G("shuffleCount",e),await G("lastShuffleResetDate",t),await z({type:"simpleUpdate",key:"shuffleCount",value:e,timestamp:new Date().toISOString()}),await z({type:"simpleUpdate",key:"lastShuffleResetDate",value:t,timestamp:new Date().toISOString()})}async function Si(e,t){e.filterMode=t,await G("filterMode",t),await z({type:"simpleUpdate",key:"filterMode",value:t,timestamp:new Date().toISOString()})}async function _i(){const{value:e}=await k("filterMode");return e||"unread"}const Xt=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:mi,loadCurrentDeck:yi,loadFilterMode:_i,loadShuffleState:wi,pruneStaleRead:gi,saveCurrentDeck:pi,saveShuffleState:it,setFilterMode:Si,toggleItemStateAndSync:Qt},Symbol.toStringTag,{value:"Module"})),ra=()=>document.getElementById("sync-toggle"),oa=()=>document.getElementById("images-toggle"),aa=()=>document.getElementById("open-urls-in-new-tab-toggle"),la=()=>document.getElementById("shadows-toggle"),ca=()=>document.getElementById("curves-toggle"),ua=()=>document.getElementById("flick-to-select-toggle"),da=()=>document.getElementById("shuffle-count-display"),fa=()=>document.querySelector("#ntn-title h2");function ha(e,t=30){const n=e.split(" ");let s=[],i=[],r=0;for(const o of n){const a=o.length+(s.length>0?1:0);r+a<=t?(s.push(o),r+=a):i.push(o)}return[s.join(" "),i.join(" ")].filter(Boolean)}async function bi(e){const t=fa();if(!t){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const n="NOT THE NEWS",s=ha(e),i=t.style.overflow;t.style.overflow="visible";const r=o=>new Promise(a=>setTimeout(a,o));s.length>0&&(t.textContent=s[0],await r(1500)),s.length>1?(t.textContent=s.join(" "),await r(1500)):s.length===1&&await r(1500),t.textContent=n,t.style.overflow=i}let Et;function v(e,t){console.log(`[Status] ${t}`),Et&&clearTimeout(Et),e.syncStatusMessage=t;const n=()=>{e.showSyncStatus=!0,Et=setTimeout(()=>{e.showSyncStatus=!1,setTimeout(()=>{e.showSyncStatus||(e.syncStatusMessage="")},300)},5e3)};e.$nextTick?e.$nextTick(n):n()}let At;function vi(e,t,n=null){At&&clearTimeout(At),e.undoItemGuid=t,e.undoItemIndex=n,e.showUndo=!0,e.undoTimerActive=!1;const s=()=>{e.$nextTick&&e.$nextTick(()=>{requestAnimationFrame(()=>{const i=document.querySelector("#undo-notification .undo-button");if(i&&e.curvesEnabled){const r=i.getBoundingClientRect().height;console.log(`[Undo] Measured button height: ${r}`),r>10&&(e.undoBtnRadius=r/2-2)}else i&&!e.curvesEnabled&&(e.undoBtnRadius=0)})}),e.undoTimerActive=!0,At=setTimeout(()=>{e.showUndo=!1,e.undoTimerActive=!1,setTimeout(()=>{e.showUndo||(e.undoItemGuid=null)},500)},5e3)};e.$nextTick?e.$nextTick(s):setTimeout(s,10)}function Zt(e){const t=document.getElementById("main-settings"),n=document.getElementById("appearance-settings-block"),s=document.getElementById("rss-settings-block"),i=document.getElementById("keywords-settings-block"),r=document.getElementById("css-settings-block"),o=document.getElementById("advanced-settings-block");if(!t||!n||!s||!i||!r||!o)return console.warn("One or more settings panels not found."),Promise.resolve();switch(t.style.display="none",n.style.display="none",s.style.display="none",i.style.display="none",r.style.display="none",o.style.display="none",e.modalView){case"main":t.style.display="block";break;case"appearance":n.style.display="block";break;case"rss":s.style.display="block";break;case"keywords":i.style.display="block";break;case"css":r.style.display="block";break;case"advanced":o.style.display="block";break;default:console.warn("Unknown modalView:",e.modalView),t.style.display="block"}return Promise.resolve()}function ki(e){!e?.entries?.length||!e.read||!e.starred||e.currentDeckGuids}function In(){window.scrollTo({top:0,behavior:"smooth"})}let Di=!1;function ga(e){Di=e}const Ei=(()=>{let e,t=0;return(n="scroll-to-top")=>{const s=document.getElementById(n);if(!s)return;const i=()=>{if(Di){s.classList.remove("visible"),t=window.scrollY;return}const r=window.scrollY;s.classList.toggle("visible",r<t&&r>0),t=r,clearTimeout(e),e=setTimeout(()=>s.classList.remove("visible"),2e3)};window.addEventListener("scroll",i),s.addEventListener("click",r=>{r.preventDefault(),In()})}})();async function Me(){let e="",t=0;const n=document.querySelectorAll(".entry[data-guid]"),s=Array.from(n).find(i=>i.getBoundingClientRect().bottom>0);if(s){const i=s.getBoundingClientRect();e=s.dataset.guid||"",t=i.top}await G("lastViewedItemId",e),await G("lastViewedItemOffset",t)}const ma=Object.freeze(Object.defineProperty({__proto__:null,attachScrollToTopHandler:Ei,createStatusBarMessage:v,displayTemporaryMessageInTitle:bi,manageSettingsPanelVisibility:Zt,saveCurrentScrollPosition:Me,scrollToTop:In,setKeyboardScrolling:ga,showUndoNotification:vi,updateCounts:ki},Symbol.toStringTag,{value:"Module"})),ya={syncEnabled:"Auto-Sync",imagesEnabled:"Images",itemButtonMode:"Item Button",openUrlsInNewTabEnabled:"Open in New Tab",shadowsEnabled:"Shadows",curvesEnabled:"Curves",flickToSelectEnabled:"Flick to Select"};async function Ie(e,t,n,s=()=>{}){const i=t();i&&i.addEventListener("change",async()=>{const r=e[n];await G(n,r);const o=ya[n]||n;v(e,`${o} ${r?"Enabled":"Disabled"}.`),s(r)})}async function pa(e){await Ie(e,ra,"syncEnabled",async t=>{e.updateSyncStatusMessage?.(),t&&(v(e,"Kicking off a new sync"),console.log("Sync enabled, triggering full sync."),await Dn(e)?v(e,"Sync complete!"):v(e,"Sync finished with some issues."),e._loadAndManageAllData&&await e._loadAndManageAllData())})}async function wa(e){await Ie(e,oa,"imagesEnabled")}async function Sa(e){const t=document.getElementById("item-button-mode-selector");t&&t.addEventListener("change",async()=>{const n=e.itemButtonMode;await G("itemButtonMode",n),v(e,`Item Button set to ${n}.`)})}async function _a(e){await Ie(e,la,"shadowsEnabled")}async function ba(e){await Ie(e,ca,"curvesEnabled")}async function va(e){await Ie(e,ua,"flickToSelectEnabled")}async function ka(e){await Ie(e,aa,"openUrlsInNewTabEnabled")}async function Da(e){window.requestAnimationFrame(async()=>{const{value:t}=await k("lastViewedItemId"),{value:n}=await k("lastViewedItemOffset");if(!t||!e.deck?.length)return;if(e.deck.some(i=>i.guid===t)){const i=document.querySelector(`.entry[data-guid="${t}"]`);i&&(e.selectedGuid=t,i.scrollIntoView({behavior:"auto",block:"start"}),typeof n=="number"&&n!==0&&window.scrollTo({top:window.scrollY-n,behavior:"auto"}))}})}let He;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),He=e;const t=document.getElementById("install-button");t&&(t.style.display="block",t.addEventListener("click",()=>{He.prompt(),He.userChoice.then(n=>{n.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),He=null})}))});const qe=2,H=e=>typeof e=="object"&&e.guid?e.guid:e,Xe=async(e,t,n,s,i,r="unread",o=null,a=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:e.length,readItemsCount:t.length,starredItemsCount:n.length,shuffledOutItemsCount:s.length,shuffleCount:i,filterMode:r,lastShuffleResetDate:o,hasPregen:!!a}),!Array.isArray(e)||e.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),{deck:[],currentDeckGuids:[],shuffledOutGuids:Array.isArray(s)?s:[],shuffleCount:typeof i=="number"?i:qe,lastShuffleResetDate:typeof o=="string"?o:new Date().toDateString()};const l=Array.isArray(t)?t:[],c=Array.isArray(n)?n:[],u=Array.isArray(s)?s:[],{loadCurrentDeck:g}=await x(async()=>{const{loadCurrentDeck:b}=await Promise.resolve().then(()=>Xt);return{loadCurrentDeck:b}},void 0),d=await g(),f=new Set(l.map(H)),w=new Set(c.map(H)),D=new Set(u.map(H)),m=new Map(e.map(b=>[b.guid,b]));let y=d.map(b=>m.get(H(b))).filter(b=>!!b);const h=new Date().toDateString(),S=o!==h,_=!d||d.length===0||y.length===0,M=_||y.every(b=>f.has(b.guid)||D.has(b.guid)),F=!_&&y.every(b=>D.has(b.guid));let U=y,Y=d,oe=u,j=typeof i=="number"?i:qe,p=o||h;if(S||M||r!=="unread"||d.length===0&&e.length>0){console.log(`[deckManager] Resetting deck. Reason: New Day (${S}), Deck Effectively Empty (${M}), Filter Mode Changed (${r}), or Initial Load (${d.length===0}).`),!S&&d.length>0&&M&&r==="unread"&&(F||(console.log("[deckManager] Automatically incrementing (refunding) shuffleCount due to deck cleared by reading."),j++,await it(j,p)));let b=[],O=!1;if(a&&a.length>0&&(a.some(ht=>!f.has(H(ht)))?O=!0:console.log("[deckManager] Pre-generated deck is stale (all items read). Falling back to manual generation.")),O&&a){if(console.log("[deckManager] Using pre-generated deck inside manageDailyDeck"),b=[...a],b.length<10){console.log(`[deckManager] Pregen is small (${b.length}), topping up to 10.`);const $=await Yt(e,l,c,[...u,...b.map(H)],r);b=[...b,...$].slice(0,10)}}else console.log("[deckManager] Generating new deck from scratch inside manageDailyDeck"),b=await Yt(e,l,c,u,r);const ae=new Date().toISOString();Y=(b||[]).map($=>({guid:H($),addedAt:ae})),U=(b||[]).map($=>m.get(H($))).filter($=>!!$).map($=>({...$,isRead:f.has($.guid),isStarred:w.has($.guid)})),await pi(Y),S&&(oe=[],await Ae("shuffledOutGuids",[]),j=qe,await it(j,h),p=h,await G("lastShuffleResetDate",h))}else U=y.map(b=>({...b,isRead:f.has(b.guid),isStarred:w.has(b.guid)}));return{deck:U||[],currentDeckGuids:Y||[],shuffledOutGuids:oe||[],shuffleCount:typeof j=="number"?j:qe,lastShuffleResetDate:typeof p=="string"?p:new Date().toDateString()}};async function Ea(e){if(console.log("[deckManager] processShuffle called."),e.shuffleCount<=0){v(e,"No shuffles left for today!");return}const t=e.deck.map(f=>f.guid);console.log(`[deckManager] processShuffle: Visible GUIDs to shuffle out: ${t.length}`,t);const n=(e.shuffledOutGuids||[]).map(H).map(f=>({guid:f,shuffledAt:new Date().toISOString()})),s=new Set(n.map(H)),i=new Set([...s,...t]),r=new Date().toISOString(),o=Array.from(i).map(f=>({guid:f,shuffledAt:r}));e.shuffledOutGuids=o,e.shuffleCount--;const{overwriteArrayAndSyncChanges:a}=await x(async()=>{const{overwriteArrayAndSyncChanges:f}=await Promise.resolve().then(()=>L);return{overwriteArrayAndSyncChanges:f}},void 0);await a("shuffledOutGuids",o),await it(e.shuffleCount,e.lastShuffleResetDate??new Date().toDateString());const l=da();l&&(l.textContent=e.shuffleCount.toString());const c=e.isOnline,u=c?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck",g=e[u],d=await Xe(e.entries,e.read,e.starred,e.shuffledOutGuids,e.shuffleCount,e.filterMode,e.lastShuffleResetDate,g);if(e.deck=d.deck,e.currentDeckGuids=d.currentDeckGuids,e.shuffledOutGuids=d.shuffledOutGuids,e.shuffleCount=d.shuffleCount,e.lastShuffleResetDate=d.lastShuffleResetDate,g&&g.length>0&&e.currentDeckGuids.length>0&&e.currentDeckGuids[0].guid===g[0].guid){console.log(`[deckManager] Consumed pre-generated ${c?"ONLINE":"OFFLINE"} deck in processShuffle.`),u==="pregeneratedOnlineDeck"?e.pregeneratedOnlineDeck=null:e.pregeneratedOfflineDeck=null;const{saveSimpleState:f}=await x(async()=>{const{saveSimpleState:w}=await Promise.resolve().then(()=>L);return{saveSimpleState:w}},void 0);await f(u,null)}e.deck.length>0&&(e.selectedGuid=null,e.$nextTick(()=>{e.deck.length>0&&e.selectItem(e.deck[0].guid)})),bi("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${e.shuffleCount}.`),e.pregenerateDecks()}const Aa=1e4;async function It(e,t){const n=Date.now();if(e.selectedGuid&&e.selectedTimestamp&&n-e.selectedTimestamp>Aa){console.log("[Navigation] Selection is old (>10s). Reselecting current item.");const i=e.selectedGuid;e.selectedGuid=null,e.$nextTick(()=>{e.selectedGuid=i})}else{const{setKeyboardScrolling:i}=await x(async()=>{const{setKeyboardScrolling:r}=await Promise.resolve().then(()=>ma);return{setKeyboardScrolling:r}},void 0);i(!0),await Ia(e,t),setTimeout(()=>i(!1),1e3)}}async function Ai(e,t){const n=e.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable)return;const s=e.key,i=e.ctrlKey||e.metaKey;if(t.openSettings){if(["j","k","s","L","i","o","Enter","r","m","t","u","p"," ","ArrowUp","ArrowDown"].includes(s)&&!i){if(s==="Enter"&&["BUTTON","SELECT","A","INPUT","TEXTAREA"].includes(n.tagName))return;e.preventDefault()}const o=document.querySelector(".modal-content");if(!o){s==="Escape"&&(e.preventDefault(),t.openSettings=!1);return}const l=Array.from(o.querySelectorAll('button, select, input, textarea, [tabindex]:not([tabindex="-1"])')).filter(d=>{const f=window.getComputedStyle(d);return f.display!=="none"&&f.visibility!=="hidden"&&d.offsetParent!==null});if(s==="Escape"){e.preventDefault(),t.openSettings=!1;return}if(l.length===0)return;const c=l[0],u=l[l.length-1],g=l.indexOf(document.activeElement);if(s==="Tab"&&(e.shiftKey?document.activeElement===c&&(e.preventDefault(),u.focus()):document.activeElement===u&&(e.preventDefault(),c.focus())),s==="ArrowDown"||s==="j"&&!i){e.preventDefault();const d=(g+1)%l.length;l[d].focus()}if(s==="ArrowUp"||s==="k"&&!i){e.preventDefault();const d=(g-1+l.length)%l.length;l[d].focus()}if(n.tagName==="INPUT"&&n.type==="range"&&(s==="ArrowLeft"||s==="ArrowRight"||s==="h"&&!i||s==="l"&&!i)){e.preventDefault();const d=parseFloat(n.step)||1,f=parseFloat(n.value),D=s==="ArrowRight"||s==="l"?f+d:f-d;n.value=D.toString(),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))}s==="Enter"&&n.tagName!=="SELECT"&&(e.preventDefault(),n.click());return}if(t.openShortcuts&&s!=="?"&&s!=="Escape"&&!(s==="k"&&i)){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," ","j","k"].includes(s)&&e.preventDefault();return}if(!(e.shiftKey&&["j","k","ArrowDown","ArrowUp"].includes(s)))switch(s){case"j":case"ArrowDown":e.preventDefault(),await It(t,1);break;case"k":i?(e.preventDefault(),t.openShortcuts=!t.openShortcuts):(e.preventDefault(),await It(t,-1));break;case"ArrowUp":e.preventDefault(),await It(t,-1);break;case"l":case"ArrowRight":t.selectedGuid&&(e.preventDefault(),t.selectedSubElement==="item"?t.selectedSubElement="read":t.selectedSubElement==="read"?t.selectedSubElement="star":t.selectedSubElement==="star"&&(t.selectedSubElement="play"));break;case"h":case"ArrowLeft":t.selectedGuid&&(e.preventDefault(),t.selectedSubElement==="play"?t.selectedSubElement="star":t.selectedSubElement==="star"?t.selectedSubElement="read":t.selectedSubElement==="read"&&(t.selectedSubElement="item"));break;case"p":t.selectedGuid&&(e.preventDefault(),t.speakItem(t.selectedGuid));break;case" ":case"n":e.preventDefault(),t.selectedGuid?await t.toggleRead(t.selectedGuid):t.filteredEntries.length>0&&(t.selectedGuid=t.filteredEntries[0].guid,On(t.selectedGuid,t));break;case"s":case"L":t.selectedGuid&&(e.preventDefault(),await t.toggleStar(t.selectedGuid));break;case"i":e.preventDefault(),t.imagesEnabled=!t.imagesEnabled,v(t,`Images ${t.imagesEnabled?"Enabled":"Disabled"}.`),x(()=>Promise.resolve().then(()=>sa),void 0).then(r=>{r.saveSimpleState("imagesEnabled",t.imagesEnabled)});break;case"o":case"Enter":if(t.selectedGuid)if(e.preventDefault(),t.selectedSubElement==="read")await t.toggleRead(t.selectedGuid);else if(t.selectedSubElement==="star")await t.toggleStar(t.selectedGuid);else if(t.selectedSubElement==="play")t.speakItem(t.selectedGuid);else{const r=t.filteredEntries.find(o=>o.guid===t.selectedGuid);r?.link&&window.open(r.link,"_blank","noopener,noreferrer")}break;case"r":case"m":t.selectedGuid&&(e.preventDefault(),await t.toggleRead(t.selectedGuid));break;case"t":e.preventDefault(),t.scrollToTop();break;case"u":e.preventDefault(),await t.undoMarkRead();break;case"/":e.preventDefault(),t.toggleSearch();break;case"?":e.preventDefault(),t.openShortcuts?t.openShortcuts=!1:t.openShortcuts=!0;break;case"Escape":t.openShortcuts?(e.preventDefault(),t.openShortcuts=!1):t.openSettings?(e.preventDefault(),t.openSettings=!1):t.selectedGuid&&(e.preventDefault(),t.selectedGuid=null);break;case"z":i&&(e.preventDefault(),await t.undoMarkRead());break}}async function Ia(e,t){const n=e.filteredEntries;if(n.length!==0){if(e.selectedGuid){let i=n.findIndex(r=>r.guid===e.selectedGuid)+t;i>=n.length&&(i=n.length-1),i<0&&(i=0),e.selectedGuid=n[i].guid}else{const s=e.lastSelectedGuid,i=s?n.findIndex(r=>r.guid===s):-1;if(i===-1)e.selectedGuid=n[0].guid;else{let r=i+t;r>=n.length&&(r=n.length-1),r<0&&(r=0),e.selectedGuid=n[r].guid}}On(e.selectedGuid,e)}}function On(e,t){if(e){if(t.filteredEntries.length>0&&t.filteredEntries[0].guid===e){t.scrollToTop();return}setTimeout(()=>{const n=document.querySelector(`.entry[data-guid="${e}"]`);if(n){const s=document.querySelector("#header"),i=s?s.getBoundingClientRect().height:0,o=n.getBoundingClientRect().top+window.pageYOffset-i-20;window.scrollTo({top:o,behavior:"smooth"})}},10)}}const Oa=Object.freeze(Object.defineProperty({__proto__:null,handleKeyboardShortcuts:Ai,scrollSelectedIntoView:On},Symbol.toStringTag,{value:"Module"}));function xa(e,t){if(!t||t.trim()==="")return e;const n=t.toLowerCase().trim().split(/\s+/);return e.filter(s=>{const i=(s.title||"").toLowerCase(),r=(s.description||"").toLowerCase(),o=`${i} ${r}`;return n.every(a=>o.includes(a))})}function Ta(e){e.showSearchBar=!e.showSearchBar,e.showSearchBar?(e.searchQuery="",e.$nextTick(()=>{const t=document.getElementById("search-input");t&&t.focus()})):e.searchQuery=""}async function Ca(e){const t=await fetch(`/api/discover-feed?url=${encodeURIComponent(e)}`);if(!t.ok){const n=await t.json();throw new Error(n.error||`Discovery failed with status ${t.status}`)}return t.json()}async function Ma(e){const t=e.discoveryUrl.trim();if(t){e.isDiscovering=!0,e.discoveryError="",e.discoveryResults=[];try{const n=await Ca(t);e.discoveryResults=n.feeds,n.feeds.length===0&&(e.discoveryError="No feeds found on this website.",v(e,"No RSS feeds found at this URL."))}catch(n){console.error("[Discovery] Error:",n),e.discoveryError=n.message}finally{e.isDiscovering=!1}}}function $a(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,openShortcuts:!1,modalView:"main",showSearchBar:!1,searchQuery:"",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,itemButtonMode:"play",openUrlsInNewTabEnabled:!0,shadowsEnabled:!0,curvesEnabled:!0,flickToSelectEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",discoveryUrl:"",isDiscovering:!1,discoveryResults:[],discoveryError:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutGuids:[],pregeneratedOnlineDeck:null,pregeneratedOfflineDeck:null,errorMessage:"",isOnline:B(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",themeStyle:"originalDark",themeStyleLight:"originalLight",themeStyleDark:"originalDark",customCss:"",fontSize:100,feedWidth:50,showUndo:!1,undoTimerActive:!1,undoItemGuid:null,undoItemIndex:null,undoBtnRadius:20,selectedGuid:null,selectedSubElement:"item",selectedTimestamp:null,lastSelectedGuid:null,starredGuid:null,readingGuid:null,speakingGuid:null,closingGuid:null,_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,imageObserver:null,db:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,_isPregenerating:!1,lastShuffleResetDate:null,initApp:async function(){try{if(this.progressMessage="Connecting to database...",this.db=await st(),this.progressMessage="Loading settings...",await this._loadInitialState(),this._initImageObserver(),this.isOnline=B(),this.isOnline){this.progressMessage="Syncing latest content...",B()&&await ce(),B()&&await J();let e=!0;try{B()&&(e=await we(this))}catch(t){console.error("Priority sync failed:",t),e=!1}await this._loadAndManageAllData(),e&&this.isOnline?v(this,"Initial sync complete!"):this.isOnline?v(this,"Sync finished with some issues. Check console for details."):v(this,"Sync skipped (Offline).")}else this.progressMessage="Offline mode. Loading local data...",await this._loadAndManageAllData();if(this.progressMessage="Applying user preferences...",pa(this),wa(this),Sa(this),_a(this),ba(this),va(this),ka(this),Ei(),this.$nextTick(()=>{Da(this)}),this.progressMessage="Setting up app watchers...",this._setupWatchers(),this._setupEventListeners(),this._setupFlickToSelectListeners(),this._startPeriodicSync(),this._initScrollObserver(),this._initObservers(),this.deck.length===0)this.entries.length>0?this.progressMessage="Fetching and building your feed...":this.progressMessage="No feed items found. Please configure your RSS feeds.",await new Promise(e=>setTimeout(e,1e3));else if(await new Promise(e=>setTimeout(e,500)),!this.selectedGuid){const{value:e}=await k("lastViewedItemId");!(e&&this.deck.some(n=>n.guid===e))&&this.deck.length>0&&this.selectItem(this.deck[0].guid)}this.pregenerateDecks(),this.loading=!1,this._initComplete=!0,await this.updateSyncStatusMessage()}catch(e){console.error("Initialization failed:",e),this.errorMessage=`Could not load feed: ${e.message}`,this.progressMessage=`Error: ${e.message}`,v(this,`Could not load feed: ${e.message}`)}},performBackgroundSync:async function(){if(!(!this.syncEnabled||!this.isOnline)){console.log("Performing immediate background sync..."),this.progressMessage="Syncing...",this.loading=!0;try{await ce();const e=await we(this);await J(),await this._loadAndManageAllData(),this.deckManaged=!0,this.progressMessage="",this.loading=!1,console.log("Immediate background sync complete."),e?v(this,"Sync complete!"):v(this,"Sync finished with errors.")}catch(e){console.error("Immediate background sync failed:",e),this.progressMessage="Sync Failed!",this.loading=!1,v(this,`Sync failed: ${e.message}`)}}},updateSyncStatusMessage:async function(){B()?this.syncEnabled?(this.showSyncStatus=!1,this.syncStatusMessage=""):(this.syncStatusMessage="Sync is disabled.",this.showSyncStatus=!0):(this.syncStatusMessage="Offline.",this.showSyncStatus=!0)},loadAndDisplayDeck:async function(){let e=this.currentDeckGuids;Array.isArray(e)||(e=[]),console.log(`[loadAndDisplayDeck] Processing ${e.length} GUIDs for display`),console.log(`[loadAndDisplayDeck] feedItems contains ${Object.keys(this.feedItems).length} items`);const t=[],n=new Set(this.read.map(a=>a.guid)),s=new Set(this.starred.map(a=>a.guid)),i=new Set;let r=0,o=0;for(const a of e){const l=a.guid;if(typeof l!="string"||!l)continue;const c=this.feedItems[l];if(c&&c.guid&&!i.has(c.guid)){const u=An(c,Ht);u&&(u.isRead=n.has(u.guid),u.isStarred=s.has(u.guid),t.push(u),i.add(u.guid),r++)}else o++,o<=3&&console.log(`[loadAndDisplayDeck] MISSING: GUID ${l} not found in feedItems`)}console.log(`[loadAndDisplayDeck] Found ${r} items, Missing ${o} items`),this.deck=Array.isArray(t)?t:[],console.log(`[loadAndDisplayDeck] Final deck size: ${this.deck.length}`)},loadFeedItemsFromDB:async function(){if(!this.db){this.entries=[],this.feedItems={};return}const e=await kn();this.feedItems={};const t=[],n=new Set;e.forEach(s=>{s&&s.guid&&!n.has(s.guid)&&(this.feedItems[s.guid]=s,t.push(s),n.add(s.guid))}),this.entries=hi(t,Ht)||[]},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const e=this.deck.length>0?this.deck[0].guid.substring(0,8):"empty",t=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}-${this.searchQuery}-${e}`;if(this.entries.length>0&&t===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let n=[];const s=new Map(this.read.map(o=>[o.guid,o.readAt])),i=new Map(this.starred.map(o=>[o.guid,o.starredAt]));switch(this.filterMode){case"unread":n=this.deck.filter(o=>!s.has(o.guid));break;case"all":n=this.entries;break;case"read":n=this.entries.filter(o=>s.has(o.guid)).sort((o,a)=>new Date(s.get(a.guid)||0).getTime()-new Date(s.get(o.guid)||0).getTime());break;case"starred":n=this.entries.filter(o=>i.has(o.guid)).sort((o,a)=>new Date(i.get(a.guid)||0).getTime()-new Date(i.get(o.guid)||0).getTime());break}n=n.map(o=>({...o,isRead:s.has(o.guid),isStarred:i.has(o.guid)}));const r=(this.keywordBlacklistInput??"").split(/\r?\n/).map(o=>o.trim().toLowerCase()).filter(o=>o.length>0);return r.length>0&&(n=n.filter(o=>{const a=`${o.title} ${o.description}`.toLowerCase();return!r.some(l=>a.includes(l))})),n=xa(n,this.searchQuery),this._cachedFilteredEntries=n,this._lastFilterHash=t,n},get allCount(){return this.entries.length},get starredCount(){if(!this.entries.length)return 0;const e=new Set(this.starred.map(t=>t.guid));return this.entries.filter(t=>e.has(t.guid)).length},get readCount(){if(!this.entries.length)return 0;const e=new Set(this.read.map(t=>t.guid));return this.entries.filter(t=>e.has(t.guid)).length},get unreadCount(){if(!this.entries.length||!this.currentDeckGuids.length)return 0;const e=new Set(this.read.map(n=>n.guid)),t=new Set(this.currentDeckGuids.map(n=>n.guid));return this.entries.filter(n=>t.has(n.guid)&&!e.has(n.guid)).length},isStarred:function(e){return this.starred.some(t=>t.guid===e)},isRead:function(e){return this.read.some(t=>t.guid===e)},toggleStar:async function(e){!this.starred.some(n=>n.guid===e)&&(this.starredGuid=e,setTimeout(()=>{this.starredGuid===e&&(this.starredGuid=null)},1e3)),await Qt(this,e,"starred")},speakItem:function(e){if(this.speakingGuid===e){window.speechSynthesis.cancel(),this.speakingGuid=null;return}const t=this.entries.find(r=>r.guid===e);if(!t)return;window.speechSynthesis.cancel(),this.speakingGuid=e;const n=t.description.replace(/<[^>]*>?/gm," "),s=`${t.title}. ${n}`,i=new SpeechSynthesisUtterance(s);i.onend=()=>{this.speakingGuid===e&&(this.speakingGuid=null)},i.onerror=()=>{this.speakingGuid=null},window.speechSynthesis.speak(i)},toggleRead:async function(e){this.speakingGuid===e&&(window.speechSynthesis.cancel(),this.speakingGuid=null);const t=this.isRead(e),n=this.selectedGuid===e;let s=null;if(!t&&n&&this.filterMode==="unread"){const o=this.filteredEntries,a=o.findIndex(l=>l.guid===e);a!==-1&&(a<o.length-1?s=o[a+1].guid:a>0&&(s=o[a-1].guid))}t||(this.readingGuid=e,this.filterMode==="unread"?(this.closingGuid=e,await new Promise(o=>setTimeout(o,500)),s&&this.selectItem(s),await new Promise(o=>setTimeout(o,450))):await new Promise(o=>setTimeout(o,500)),this.readingGuid=null,this.closingGuid=null);let i=null;if(await Qt(this,e,"read"),this.deck=this.deck.map(o=>o.guid===e?{...o,isRead:!t}:o),this.entries=this.entries.map(o=>o.guid===e?{...o,isRead:!t}:o),this.filterMode==="unread"&&!t){i=this.currentDeckGuids.findIndex(a=>a.guid===e),i===-1&&(i=null),this.deck=this.deck.filter(a=>a.guid!==e),this.currentDeckGuids=this.currentDeckGuids.filter(a=>a.guid!==e);const{saveCurrentDeck:o}=await x(async()=>{const{saveCurrentDeck:a}=await Promise.resolve().then(()=>Xt);return{saveCurrentDeck:a}},void 0);await o(this.currentDeckGuids),!s&&n&&(this.selectedGuid=null)}else if(this.filterMode==="unread"&&t&&!this.currentDeckGuids.some(o=>o.guid===e)){const o={guid:e,addedAt:new Date().toISOString()};this.undoItemIndex!==null&&this.undoItemIndex>=0?this.currentDeckGuids.splice(this.undoItemIndex,0,o):this.currentDeckGuids.push(o);const{saveCurrentDeck:a}=await x(async()=>{const{saveCurrentDeck:l}=await Promise.resolve().then(()=>Xt);return{saveCurrentDeck:l}},void 0);await a(this.currentDeckGuids)}this.updateCounts(),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage(),!t&&this.filterMode!=="all"&&vi(this,e,i);let r=this.deck.filter(o=>!this.isRead(o.guid)).length;if(this.filterMode==="unread"&&r===0){for(console.log("[toggleRead] Last item read. Preloading next deck during undo period..."),this.pregenerateDecks(),this.loadFeedItemsFromDB();this.showUndo;)await new Promise(o=>setTimeout(o,100));if(r=this.deck.filter(o=>!this.isRead(o.guid)).length,r>0){console.log("[toggleRead] Undo detected, skipping refresh.");return}}if(this.filterMode==="unread"&&r<3){console.log(`[toggleRead] Deck running low (${r} unread), initiating refresh.`);const o=this.isOnline?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck",a=!!this[o];r===0&&!a&&(this.progressMessage="Generating new deck...",this.loading=!0);try{await this._loadAndManageAllData(),r===0&&this.deck.length>0&&this.selectItem(this.deck[0].guid)}catch(l){console.error("[toggleRead] Error during deck refresh:",l)}finally{this.loading=!1,this.progressMessage=""}}},undoMarkRead:async function(){if(!this.undoItemGuid)return;const e=this.undoItemGuid;this.showUndo=!1,await this.toggleRead(e),this.undoItemGuid=null,this.undoItemIndex=null},selectItem:function(e){if(this.selectedGuid===e){this.openShortcuts&&(this.openShortcuts=!1);return}this.selectedGuid=e,this.openShortcuts&&(this.openShortcuts=!1),x(()=>Promise.resolve().then(()=>Oa),void 0).then(t=>{t.scrollSelectedIntoView(e,this)})},processShuffle:async function(){await Ea(this),this.updateCounts()},loadRssFeeds:async function(){try{const e=await k("rssFeeds");this.rssFeedsInput=Qe(e.value).join(`
`)}catch(e){console.error("Error loading RSS feeds:",e)}},loadKeywordBlacklist:async function(){const{loadSimpleState:e}=await x(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>L);return{loadSimpleState:n}},void 0),{value:t}=await e("keywordBlacklist");this.keywordBlacklistInput=Array.isArray(t)?t.join(`
`):""},loadCustomCss:async function(){const{loadSimpleState:e}=await x(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>L);return{loadSimpleState:n}},void 0),{value:t}=await e("customCss");this.customCss=typeof t=="string"&&t.trim()!==""?t:this.generateCustomCssTemplate(),this.applyCustomCss()},saveRssFeeds:async function(){const e=this.rssFeedsInput.split(/\r?\n/).map(t=>t.trim());try{await G("rssFeeds",e),this.rssFeedsInput=e.join(`
`),v(this,"RSS Feeds saved!"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...";const t=await Dn(this);await this.loadFeedItemsFromDB();const n=await Xe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=n.deck,this.currentDeckGuids=n.currentDeckGuids,this.shuffledOutGuids=n.shuffledOutGuids,this.shuffleCount=n.shuffleCount,this.lastShuffleResetDate=n.lastShuffleResetDate,await this.loadAndDisplayDeck(),this.deck.length>0&&this.selectItem(this.deck[0].guid),this.progressMessage="",this.loading=!1,t||v(this,"Feeds saved, but sync finished with errors.")}catch(t){console.error("Error saving RSS feeds:",t),v(this,`Failed to save RSS feeds: ${t.message}`),this.loading=!1}},saveKeywordBlacklist:async function(){const e=this.keywordBlacklistInput.split(/\r?\n/).map(t=>t.trim()).filter(Boolean).sort();try{await G("keywordBlacklist",e),this.keywordBlacklistInput=e.join(`
`),v(this,"Keyword Blacklist saved!"),this.updateCounts()}catch(t){console.error("Error saving keyword blacklist:",t),v(this,`Failed to save keyword blacklist: ${t.message}`)}},saveCustomCss:async function(){try{await G("customCss",this.customCss),this.applyCustomCss(),v(this,"Custom CSS saved!")}catch(e){console.error("Error saving custom CSS:",e),v(this,`Failed to save custom CSS: ${e.message}`)}},resetCustomCss:async function(){confirm("Reset Custom CSS to default template? This will overwrite your current customizations.")&&(this.customCss=this.generateCustomCssTemplate(),await this.saveCustomCss(),v(this,"Custom CSS reset to template!"))},generateCustomCssTemplate:function(){const e=getComputedStyle(document.documentElement),t=["--bg","--fg","--primary","--secondary","--card-bg","--card-border","--card-shadow-color","--fg-muted","--border-radius"];let n=`/* Custom CSS Template - Current theme: ${this.theme} ${this.themeStyle} */
:root {
`;return t.forEach(s=>{const i=e.getPropertyValue(s).trim();i&&(n+=`  ${s}: ${i};
`)}),n+=`}

/* Add custom styles below */
`,n},applyCustomCss:function(){let e=document.getElementById("custom-user-css");e||(e=document.createElement("style"),e.id="custom-user-css",document.head.appendChild(e)),e.textContent=this.customCss},loadThemeStyle:async function(){const{loadSimpleState:e}=await x(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>L);return{loadSimpleState:s}},void 0),[,t,n]=await Promise.all([e("themeStyle"),e("themeStyleLight"),e("themeStyleDark")]);this.themeStyleLight=typeof t.value=="string"?t.value:"originalLight",this.themeStyleDark=typeof n.value=="string"?n.value:"originalDark",this.theme==="light"?this.themeStyle=this.themeStyleLight:this.themeStyle=this.themeStyleDark,this.applyThemeStyle()},updateThemeAndStyle:async function(e,t){console.log(`Updating theme to ${t} and style to ${e}`),this.theme=t,this.themeStyle=e;const n=document.documentElement;n.classList.remove("light","dark"),n.classList.add(t),localStorage.setItem("theme",t);const{saveSimpleState:s}=await x(async()=>{const{saveSimpleState:i}=await Promise.resolve().then(()=>L);return{saveSimpleState:i}},void 0);await s("theme",t),t==="light"?(this.themeStyleLight=e,await s("themeStyleLight",e)):(this.themeStyleDark=e,await s("themeStyleDark",e)),await s("themeStyle",e),this.applyThemeStyle(),v(this,`Theme set to ${t} (${e}).`)},saveThemeStyle:async function(){const{saveSimpleState:e}=await x(async()=>{const{saveSimpleState:t}=await Promise.resolve().then(()=>L);return{saveSimpleState:t}},void 0);this.theme==="light"?(this.themeStyleLight=this.themeStyle,await e("themeStyleLight",this.themeStyleLight)):(this.themeStyleDark=this.themeStyle,await e("themeStyleDark",this.themeStyleDark)),await e("themeStyle",this.themeStyle),this.applyThemeStyle()},applyThemeStyle:function(){const e=document.documentElement;e.classList.remove("light","dark"),e.classList.add(this.theme);const t=Array.from(e.classList).filter(n=>n.startsWith("theme-"));e.classList.remove(...t),this.themeStyle!=="originalLight"&&this.themeStyle!=="originalDark"&&e.classList.add(`theme-${this.themeStyle}`)},loadFontSize:async function(){const{loadSimpleState:e}=await x(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>L);return{loadSimpleState:n}},void 0),{value:t}=await e("fontSize");this.fontSize=typeof t=="number"?t:100,this.applyFontSize()},saveFontSize:async function(){const{saveSimpleState:e}=await x(async()=>{const{saveSimpleState:t}=await Promise.resolve().then(()=>L);return{saveSimpleState:t}},void 0);await e("fontSize",this.fontSize),this.applyFontSize()},applyFontSize:function(){document.documentElement.style.setProperty("--font-scale",(this.fontSize/100).toString())},loadFeedWidth:async function(){const{loadSimpleState:e}=await x(async()=>{const{loadSimpleState:n}=await Promise.resolve().then(()=>L);return{loadSimpleState:n}},void 0),{value:t}=await e("feedWidth");this.feedWidth=typeof t=="number"?t:50,this.applyFeedWidth()},saveFeedWidth:async function(){const{saveSimpleState:e}=await x(async()=>{const{saveSimpleState:t}=await Promise.resolve().then(()=>L);return{saveSimpleState:t}},void 0);await e("feedWidth",this.feedWidth),this.applyFeedWidth()},applyFeedWidth:function(){document.documentElement.style.setProperty("--feed-width",`${this.feedWidth}%`)},updateCounts:function(){ki(this)},scrollToTop:function(){In()},observeImage:function(e){this.imageObserver&&this.imageObserver.observe(e)},_initImageObserver:function(){this.imageObserver=new IntersectionObserver(e=>{e.forEach(t=>{if(t.isIntersecting){const n=t.target;n.dataset.src&&(n.src=n.dataset.src,this.imageObserver?.unobserve(n))}})},{root:null,rootMargin:"50% 0px",threshold:.01})},resetApplicationData:async function(){console.log("resetApplicationData called.");const e=confirm("Are you sure you want to reset the application? This will clear all local data, cache, and unregister the service worker.");if(console.log("User confirmed reset:",e),!e){console.log("Reset cancelled by user.");return}this.loading=!0,this.progressMessage="Resetting application data...";try{if(console.log("Closing database connection..."),await ci(),console.log("Unregistering service workers..."),"serviceWorker"in navigator){const n=await navigator.serviceWorker.getRegistrations();for(const s of n)await s.unregister(),console.log("Service Worker unregistered:",s.scope)}console.log("Service workers unregistered."),console.log("Clearing feed and progress IndexedDB object stores...");try{const n=await st(),s=["read","starred","currentDeckGuids","shuffledOutGuids","feedItems","pendingOperations"],i=n.transaction([...s,"userSettings"],"readwrite");await Promise.all(s.map(o=>(console.log(`Clearing object store: ${o}`),i.objectStore(o).clear()))),console.log("Clearing sync metadata from userSettings...");const r=i.objectStore("userSettings");await Promise.all([r.delete("lastFeedSync"),r.delete("lastStateSync")]),await i.done,console.log("Specific IndexedDB object stores and sync metadata cleared.")}catch(n){console.error("Error clearing IndexedDB stores:",n)}console.log("localStorage is preserved."),console.log("DEBUG: About to make fetch call to /api/admin/reset-app");const t=await fetch("/api/admin/reset-app",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const n=await t.json();throw new Error(n.message||"Failed to reset backend data.")}console.log("Backend application data reset successfully."),v(this,"Application reset complete! Reloading..."),await J(!0),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.error("Error during application reset:",t),this.errorMessage=`Failed to reset application: ${t.message}`,v(this,`Failed to reset application: ${t.message}`),this.loading=!1}},backupConfig:async function(){console.log("backupConfig called."),this.showUndo=!1;try{this.progressMessage="Fetching configuration for backup...",console.log("Fetching config for backup from:","/api/admin/config-backup");const e=await fetch("/api/admin/config-backup",{method:"GET",credentials:"include"});if(!e.ok){const r=await e.json();throw new Error(r.message||"Failed to fetch config for backup.")}const t=await e.json(),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=`not-the-news-config-backup-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),v(this,"Configuration backed up successfully!")}catch(e){console.error("Error during config backup:",e),v(this,`Failed to backup configuration: ${e.message}`)}finally{this.progressMessage=""}},restoreConfig:async function(e){if(!confirm("Are you sure you want to restore configuration? This will overwrite your current settings and reload the application."))return;const t=e.target.files?.[0];if(!t){v(this,"No file selected for restoration.");return}this.loading=!0,this.progressMessage="Restoring configuration...";try{const n=await new Promise((r,o)=>{const a=new FileReader;a.onload=l=>r(l.target?.result),a.onerror=l=>o(l),a.readAsText(t)}),s=JSON.parse(n),i=await fetch("/api/admin/config-restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include"});if(!i.ok){const r=await i.json();throw new Error(r.message||"Failed to restore backend data.")}console.log("Backend configuration restored successfully."),v(this,"Configuration restored successfully! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error during config restoration:",n),v(this,`Failed to restore configuration: ${n.message}`),this.loading=!1}finally{e.target.value=""}},_loadInitialState:async function(){try{const[e,t,n,s,i,r,o,a]=await Promise.all([k("syncEnabled"),k("imagesEnabled"),k("itemButtonMode"),k("openUrlsInNewTabEnabled"),_i(),k("theme"),k("curvesEnabled"),k("flickToSelectEnabled")]);this.syncEnabled=e.value??!0,this.imagesEnabled=t.value??!0,this.itemButtonMode=n.value??"play",this.openUrlsInNewTabEnabled=s.value??!0,this.curvesEnabled=o.value??!0,this.flickToSelectEnabled=a.value??!0,this.filterMode=i,this.theme=r.value==="light"||r.value==="dark"?r.value:"dark",localStorage.setItem("theme",this.theme),this.isOnline=B();const[l,c,u,g]=await Promise.all([k("rssFeeds"),k("keywordBlacklist"),k("themeStyleLight"),k("themeStyleDark")]);this.themeStyleLight=typeof u.value=="string"?u.value:"originalLight",this.themeStyleDark=typeof g.value=="string"?g.value:"originalDark",this.themeStyle=this.theme==="light"?this.themeStyleLight:this.themeStyleDark,this.rssFeedsInput=Qe(l.value).join(`
`),this.keywordBlacklistInput=Array.isArray(c.value)?c.value.join(`
`):"",await this.loadCustomCss(),await this.loadFontSize(),await this.loadFeedWidth(),this.applyThemeStyle();const[d,f]=await Promise.all([k("pregeneratedOnlineDeck"),k("pregeneratedOfflineDeck")]);this.pregeneratedOnlineDeck=d.value,this.pregeneratedOfflineDeck=f.value}catch(e){console.error("Error loading initial state:",e),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){console.log("_loadAndManageAllData: START"),this.progressMessage="Loading saved feed items...",await this.loadFeedItemsFromDB(),console.log(`_loadAndManageAllData: After loadFeedItemsFromDB. Entries: ${this.entries.length}`),this.progressMessage="Loading user state from storage...";const[e,t,n,s]=await Promise.all([ie("starred"),ie("shuffledOutGuids"),yi(),wi()]);console.log("_loadAndManageAllData: Loaded starred state:",e.value),this.starred=Array.isArray(e.value)?e.value:[],this.shuffledOutGuids=Array.isArray(t.value)?t.value:[],this.currentDeckGuids=Array.isArray(n)?n:[],console.log("_loadAndManageAllData: Loaded currentDeckGuids:",this.currentDeckGuids.slice(0,3),typeof this.currentDeckGuids[0]),this.shuffleCount=s.shuffleCount,this.lastShuffleResetDate=s.lastShuffleResetDate,this.progressMessage="Pruning read items...",this.read=await mi(Object.values(this.feedItems)),console.log(`_loadAndManageAllData: After loadAndPruneReadItems. Read count: ${this.read.length}`),console.log("[deckManager] Starting deck management with all data loaded."),this.progressMessage="Organizing your deck...",console.log("_loadAndManageAllData: Before manageDailyDeck",{readCount:this.read.length,currentDeckGuidsCount:this.currentDeckGuids.length,shuffleCount:this.shuffleCount});const i=this.isOnline,r=i?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck",o=this[r],a=await Xe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate,o);if(this.deck=a.deck,this.currentDeckGuids=a.currentDeckGuids,this.shuffledOutGuids=a.shuffledOutGuids,this.shuffleCount=a.shuffleCount,this.lastShuffleResetDate=a.lastShuffleResetDate,o&&o.length>0&&this.currentDeckGuids.length>0&&this.currentDeckGuids[0].guid===o[0].guid){console.log(`[deckManager] Consumed pre-generated ${i?"ONLINE":"OFFLINE"} deck in _loadAndManageAllData.`),r==="pregeneratedOnlineDeck"?this.pregeneratedOnlineDeck=null:this.pregeneratedOfflineDeck=null;const{saveSimpleState:l}=await x(async()=>{const{saveSimpleState:c}=await Promise.resolve().then(()=>L);return{saveSimpleState:c}},void 0);await l(r,null),this.pregenerateDecks()}console.log("_loadAndManageAllData: After manageDailyDeck. Deck size:",this.deck.length),this.progressMessage="Displaying your feed...",await this.loadAndDisplayDeck(),console.log("_loadAndManageAllData: After loadAndDisplayDeck. Final Deck size:",this.deck.length),this.updateAllUI(),this._initComplete&&this.deck.length>0&&!this.showUndo&&(console.log("[_loadAndManageAllData] Auto-selecting first item after refresh."),this.selectItem(this.deck[0].guid)),console.log("_loadAndManageAllData: END")},updateAllUI:function(){this.updateCounts()},_reconcileAndRefreshUI:async function(){console.log("[UI] _reconcileAndRefreshUI: Initiating UI reconciliation and refresh."),await this.loadAndDisplayDeck(),this.updateAllUI(),console.log("[UI] _reconcileAndRefreshUI: Completed UI reconciliation and refresh.")},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(e=>{e.forEach(t=>{if(!t.isIntersecting){const n=t.target.dataset.guid;console.log(`[Observer] Stale item ${n} is off-screen. Removing.`),this.deck=this.deck.filter(s=>s.guid!==n),this.staleItemObserver?.unobserve(t.target)}})},{root:null,threshold:0})},_setupWatchers:function(){this.$watch("openShortcuts",async e=>{const t=window.innerWidth<1024;e?(t||document.body.classList.add("no-scroll"),await Me()):(document.body.classList.remove("no-scroll"),document.body.style.overflow="")}),this.$watch("openSettings",async e=>{const t=window.innerWidth<1024;if(e){this.showUndo=!1,t||document.body.classList.add("no-scroll"),this.modalView="main",await Zt(this),this.$nextTick(()=>{document.querySelector(".modal-content")?.querySelector("button, select, input, textarea")?.focus()});const[n,s]=await Promise.all([k("rssFeeds"),k("keywordBlacklist")]);this.rssFeedsInput=Qe(n.value).join(`
`),Array.isArray(s.value)?this.keywordBlacklistInput=s.value.filter(Boolean).sort().join(`
`):typeof s.value=="string"?this.keywordBlacklistInput=s.value.split(/\r?\n/).filter(Boolean).sort().join(`
`):this.keywordBlacklistInput="",await Me()}else document.body.classList.remove("no-scroll"),document.body.style.overflow="",await Me()}),this.$watch("openUrlsInNewTabEnabled",()=>{document.querySelectorAll(".itemdescription").forEach(e=>this.handleEntryLinks(e))}),this.$watch("modalView",async()=>{await Zt(this),this.$nextTick(()=>{document.querySelector(".modal-content")?.querySelector('div[style*="display: block"] button, div[style*="display: block"] select, div[style*="display: block"] input, div[style*="display: block"] textarea')?.focus()})}),this.$watch("filterMode",async e=>{await Si(this,e),e==="unread"&&await Xe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate),this.scrollToTop()}),this.$watch("shadowsEnabled",e=>{document.body.classList.toggle("no-shadows",!e)}),document.body.classList.toggle("no-shadows",!this.shadowsEnabled),this.$watch("curvesEnabled",e=>{document.body.classList.toggle("no-curves",!e),e?this.undoBtnRadius=20:this.undoBtnRadius=0}),document.body.classList.toggle("no-curves",!this.curvesEnabled),this.curvesEnabled||(this.undoBtnRadius=0),this.$watch("entries",()=>this.updateCounts()),this.$watch("read",()=>this.updateCounts()),this.$watch("starred",()=>this.updateCounts()),this.$watch("currentDeckGuids",()=>this.updateCounts()),this.$watch("selectedGuid",e=>{e?(this.lastSelectedGuid=e,this.selectedTimestamp=Date.now(),this.selectedSubElement="item"):(this.selectedTimestamp=null,this.selectedSubElement="item")})},_setupEventListeners:function(){const e=async()=>{if(!this.syncEnabled||!this.isOnline)return;console.log("Performing periodic background sync..."),await ce();const n=await we(this);await J(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Background sync complete. Success: ${n}`)};window.addEventListener("online",async()=>{if(this.isOnline=!0,await this.updateSyncStatusMessage(),this.syncEnabled)try{await ce(),await e()}catch(n){console.error("Error handling online event:",n)}}),window.addEventListener("offline",async()=>{this.isOnline=!1,await this.updateSyncStatusMessage()});let t;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>{Me()},1e3)},{passive:!0}),window.addEventListener("keydown",n=>{Ai(n,this)}),window.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"&&this.selectedGuid){console.log("[Visibility] App returned to foreground. Redrawing selection animation.");const n=this.selectedGuid;this.selectedGuid=null,this.$nextTick(()=>{this.selectedGuid=n})}})},_setupFlickToSelectListeners:function(){let e=0;const t=800,n=.5,s=50,i=100,r=u=>{const g=this.filteredEntries;if(g.length===0)return null;let f=(this.selectedGuid?g.findIndex(w=>w.guid===this.selectedGuid):-1)+u;return f<0&&(f=0),f>=g.length&&(f=g.length-1),g[f].guid},o=()=>{if(!this.selectedGuid)return!1;const u=document.querySelector(`.entry[data-guid="${this.selectedGuid}"]`);return u?u.offsetHeight>window.innerHeight*.8:!1},a=u=>{const g=Date.now();if(g-e<t)return;const d=r(u);!d||d===this.selectedGuid||(console.log(`[Flick] Triggering selection move: direction=${u}`),e=g,window.scrollTo(window.scrollX,window.scrollY),this.selectItem(d))};window.addEventListener("wheel",u=>{!this.flickToSelectEnabled||this.openSettings||this.showSearchBar||!o()||Math.abs(u.deltaY)>i&&a(u.deltaY>0?1:-1)},{passive:!0});let l=0,c=0;window.addEventListener("touchstart",u=>{!this.flickToSelectEnabled||this.openSettings||this.showSearchBar||!o()||(l=u.touches[0].clientY,c=Date.now())},{passive:!0}),window.addEventListener("touchend",u=>{if(!this.flickToSelectEnabled||this.openSettings||this.showSearchBar||!o())return;const g=u.changedTouches[0].clientY,d=Date.now(),f=g-l,w=d-c;w>0&&Math.abs(f)/w>n&&Math.abs(f)>s&&a(f<0?1:-1)},{passive:!0})},_startPeriodicSync:function(){let e=Date.now();const t=()=>e=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(i=>{document.addEventListener(i,t,!0),i==="focus"&&window.addEventListener(i,t,!0),i==="visibilitychange"&&document.addEventListener(i,t,!0)});const n=300*1e3,s=60*1e3;setInterval(async()=>{const i=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||i-e>s)){console.log("Starting scheduled background sync...");try{await ce();const r=await we(this);await J(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Scheduled sync complete. Success: ${r}`),await this.pregenerateDecks()}catch(r){console.error("Periodic sync failed:",r)}}},n)},_initScrollObserver:function(){const e=new IntersectionObserver(async()=>{},{root:document.querySelector("#feed-container"),rootMargin:"0px",threshold:.1}),t=document.querySelector("#feed-container");if(!t)return;const n=()=>{t.querySelectorAll("[data-guid]").forEach(i=>{e.observe(i)})};n(),new MutationObserver(()=>{e.disconnect(),n()}).observe(t,{childList:!0,subtree:!0}),this.scrollObserver=e},handleEntryLinks:function(e){e&&e.querySelectorAll("a").forEach(t=>{t.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")):t.removeAttribute("target"))})},toggleSearch:function(){Ta(this)},discoverFeed:async function(){await Ma(this)},pregenerateDecks:async function(){if(!this._isPregenerating){this._isPregenerating=!0,console.log("[Background] Starting pre-generation of decks...");try{await this._generateAndSavePregeneratedDeck(!0),await this._generateAndSavePregeneratedDeck(!1),console.log("[Background] Deck pre-generation completed.")}catch(e){console.error("[Background] Deck pre-generation failed:",e)}finally{this._isPregenerating=!1}}},_generateAndSavePregeneratedDeck:async function(e){const{generateNewDeck:t}=await x(async()=>{const{generateNewDeck:a}=await Promise.resolve().then(()=>ia);return{generateNewDeck:a}},void 0),{saveSimpleState:n}=await x(async()=>{const{saveSimpleState:a}=await Promise.resolve().then(()=>L);return{saveSimpleState:a}},void 0),s=await t(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,"unread",e),i=new Date().toISOString(),r=(s||[]).map(a=>({guid:a.guid,addedAt:i})),o=e?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck";this[o]=r,await n(o,r),console.log(`[Background] Pregenerated ${e?"ONLINE":"OFFLINE"} deck saved. Size: ${r.length}`)},$nextTick:function(e){return Be.nextTick(e)},$watch:function(e,t){return Be.watch(this,e,t)}}}Be.data("rssApp",$a);window.Alpine=Be;Be.start();
