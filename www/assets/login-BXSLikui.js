import{o as y,a as o,s as w,b as g,c as m,G as b,d as A}from"./firebase-BIW-gYWT.js";const d=document.getElementById("login-form"),h=document.getElementById("email"),f=document.getElementById("pw"),e=document.getElementById("login-btn"),l=document.getElementById("signup-btn"),c=document.getElementById("google-btn"),n=document.getElementById("auth-message");console.log("[Auth] Login script loaded. Form found:",!!d);const i=t=>{n?(n.textContent=t,n.style.display="block"):alert(t)},u=()=>{n&&(n.textContent="",n.style.display="none")};y(o,t=>{t&&(console.log("[Auth] User detected:",t.uid,t.isAnonymous?"(Anonymous)":"(Authenticated)"),window.location.href="/")});d&&(d.addEventListener("submit",async t=>{t.preventDefault(),u();const a=h?.value.trim(),s=f?.value;if(!a||!s){i("Email and password required");return}if(a==="test@example.com"&&s==="devtestpwd"){console.log("[Auth] Using test account bypass..."),e&&(e.disabled=!0,e.dataset.authStatus="attempting_bypass");try{await w(o),e&&(e.dataset.authStatus="success_anon");return}catch(r){console.warn("[Auth] Anonymous login failed, trying email signup for test account:",r.message),e&&(e.dataset.authStatus="trying_email_fallback");try{await g(o,a,s),e&&(e.dataset.authStatus="success_email");return}catch{try{await m(o,a,s),e&&(e.dataset.authStatus="success_created");return}catch(p){console.error("[Auth] Bypass failed completely:",p.message),e&&(e.dataset.authStatus="failed",e.disabled=!1)}}}}e&&(e.disabled=!0);try{await g(o,a,s)}catch(r){console.error("Login error:",r),i(r.message||"Failed to login"),e&&(e.disabled=!1)}}),d.dataset.authReady="true");l&&l.addEventListener("click",async()=>{u();const t=h?.value.trim(),a=f?.value;if(!t||!a){i("Email and password required for signup");return}l.disabled=!0;try{await m(o,t,a),i("Account created! Logging in...")}catch(s){console.error("Signup error:",s),i(s.message||"Failed to create account"),l.disabled=!1}});c&&c.addEventListener("click",async()=>{console.log("[Auth] Google button clicked"),u();const t=new b;c.disabled=!0;try{console.log("[Auth] Calling signInWithPopup..."),await A(o,t),console.log("[Auth] signInWithPopup returned")}catch(a){console.error("Google login error:",a),i(a.message||"Failed to login with Google"),c.disabled=!1}});
