/* empty css              */(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const vr="modulepreload",Dr=function(t){return"/"+t},Dn={},P=function(n,s,r){let i=Promise.resolve();if(s&&s.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=c(s.map(u=>{if(u=Dr(u),u in Dn)return;Dn[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":vr,d||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),d)return new Promise((w,b)=>{g.addEventListener("load",w),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return n().catch(o)})};var xt=!1,Ot=!1,ue=[],Ct=-1;function kr(t){Er(t)}function Er(t){ue.includes(t)||ue.push(t),Ir()}function Ar(t){let n=ue.indexOf(t);n!==-1&&n>Ct&&ue.splice(n,1)}function Ir(){!Ot&&!xt&&(xt=!0,queueMicrotask(xr))}function xr(){xt=!1,Ot=!0;for(let t=0;t<ue.length;t++)ue[t](),Ct=t;ue.length=0,Ct=-1,Ot=!1}var ve,pe,De,Hn,Tt=!0;function Or(t){Tt=!1,t(),Tt=!0}function Cr(t){ve=t.reactive,De=t.release,pe=n=>t.effect(n,{scheduler:s=>{Tt?kr(s):s()}}),Hn=t.raw}function kn(t){pe=t}function Tr(t){let n=()=>{};return[r=>{let i=pe(r);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach(o=>o())}),t._x_effects.add(i),n=()=>{i!==void 0&&(t._x_effects.delete(i),De(i))},i},()=>{n()}]}function Wn(t,n){let s=!0,r,i=pe(()=>{let o=t();JSON.stringify(o),s?r=o:queueMicrotask(()=>{n(o,r),r=o}),s=!1});return()=>De(i)}var qn=[],Jn=[],Yn=[];function Mr(t){Yn.push(t)}function Yt(t,n){typeof n=="function"?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(n)):(n=t,Jn.push(n))}function Qn(t){qn.push(t)}function Xn(t,n,s){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[n]||(t._x_attributeCleanups[n]=[]),t._x_attributeCleanups[n].push(s)}function Zn(t,n){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach(([s,r])=>{(n===void 0||n.includes(s))&&(r.forEach(i=>i()),delete t._x_attributeCleanups[s])})}function $r(t){for(t._x_effects?.forEach(Ar);t._x_cleanups?.length;)t._x_cleanups.pop()()}var Qt=new MutationObserver(tn),Xt=!1;function Zt(){Qt.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),Xt=!0}function es(){Rr(),Qt.disconnect(),Xt=!1}var Ie=[];function Rr(){let t=Qt.takeRecords();Ie.push(()=>t.length>0&&tn(t));let n=Ie.length;queueMicrotask(()=>{if(Ie.length===n)for(;Ie.length>0;)Ie.shift()()})}function x(t){if(!Xt)return t();es();let n=t();return Zt(),n}var en=!1,Je=[];function Pr(){en=!0}function Br(){en=!1,tn(Je),Je=[]}function tn(t){if(en){Je=Je.concat(t);return}let n=[],s=new Set,r=new Map,i=new Map;for(let o=0;o<t.length;o++)if(!t[o].target._x_ignoreMutationObserver&&(t[o].type==="childList"&&(t[o].removedNodes.forEach(a=>{a.nodeType===1&&a._x_marker&&s.add(a)}),t[o].addedNodes.forEach(a=>{if(a.nodeType===1){if(s.has(a)){s.delete(a);return}a._x_marker||n.push(a)}})),t[o].type==="attributes")){let a=t[o].target,l=t[o].attributeName,c=t[o].oldValue,u=()=>{r.has(a)||r.set(a,[]),r.get(a).push({name:l,value:a.getAttribute(l)})},d=()=>{i.has(a)||i.set(a,[]),i.get(a).push(l)};a.hasAttribute(l)&&c===null?u():a.hasAttribute(l)?(d(),u()):d()}i.forEach((o,a)=>{Zn(a,o)}),r.forEach((o,a)=>{qn.forEach(l=>l(a,o))});for(let o of s)n.some(a=>a.contains(o))||Jn.forEach(a=>a(o));for(let o of n)o.isConnected&&Yn.forEach(a=>a(o));n=null,s=null,r=null,i=null}function ts(t){return Be(_e(t))}function Pe(t,n,s){return t._x_dataStack=[n,..._e(s||t)],()=>{t._x_dataStack=t._x_dataStack.filter(r=>r!==n)}}function _e(t){return t._x_dataStack?t._x_dataStack:typeof ShadowRoot=="function"&&t instanceof ShadowRoot?_e(t.host):t.parentNode?_e(t.parentNode):[]}function Be(t){return new Proxy({objects:t},Lr)}var Lr={ownKeys({objects:t}){return Array.from(new Set(t.flatMap(n=>Object.keys(n))))},has({objects:t},n){return n==Symbol.unscopables?!1:t.some(s=>Object.prototype.hasOwnProperty.call(s,n)||Reflect.has(s,n))},get({objects:t},n,s){return n=="toJSON"?Gr:Reflect.get(t.find(r=>Reflect.has(r,n))||{},n,s)},set({objects:t},n,s,r){const i=t.find(a=>Object.prototype.hasOwnProperty.call(a,n))||t[t.length-1],o=Object.getOwnPropertyDescriptor(i,n);return o?.set&&o?.get?o.set.call(r,s)||!0:Reflect.set(i,n,s)}};function Gr(){return Reflect.ownKeys(this).reduce((n,s)=>(n[s]=Reflect.get(this,s),n),{})}function ns(t){let n=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,s=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([o,{value:a,enumerable:l}])=>{if(l===!1||a===void 0||typeof a=="object"&&a!==null&&a.__v_skip)return;let c=i===""?o:`${i}.${o}`;typeof a=="object"&&a!==null&&a._x_interceptor?r[o]=a.initialize(t,c,o):n(a)&&a!==r&&!(a instanceof Element)&&s(a,c)})};return s(t)}function ss(t,n=()=>{}){let s={initialValue:void 0,_x_interceptor:!0,initialize(r,i,o){return t(this.initialValue,()=>Fr(r,i),a=>Mt(r,i,a),i,o)}};return n(s),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=s.initialize.bind(s);s.initialize=(o,a,l)=>{let c=r.initialize(o,a,l);return s.initialValue=c,i(o,a,l)}}else s.initialValue=r;return s}}function Fr(t,n){return n.split(".").reduce((s,r)=>s[r],t)}function Mt(t,n,s){if(typeof n=="string"&&(n=n.split(".")),n.length===1)t[n[0]]=s;else{if(n.length===0)throw error;return t[n[0]]||(t[n[0]]={}),Mt(t[n[0]],n.slice(1),s)}}var rs={};function z(t,n){rs[t]=n}function $t(t,n){let s=jr(n);return Object.entries(rs).forEach(([r,i])=>{Object.defineProperty(t,`$${r}`,{get(){return i(n,s)},enumerable:!1})}),t}function jr(t){let[n,s]=us(t),r={interceptor:ss,...n};return Yt(t,s),r}function Nr(t,n,s,...r){try{return s(...r)}catch(i){$e(i,t,n)}}function $e(t,n,s=void 0){t=Object.assign(t??{message:"No error message given."},{el:n,expression:s}),console.warn(`Alpine Expression Error: ${t.message}

${s?'Expression: "'+s+`"

`:""}`,n),setTimeout(()=>{throw t},0)}var He=!0;function is(t){let n=He;He=!1;let s=t();return He=n,s}function de(t,n,s={}){let r;return $(t,n)(i=>r=i,s),r}function $(...t){return os(...t)}var os=as;function Ur(t){os=t}function as(t,n){let s={};$t(s,t);let r=[s,..._e(t)],i=typeof n=="function"?zr(r,n):Kr(r,n,t);return Nr.bind(null,t,n,i)}function zr(t,n){return(s=()=>{},{scope:r={},params:i=[]}={})=>{let o=n.apply(Be([r,...t]),i);Ye(s,o)}}var ft={};function Vr(t,n){if(ft[t])return ft[t];let s=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t,o=(()=>{try{let a=new s(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(a,"name",{value:`[Alpine] ${t}`}),a}catch(a){return $e(a,n,t),Promise.resolve()}})();return ft[t]=o,o}function Kr(t,n,s){let r=Vr(n,s);return(i=()=>{},{scope:o={},params:a=[]}={})=>{r.result=void 0,r.finished=!1;let l=Be([o,...t]);if(typeof r=="function"){let c=r(r,l).catch(u=>$e(u,s,n));r.finished?(Ye(i,r.result,l,a,s),r.result=void 0):c.then(u=>{Ye(i,u,l,a,s)}).catch(u=>$e(u,s,n)).finally(()=>r.result=void 0)}}}function Ye(t,n,s,r,i){if(He&&typeof n=="function"){let o=n.apply(s,r);o instanceof Promise?o.then(a=>Ye(t,a,s,r)).catch(a=>$e(a,i,n)):t(o)}else typeof n=="object"&&n instanceof Promise?n.then(o=>t(o)):t(n)}var nn="x-";function ke(t=""){return nn+t}function Hr(t){nn=t}var Qe={};function C(t,n){return Qe[t]=n,{before(s){if(!Qe[s]){console.warn(String.raw`Cannot find directive \`${s}\`. \`${t}\` will use the default order of execution`);return}const r=ce.indexOf(s);ce.splice(r>=0?r:ce.indexOf("DEFAULT"),0,t)}}}function Wr(t){return Object.keys(Qe).includes(t)}function sn(t,n,s){if(n=Array.from(n),t._x_virtualDirectives){let o=Object.entries(t._x_virtualDirectives).map(([l,c])=>({name:l,value:c})),a=ls(o);o=o.map(l=>a.find(c=>c.name===l.name)?{name:`x-bind:${l.name}`,value:`"${l.value}"`}:l),n=n.concat(o)}let r={};return n.map(hs((o,a)=>r[o]=a)).filter(ps).map(Yr(r,s)).sort(Qr).map(o=>Jr(t,o))}function ls(t){return Array.from(t).map(hs()).filter(n=>!ps(n))}var Rt=!1,Ce=new Map,cs=Symbol();function qr(t){Rt=!0;let n=Symbol();cs=n,Ce.set(n,[]);let s=()=>{for(;Ce.get(n).length;)Ce.get(n).shift()();Ce.delete(n)},r=()=>{Rt=!1,s()};t(s),r()}function us(t){let n=[],s=l=>n.push(l),[r,i]=Tr(t);return n.push(i),[{Alpine:Le,effect:r,cleanup:s,evaluateLater:$.bind($,t),evaluate:de.bind(de,t)},()=>n.forEach(l=>l())]}function Jr(t,n){let s=()=>{},r=Qe[n.type]||s,[i,o]=us(t);Xn(t,n.original,o);let a=()=>{t._x_ignore||t._x_ignoreSelf||(r.inline&&r.inline(t,n,i),r=r.bind(r,t,n,i),Rt?Ce.get(cs).push(r):r())};return a.runCleanups=o,a}var ds=(t,n)=>({name:s,value:r})=>(s.startsWith(t)&&(s=s.replace(t,n)),{name:s,value:r}),fs=t=>t;function hs(t=()=>{}){return({name:n,value:s})=>{let{name:r,value:i}=gs.reduce((o,a)=>a(o),{name:n,value:s});return r!==n&&t(r,n),{name:r,value:i}}}var gs=[];function rn(t){gs.push(t)}function ps({name:t}){return ys().test(t)}var ys=()=>new RegExp(`^${nn}([^:^.]+)\\b`);function Yr(t,n){return({name:s,value:r})=>{let i=s.match(ys()),o=s.match(/:([a-zA-Z0-9\-_:]+)/),a=s.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],l=n||t[s]||s;return{type:i?i[1]:null,value:o?o[1]:null,modifiers:a.map(c=>c.replace(".","")),expression:r,original:l}}}var Pt="DEFAULT",ce=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Pt,"teleport"];function Qr(t,n){let s=ce.indexOf(t.type)===-1?Pt:t.type,r=ce.indexOf(n.type)===-1?Pt:n.type;return ce.indexOf(s)-ce.indexOf(r)}function Te(t,n,s={}){t.dispatchEvent(new CustomEvent(n,{detail:s,bubbles:!0,composed:!0,cancelable:!0}))}function ge(t,n){if(typeof ShadowRoot=="function"&&t instanceof ShadowRoot){Array.from(t.children).forEach(i=>ge(i,n));return}let s=!1;if(n(t,()=>s=!0),s)return;let r=t.firstElementChild;for(;r;)ge(r,n),r=r.nextElementSibling}function L(t,...n){console.warn(`Alpine Warning: ${t}`,...n)}var En=!1;function Xr(){En&&L("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),En=!0,document.body||L("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Te(document,"alpine:init"),Te(document,"alpine:initializing"),Zt(),Mr(n=>J(n,ge)),Yt(n=>Ae(n)),Qn((n,s)=>{sn(n,s).forEach(r=>r())});let t=n=>!nt(n.parentElement,!0);Array.from(document.querySelectorAll(Ss().join(","))).filter(t).forEach(n=>{J(n)}),Te(document,"alpine:initialized"),setTimeout(()=>{ni()})}var on=[],ms=[];function ws(){return on.map(t=>t())}function Ss(){return on.concat(ms).map(t=>t())}function _s(t){on.push(t)}function bs(t){ms.push(t)}function nt(t,n=!1){return Ee(t,s=>{if((n?Ss():ws()).some(i=>s.matches(i)))return!0})}function Ee(t,n){if(t){if(n(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),!!t.parentElement)return Ee(t.parentElement,n)}}function Zr(t){return ws().some(n=>t.matches(n))}var vs=[];function ei(t){vs.push(t)}var ti=1;function J(t,n=ge,s=()=>{}){Ee(t,r=>r._x_ignore)||qr(()=>{n(t,(r,i)=>{r._x_marker||(s(r,i),vs.forEach(o=>o(r,i)),sn(r,r.attributes).forEach(o=>o()),r._x_ignore||(r._x_marker=ti++),r._x_ignore&&i())})})}function Ae(t,n=ge){n(t,s=>{$r(s),Zn(s),delete s._x_marker})}function ni(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([n,s,r])=>{Wr(s)||r.some(i=>{if(document.querySelector(i))return L(`found "${i}", but missing ${n} plugin`),!0})})}var Bt=[],an=!1;function ln(t=()=>{}){return queueMicrotask(()=>{an||setTimeout(()=>{Lt()})}),new Promise(n=>{Bt.push(()=>{t(),n()})})}function Lt(){for(an=!1;Bt.length;)Bt.shift()()}function si(){an=!0}function cn(t,n){return Array.isArray(n)?An(t,n.join(" ")):typeof n=="object"&&n!==null?ri(t,n):typeof n=="function"?cn(t,n()):An(t,n)}function An(t,n){let s=i=>i.split(" ").filter(o=>!t.classList.contains(o)).filter(Boolean),r=i=>(t.classList.add(...i),()=>{t.classList.remove(...i)});return n=n===!0?n="":n||"",r(s(n))}function ri(t,n){let s=l=>l.split(" ").filter(Boolean),r=Object.entries(n).flatMap(([l,c])=>c?s(l):!1).filter(Boolean),i=Object.entries(n).flatMap(([l,c])=>c?!1:s(l)).filter(Boolean),o=[],a=[];return i.forEach(l=>{t.classList.contains(l)&&(t.classList.remove(l),a.push(l))}),r.forEach(l=>{t.classList.contains(l)||(t.classList.add(l),o.push(l))}),()=>{a.forEach(l=>t.classList.add(l)),o.forEach(l=>t.classList.remove(l))}}function st(t,n){return typeof n=="object"&&n!==null?ii(t,n):oi(t,n)}function ii(t,n){let s={};return Object.entries(n).forEach(([r,i])=>{s[r]=t.style[r],r.startsWith("--")||(r=ai(r)),t.style.setProperty(r,i)}),setTimeout(()=>{t.style.length===0&&t.removeAttribute("style")}),()=>{st(t,s)}}function oi(t,n){let s=t.getAttribute("style",n);return t.setAttribute("style",n),()=>{t.setAttribute("style",s||"")}}function ai(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Gt(t,n=()=>{}){let s=!1;return function(){s?n.apply(this,arguments):(s=!0,t.apply(this,arguments))}}C("transition",(t,{value:n,modifiers:s,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?ci(t,s,n):li(t,r,n))});function li(t,n,s){Ds(t,cn,""),{enter:i=>{t._x_transition.enter.during=i},"enter-start":i=>{t._x_transition.enter.start=i},"enter-end":i=>{t._x_transition.enter.end=i},leave:i=>{t._x_transition.leave.during=i},"leave-start":i=>{t._x_transition.leave.start=i},"leave-end":i=>{t._x_transition.leave.end=i}}[s](n)}function ci(t,n,s){Ds(t,st);let r=!n.includes("in")&&!n.includes("out")&&!s,i=r||n.includes("in")||["enter"].includes(s),o=r||n.includes("out")||["leave"].includes(s);n.includes("in")&&!r&&(n=n.filter((p,y)=>y<n.indexOf("out"))),n.includes("out")&&!r&&(n=n.filter((p,y)=>y>n.indexOf("out")));let a=!n.includes("opacity")&&!n.includes("scale"),l=a||n.includes("opacity"),c=a||n.includes("scale"),u=l?0:1,d=c?xe(n,"scale",95)/100:1,h=xe(n,"delay",0)/1e3,g=xe(n,"origin","center"),w="opacity, transform",b=xe(n,"duration",150)/1e3,S=xe(n,"duration",75)/1e3,f="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(t._x_transition.enter.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:w,transitionDuration:`${b}s`,transitionTimingFunction:f},t._x_transition.enter.start={opacity:u,transform:`scale(${d})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"}),o&&(t._x_transition.leave.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:w,transitionDuration:`${S}s`,transitionTimingFunction:f},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:u,transform:`scale(${d})`})}function Ds(t,n,s={}){t._x_transition||(t._x_transition={enter:{during:s,start:s,end:s},leave:{during:s,start:s,end:s},in(r=()=>{},i=()=>{}){Ft(t,n,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){Ft(t,n,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,n,s,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let o=()=>i(s);if(n){t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(s):o():t._x_transition?t._x_transition.in(s):o();return}t._x_hidePromise=t._x_transition?new Promise((a,l)=>{t._x_transition.out(()=>{},()=>a(r)),t._x_transitioning&&t._x_transitioning.beforeCancel(()=>l({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let a=ks(t);a?(a._x_hideChildren||(a._x_hideChildren=[]),a._x_hideChildren.push(t)):i(()=>{let l=c=>{let u=Promise.all([c._x_hidePromise,...(c._x_hideChildren||[]).map(l)]).then(([d])=>d?.());return delete c._x_hidePromise,delete c._x_hideChildren,u};l(t).catch(c=>{if(!c.isFromCancelledTransition)throw c})})})};function ks(t){let n=t.parentNode;if(n)return n._x_hidePromise?n:ks(n)}function Ft(t,n,{during:s,start:r,end:i}={},o=()=>{},a=()=>{}){if(t._x_transitioning&&t._x_transitioning.cancel(),Object.keys(s).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){o(),a();return}let l,c,u;ui(t,{start(){l=n(t,r)},during(){c=n(t,s)},before:o,end(){l(),u=n(t,i)},after:a,cleanup(){c(),u()}})}function ui(t,n){let s,r,i,o=Gt(()=>{x(()=>{s=!0,r||n.before(),i||(n.end(),Lt()),n.after(),t.isConnected&&n.cleanup(),delete t._x_transitioning})});t._x_transitioning={beforeCancels:[],beforeCancel(a){this.beforeCancels.push(a)},cancel:Gt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()}),finish:o},x(()=>{n.start(),n.during()}),si(),requestAnimationFrame(()=>{if(s)return;let a=Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,l=Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;a===0&&(a=Number(getComputedStyle(t).animationDuration.replace("s",""))*1e3),x(()=>{n.before()}),r=!0,requestAnimationFrame(()=>{s||(x(()=>{n.end()}),Lt(),setTimeout(t._x_transitioning.finish,a+l),i=!0)})})}function xe(t,n,s){if(t.indexOf(n)===-1)return s;const r=t[t.indexOf(n)+1];if(!r||n==="scale"&&isNaN(r))return s;if(n==="duration"||n==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return n==="origin"&&["top","right","left","center","bottom"].includes(t[t.indexOf(n)+2])?[r,t[t.indexOf(n)+2]].join(" "):r}var ne=!1;function ie(t,n=()=>{}){return(...s)=>ne?n(...s):t(...s)}function di(t){return(...n)=>ne&&t(...n)}var Es=[];function rt(t){Es.push(t)}function fi(t,n){Es.forEach(s=>s(t,n)),ne=!0,As(()=>{J(n,(s,r)=>{r(s,()=>{})})}),ne=!1}var jt=!1;function hi(t,n){n._x_dataStack||(n._x_dataStack=t._x_dataStack),ne=!0,jt=!0,As(()=>{gi(n)}),ne=!1,jt=!1}function gi(t){let n=!1;J(t,(r,i)=>{ge(r,(o,a)=>{if(n&&Zr(o))return a();n=!0,i(o,a)})})}function As(t){let n=pe;kn((s,r)=>{let i=n(s);return De(i),()=>{}}),t(),kn(n)}function Is(t,n,s,r=[]){switch(t._x_bindings||(t._x_bindings=ve({})),t._x_bindings[n]=s,n=r.includes("camel")?vi(n):n,n){case"value":pi(t,s);break;case"style":mi(t,s);break;case"class":yi(t,s);break;case"selected":case"checked":wi(t,n,s);break;default:xs(t,n,s);break}}function pi(t,n){if(Ts(t))t.attributes.value===void 0&&(t.value=n),window.fromModel&&(typeof n=="boolean"?t.checked=We(t.value)===n:t.checked=In(t.value,n));else if(un(t))Number.isInteger(n)?t.value=n:!Array.isArray(n)&&typeof n!="boolean"&&![null,void 0].includes(n)?t.value=String(n):Array.isArray(n)?t.checked=n.some(s=>In(s,t.value)):t.checked=!!n;else if(t.tagName==="SELECT")bi(t,n);else{if(t.value===n)return;t.value=n===void 0?"":n}}function yi(t,n){t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedClasses=cn(t,n)}function mi(t,n){t._x_undoAddedStyles&&t._x_undoAddedStyles(),t._x_undoAddedStyles=st(t,n)}function wi(t,n,s){xs(t,n,s),_i(t,n,s)}function xs(t,n,s){[null,void 0,!1].includes(s)&&ki(n)?t.removeAttribute(n):(Os(n)&&(s=n),Si(t,n,s))}function Si(t,n,s){t.getAttribute(n)!=s&&t.setAttribute(n,s)}function _i(t,n,s){t[n]!==s&&(t[n]=s)}function bi(t,n){const s=[].concat(n).map(r=>r+"");Array.from(t.options).forEach(r=>{r.selected=s.includes(r.value)})}function vi(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function In(t,n){return t==n}function We(t){return[1,"1","true","on","yes",!0].includes(t)?!0:[0,"0","false","off","no",!1].includes(t)?!1:t?!!t:null}var Di=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Os(t){return Di.has(t)}function ki(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}function Ei(t,n,s){return t._x_bindings&&t._x_bindings[n]!==void 0?t._x_bindings[n]:Cs(t,n,s)}function Ai(t,n,s,r=!0){if(t._x_bindings&&t._x_bindings[n]!==void 0)return t._x_bindings[n];if(t._x_inlineBindings&&t._x_inlineBindings[n]!==void 0){let i=t._x_inlineBindings[n];return i.extract=r,is(()=>de(t,i.expression))}return Cs(t,n,s)}function Cs(t,n,s){let r=t.getAttribute(n);return r===null?typeof s=="function"?s():s:r===""?!0:Os(n)?!![n,"true"].includes(r):r}function un(t){return t.type==="checkbox"||t.localName==="ui-checkbox"||t.localName==="ui-switch"}function Ts(t){return t.type==="radio"||t.localName==="ui-radio"}function Ms(t,n){var s;return function(){var r=this,i=arguments,o=function(){s=null,t.apply(r,i)};clearTimeout(s),s=setTimeout(o,n)}}function $s(t,n){let s;return function(){let r=this,i=arguments;s||(t.apply(r,i),s=!0,setTimeout(()=>s=!1,n))}}function Rs({get:t,set:n},{get:s,set:r}){let i=!0,o,a=pe(()=>{let l=t(),c=s();if(i)r(ht(l)),i=!1;else{let u=JSON.stringify(l),d=JSON.stringify(c);u!==o?r(ht(l)):u!==d&&n(ht(c))}o=JSON.stringify(t()),JSON.stringify(s())});return()=>{De(a)}}function ht(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t}function Ii(t){(Array.isArray(t)?t:[t]).forEach(s=>s(Le))}var ae={},xn=!1;function xi(t,n){if(xn||(ae=ve(ae),xn=!0),n===void 0)return ae[t];ae[t]=n,ns(ae[t]),typeof n=="object"&&n!==null&&n.hasOwnProperty("init")&&typeof n.init=="function"&&ae[t].init()}function Oi(){return ae}var Ps={};function Ci(t,n){let s=typeof n!="function"?()=>n:n;return t instanceof Element?Bs(t,s()):(Ps[t]=s,()=>{})}function Ti(t){return Object.entries(Ps).forEach(([n,s])=>{Object.defineProperty(t,n,{get(){return(...r)=>s(...r)}})}),t}function Bs(t,n,s){let r=[];for(;r.length;)r.pop()();let i=Object.entries(n).map(([a,l])=>({name:a,value:l})),o=ls(i);return i=i.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),sn(t,i,s).map(a=>{r.push(a.runCleanups),a()}),()=>{for(;r.length;)r.pop()()}}var Ls={};function Mi(t,n){Ls[t]=n}function $i(t,n){return Object.entries(Ls).forEach(([s,r])=>{Object.defineProperty(t,s,{get(){return(...i)=>r.bind(n)(...i)},enumerable:!1})}),t}var Ri={get reactive(){return ve},get release(){return De},get effect(){return pe},get raw(){return Hn},version:"3.14.9",flushAndStopDeferringMutations:Br,dontAutoEvaluateFunctions:is,disableEffectScheduling:Or,startObservingMutations:Zt,stopObservingMutations:es,setReactivityEngine:Cr,onAttributeRemoved:Xn,onAttributesAdded:Qn,closestDataStack:_e,skipDuringClone:ie,onlyDuringClone:di,addRootSelector:_s,addInitSelector:bs,interceptClone:rt,addScopeToNode:Pe,deferMutations:Pr,mapAttributes:rn,evaluateLater:$,interceptInit:ei,setEvaluator:Ur,mergeProxies:Be,extractProp:Ai,findClosest:Ee,onElRemoved:Yt,closestRoot:nt,destroyTree:Ae,interceptor:ss,transition:Ft,setStyles:st,mutateDom:x,directive:C,entangle:Rs,throttle:$s,debounce:Ms,evaluate:de,initTree:J,nextTick:ln,prefixed:ke,prefix:Hr,plugin:Ii,magic:z,store:xi,start:Xr,clone:hi,cloneNode:fi,bound:Ei,$data:ts,watch:Wn,walk:ge,data:Mi,bind:Ci},Le=Ri;function Pi(t,n){const s=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)s[r[i]]=!0;return i=>!!s[i]}var Bi=Object.freeze({}),Li=Object.prototype.hasOwnProperty,it=(t,n)=>Li.call(t,n),fe=Array.isArray,Me=t=>Gs(t)==="[object Map]",Gi=t=>typeof t=="string",dn=t=>typeof t=="symbol",ot=t=>t!==null&&typeof t=="object",Fi=Object.prototype.toString,Gs=t=>Fi.call(t),Fs=t=>Gs(t).slice(8,-1),fn=t=>Gi(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,ji=t=>{const n=Object.create(null);return s=>n[s]||(n[s]=t(s))},Ni=ji(t=>t.charAt(0).toUpperCase()+t.slice(1)),js=(t,n)=>t!==n&&(t===t||n===n),Nt=new WeakMap,Oe=[],H,he=Symbol("iterate"),Ut=Symbol("Map key iterate");function Ui(t){return t&&t._isEffect===!0}function zi(t,n=Bi){Ui(t)&&(t=t.raw);const s=Hi(t,n);return n.lazy||s(),s}function Vi(t){t.active&&(Ns(t),t.options.onStop&&t.options.onStop(),t.active=!1)}var Ki=0;function Hi(t,n){const s=function(){if(!s.active)return t();if(!Oe.includes(s)){Ns(s);try{return qi(),Oe.push(s),H=s,t()}finally{Oe.pop(),Us(),H=Oe[Oe.length-1]}}};return s.id=Ki++,s.allowRecurse=!!n.allowRecurse,s._isEffect=!0,s.active=!0,s.raw=t,s.deps=[],s.options=n,s}function Ns(t){const{deps:n}=t;if(n.length){for(let s=0;s<n.length;s++)n[s].delete(t);n.length=0}}var be=!0,hn=[];function Wi(){hn.push(be),be=!1}function qi(){hn.push(be),be=!0}function Us(){const t=hn.pop();be=t===void 0?!0:t}function N(t,n,s){if(!be||H===void 0)return;let r=Nt.get(t);r||Nt.set(t,r=new Map);let i=r.get(s);i||r.set(s,i=new Set),i.has(H)||(i.add(H),H.deps.push(i),H.options.onTrack&&H.options.onTrack({effect:H,target:t,type:n,key:s}))}function se(t,n,s,r,i,o){const a=Nt.get(t);if(!a)return;const l=new Set,c=d=>{d&&d.forEach(h=>{(h!==H||h.allowRecurse)&&l.add(h)})};if(n==="clear")a.forEach(c);else if(s==="length"&&fe(t))a.forEach((d,h)=>{(h==="length"||h>=r)&&c(d)});else switch(s!==void 0&&c(a.get(s)),n){case"add":fe(t)?fn(s)&&c(a.get("length")):(c(a.get(he)),Me(t)&&c(a.get(Ut)));break;case"delete":fe(t)||(c(a.get(he)),Me(t)&&c(a.get(Ut)));break;case"set":Me(t)&&c(a.get(he));break}const u=d=>{d.options.onTrigger&&d.options.onTrigger({effect:d,target:t,key:s,type:n,newValue:r,oldValue:i,oldTarget:o}),d.options.scheduler?d.options.scheduler(d):d()};l.forEach(u)}var Ji=Pi("__proto__,__v_isRef,__isVue"),zs=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(dn)),Yi=Vs(),Qi=Vs(!0),On=Xi();function Xi(){const t={};return["includes","indexOf","lastIndexOf"].forEach(n=>{t[n]=function(...s){const r=k(this);for(let o=0,a=this.length;o<a;o++)N(r,"get",o+"");const i=r[n](...s);return i===-1||i===!1?r[n](...s.map(k)):i}}),["push","pop","shift","unshift","splice"].forEach(n=>{t[n]=function(...s){Wi();const r=k(this)[n].apply(this,s);return Us(),r}}),t}function Vs(t=!1,n=!1){return function(r,i,o){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_raw"&&o===(t?n?ho:qs:n?fo:Ws).get(r))return r;const a=fe(r);if(!t&&a&&it(On,i))return Reflect.get(On,i,o);const l=Reflect.get(r,i,o);return(dn(i)?zs.has(i):Ji(i))||(t||N(r,"get",i),n)?l:zt(l)?!a||!fn(i)?l.value:l:ot(l)?t?Js(l):mn(l):l}}var Zi=eo();function eo(t=!1){return function(s,r,i,o){let a=s[r];if(!t&&(i=k(i),a=k(a),!fe(s)&&zt(a)&&!zt(i)))return a.value=i,!0;const l=fe(s)&&fn(r)?Number(r)<s.length:it(s,r),c=Reflect.set(s,r,i,o);return s===k(o)&&(l?js(i,a)&&se(s,"set",r,i,a):se(s,"add",r,i)),c}}function to(t,n){const s=it(t,n),r=t[n],i=Reflect.deleteProperty(t,n);return i&&s&&se(t,"delete",n,void 0,r),i}function no(t,n){const s=Reflect.has(t,n);return(!dn(n)||!zs.has(n))&&N(t,"has",n),s}function so(t){return N(t,"iterate",fe(t)?"length":he),Reflect.ownKeys(t)}var ro={get:Yi,set:Zi,deleteProperty:to,has:no,ownKeys:so},io={get:Qi,set(t,n){return console.warn(`Set operation on key "${String(n)}" failed: target is readonly.`,t),!0},deleteProperty(t,n){return console.warn(`Delete operation on key "${String(n)}" failed: target is readonly.`,t),!0}},gn=t=>ot(t)?mn(t):t,pn=t=>ot(t)?Js(t):t,yn=t=>t,at=t=>Reflect.getPrototypeOf(t);function Fe(t,n,s=!1,r=!1){t=t.__v_raw;const i=k(t),o=k(n);n!==o&&!s&&N(i,"get",n),!s&&N(i,"get",o);const{has:a}=at(i),l=r?yn:s?pn:gn;if(a.call(i,n))return l(t.get(n));if(a.call(i,o))return l(t.get(o));t!==i&&t.get(n)}function je(t,n=!1){const s=this.__v_raw,r=k(s),i=k(t);return t!==i&&!n&&N(r,"has",t),!n&&N(r,"has",i),t===i?s.has(t):s.has(t)||s.has(i)}function Ne(t,n=!1){return t=t.__v_raw,!n&&N(k(t),"iterate",he),Reflect.get(t,"size",t)}function Cn(t){t=k(t);const n=k(this);return at(n).has.call(n,t)||(n.add(t),se(n,"add",t,t)),this}function Tn(t,n){n=k(n);const s=k(this),{has:r,get:i}=at(s);let o=r.call(s,t);o?Hs(s,r,t):(t=k(t),o=r.call(s,t));const a=i.call(s,t);return s.set(t,n),o?js(n,a)&&se(s,"set",t,n,a):se(s,"add",t,n),this}function Mn(t){const n=k(this),{has:s,get:r}=at(n);let i=s.call(n,t);i?Hs(n,s,t):(t=k(t),i=s.call(n,t));const o=r?r.call(n,t):void 0,a=n.delete(t);return i&&se(n,"delete",t,void 0,o),a}function $n(){const t=k(this),n=t.size!==0,s=Me(t)?new Map(t):new Set(t),r=t.clear();return n&&se(t,"clear",void 0,void 0,s),r}function Ue(t,n){return function(r,i){const o=this,a=o.__v_raw,l=k(a),c=n?yn:t?pn:gn;return!t&&N(l,"iterate",he),a.forEach((u,d)=>r.call(i,c(u),c(d),o))}}function ze(t,n,s){return function(...r){const i=this.__v_raw,o=k(i),a=Me(o),l=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,u=i[t](...r),d=s?yn:n?pn:gn;return!n&&N(o,"iterate",c?Ut:he),{next(){const{value:h,done:g}=u.next();return g?{value:h,done:g}:{value:l?[d(h[0]),d(h[1])]:d(h),done:g}},[Symbol.iterator](){return this}}}}function X(t){return function(...n){{const s=n[0]?`on key "${n[0]}" `:"";console.warn(`${Ni(t)} operation ${s}failed: target is readonly.`,k(this))}return t==="delete"?!1:this}}function oo(){const t={get(o){return Fe(this,o)},get size(){return Ne(this)},has:je,add:Cn,set:Tn,delete:Mn,clear:$n,forEach:Ue(!1,!1)},n={get(o){return Fe(this,o,!1,!0)},get size(){return Ne(this)},has:je,add:Cn,set:Tn,delete:Mn,clear:$n,forEach:Ue(!1,!0)},s={get(o){return Fe(this,o,!0)},get size(){return Ne(this,!0)},has(o){return je.call(this,o,!0)},add:X("add"),set:X("set"),delete:X("delete"),clear:X("clear"),forEach:Ue(!0,!1)},r={get(o){return Fe(this,o,!0,!0)},get size(){return Ne(this,!0)},has(o){return je.call(this,o,!0)},add:X("add"),set:X("set"),delete:X("delete"),clear:X("clear"),forEach:Ue(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=ze(o,!1,!1),s[o]=ze(o,!0,!1),n[o]=ze(o,!1,!0),r[o]=ze(o,!0,!0)}),[t,s,n,r]}var[ao,lo,Sa,_a]=oo();function Ks(t,n){const s=t?lo:ao;return(r,i,o)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(it(s,i)&&i in r?s:r,i,o)}var co={get:Ks(!1)},uo={get:Ks(!0)};function Hs(t,n,s){const r=k(s);if(r!==s&&n.call(t,r)){const i=Fs(t);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Ws=new WeakMap,fo=new WeakMap,qs=new WeakMap,ho=new WeakMap;function go(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function po(t){return t.__v_skip||!Object.isExtensible(t)?0:go(Fs(t))}function mn(t){return t&&t.__v_isReadonly?t:Ys(t,!1,ro,co,Ws)}function Js(t){return Ys(t,!0,io,uo,qs)}function Ys(t,n,s,r,i){if(!ot(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&!(n&&t.__v_isReactive))return t;const o=i.get(t);if(o)return o;const a=po(t);if(a===0)return t;const l=new Proxy(t,a===2?r:s);return i.set(t,l),l}function k(t){return t&&k(t.__v_raw)||t}function zt(t){return!!(t&&t.__v_isRef===!0)}z("nextTick",()=>ln);z("dispatch",t=>Te.bind(Te,t));z("watch",(t,{evaluateLater:n,cleanup:s})=>(r,i)=>{let o=n(r),l=Wn(()=>{let c;return o(u=>c=u),c},i);s(l)});z("store",Oi);z("data",t=>ts(t));z("root",t=>nt(t));z("refs",t=>(t._x_refs_proxy||(t._x_refs_proxy=Be(yo(t))),t._x_refs_proxy));function yo(t){let n=[];return Ee(t,s=>{s._x_refs&&n.push(s._x_refs)}),n}var gt={};function Qs(t){return gt[t]||(gt[t]=0),++gt[t]}function mo(t,n){return Ee(t,s=>{if(s._x_ids&&s._x_ids[n])return!0})}function wo(t,n){t._x_ids||(t._x_ids={}),t._x_ids[n]||(t._x_ids[n]=Qs(n))}z("id",(t,{cleanup:n})=>(s,r=null)=>{let i=`${s}${r?`-${r}`:""}`;return So(t,i,n,()=>{let o=mo(t,s),a=o?o._x_ids[s]:Qs(s);return r?`${s}-${a}-${r}`:`${s}-${a}`})});rt((t,n)=>{t._x_id&&(n._x_id=t._x_id)});function So(t,n,s,r){if(t._x_id||(t._x_id={}),t._x_id[n])return t._x_id[n];let i=r();return t._x_id[n]=i,s(()=>{delete t._x_id[n]}),i}z("el",t=>t);Xs("Focus","focus","focus");Xs("Persist","persist","persist");function Xs(t,n,s){z(n,r=>L(`You can't use [$${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}C("modelable",(t,{expression:n},{effect:s,evaluateLater:r,cleanup:i})=>{let o=r(n),a=()=>{let d;return o(h=>d=h),d},l=r(`${n} = __placeholder`),c=d=>l(()=>{},{scope:{__placeholder:d}}),u=a();c(u),queueMicrotask(()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let d=t._x_model.get,h=t._x_model.set,g=Rs({get(){return d()},set(w){h(w)}},{get(){return a()},set(w){c(w)}});i(g)})});C("teleport",(t,{modifiers:n,expression:s},{cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-teleport can only be used on a <template> tag",t);let i=Rn(s),o=t.content.cloneNode(!0).firstElementChild;t._x_teleport=o,o._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach(l=>{o.addEventListener(l,c=>{c.stopPropagation(),t.dispatchEvent(new c.constructor(c.type,c))})}),Pe(o,{},t);let a=(l,c,u)=>{u.includes("prepend")?c.parentNode.insertBefore(l,c):u.includes("append")?c.parentNode.insertBefore(l,c.nextSibling):c.appendChild(l)};x(()=>{a(o,i,n),ie(()=>{J(o)})()}),t._x_teleportPutBack=()=>{let l=Rn(s);x(()=>{a(t._x_teleport,l,n)})},r(()=>x(()=>{o.remove(),Ae(o)}))});var _o=document.createElement("div");function Rn(t){let n=ie(()=>document.querySelector(t),()=>_o)();return n||L(`Cannot find x-teleport element for selector: "${t}"`),n}var Zs=()=>{};Zs.inline=(t,{modifiers:n},{cleanup:s})=>{n.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,s(()=>{n.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore})};C("ignore",Zs);C("effect",ie((t,{expression:n},{effect:s})=>{s($(t,n))}));function Vt(t,n,s,r){let i=t,o=c=>r(c),a={},l=(c,u)=>d=>u(c,d);if(s.includes("dot")&&(n=bo(n)),s.includes("camel")&&(n=vo(n)),s.includes("passive")&&(a.passive=!0),s.includes("capture")&&(a.capture=!0),s.includes("window")&&(i=window),s.includes("document")&&(i=document),s.includes("debounce")){let c=s[s.indexOf("debounce")+1]||"invalid-wait",u=Xe(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Ms(o,u)}if(s.includes("throttle")){let c=s[s.indexOf("throttle")+1]||"invalid-wait",u=Xe(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=$s(o,u)}return s.includes("prevent")&&(o=l(o,(c,u)=>{u.preventDefault(),c(u)})),s.includes("stop")&&(o=l(o,(c,u)=>{u.stopPropagation(),c(u)})),s.includes("once")&&(o=l(o,(c,u)=>{c(u),i.removeEventListener(n,o,a)})),(s.includes("away")||s.includes("outside"))&&(i=document,o=l(o,(c,u)=>{t.contains(u.target)||u.target.isConnected!==!1&&(t.offsetWidth<1&&t.offsetHeight<1||t._x_isShown!==!1&&c(u))})),s.includes("self")&&(o=l(o,(c,u)=>{u.target===t&&c(u)})),(ko(n)||er(n))&&(o=l(o,(c,u)=>{Eo(u,s)||c(u)})),i.addEventListener(n,o,a),()=>{i.removeEventListener(n,o,a)}}function bo(t){return t.replace(/-/g,".")}function vo(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function Xe(t){return!Array.isArray(t)&&!isNaN(t)}function Do(t){return[" ","_"].includes(t)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function ko(t){return["keydown","keyup"].includes(t)}function er(t){return["contextmenu","click","mouse"].some(n=>t.includes(n))}function Eo(t,n){let s=n.filter(o=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(o));if(s.includes("debounce")){let o=s.indexOf("debounce");s.splice(o,Xe((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.includes("throttle")){let o=s.indexOf("throttle");s.splice(o,Xe((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.length===0||s.length===1&&Pn(t.key).includes(s[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(o=>s.includes(o));return s=s.filter(o=>!i.includes(o)),!(i.length>0&&i.filter(a=>((a==="cmd"||a==="super")&&(a="meta"),t[`${a}Key`])).length===i.length&&(er(t.type)||Pn(t.key).includes(s[0])))}function Pn(t){if(!t)return[];t=Do(t);let n={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return n[t]=t,Object.keys(n).map(s=>{if(n[s]===t)return s}).filter(s=>s)}C("model",(t,{modifiers:n,expression:s},{effect:r,cleanup:i})=>{let o=t;n.includes("parent")&&(o=t.parentNode);let a=$(o,s),l;typeof s=="string"?l=$(o,`${s} = __placeholder`):typeof s=="function"&&typeof s()=="string"?l=$(o,`${s()} = __placeholder`):l=()=>{};let c=()=>{let g;return a(w=>g=w),Bn(g)?g.get():g},u=g=>{let w;a(b=>w=b),Bn(w)?w.set(g):l(()=>{},{scope:{__placeholder:g}})};typeof s=="string"&&t.type==="radio"&&x(()=>{t.hasAttribute("name")||t.setAttribute("name",s)});var d=t.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(t.type)||n.includes("lazy")?"change":"input";let h=ne?()=>{}:Vt(t,d,n,g=>{u(pt(t,n,g,c()))});if(n.includes("fill")&&([void 0,null,""].includes(c())||un(t)&&Array.isArray(c())||t.tagName.toLowerCase()==="select"&&t.multiple)&&u(pt(t,n,{target:t},c())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=h,i(()=>t._x_removeModelListeners.default()),t.form){let g=Vt(t.form,"reset",[],w=>{ln(()=>t._x_model&&t._x_model.set(pt(t,n,{target:t},c())))});i(()=>g())}t._x_model={get(){return c()},set(g){u(g)}},t._x_forceModelUpdate=g=>{g===void 0&&typeof s=="string"&&s.match(/\./)&&(g=""),window.fromModel=!0,x(()=>Is(t,"value",g)),delete window.fromModel},r(()=>{let g=c();n.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate(g)})});function pt(t,n,s,r){return x(()=>{if(s instanceof CustomEvent&&s.detail!==void 0)return s.detail!==null&&s.detail!==void 0?s.detail:s.target.value;if(un(t))if(Array.isArray(r)){let i=null;return n.includes("number")?i=yt(s.target.value):n.includes("boolean")?i=We(s.target.value):i=s.target.value,s.target.checked?r.includes(i)?r:r.concat([i]):r.filter(o=>!Ao(o,i))}else return s.target.checked;else{if(t.tagName.toLowerCase()==="select"&&t.multiple)return n.includes("number")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return yt(o)}):n.includes("boolean")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return We(o)}):Array.from(s.target.selectedOptions).map(i=>i.value||i.text);{let i;return Ts(t)?s.target.checked?i=s.target.value:i=r:i=s.target.value,n.includes("number")?yt(i):n.includes("boolean")?We(i):n.includes("trim")?i.trim():i}}})}function yt(t){let n=t?parseFloat(t):null;return Io(n)?n:t}function Ao(t,n){return t==n}function Io(t){return!Array.isArray(t)&&!isNaN(t)}function Bn(t){return t!==null&&typeof t=="object"&&typeof t.get=="function"&&typeof t.set=="function"}C("cloak",t=>queueMicrotask(()=>x(()=>t.removeAttribute(ke("cloak")))));bs(()=>`[${ke("init")}]`);C("init",ie((t,{expression:n},{evaluate:s})=>typeof n=="string"?!!n.trim()&&s(n,{},!1):s(n,{},!1)));C("text",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.textContent=o})})})});C("html",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.innerHTML=o,t._x_ignoreSelf=!0,J(t),delete t._x_ignoreSelf})})})});rn(ds(":",fs(ke("bind:"))));var tr=(t,{value:n,modifiers:s,expression:r,original:i},{effect:o,cleanup:a})=>{if(!n){let c={};Ti(c),$(t,r)(d=>{Bs(t,d,i)},{scope:c});return}if(n==="key")return xo(t,r);if(t._x_inlineBindings&&t._x_inlineBindings[n]&&t._x_inlineBindings[n].extract)return;let l=$(t,r);o(()=>l(c=>{c===void 0&&typeof r=="string"&&r.match(/\./)&&(c=""),x(()=>Is(t,n,c,s))})),a(()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()})};tr.inline=(t,{value:n,modifiers:s,expression:r})=>{n&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[n]={expression:r,extract:!1})};C("bind",tr);function xo(t,n){t._x_keyExpression=n}_s(()=>`[${ke("data")}]`);C("data",(t,{expression:n},{cleanup:s})=>{if(Oo(t))return;n=n===""?"{}":n;let r={};$t(r,t);let i={};$i(i,r);let o=de(t,n,{scope:i});(o===void 0||o===!0)&&(o={}),$t(o,t);let a=ve(o);ns(a);let l=Pe(t,a);a.init&&de(t,a.init),s(()=>{a.destroy&&de(t,a.destroy),l()})});rt((t,n)=>{t._x_dataStack&&(n._x_dataStack=t._x_dataStack,n.setAttribute("data-has-alpine-state",!0))});function Oo(t){return ne?jt?!0:t.hasAttribute("data-has-alpine-state"):!1}C("show",(t,{modifiers:n,expression:s},{effect:r})=>{let i=$(t,s);t._x_doHide||(t._x_doHide=()=>{x(()=>{t.style.setProperty("display","none",n.includes("important")?"important":void 0)})}),t._x_doShow||(t._x_doShow=()=>{x(()=>{t.style.length===1&&t.style.display==="none"?t.removeAttribute("style"):t.style.removeProperty("display")})});let o=()=>{t._x_doHide(),t._x_isShown=!1},a=()=>{t._x_doShow(),t._x_isShown=!0},l=()=>setTimeout(a),c=Gt(h=>h?a():o(),h=>{typeof t._x_toggleAndCascadeWithTransitions=="function"?t._x_toggleAndCascadeWithTransitions(t,h,a,o):h?l():o()}),u,d=!0;r(()=>i(h=>{!d&&h===u||(n.includes("immediate")&&(h?l():o()),c(h),u=h,d=!1)}))});C("for",(t,{expression:n},{effect:s,cleanup:r})=>{let i=To(n),o=$(t,i.items),a=$(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},s(()=>Co(t,i,o,a)),r(()=>{Object.values(t._x_lookup).forEach(l=>x(()=>{Ae(l),l.remove()})),delete t._x_prevKeys,delete t._x_lookup})});function Co(t,n,s,r){let i=a=>typeof a=="object"&&!Array.isArray(a),o=t;s(a=>{Mo(a)&&a>=0&&(a=Array.from(Array(a).keys(),f=>f+1)),a===void 0&&(a=[]);let l=t._x_lookup,c=t._x_prevKeys,u=[],d=[];if(i(a))a=Object.entries(a).map(([f,p])=>{let y=Ln(n,p,f,a);r(_=>{d.includes(_)&&L("Duplicate key on x-for",t),d.push(_)},{scope:{index:f,...y}}),u.push(y)});else for(let f=0;f<a.length;f++){let p=Ln(n,a[f],f,a);r(y=>{d.includes(y)&&L("Duplicate key on x-for",t),d.push(y)},{scope:{index:f,...p}}),u.push(p)}let h=[],g=[],w=[],b=[];for(let f=0;f<c.length;f++){let p=c[f];d.indexOf(p)===-1&&w.push(p)}c=c.filter(f=>!w.includes(f));let S="template";for(let f=0;f<d.length;f++){let p=d[f],y=c.indexOf(p);if(y===-1)c.splice(f,0,p),h.push([S,f]);else if(y!==f){let _=c.splice(f,1)[0],O=c.splice(y-1,1)[0];c.splice(f,0,O),c.splice(y,0,_),g.push([_,O])}else b.push(p);S=p}for(let f=0;f<w.length;f++){let p=w[f];p in l&&(x(()=>{Ae(l[p]),l[p].remove()}),delete l[p])}for(let f=0;f<g.length;f++){let[p,y]=g[f],_=l[p],O=l[y],T=document.createElement("div");x(()=>{O||L('x-for ":key" is undefined or invalid',o,y,l),O.after(T),_.after(O),O._x_currentIfEl&&O.after(O._x_currentIfEl),T.before(_),_._x_currentIfEl&&_.after(_._x_currentIfEl),T.remove()}),O._x_refreshXForScope(u[d.indexOf(y)])}for(let f=0;f<h.length;f++){let[p,y]=h[f],_=p==="template"?o:l[p];_._x_currentIfEl&&(_=_._x_currentIfEl);let O=u[y],T=d[y],F=document.importNode(o.content,!0).firstElementChild,Y=ve(O);Pe(F,Y,o),F._x_refreshXForScope=V=>{Object.entries(V).forEach(([m,B])=>{Y[m]=B})},x(()=>{_.after(F),ie(()=>J(F))()}),typeof T=="object"&&L("x-for key cannot be an object, it must be a string or an integer",o),l[T]=F}for(let f=0;f<b.length;f++)l[b[f]]._x_refreshXForScope(u[d.indexOf(b[f])]);o._x_prevKeys=d})}function To(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,s=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(r);if(!i)return;let o={};o.items=i[2].trim();let a=i[1].replace(s,"").trim(),l=a.match(n);return l?(o.item=a.replace(n,"").trim(),o.index=l[1].trim(),l[2]&&(o.collection=l[2].trim())):o.item=a,o}function Ln(t,n,s,r){let i={};return/^\[.*\]$/.test(t.item)&&Array.isArray(n)?t.item.replace("[","").replace("]","").split(",").map(a=>a.trim()).forEach((a,l)=>{i[a]=n[l]}):/^\{.*\}$/.test(t.item)&&!Array.isArray(n)&&typeof n=="object"?t.item.replace("{","").replace("}","").split(",").map(a=>a.trim()).forEach(a=>{i[a]=n[a]}):i[t.item]=n,t.index&&(i[t.index]=s),t.collection&&(i[t.collection]=r),i}function Mo(t){return!Array.isArray(t)&&!isNaN(t)}function nr(){}nr.inline=(t,{expression:n},{cleanup:s})=>{let r=nt(t);r._x_refs||(r._x_refs={}),r._x_refs[n]=t,s(()=>delete r._x_refs[n])};C("ref",nr);C("if",(t,{expression:n},{effect:s,cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-if can only be used on a <template> tag",t);let i=$(t,n),o=()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let l=t.content.cloneNode(!0).firstElementChild;return Pe(l,{},t),x(()=>{t.after(l),ie(()=>J(l))()}),t._x_currentIfEl=l,t._x_undoIf=()=>{x(()=>{Ae(l),l.remove()}),delete t._x_currentIfEl},l},a=()=>{t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)};s(()=>i(l=>{l?o():a()})),r(()=>t._x_undoIf&&t._x_undoIf())});C("id",(t,{expression:n},{evaluate:s})=>{s(n).forEach(i=>wo(t,i))});rt((t,n)=>{t._x_ids&&(n._x_ids=t._x_ids)});rn(ds("@",fs(ke("on:"))));C("on",ie((t,{value:n,modifiers:s,expression:r},{cleanup:i})=>{let o=r?$(t,r):()=>{};t.tagName.toLowerCase()==="template"&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(n)||t._x_forwardEvents.push(n));let a=Vt(t,n,s,l=>{o(()=>{},{scope:{$event:l},params:[l]})});i(()=>a())}));lt("Collapse","collapse","collapse");lt("Intersect","intersect","intersect");lt("Focus","trap","focus");lt("Mask","mask","mask");function lt(t,n,s){C(n,r=>L(`You can't use [x-${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}Le.setEvaluator(as);Le.setReactivityEngine({reactive:mn,effect:zi,release:Vi,raw:k});var $o=Le,Ze=$o;const Ro=(t,n)=>n.some(s=>t instanceof s);let Gn,Fn;function Po(){return Gn||(Gn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bo(){return Fn||(Fn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sr=new WeakMap,Kt=new WeakMap,rr=new WeakMap,mt=new WeakMap,wn=new WeakMap;function Lo(t){const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",a)},o=()=>{s(te(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",a)});return n.then(s=>{s instanceof IDBCursor&&sr.set(s,t)}).catch(()=>{}),wn.set(n,t),n}function Go(t){if(Kt.has(t))return;const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",a),t.removeEventListener("abort",a)},o=()=>{s(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",a),t.addEventListener("abort",a)});Kt.set(t,n)}let Ht={get(t,n,s){if(t instanceof IDBTransaction){if(n==="done")return Kt.get(t);if(n==="objectStoreNames")return t.objectStoreNames||rr.get(t);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return te(t[n])},set(t,n,s){return t[n]=s,!0},has(t,n){return t instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in t}};function Fo(t){Ht=t(Ht)}function jo(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...s){const r=t.call(wt(this),n,...s);return rr.set(r,n.sort?n.sort():[n]),te(r)}:Bo().includes(t)?function(...n){return t.apply(wt(this),n),te(sr.get(this))}:function(...n){return te(t.apply(wt(this),n))}}function No(t){return typeof t=="function"?jo(t):(t instanceof IDBTransaction&&Go(t),Ro(t,Po())?new Proxy(t,Ht):t)}function te(t){if(t instanceof IDBRequest)return Lo(t);if(mt.has(t))return mt.get(t);const n=No(t);return n!==t&&(mt.set(t,n),wn.set(n,t)),n}const wt=t=>wn.get(t);function Uo(t,n,{blocked:s,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(t,n),l=te(a);return r&&a.addEventListener("upgradeneeded",c=>{r(te(a.result),c.oldVersion,c.newVersion,te(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{o&&c.addEventListener("close",()=>o()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const zo=["get","getKey","getAll","getAllKeys","count"],Vo=["put","add","delete","clear"],St=new Map;function jn(t,n){if(!(t instanceof IDBDatabase&&!(n in t)&&typeof n=="string"))return;if(St.get(n))return St.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,i=Vo.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||zo.includes(s)))return;const o=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&c.done]))[0]};return St.set(n,o),o}Fo(t=>({...t,get:(n,s,r)=>jn(n,s)||t.get(n,s,r),has:(n,s)=>!!jn(n,s)||t.has(n,s)}));const _t="not-the-news-db",bt=29;let ee=null,me=null;const Ko=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function et(){if(ee)return ee;if(me)return me;me=Uo(_t,bt,{upgrade(t,n){console.log(`[DB] Upgrading database from version ${n} to ${bt}`);const s=new Set(t.objectStoreNames);Ko.forEach(r=>{let i;s.has(r.name)&&t.deleteObjectStore(r.name),i=t.createObjectStore(r.name,{keyPath:r.keyPath,...r.options||{}}),console.log(`[DB] Created/Recreated store: ${r.name}`),r.indexes&&r.indexes.forEach(o=>{i.createIndex(o.name,o.keyPath,o.options||{}),console.log(`[DB] Created index '${o.name}' on store '${r.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return ee=await me,console.log(`[DB] Opened '${_t}', version ${bt}`),ee}catch(t){throw console.error(`[DB] Failed to open database '${_t}':`,t),ee=null,me=null,t}}async function ir(){ee&&(ee.close(),ee=null,me=null,console.log("[DB] Database connection closed."))}async function M(t){let n=await et();return t(n)}const q=()=>navigator.onLine,Re=window.location.origin;async function Ge(t,n,s){return M(async r=>{try{const i=s||new Date().toISOString();await r.put("userSettings",{key:t,value:n,lastModified:i})}catch(i){console.error(`[DB] Failed to save sync metadata for key '${t}':`,i)}})}async function Ho(t){return M(async n=>{const s={...t};s.id&&delete s.id;try{const r=n.transaction("pendingOperations","readwrite"),i=await r.store.add(s);return await r.done,i}catch(r){throw console.error("[DB] Error buffering operation:",r),r}})}async function j(t){if(!t||typeof t.type!="string"||t.type==="simpleUpdate"&&(t.value===null||t.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",t);return}try{const n=await Ho(t);console.log(`[DB] Operation buffered with ID: ${n}`,t);const{value:s}=await A("syncEnabled");if(q()&&s){console.log(`[DB] Attempting immediate sync for ${t.type} (ID: ${n}).`);const r=[{...t,id:n}],i=await fetch(`${Re}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){const l=await i.text();throw new Error(`HTTP error ${i.status} for immediate sync. Details: ${l}`)}const o=await i.json(),a=o.results?.find(l=>l.id===n);a?.status==="success"?(await M(l=>l.delete("pendingOperations",n)),console.log(`[DB] Successfully synced and removed immediate op ${n} (${t.type}).`),o.serverTime&&await Ge("lastStateSync",o.serverTime),W()):console.warn(`[DB] Immediate sync for op ${n} reported non-success by server:`,a)}else console.log(`[DB] ${q()?"Sync is disabled.":"Offline."} Buffering op ${n} for later batch sync.`)}catch(n){console.error(`[DB] Network error during immediate sync for ${t.type}. Will retry with batch sync.`,n)}}async function le(){const{value:t}=await A("syncEnabled");if(!q()||!t){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const n=await M(s=>s.getAll("pendingOperations")).catch(s=>(console.error("[DB] Error fetching pending operations:",s),null));if(!n||n.length===0){n&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${n.length} batched operations to /api/user-state.`);try{const s=await fetch(`${Re}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP error ${s.status}. Details: ${await s.text()}`);const r=await s.json();console.log("[DB] Batch sync successful. Server response:",r),r.results&&Array.isArray(r.results)?await M(async i=>{const o=i.transaction("pendingOperations","readwrite");for(const a of r.results)a.status==="success"&&a.id!==void 0?await o.store.delete(a.id):console.warn(`[DB] Op ${a.id??"N/A"} (${a.opType}) ${a.status}: ${a.reason||"N/A"}`);await o.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),r.serverTime&&await Ge("lastStateSync",r.serverTime),W()}catch(s){console.error("[DB] Error during batch synchronization:",s)}}let vt=!1,Nn=0;const Wo=500;async function Un(t,n,s=!1){if(!s&&(await M(u=>u.getAll("pendingOperations")).catch(()=>[])).some(u=>u.key===t||u.type==="starDelta"&&t==="starred"||u.type==="readDelta"&&t==="read"||u.type==="simpleUpdate"&&u.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${t}' because local changes are pending synchronization.`),{key:t,status:"skipped_pending"};const{value:r,lastModified:i}=n.type==="array"?await re(n.store):await A(t,n.store),o=i||"",a={"Content-Type":"application/json"};o&&!s&&(a["If-None-Match"]=o);try{const l=await fetch(`${Re}/api/user-state/${t}`,{method:"GET",headers:a});if(l.status===304&&!s)return{key:t,status:304,timestamp:o};if(!l.ok)return console.error(`[DB] HTTP error for ${t}: ${l.status}`),{key:t,status:l.status};const c=await l.json();if(console.log(`[DB Sync] Received data for ${t}:`,c.value),n.type==="array"){const u=c.value||[],d=r||[],h=new Set(u.map(S=>S.guid)),g=new Set(d.map(S=>S.guid)),w=s?u:u.filter(S=>!g.has(S.guid)),b=s?[]:d.filter(S=>!h.has(S.guid));(w.length>0||b.length>0||s)&&await M(async S=>{const f=S.transaction(n.store,"readwrite");s&&await f.store.clear();for(const p of w)await f.store.put(p);for(const p of b)s||await f.store.delete(p.id);await f.done})}else await Ge(t,c.value,c.lastModified);return{key:t,status:200,timestamp:c.lastModified}}catch(l){return console.error(`[DB] Failed to pull ${t}:`,l),{key:t,status:"error"}}}async function W(t=!1){if(!q())return;let{value:n}=await A("syncEnabled");if(!n&&!t){console.log("[DB] Sync is disabled locally. Checking for remote status...");const r=U.syncEnabled;(await Un("syncEnabled",r,!1)).status===200&&(n=(await A("syncEnabled")).value)}if(!n&&!t||vt&&!t)return;const s=Date.now();if(!(!t&&s-Nn<Wo)){Nn=s,vt=!0,console.log(`[DB] Pulling user state (force=${t})...`);try{const r=Object.entries(U).filter(([a,l])=>!l.localOnly&&a!=="syncEnabled"),o=(await Promise.all(r.map(([a,l])=>Un(a,l,t)))).reduce((a,l)=>l?.timestamp&&l.timestamp>a?l.timestamp:a,"");o&&await Ge("lastStateSync",o)}catch(r){console.error("[DB] User state pull failed:",r)}finally{vt=!1,console.log("[DB] User state pull completed.")}}}async function Sn(){return M(t=>t.getAll("feedItems")).catch(t=>(console.error("Failed to get all feed items:",t),[]))}async function we(t){const{value:n}=await A("syncEnabled");if(!q()||!n)return n&&console.log("[DB] Offline. Skipping feed sync."),!0;console.log("[DB] Fetching feed items from server.");try{const{value:s}=await A("lastFeedSync"),r=await fetch(`${Re}/api/feed-guids?since=${s||""}`);if(r.status===304)return console.log("[DB] Feed not modified."),!0;if(!r.ok)throw new Error(`HTTP error ${r.status} for /api/feed-guids`);const i=await r.json();console.log("[DB] /api/feed-guids response:",i);const{guids:o,serverTime:a}=i,l=new Set(o),c=await Sn(),u=new Set(c.map(b=>b.guid)),d=[...l].filter(b=>!u.has(b));console.log(`[DB] GUIDs to fetch: ${d.length}`,d);const h=[...u].filter(b=>!l.has(b));console.log(`[DB] New GUIDs: ${d.length}, Deleting: ${h.length}`);const g=d.length;let w=0;if(d.length>0){const S=[];for(let f=0;f<d.length;f+=50){const p=d.slice(f,f+50),y=await fetch(`${Re}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:p})});if(y.ok){const _=await y.json();console.log(`[DB] Fetched batch of ${_.length} items:`,_),S.push(..._),w+=_.length,t&&(t.progressMessage=`Fetching feed content... (${w}/${g})`)}else return console.error(`[DB] Failed to fetch a batch of feed items. Status: ${y.status}`),!1}await M(async f=>{const p=f.transaction("feedItems","readwrite");for(const y of S)y.guid&&await p.store.put(y);await p.done})}if(h.length>0){const b=new Map(c.map(S=>[S.guid,S.id]));await M(async S=>{const f=S.transaction("feedItems","readwrite");for(const p of h){const y=b.get(p);y!==void 0&&await f.store.delete(y)}await f.done})}return a&&await Ge("lastFeedSync",a),t?.loadFeedItemsFromDB?.(),t?.loadAndDisplayDeck?.(),t?.updateCounts?.(),!0}catch(s){return console.error("[DB] Failed to synchronize feed:",s),!1}}async function _n(t){const{value:n}=await A("syncEnabled");if(!q()||!n)return!0;console.log("[DB] Full sync initiated.");try{return await le(),await W(),await we(t)}catch(s){return console.error("[DB] Full sync failed:",s),!1}}const U={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},syncEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},theme:{store:"userSettings",type:"simple",localOnly:!1,default:"dark"},themeStyle:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleLight:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleDark:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},customCss:{store:"userSettings",type:"simple",localOnly:!1,default:""},fontSize:{store:"userSettings",type:"simple",localOnly:!0,default:100},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0},rssFeeds:{store:"userSettings",type:"simple",localOnly:!1,default:{}},keywordBlacklist:{store:"userSettings",type:"simple",localOnly:!1,default:[]},shuffleCount:{store:"userSettings",type:"simple",localOnly:!1,default:2},lastShuffleResetDate:{store:"userSettings",type:"simple",localOnly:!1,default:null},shadowsEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0}};async function A(t,n="userSettings"){return M(async s=>{try{const r=await s.get(n,t);return{value:r?r.value:U[t]?.default||null,lastModified:r?.lastModified||null}}catch(r){return console.error(`Failed to load simple state for key '${t}':`,r),{value:U[t]?.default||null,lastModified:null}}})}async function G(t,n,s="userSettings"){await M(i=>i.put(s,{key:t,value:n,lastModified:new Date().toISOString()}));const r=U[t];r&&!r.localOnly&&await j({type:"simpleUpdate",key:t,value:n,timestamp:new Date().toISOString()})}const or=t=>{switch(t){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function re(t){return console.log(`ENTERING loadArrayState for ${t}`),M(async n=>{try{const s=await n.getAll(t);if(s.length>0&&(typeof s[0]=="string"||s[0].id===void 0)){console.log(`[DB] Migration required for '${t}'.`);const i=or(t),o=new Date().toISOString(),a=new Map;s.forEach(d=>{const h=typeof d=="string"?d:d.guid;h&&!a.has(h)&&a.set(h,d)});const c=Array.from(a.values()).map(d=>({guid:typeof d=="string"?d:d.guid,[i]:o})),u=n.transaction(t,"readwrite");await u.store.clear();for(const d of c)await u.store.put(d);return await u.done,console.log(`[DB] Migration complete for '${t}'.`),{value:await n.getAll(t)}}return{value:s||U[t]?.default||[]}}catch(s){return console.error(`Failed to load array state from store '${t}':`,s),{value:U[t]?.default||[]}}})}async function ar(t,n){return M(s=>s.getFromIndex(t,"guid",n)).catch(s=>{console.error(`Error finding item by GUID '${n}' in store '${t}':`,s)})}async function bn(t,n,s){await M(async i=>{const o=i.transaction(t,"readwrite");if(!n||!n.guid){console.error("[DB] updateArrayState requires an item with a guid property.",n);return}const a=o.objectStore(t);if(s)await a.put(n);else{const l=await a.index("guid").get(n.guid);l?.id!==void 0&&await a.delete(l.id)}await o.done});const r=Object.entries(U).find(([,i])=>i.store===t);if(r&&!r[1].localOnly){let i="";t==="starred"&&(i="starDelta"),t==="read"&&(i="readDelta"),i&&await j({type:i,guid:n.guid,action:s?"add":"remove",timestamp:n[or(t)]||new Date().toISOString()})}}async function ct(t,n){const{value:s}=await re(t),r=new Set(s.map(u=>u.guid));await ye(t,n);const i=new Set(n.map(u=>u.guid)),o=[...r].filter(u=>!i.has(u)),a=[...i].filter(u=>!i.has(u)),l=Object.entries(U).find(([,u])=>u.store===t);if(!l||l[1].localOnly)return;let c="";if(t==="starred"&&(c="starDelta"),t==="read"&&(c="readDelta"),!c){await j({type:"simpleUpdate",key:l[0],value:n,timestamp:new Date().toISOString()});return}if(o.length>0){console.log(`[DB] Queuing ${o.length} 'remove' operations for '${t}'.`);for(const u of o)await j({type:c,guid:u,action:"remove",timestamp:new Date().toISOString()})}if(a.length>0){console.log(`[DB] Queuing ${a.length} 'add' operations for '${t}'.`);for(const u of a)await j({type:c,guid:u,action:"add",timestamp:new Date().toISOString()})}}async function lr(t,n){if(!Array.isArray(t)||!Array.isArray(n)){console.warn("[DB] pruneStaleReadItems skipped due to invalid input.");return}const s=new Set(n.map(a=>a.guid)),r=720*60*60*1e3,i=Date.now(),o=t.filter(a=>{if(s.has(a.guid))return!0;const l=new Date(a.readAt).getTime();return i-l<r});if(o.length<t.length){const a=t.length-o.length;console.log(`[DB] Pruning ${a} stale read items.`),await ct("read",o)}else console.log("[DB] No stale read items to prune.")}async function ye(t,n){return M(async s=>{const r=s.transaction(t,"readwrite");await r.store.clear();for(const i of n){const o=JSON.parse(JSON.stringify(i));delete o.id,await r.store.put(o)}await r.done})}const Z=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,findByGuid:ar,loadArrayState:re,loadSimpleState:A,overwriteArrayAndSyncChanges:ct,pruneStaleReadItems:lr,queueAndAttemptSyncOperation:j,saveArrayState:ye,saveSimpleState:G,updateArrayState:bn},Symbol.toStringTag,{value:"Module"})),qo=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:U,closeDb:ir,findByGuid:ar,getAllFeedItems:Sn,initDb:et,loadArrayState:re,loadSimpleState:A,overwriteArrayAndSyncChanges:ct,performFeedSync:we,performFullSync:_n,processPendingOperations:le,pruneStaleReadItems:lr,pullUserState:W,queueAndAttemptSyncOperation:j,saveArrayState:ye,saveSimpleState:G,updateArrayState:bn,withDb:M},Symbol.toStringTag,{value:"Module"}));function zn(t){const n=new Date,s=new Date(t),r=Math.floor((n.getTime()-s.getTime())/1e3),i=336*60*60;if(r>i)return s.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const o=Math.floor(r/60),a=Math.floor(o/60),l=Math.floor(a/24);if(r<60)return"Just now";if(o<60)return`${o} minute${o!==1?"s":""} ago`;if(a<24)return`${a} hour${a!==1?"s":""} ago`;if(l<7)return`${l} day${l!==1?"s":""} ago`;const c=Math.floor(l/7);return`${c} week${c!==1?"s":""} ago`}function Vn(t){for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}return t}function Dt(t){const n=[];if(!t)return n;if(Array.isArray(t))t.forEach(s=>{typeof s=="string"&&s.trim()?n.push(s.trim()):s&&typeof s=="object"&&s.url&&n.push(s.url.trim())});else if(typeof t=="object")for(const s in t){const r=t[s];if(r&&typeof r=="object")for(const i in r){const o=r[i];Array.isArray(o)&&o.forEach(a=>{a&&a.url&&n.push(a.url.trim())})}}return n}function cr(t,n){if(!t)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const r=new DOMParser().parseFromString(t.description||"","text/html"),i=r.querySelectorAll("img");let o="";if(i.length===1){const d=i[0];d.classList.add("title-image"),o=d.src||"",d.remove()}else i.forEach(d=>{d.setAttribute("loading","lazy"),d.setAttribute("onload","this.classList.add('loaded')")});let a="";const l=r.querySelector(".source-url")||r.querySelector("a");l?(a=l.textContent?.trim()||"",l.remove()):a=t.link?new URL(t.link).hostname:"";const c=r.body.innerHTML.trim(),u=Date.parse(t.pubDate)||0;return{guid:t.guid,image:o,title:t.title,link:t.link,pubDate:n(t.pubDate||""),description:c,source:a,timestamp:u}}function Jo(t,n){if(console.log(`ENTERING mapRawItems. rawList length: ${t.length}`),!Array.isArray(t))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const s=t.map(r=>cr(r,n)).filter(r=>r!==null).sort((r,i)=>i.timestamp-r.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${s.length}`),s}async function Yo(t,n,s,r,i){console.log("ENTERING generateNewDeck with filterMode:",i),console.log("generateNewDeck: allFeedItems count:",t.length),console.log("generateNewDeck: readItems count:",n.length);try{const a=f=>{if(!Array.isArray(f))return new Set;const p=f.map(y=>typeof y=="object"&&"guid"in y&&y.guid?y.guid:y);return new Set(p.filter(y=>typeof y=="string"&&!!y))},l=new Set(t.map(f=>f.guid)),c=new Set([...a(n)].filter(f=>l.has(f))),u=new Set([...a(s)].filter(f=>l.has(f))),d=new Set([...a(r)].filter(f=>l.has(f)));console.log(`[generateNewDeck] readGuidsSet size: ${c.size}`),console.log(`[generateNewDeck] shuffledOutGuidsSet size: ${d.size}`);let h=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${h.length}`),i){case"read":h=t.filter(f=>c.has(f.guid));break;case"starred":h=t.filter(f=>u.has(f.guid));break;default:h=t.filter(f=>!c.has(f.guid)&&!d.has(f.guid)),h.length===0&&(console.log("generateNewDeck: No unread/unshuffled items found, trying all unshuffled items."),h=t.filter(f=>!d.has(f.guid))),h.length===0&&(console.log("generateNewDeck: No unshuffled items found, trying all unread items."),h=t.filter(f=>!c.has(f.guid))),h.length===0&&(console.log("generateNewDeck: Absolutely no filter matches, using all items."),h=[...t]);break}if(console.log("generateNewDeck: Final filteredItems count:",h.length),i==="read"||i==="starred")return h.sort((f,p)=>p.timestamp-f.timestamp),console.log(`[generateNewDeck] Filtered items for ${i}: ${h.length}`),h;let g=[];const w=new Set,b=f=>g.length<10&&f&&!w.has(f.guid)?(g.push(f),w.add(f.guid),!0):!1,S=(f,p)=>{let y=0;for(const _ of f){if(y>=p||g.length>=10)break;b(_)&&y++}};if(navigator.onLine){const f=Date.now(),p=I=>/<a\s+href=/i.test(I.description),y=I=>I.title?.includes("?"),_=I=>I.description?.length>=150&&I.description.substring(0,150).includes("?"),O=I=>{const R=I.description;return R?.length>=150&&R.substring(R.length-150).includes("?")},T=I=>I.image!=="",F=I=>I.description?.length>=750,Y=I=>I.description?.length<750,V=h.filter(I=>f-I.timestamp<=1440*60*1e3);S(V,2),console.log(`[generateNewDeck] After recentItems: ${g.length}`);const m=h.filter(p);S(m,1),console.log(`[generateNewDeck] After itemsWithLinks: ${g.length}`);const B=h.filter(y);S(B,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${g.length}`);const E=h.filter(_);S(E,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${g.length}`);const K=h.filter(O);S(K,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${g.length}`);const D=h.filter(T);S(D,1),console.log(`[generateNewDeck] After itemsWithImages: ${g.length}`);const dt=h.filter(F);S(dt,1),console.log(`[generateNewDeck] After longItems: ${g.length}`);const oe=h.filter(Y);S(oe,1),console.log(`[generateNewDeck] After shortItems: ${g.length}`);const Sr=h.filter(I=>!w.has(I.guid)),_r=Vn([...Sr]);for(const I of _r){if(g.length>=10)break;b(I)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${g.length}`),g.length<10){const I=t.filter(R=>d.has(R.guid)&&!c.has(R.guid)&&!w.has(R.guid));I.sort((R,Q)=>R.timestamp-Q.timestamp);for(const R of I){if(g.length>=10)break;b(R)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${g.length}`),g.length<10){const R=t.filter(Q=>!w.has(Q.guid));R.sort((Q,br)=>Q.timestamp-br.timestamp);for(const Q of R){if(g.length>=10)break;g.push(Q),w.add(Q.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${g.length}`)}}}else{let f=[...h];const p=m=>m.title?.includes("?"),y=m=>m.description?.length>=150&&m.description.substring(0,150).includes("?"),_=m=>{const B=m.description;return B?.length>=150&&B.substring(B.length-150).includes("?")},O=m=>/<a\s+href=/i.test(m.description),T=m=>m.image!=="";if(f=f.filter(m=>!p(m)),f=f.filter(m=>!(m.description&&y(m))),f=f.filter(m=>!(m.description&&_(m))),f=f.filter(m=>!O(m)),f=f.filter(m=>!T(m)),f.length<10){let m=h.filter(E=>!f.includes(E));const B=[E=>T(E),E=>O(E),E=>E.description&&_(E),E=>E.description&&y(E),E=>p(E)];for(const E of B){for(;f.length<10;){const K=m.find(E);if(K)f.push(K),m=m.filter(D=>D!==K);else break}if(f.length>=10)break}for(;f.length<10&&m.length>0;)f.push(m.shift())}const F=Date.now();g=f.filter(m=>F-m.timestamp<=1440*60*1e3).slice(0,2);const V=f.filter(m=>!g.includes(m));g=g.concat(V.slice(0,10-g.length))}return Vn([...g])}catch(o){return console.error("An error occurred during deck generation:",o),[]}}function Wt(t){if(typeof structuredClone=="function")try{return structuredClone(t)}catch(s){console.error("structuredClone failed, falling back to manual sanitization.",s)}const n={};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s];typeof r=="object"&&r!==null?Array.isArray(r)?n[s]=r.map(i=>Wt(i)):n[s]=Wt(r):typeof r!="function"&&(n[s]=r)}return n}async function qt(t,n,s){const i=t[s].some(u=>u.guid===n)?"remove":"add",o=new Date().toISOString(),a=s==="read"?{guid:n,readAt:o}:{guid:n,starredAt:o};await bn(s,a,i==="add"),i==="add"?s==="read"?t.read=[...t.read,a]:t.starred=[...t.starred,a]:s==="read"?t.read=t.read.filter(u=>u.guid!==n):t.starred=t.starred.filter(u=>u.guid!==n),typeof t.updateCounts=="function"&&t.updateCounts();const c={type:`${s}Delta`,guid:n,action:i,timestamp:o};await j(c)}async function ur(t,n,s){if(!Array.isArray(n))return[];if(!Array.isArray(t)||t.length===0)return n;const r=new Set(t.filter(o=>o&&o.guid).map(o=>String(o.guid).trim().toLowerCase())),i=720*60*60*1e3;return n.filter(o=>{if(!o||!o.guid)return!1;const a=String(o.guid).trim().toLowerCase();if(r.has(a))return!0;if(o.readAt){const l=new Date(o.readAt).getTime();if(!isNaN(l))return s-l<i}return!0})}async function dr(t){const{value:n}=await re("read");let s=!1,r=[];if(Array.isArray(n)){const o=new Date().toISOString();for(const a of n)typeof a=="string"&&a?(r.push({guid:a,readAt:o}),s=!0):typeof a=="object"&&a!==null&&typeof a.guid=="string"&&a.guid&&(a.readAt||(a.readAt=o,s=!0),r.push(a))}const i=await ur(t,r,Date.now());if(i.length!==r.length&&(s=!0),s)try{await ye("read",i),console.log(`Sanitized, pruned, or migrated read items. Original count: ${n.length}, New count: ${i.length}`)}catch(o){console.error("Error saving pruned read items:",o)}return i}async function fr(){const{value:t}=await re("currentDeckGuids");if(t&&t.length>0&&typeof t[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const s=new Date().toISOString(),r=t.map(i=>({guid:i,addedAt:s}));return await ye("currentDeckGuids",r),console.log(`[loadCurrentDeck] Migration complete. Loaded ${r.length} objects.`),r}const n=Array.isArray(t)?t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid):[];return console.log(`[loadCurrentDeck] Loaded ${n.length} deck objects.`),n}async function hr(t){if(!Array.isArray(t)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const n=t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid);n.length!==t.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",n.length,"deck objects.");try{const s=n.map(r=>Wt(r));await ct("currentDeckGuids",s)}catch(s){console.error("[saveCurrentDeck] An error occurred while saving the deck:",s)}}async function gr(){const{value:t}=await A("shuffleCount"),{value:n}=await A("lastShuffleResetDate");return{shuffleCount:typeof t=="number"?t:2,lastShuffleResetDate:n||null}}async function tt(t,n){await G("shuffleCount",t),await G("lastShuffleResetDate",n),await j({type:"simpleUpdate",key:"shuffleCount",value:t,timestamp:new Date().toISOString()}),await j({type:"simpleUpdate",key:"lastShuffleResetDate",value:n,timestamp:new Date().toISOString()})}async function pr(t,n){t.filterMode=n,await G("filterMode",n),await j({type:"simpleUpdate",key:"filterMode",value:n,timestamp:new Date().toISOString()})}async function yr(){const{value:t}=await A("filterMode");return t||"unread"}const Jt=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:dr,loadCurrentDeck:fr,loadFilterMode:yr,loadShuffleState:gr,pruneStaleRead:ur,saveCurrentDeck:hr,saveShuffleState:tt,setFilterMode:pr,toggleItemStateAndSync:qt},Symbol.toStringTag,{value:"Module"})),Qo=()=>document.getElementById("sync-toggle"),Xo=()=>document.getElementById("images-toggle"),Zo=()=>document.getElementById("open-urls-in-new-tab-toggle"),ea=()=>document.getElementById("shadows-toggle"),ta=()=>document.getElementById("shuffle-count-display"),na=()=>document.getElementById("filter-selector"),sa=()=>document.querySelector("#ntn-title h2");function ra(t,n=30){const s=t.split(" ");let r=[],i=[],o=0;for(const a of s){const l=a.length+(r.length>0?1:0);o+l<=n?(r.push(a),o+=l):i.push(a)}return[r.join(" "),i.join(" ")].filter(Boolean)}async function ia(t){const n=sa();if(!n){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const s="NOT THE NEWS",r=ra(t),i=n.style.overflow;n.style.overflow="visible";const o=a=>new Promise(l=>setTimeout(l,a));r.length>0&&(n.textContent=r[0],await o(1500)),r.length>1?(n.textContent=r.join(" "),await o(1500)):r.length===1&&await o(1500),n.textContent=s,n.style.overflow=i}let kt;function v(t,n){console.log(`[Status] ${n}`),kt&&clearTimeout(kt),t.syncStatusMessage=n;const s=()=>{t.showSyncStatus=!0,kt=setTimeout(()=>{t.showSyncStatus=!1,setTimeout(()=>{t.showSyncStatus||(t.syncStatusMessage="")},300)},5e3)};t.$nextTick?t.$nextTick(s):s()}let Et;function oa(t,n,s=null){Et&&clearTimeout(Et),t.undoItemGuid=n,t.undoItemIndex=s,t.showUndo=!0,t.undoTimerActive=!1;const r=()=>{t.undoTimerActive=!0,Et=setTimeout(()=>{t.showUndo=!1,t.undoTimerActive=!1,setTimeout(()=>{t.showUndo||(t.undoItemGuid=null)},500)},5e3)};t.$nextTick?t.$nextTick(r):setTimeout(r,10)}function Kn(t){const n=document.getElementById("main-settings"),s=document.getElementById("rss-settings-block"),r=document.getElementById("keywords-settings-block"),i=document.getElementById("css-settings-block"),o=document.getElementById("advanced-settings-block");if(!n||!s||!r||!i||!o)return console.warn("One or more settings panels not found."),Promise.resolve();switch(n.style.display="none",s.style.display="none",r.style.display="none",i.style.display="none",o.style.display="none",t.modalView){case"main":n.style.display="block";break;case"rss":s.style.display="block";break;case"keywords":r.style.display="block";break;case"css":i.style.display="block";break;case"advanced":o.style.display="block";break;default:console.warn("Unknown modalView:",t.modalView),n.style.display="block"}return Promise.resolve()}async function aa(t){if(!t?.entries?.length||!t.read||!t.starred||!t.currentDeckGuids){console.warn("Attempted to update counts with an invalid app object. Skipping.");return}const n=new Set(t.read.map(h=>h.guid)),s=new Set(t.starred.map(h=>h.guid)),r=new Set(t.currentDeckGuids.map(h=>h.guid)),i=t.entries,o=i.length,a=i.filter(h=>n.has(h.guid)).length,l=i.filter(h=>s.has(h.guid)).length,c=i.filter(h=>r.has(h.guid)&&!n.has(h.guid)).length,u=na();if(!u)return;const d={all:o,read:a,starred:l,unread:c};Array.from(u.options).forEach(h=>{const g=h.text.split(" ")[0];h.text=`${g} (${d[h.value]??0})`})}function mr(){window.scrollTo({top:0,behavior:"smooth"})}const la=(()=>{let t,n=0;return(s="scroll-to-top")=>{const r=document.getElementById(s);if(!r)return;const i=()=>{const o=window.scrollY;r.classList.toggle("visible",o<n&&o>0),n=o,clearTimeout(t),t=setTimeout(()=>r.classList.remove("visible"),2e3)};window.addEventListener("scroll",i),r.addEventListener("click",o=>{o.preventDefault(),mr()})}})();async function At(){let t="",n=0;const s=document.querySelectorAll(".entry[data-guid]"),r=Array.from(s).find(i=>i.getBoundingClientRect().bottom>0);if(r){const i=r.getBoundingClientRect();t=r.dataset.guid||"",n=i.top}await G("lastViewedItemId",t),await G("lastViewedItemOffset",n)}const ca={syncEnabled:"Auto-Sync",imagesEnabled:"Images",openUrlsInNewTabEnabled:"Open in New Tab",shadowsEnabled:"Shadows"};async function ut(t,n,s,r=()=>{}){const i=n();i&&i.addEventListener("change",async()=>{const o=t[s];await G(s,o);const a=ca[s]||s;v(t,`${a} ${o?"Enabled":"Disabled"}.`),r(o)})}async function ua(t){await ut(t,Qo,"syncEnabled",async n=>{if(t.updateSyncStatusMessage?.(),n&&(v(t,"Kicking off a new sync"),console.log("Sync enabled, triggering full sync."),await _n(t)?v(t,"Sync complete!"):v(t,"Sync finished with some issues."),!t.currentDeckGuids?.length&&t.entries?.length)){console.log("Deck is empty after sync. Rebuilding from all available items.");const r=new Date().toISOString(),i=new Set(t.read?.map(a=>a.guid)),o=new Set(t.shuffledOutGuids?.map(a=>a.guid));t.currentDeckGuids=t.entries.filter(a=>!i.has(a.guid)&&!o.has(a.guid)).map(a=>({guid:a.guid,addedAt:r})),await ye("currentDeckGuids",t.currentDeckGuids),console.log(`Rebuilt deck with ${t.currentDeckGuids.length} items.`)}})}async function da(t){await ut(t,Xo,"imagesEnabled")}async function fa(t){await ut(t,ea,"shadowsEnabled")}async function ha(t){await ut(t,Zo,"openUrlsInNewTabEnabled")}async function ga(t){window.requestAnimationFrame(async()=>{const{value:n}=await A("lastViewedItemId"),{value:s}=await A("lastViewedItemOffset");if(!n||!t.deck?.length)return;if(t.deck.some(i=>i.guid===n)){const i=document.querySelector(`.entry[data-guid="${n}"]`);i&&(i.scrollIntoView({behavior:"auto",block:"start"}),typeof s=="number"&&s!==0&&window.scrollTo({top:window.scrollY-s,behavior:"auto"}))}})}let Ve;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),Ve=t;const n=document.getElementById("install-button");n&&(n.style.display="block",n.addEventListener("click",()=>{Ve.prompt(),Ve.userChoice.then(s=>{s.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),Ve=null})}))});const Ke=2,Se=t=>typeof t=="object"&&t.guid?t.guid:t,qe=async(t,n,s,r,i,o="unread",a=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:t.length,readItemsCount:n.length,starredItemsCount:s.length,shuffledOutItemsCount:r.length,shuffleCount:i,filterMode:o,lastShuffleResetDate:a}),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),!Array.isArray(t)||t.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),console.log("manageDailyDeck: END (skipped)"),{deck:[],currentDeckGuids:[],shuffledOutGuids:Array.isArray(r)?r:[],shuffleCount:typeof i=="number"?i:Ke,lastShuffleResetDate:typeof a=="string"?a:new Date().toDateString()};const l=t,c=Array.isArray(n)?n:[],u=Array.isArray(s)?s:[],d=Array.isArray(r)?r:[],{loadCurrentDeck:h}=await P(async()=>{const{loadCurrentDeck:D}=await Promise.resolve().then(()=>Jt);return{loadCurrentDeck:D}},void 0),g=await h();console.log("manageDailyDeck: Loaded currentDeckItems count:",g.length);const w=new Set(c.map(Se)),b=new Set(u.map(Se)),S=new Set(d.map(Se)),f=new Map(t.map(D=>[D.guid,D]));let p=g.map(D=>f.get(Se(D))).filter(D=>!!D);const y=new Date().toDateString(),_=a!==y,O=!g||g.length===0||p.length===0,T=O||p.every(D=>w.has(D.guid)||S.has(D.guid)),F=!O&&p.every(D=>w.has(D.guid)),Y=!O&&p.every(D=>S.has(D.guid));console.log("manageDailyDeck: Deck Status:",{isDeckEmpty:O,isDeckEffectivelyEmpty:T,allItemsInDeckRead:F,allItemsInDeckShuffled:Y,existingDeckCount:p.length,currentDeckItemsCount:g.length});let V=p,m=g,B=d,E=typeof i=="number"?i:Ke,K=a||y;if(console.log("manageDailyDeck: Condition check:",{isNewDay:_,isDeckEffectivelyEmpty:T,filterModeIsNotUnread:o!=="unread",entriesCount:t.length}),_||T||o!=="unread"||g.length===0&&t.length>0){console.log(`[deckManager] Resetting deck. Reason: New Day (${_}), Deck Effectively Empty (${T}), Filter Mode Changed (${o}), or Initial Load (${g.length===0}).`),!_&&g.length>0&&T&&o==="unread"&&(Y||(console.log("[deckManager] Automatically incrementing (refunding) shuffleCount due to deck cleared by reading."),E++,await tt(E,K)));const D=await Yo(l,c,u,d,o);console.log("manageDailyDeck: generateNewDeck returned count:",D.length);const dt=new Date().toISOString();m=(D||[]).map(oe=>({guid:oe.guid,addedAt:dt})),V=(D||[]).map(oe=>({...oe,isRead:w.has(oe.guid),isStarred:b.has(oe.guid)})),await hr(m),_&&(B=[],await ye("shuffledOutGuids",[]),E=Ke,await tt(E,y),K=y,await G("lastShuffleResetDate",y))}else V=p.map(D=>({...D,isRead:w.has(D.guid),isStarred:b.has(D.guid)}));return console.log(`[deckManager] Deck management complete. Final deck size: ${V.length}.`),console.log("manageDailyDeck: END"),{deck:V||[],currentDeckGuids:m||[],shuffledOutGuids:B||[],shuffleCount:typeof E=="number"?E:Ke,lastShuffleResetDate:typeof K=="string"?K:new Date().toDateString()}};async function pa(t){if(console.log("[deckManager] processShuffle called."),t.shuffleCount<=0){v(t,"No shuffles left for today!");return}const n=t.deck.map(d=>d.guid);console.log(`[deckManager] processShuffle: Visible GUIDs to shuffle out: ${n.length}`,n);const s=(t.shuffledOutGuids||[]).map(Se).map(d=>({guid:d,shuffledAt:new Date().toISOString()})),r=new Set(s.map(Se)),i=new Set([...r,...n]),o=new Date().toISOString(),a=Array.from(i).map(d=>({guid:d,shuffledAt:o}));t.shuffledOutGuids=a,t.shuffleCount--;const{overwriteArrayAndSyncChanges:l}=await P(async()=>{const{overwriteArrayAndSyncChanges:d}=await Promise.resolve().then(()=>Z);return{overwriteArrayAndSyncChanges:d}},void 0);await l("shuffledOutGuids",a),await tt(t.shuffleCount,t.lastShuffleResetDate??new Date().toDateString());const c=ta();c&&(c.textContent=t.shuffleCount.toString());const u=await qe(t.entries,t.read,t.starred,t.shuffledOutGuids,t.shuffleCount,t.filterMode,t.lastShuffleResetDate);t.deck=u.deck,t.currentDeckGuids=u.currentDeckGuids,t.shuffledOutGuids=u.shuffledOutGuids,t.shuffleCount=u.shuffleCount,t.lastShuffleResetDate=u.lastShuffleResetDate,ia("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${t.shuffleCount}.`)}async function wr(t,n){const s=t.target;if(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable)return;const i=t.key,o=t.ctrlKey||t.metaKey;if(n.openShortcuts&&i!=="?"&&i!=="Escape"&&!(i==="k"&&o)){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," ","j","k"].includes(i)&&t.preventDefault();return}switch(i){case"j":case"ArrowDown":t.preventDefault(),await It(n,1);break;case"k":o?(t.preventDefault(),n.openShortcuts?n.openShortcuts=!1:n.openShortcuts=!0):(t.preventDefault(),await It(n,-1));break;case"ArrowUp":t.preventDefault(),await It(n,-1);break;case" ":case"n":e.preventDefault(),n.selectedGuid?await n.toggleRead(n.selectedGuid):n.filteredEntries.length>0&&(n.selectedGuid=n.filteredEntries[0].guid,vn(n.selectedGuid,n));break;case"s":case"L":n.selectedGuid&&(t.preventDefault(),await n.toggleStar(n.selectedGuid));break;case"i":t.preventDefault(),n.imagesEnabled=!n.imagesEnabled,v(n,`Images ${n.imagesEnabled?"Enabled":"Disabled"}.`),P(()=>Promise.resolve().then(()=>qo),void 0).then(a=>{a.saveSimpleState("imagesEnabled",n.imagesEnabled)});break;case"o":case"Enter":if(n.selectedGuid){t.preventDefault();const a=n.filteredEntries.find(l=>l.guid===n.selectedGuid);a?.link&&window.open(a.link,"_blank","noopener,noreferrer")}break;case"r":case"m":n.selectedGuid&&(t.preventDefault(),await n.toggleRead(n.selectedGuid));break;case"t":t.preventDefault(),n.scrollToTop();break;case"u":t.preventDefault(),await n.undoMarkRead();break;case"?":t.preventDefault(),n.openShortcuts?n.openShortcuts=!1:n.openShortcuts=!0;break;case"Escape":n.openShortcuts?(t.preventDefault(),n.openShortcuts=!1):n.openSettings?(t.preventDefault(),n.openSettings=!1):n.selectedGuid&&(t.preventDefault(),n.selectedGuid=null);break;case"z":o&&(t.preventDefault(),await n.undoMarkRead());break}}async function It(t,n){const s=t.filteredEntries;if(s.length!==0){if(t.selectedGuid){let i=s.findIndex(o=>o.guid===t.selectedGuid)+n;i>=s.length&&(i=s.length-1),i<0&&(i=0),t.selectedGuid=s[i].guid}else{const r=t.lastSelectedGuid,i=r?s.findIndex(o=>o.guid===r):-1;if(i===-1)t.selectedGuid=s[0].guid;else{let o=i+n;o>=s.length&&(o=s.length-1),o<0&&(o=0),t.selectedGuid=s[o].guid}}vn(t.selectedGuid,t)}}function vn(t,n){if(t){if(n.filteredEntries.length>0&&n.filteredEntries[0].guid===t){n.scrollToTop();return}setTimeout(()=>{const s=document.querySelector(`.entry[data-guid="${t}"]`);if(s){const r=document.querySelector("#header"),i=r?r.getBoundingClientRect().height:0,a=s.getBoundingClientRect().top+window.pageYOffset-i-20;window.scrollTo({top:a,behavior:"smooth"})}},10)}}const ya=Object.freeze(Object.defineProperty({__proto__:null,handleKeyboardShortcuts:wr,scrollSelectedIntoView:vn},Symbol.toStringTag,{value:"Module"}));function ma(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,openShortcuts:!1,modalView:"main",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,openUrlsInNewTabEnabled:!0,shadowsEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutGuids:[],errorMessage:"",isOnline:q(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",themeStyle:"original",themeStyleLight:"original",themeStyleDark:"original",customCss:"",fontSize:100,showUndo:!1,undoTimerActive:!1,undoItemGuid:null,undoItemIndex:null,selectedGuid:null,lastSelectedGuid:null,starredGuid:null,readingGuid:null,_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,imageObserver:null,db:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,lastShuffleResetDate:null,initApp:async function(){try{if(this.progressMessage="Connecting to database...",this.db=await et(),this.progressMessage="Loading settings...",await this._loadInitialState(),this._initImageObserver(),this.isOnline){this.progressMessage="Syncing latest content...",await le(),await W();const t=await we(this);await this._loadAndManageAllData(),t?v(this,"Initial sync complete!"):v(this,"Sync finished with some issues. Check console for details.")}else this.progressMessage="Offline mode. Loading local data...",await this._loadAndManageAllData();this.progressMessage="Applying user preferences...",ua(this),da(this),fa(this),ha(this),la(),this.$nextTick(()=>{ga(this)}),this.progressMessage="Setting up app watchers...",this._setupWatchers(),this._setupEventListeners(),this._startPeriodicSync(),this._initScrollObserver(),this._initObservers(),this.deck.length===0&&(this.entries.length>0?this.progressMessage="Fetching and building your feed...":this.progressMessage="No feed items found. Please configure your RSS feeds.",await new Promise(t=>setTimeout(t,1e3))),this.loading=!1,await this.updateSyncStatusMessage()}catch(t){console.error("Initialization failed:",t),this.errorMessage=`Could not load feed: ${t.message}`,this.progressMessage=`Error: ${t.message}`,v(this,`Could not load feed: ${t.message}`)}},performBackgroundSync:async function(){if(!(!this.syncEnabled||!this.isOnline)){console.log("Performing immediate background sync..."),this.progressMessage="Syncing...",this.loading=!0;try{await le();const t=await we(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,this.progressMessage="",this.loading=!1,console.log("Immediate background sync complete."),t?v(this,"Sync complete!"):v(this,"Sync finished with errors.")}catch(t){console.error("Immediate background sync failed:",t),this.progressMessage="Sync Failed!",this.loading=!1,v(this,`Sync failed: ${t.message}`)}}},updateSyncStatusMessage:async function(){q()?this.syncEnabled?(this.showSyncStatus=!1,this.syncStatusMessage=""):(this.syncStatusMessage="Sync is disabled.",this.showSyncStatus=!0):(this.syncStatusMessage="Offline.",this.showSyncStatus=!0)},loadAndDisplayDeck:async function(){let t=this.currentDeckGuids;Array.isArray(t)||(t=[]),console.log(`[loadAndDisplayDeck] Processing ${t.length} GUIDs for display`),console.log(`[loadAndDisplayDeck] feedItems contains ${Object.keys(this.feedItems).length} items`);const n=[],s=new Set(this.read.map(l=>l.guid)),r=new Set(this.starred.map(l=>l.guid)),i=new Set;let o=0,a=0;for(const l of t){const c=l.guid;if(typeof c!="string"||!c)continue;const u=this.feedItems[c];if(u&&u.guid&&!i.has(u.guid)){const d=cr(u,zn);d&&(d.isRead=s.has(d.guid),d.isStarred=r.has(d.guid),n.push(d),i.add(d.guid),o++)}else a++,a<=3&&console.log(`[loadAndDisplayDeck] MISSING: GUID ${c} not found in feedItems`)}console.log(`[loadAndDisplayDeck] Found ${o} items, Missing ${a} items`),this.deck=Array.isArray(n)?n:[],console.log(`[loadAndDisplayDeck] Final deck size: ${this.deck.length}`)},loadFeedItemsFromDB:async function(){if(!this.db){this.entries=[],this.feedItems={};return}const t=await Sn();this.feedItems={};const n=[],s=new Set;t.forEach(r=>{r&&r.guid&&!s.has(r.guid)&&(this.feedItems[r.guid]=r,n.push(r),s.add(r.guid))}),this.entries=Jo(n,zn)||[]},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const t=this.deck.length>0?this.deck[0].guid.substring(0,8):"empty",n=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}-${t}`;if(this.entries.length>0&&n===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let s=[];const r=new Map(this.read.map(a=>[a.guid,a.readAt])),i=new Map(this.starred.map(a=>[a.guid,a.starredAt]));switch(this.filterMode){case"unread":s=this.deck.filter(a=>!r.has(a.guid));break;case"all":s=this.entries;break;case"read":s=this.entries.filter(a=>r.has(a.guid)).sort((a,l)=>new Date(r.get(l.guid)||0).getTime()-new Date(r.get(a.guid)||0).getTime());break;case"starred":s=this.entries.filter(a=>i.has(a.guid)).sort((a,l)=>new Date(i.get(l.guid)||0).getTime()-new Date(i.get(a.guid)||0).getTime());break}s=s.map(a=>({...a,isRead:r.has(a.guid),isStarred:i.has(a.guid)}));const o=(this.keywordBlacklistInput??"").split(/\r?\n/).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0);return o.length>0&&(s=s.filter(a=>{const l=`${a.title} ${a.description}`.toLowerCase();return!o.some(c=>l.includes(c))})),this._cachedFilteredEntries=s,this._lastFilterHash=n,s},isStarred:function(t){return this.starred.some(n=>n.guid===t)},isRead:function(t){return this.read.some(n=>n.guid===t)},toggleStar:async function(t){!this.starred.some(s=>s.guid===t)&&(this.starredGuid=t,setTimeout(()=>{this.starredGuid===t&&(this.starredGuid=null)},1e3)),await qt(this,t,"starred")},toggleRead:async function(t){const n=this.isRead(t),s=this.selectedGuid===t;let r=null;if(!n&&s&&this.filterMode==="unread"){const o=this.filteredEntries.findIndex(a=>a.guid===t);o!==-1&&o<this.filteredEntries.length-1&&(r=this.filteredEntries[o+1].guid)}n||(this.readingGuid=t,await new Promise(o=>setTimeout(o,500)),this.readingGuid=null);let i=null;if(await qt(this,t,"read"),this.deck=this.deck.map(o=>o.guid===t?{...o,isRead:!n}:o),this.entries=this.entries.map(o=>o.guid===t?{...o,isRead:!n}:o),this.filterMode==="unread"&&!n){i=this.currentDeckGuids.findIndex(a=>a.guid===t),i===-1&&(i=null),this.deck=this.deck.filter(a=>a.guid!==t),this.currentDeckGuids=this.currentDeckGuids.filter(a=>a.guid!==t);const{saveCurrentDeck:o}=await P(async()=>{const{saveCurrentDeck:a}=await Promise.resolve().then(()=>Jt);return{saveCurrentDeck:a}},void 0);await o(this.currentDeckGuids),r?this.$nextTick(()=>{this.selectItem(r)}):s&&(this.selectedGuid=null)}else if(this.filterMode==="unread"&&n&&!this.currentDeckGuids.some(o=>o.guid===t)){const o={guid:t,addedAt:new Date().toISOString()};this.undoItemIndex!==null&&this.undoItemIndex>=0?this.currentDeckGuids.splice(this.undoItemIndex,0,o):this.currentDeckGuids.push(o);const{saveCurrentDeck:a}=await P(async()=>{const{saveCurrentDeck:l}=await Promise.resolve().then(()=>Jt);return{saveCurrentDeck:l}},void 0);await a(this.currentDeckGuids)}if(this.updateCounts(),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage(),!n&&this.filterMode!=="all"&&oa(this,t,i),this.filterMode==="unread"&&this.deck.length===0){console.log("[toggleRead] Deck is empty, initiating refresh process."),this.progressMessage="Generating new deck...",this.loading=!0;try{await this._loadAndManageAllData(),this.deck=[...this.deck]}catch(o){console.error("[toggleRead] Error during deck refresh:",o)}finally{this.loading=!1,this.progressMessage=""}console.log("[toggleRead] Deck refresh process completed. Deck size:",this.deck.length)}},undoMarkRead:async function(){if(!this.undoItemGuid)return;const t=this.undoItemGuid;this.showUndo=!1,await this.toggleRead(t),this.undoItemGuid=null,this.undoItemIndex=null},selectItem:function(t){if(this.selectedGuid===t){this.openShortcuts&&(this.openShortcuts=!1);return}this.selectedGuid=t,this.openShortcuts&&(this.openShortcuts=!1),P(()=>Promise.resolve().then(()=>ya),void 0).then(n=>{n.scrollSelectedIntoView(t,this)})},processShuffle:async function(){await pa(this),this.updateCounts()},loadRssFeeds:async function(){try{const t=await A("rssFeeds");this.rssFeedsInput=Dt(t.value).join(`
`)}catch(t){console.error("Error loading RSS feeds:",t)}},loadKeywordBlacklist:async function(){const{loadSimpleState:t}=await P(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>Z);return{loadSimpleState:s}},void 0),{value:n}=await t("keywordBlacklist");this.keywordBlacklistInput=Array.isArray(n)?n.join(`
`):""},loadCustomCss:async function(){const{loadSimpleState:t}=await P(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>Z);return{loadSimpleState:s}},void 0),{value:n}=await t("customCss");this.customCss=typeof n=="string"&&n.trim()!==""?n:this.generateCustomCssTemplate(),this.applyCustomCss()},saveRssFeeds:async function(){const t=this.rssFeedsInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean);try{await G("rssFeeds",t),this.rssFeedsInput=t.join(`
`),v(this,"RSS Feeds saved!"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...";const n=await _n(this);await this.loadFeedItemsFromDB();const s=await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=s.deck,this.currentDeckGuids=s.currentDeckGuids,this.shuffledOutGuids=s.shuffledOutGuids,this.shuffleCount=s.shuffleCount,this.lastShuffleResetDate=s.lastShuffleResetDate,await this.loadAndDisplayDeck(),this.progressMessage="",this.loading=!1,n||v(this,"Feeds saved, but sync finished with errors.")}catch(n){console.error("Error saving RSS feeds:",n),v(this,`Failed to save RSS feeds: ${n.message}`),this.loading=!1}},saveKeywordBlacklist:async function(){const t=this.keywordBlacklistInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean).sort();try{await G("keywordBlacklist",t),this.keywordBlacklistInput=t.join(`
`),v(this,"Keyword Blacklist saved!"),this.updateCounts()}catch(n){console.error("Error saving keyword blacklist:",n),v(this,`Failed to save keyword blacklist: ${n.message}`)}},saveCustomCss:async function(){try{await G("customCss",this.customCss),this.applyCustomCss(),v(this,"Custom CSS saved!")}catch(t){console.error("Error saving custom CSS:",t),v(this,`Failed to save custom CSS: ${t.message}`)}},resetCustomCss:async function(){confirm("Reset Custom CSS to default template? This will overwrite your current customizations.")&&(this.customCss=this.generateCustomCssTemplate(),await this.saveCustomCss(),v(this,"Custom CSS reset to template!"))},generateCustomCssTemplate:function(){const t=getComputedStyle(document.documentElement),n=["--bg","--fg","--primary","--secondary","--card-bg","--card-border","--card-shadow-color","--fg-muted","--border-radius"];let s=`/* Custom CSS Template - Current theme: ${this.theme} ${this.themeStyle} */
:root {
`;return n.forEach(r=>{const i=t.getPropertyValue(r).trim();i&&(s+=`  ${r}: ${i};
`)}),s+=`}

/* Add custom styles below */
`,s},applyCustomCss:function(){let t=document.getElementById("custom-user-css");t||(t=document.createElement("style"),t.id="custom-user-css",document.head.appendChild(t)),t.textContent=this.customCss},loadThemeStyle:async function(){const{loadSimpleState:t}=await P(async()=>{const{loadSimpleState:r}=await Promise.resolve().then(()=>Z);return{loadSimpleState:r}},void 0),[,n,s]=await Promise.all([t("themeStyle"),t("themeStyleLight"),t("themeStyleDark")]);this.themeStyleLight=typeof n.value=="string"?n.value:"original",this.themeStyleDark=typeof s.value=="string"?s.value:"original",this.theme==="light"?this.themeStyle=this.themeStyleLight:this.themeStyle=this.themeStyleDark,this.applyThemeStyle()},updateThemeAndStyle:async function(t,n){console.log(`Updating theme to ${n} and style to ${t}`),this.theme=n,this.themeStyle=t;const s=document.documentElement;s.classList.remove("light","dark"),s.classList.add(n),localStorage.setItem("theme",n);const{saveSimpleState:r}=await P(async()=>{const{saveSimpleState:i}=await Promise.resolve().then(()=>Z);return{saveSimpleState:i}},void 0);await r("theme",n),n==="light"?(this.themeStyleLight=t,await r("themeStyleLight",t)):(this.themeStyleDark=t,await r("themeStyleDark",t)),await r("themeStyle",t),this.applyThemeStyle(),v(this,`Theme set to ${n} (${t}).`)},saveThemeStyle:async function(){const{saveSimpleState:t}=await P(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>Z);return{saveSimpleState:n}},void 0);this.theme==="light"?(this.themeStyleLight=this.themeStyle,await t("themeStyleLight",this.themeStyleLight)):(this.themeStyleDark=this.themeStyle,await t("themeStyleDark",this.themeStyleDark)),await t("themeStyle",this.themeStyle),this.applyThemeStyle()},applyThemeStyle:function(){const t=document.documentElement;t.classList.remove("light","dark"),t.classList.add(this.theme);const n=Array.from(t.classList).filter(s=>s.startsWith("theme-"));t.classList.remove(...n),this.themeStyle!=="original"&&t.classList.add(`theme-${this.themeStyle}`)},loadFontSize:async function(){const{loadSimpleState:t}=await P(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>Z);return{loadSimpleState:s}},void 0),{value:n}=await t("fontSize");this.fontSize=typeof n=="number"?n:100,this.applyFontSize()},saveFontSize:async function(){const{saveSimpleState:t}=await P(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>Z);return{saveSimpleState:n}},void 0);await t("fontSize",this.fontSize),this.applyFontSize()},applyFontSize:function(){document.documentElement.style.setProperty("--font-scale",(this.fontSize/100).toString())},updateCounts:async function(){aa(this)},scrollToTop:function(){mr()},observeImage:function(t){this.imageObserver&&this.imageObserver.observe(t)},_initImageObserver:function(){this.imageObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(n.isIntersecting){const s=n.target;s.dataset.src&&(s.src=s.dataset.src,this.imageObserver?.unobserve(s))}})},{root:null,rootMargin:"50% 0px",threshold:.01})},resetApplicationData:async function(){console.log("resetApplicationData called.");const t=confirm("Are you sure you want to reset the application? This will clear all local data, cache, and unregister the service worker.");if(console.log("User confirmed reset:",t),!t){console.log("Reset cancelled by user.");return}this.loading=!0,this.progressMessage="Resetting application data...";try{if(console.log("Closing database connection..."),await ir(),console.log("Unregistering service workers..."),"serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations();for(const r of s)await r.unregister(),console.log("Service Worker unregistered:",r.scope)}console.log("Service workers unregistered."),console.log("Clearing feed and progress IndexedDB object stores...");try{const s=await et(),r=["read","starred","currentDeckGuids","shuffledOutGuids","feedItems","pendingOperations"],i=s.transaction([...r,"userSettings"],"readwrite");await Promise.all(r.map(a=>(console.log(`Clearing object store: ${a}`),i.objectStore(a).clear()))),console.log("Clearing sync metadata from userSettings...");const o=i.objectStore("userSettings");await Promise.all([o.delete("lastFeedSync"),o.delete("lastStateSync")]),await i.done,console.log("Specific IndexedDB object stores and sync metadata cleared.")}catch(s){console.error("Error clearing IndexedDB stores:",s)}console.log("localStorage is preserved."),console.log("DEBUG: About to make fetch call to /api/admin/reset-app");const n=await fetch("/api/admin/reset-app",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to reset backend data.")}console.log("Backend application data reset successfully."),v(this,"Application reset complete! Reloading..."),await W(!0),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error during application reset:",n),this.errorMessage=`Failed to reset application: ${n.message}`,v(this,`Failed to reset application: ${n.message}`),this.loading=!1}},backupConfig:async function(){console.log("backupConfig called.");try{this.progressMessage="Fetching configuration for backup...",console.log("Fetching config for backup from:","/api/admin/config-backup");const t=await fetch("/api/admin/config-backup",{method:"GET",credentials:"include"});if(!t.ok){const o=await t.json();throw new Error(o.message||"Failed to fetch config for backup.")}const n=await t.json(),s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`not-the-news-config-backup-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),v(this,"Configuration backed up successfully!")}catch(t){console.error("Error during config backup:",t),v(this,`Failed to backup configuration: ${t.message}`)}finally{this.progressMessage=""}},restoreConfig:async function(t){if(!confirm("Are you sure you want to restore configuration? This will overwrite your current settings and reload the application."))return;const n=t.target.files?.[0];if(!n){v(this,"No file selected for restoration.");return}this.loading=!0,this.progressMessage="Restoring configuration...";try{const s=await new Promise((o,a)=>{const l=new FileReader;l.onload=c=>o(c.target?.result),l.onerror=c=>a(c),l.readAsText(n)}),r=JSON.parse(s),i=await fetch("/api/admin/config-restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"});if(!i.ok){const o=await i.json();throw new Error(o.message||"Failed to restore backend data.")}console.log("Backend configuration restored successfully."),v(this,"Configuration restored successfully! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(s){console.error("Error during config restoration:",s),v(this,`Failed to restore configuration: ${s.message}`),this.loading=!1}finally{t.target.value=""}},_loadInitialState:async function(){try{const[t,n,s,r,i]=await Promise.all([A("syncEnabled"),A("imagesEnabled"),A("openUrlsInNewTabEnabled"),yr(),A("theme")]);this.syncEnabled=t.value??!0,this.imagesEnabled=n.value??!0,this.openUrlsInNewTabEnabled=s.value??!0,this.filterMode=r,this.theme=i.value??"dark",localStorage.setItem("theme",this.theme),this.isOnline=q();const[o,a]=await Promise.all([A("rssFeeds"),A("keywordBlacklist")]);this.rssFeedsInput=Dt(o.value).join(`
`),this.keywordBlacklistInput=Array.isArray(a.value)?a.value.join(`
`):"",await this.loadCustomCss(),await this.loadThemeStyle(),await this.loadFontSize()}catch(t){console.error("Error loading initial state:",t),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){console.log("_loadAndManageAllData: START"),this.progressMessage="Loading saved feed items...",await this.loadFeedItemsFromDB(),console.log(`_loadAndManageAllData: After loadFeedItemsFromDB. Entries: ${this.entries.length}`),this.progressMessage="Loading user state from storage...";const[t,n,s,r]=await Promise.all([re("starred"),re("shuffledOutGuids"),fr(),gr()]);console.log("_loadAndManageAllData: Loaded starred state:",t.value),this.starred=Array.isArray(t.value)?t.value:[],this.shuffledOutGuids=Array.isArray(n.value)?n.value:[],this.currentDeckGuids=Array.isArray(s)?s:[],console.log("_loadAndManageAllData: Loaded currentDeckGuids:",this.currentDeckGuids.slice(0,3),typeof this.currentDeckGuids[0]),this.shuffleCount=r.shuffleCount,this.lastShuffleResetDate=r.lastShuffleResetDate,this.progressMessage="Pruning read items...",this.read=await dr(Object.values(this.feedItems)),console.log(`_loadAndManageAllData: After loadAndPruneReadItems. Read count: ${this.read.length}`),console.log("[deckManager] Starting deck management with all data loaded."),this.progressMessage="Organizing your deck...",console.log("_loadAndManageAllData: Before manageDailyDeck",{readCount:this.read.length,currentDeckGuidsCount:this.currentDeckGuids.length,shuffleCount:this.shuffleCount});const i=await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=i.deck,this.currentDeckGuids=i.currentDeckGuids,this.shuffledOutGuids=i.shuffledOutGuids,this.shuffleCount=i.shuffleCount,this.lastShuffleResetDate=i.lastShuffleResetDate,console.log("_loadAndManageAllData: After manageDailyDeck. Deck size:",this.deck.length),this.progressMessage="Displaying your feed...",await this.loadAndDisplayDeck(),console.log("_loadAndManageAllData: After loadAndDisplayDeck. Final Deck size:",this.deck.length),this.updateAllUI(),console.log("_loadAndManageAllData: END")},updateAllUI:async function(){await this.updateCounts()},_reconcileAndRefreshUI:async function(){console.log("[UI] _reconcileAndRefreshUI: Initiating UI reconciliation and refresh."),await this.loadAndDisplayDeck(),this.updateAllUI(),console.log("[UI] _reconcileAndRefreshUI: Completed UI reconciliation and refresh.")},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(!n.isIntersecting){const s=n.target.dataset.guid;console.log(`[Observer] Stale item ${s} is off-screen. Removing.`),this.deck=this.deck.filter(r=>r.guid!==s),this.staleItemObserver?.unobserve(n.target)}})},{root:null,threshold:0})},_setupWatchers:function(){this.$watch("openShortcuts",async t=>{const n=window.innerWidth<1024;t?(n||document.body.classList.add("no-scroll"),await At()):(document.body.classList.remove("no-scroll"),document.body.style.overflow="")}),this.$watch("openSettings",async t=>{if(t){this.modalView="main",await Kn(this);const[n,s]=await Promise.all([A("rssFeeds"),A("keywordBlacklist")]);this.rssFeedsInput=Dt(n.value).join(`
`),Array.isArray(s.value)?this.keywordBlacklistInput=s.value.filter(Boolean).sort().join(`
`):typeof s.value=="string"?this.keywordBlacklistInput=s.value.split(/\r?\n/).filter(Boolean).sort().join(`
`):this.keywordBlacklistInput=""}else await At()}),this.$watch("openUrlsInNewTabEnabled",()=>{document.querySelectorAll(".itemdescription").forEach(t=>this.handleEntryLinks(t))}),this.$watch("modalView",async()=>Kn(this)),this.$watch("filterMode",async t=>{await pr(this,t),t==="unread"&&await qe(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate),this.scrollToTop()}),this.$watch("shadowsEnabled",t=>{document.body.classList.toggle("no-shadows",!t)}),document.body.classList.toggle("no-shadows",!this.shadowsEnabled),this.$watch("entries",()=>this.updateCounts()),this.$watch("read",()=>this.updateCounts()),this.$watch("starred",()=>this.updateCounts()),this.$watch("currentDeckGuids",()=>this.updateCounts()),this.$watch("selectedGuid",t=>{t&&(this.lastSelectedGuid=t)})},_setupEventListeners:function(){const t=async()=>{if(!this.syncEnabled||!this.isOnline)return;console.log("Performing periodic background sync..."),await le();const s=await we(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Background sync complete. Success: ${s}`)};window.addEventListener("online",async()=>{if(this.isOnline=!0,await this.updateSyncStatusMessage(),this.syncEnabled)try{await le(),await t()}catch(s){console.error("Error handling online event:",s)}}),window.addEventListener("offline",async()=>{this.isOnline=!1,await this.updateSyncStatusMessage()});let n;window.addEventListener("scroll",()=>{clearTimeout(n),n=setTimeout(()=>{At()},1e3)},{passive:!0}),window.addEventListener("keydown",s=>{wr(s,this)})},_startPeriodicSync:function(){let t=Date.now();const n=()=>t=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(i=>{document.addEventListener(i,n,!0),i==="focus"&&window.addEventListener(i,n,!0),i==="visibilitychange"&&document.addEventListener(i,n,!0)});const s=300*1e3,r=60*1e3;setInterval(async()=>{const i=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||i-t>r)){console.log("Starting scheduled background sync...");try{await le();const o=await we(this);await W(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Scheduled sync complete. Success: ${o}`)}catch(o){console.error("Periodic sync failed:",o)}}},s)},_initScrollObserver:function(){const t=new IntersectionObserver(async()=>{},{root:document.querySelector("#feed-container"),rootMargin:"0px",threshold:.1}),n=document.querySelector("#feed-container");if(!n)return;const s=()=>{n.querySelectorAll("[data-guid]").forEach(i=>{t.observe(i)})};s(),new MutationObserver(()=>{t.disconnect(),s()}).observe(n,{childList:!0,subtree:!0}),this.scrollObserver=t},handleEntryLinks:function(t){if(!t)return;t.querySelectorAll("a").forEach(s=>{s.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(s.setAttribute("target","_blank"),s.setAttribute("rel","noopener noreferrer")):s.removeAttribute("target"))})},$nextTick:function(t){return Ze.nextTick(t)},$watch:function(t,n){return Ze.watch(this,t,n)}}}Ze.data("rssApp",ma);Ze.start();
