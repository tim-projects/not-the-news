/* empty css              */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var yt=!1,wt=!1,ee=[],_t=-1;function ui(e){di(e)}function di(e){ee.includes(e)||ee.push(e),hi()}function fi(e){let t=ee.indexOf(e);t!==-1&&t>_t&&ee.splice(t,1)}function hi(){!wt&&!yt&&(yt=!0,queueMicrotask(gi))}function gi(){yt=!1,wt=!0;for(let e=0;e<ee.length;e++)ee[e](),_t=e;ee.length=0,_t=-1,wt=!1}var he,oe,ge,Tn,bt=!0;function pi(e){bt=!1,e(),bt=!0}function mi(e){he=e.reactive,ge=e.release,oe=t=>e.effect(t,{scheduler:n=>{bt?ui(n):n()}}),Tn=e.raw}function cn(e){oe=e}function yi(e){let t=()=>{};return[r=>{let s=oe(r);return e._x_effects||(e._x_effects=new Set,e._x_runEffects=()=>{e._x_effects.forEach(i=>i())}),e._x_effects.add(s),t=()=>{s!==void 0&&(e._x_effects.delete(s),ge(s))},s},()=>{t()}]}function $n(e,t){let n=!0,r,s=oe(()=>{let i=e();JSON.stringify(i),n?r=i:queueMicrotask(()=>{t(i,r),r=i}),n=!1});return()=>ge(s)}var Mn=[],Bn=[],Rn=[];function wi(e){Rn.push(e)}function Gt(e,t){typeof t=="function"?(e._x_cleanups||(e._x_cleanups=[]),e._x_cleanups.push(t)):(t=e,Bn.push(t))}function Pn(e){Mn.push(e)}function Nn(e,t,n){e._x_attributeCleanups||(e._x_attributeCleanups={}),e._x_attributeCleanups[t]||(e._x_attributeCleanups[t]=[]),e._x_attributeCleanups[t].push(n)}function Ln(e,t){e._x_attributeCleanups&&Object.entries(e._x_attributeCleanups).forEach(([n,r])=>{(t===void 0||t.includes(n))&&(r.forEach(s=>s()),delete e._x_attributeCleanups[n])})}function _i(e){for(e._x_effects?.forEach(fi);e._x_cleanups?.length;)e._x_cleanups.pop()()}var Ut=new MutationObserver(qt),zt=!1;function Ht(){Ut.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),zt=!0}function jn(){bi(),Ut.disconnect(),zt=!1}var be=[];function bi(){let e=Ut.takeRecords();be.push(()=>e.length>0&&qt(e));let t=be.length;queueMicrotask(()=>{if(be.length===t)for(;be.length>0;)be.shift()()})}function k(e){if(!zt)return e();jn();let t=e();return Ht(),t}var Kt=!1,qe=[];function vi(){Kt=!0}function Si(){Kt=!1,qt(qe),qe=[]}function qt(e){if(Kt){qe=qe.concat(e);return}let t=[],n=new Set,r=new Map,s=new Map;for(let i=0;i<e.length;i++)if(!e[i].target._x_ignoreMutationObserver&&(e[i].type==="childList"&&(e[i].removedNodes.forEach(o=>{o.nodeType===1&&o._x_marker&&n.add(o)}),e[i].addedNodes.forEach(o=>{if(o.nodeType===1){if(n.has(o)){n.delete(o);return}o._x_marker||t.push(o)}})),e[i].type==="attributes")){let o=e[i].target,a=e[i].attributeName,l=e[i].oldValue,c=()=>{r.has(o)||r.set(o,[]),r.get(o).push({name:a,value:o.getAttribute(a)})},u=()=>{s.has(o)||s.set(o,[]),s.get(o).push(a)};o.hasAttribute(a)&&l===null?c():o.hasAttribute(a)?(u(),c()):u()}s.forEach((i,o)=>{Ln(o,i)}),r.forEach((i,o)=>{Mn.forEach(a=>a(o,i))});for(let i of n)t.some(o=>o.contains(i))||Bn.forEach(o=>o(i));for(let i of t)i.isConnected&&Rn.forEach(o=>o(i));t=null,n=null,r=null,s=null}function Fn(e){return $e(ue(e))}function Te(e,t,n){return e._x_dataStack=[t,...ue(n||e)],()=>{e._x_dataStack=e._x_dataStack.filter(r=>r!==t)}}function ue(e){return e._x_dataStack?e._x_dataStack:typeof ShadowRoot=="function"&&e instanceof ShadowRoot?ue(e.host):e.parentNode?ue(e.parentNode):[]}function $e(e){return new Proxy({objects:e},Ei)}var Ei={ownKeys({objects:e}){return Array.from(new Set(e.flatMap(t=>Object.keys(t))))},has({objects:e},t){return t==Symbol.unscopables?!1:e.some(n=>Object.prototype.hasOwnProperty.call(n,t)||Reflect.has(n,t))},get({objects:e},t,n){return t=="toJSON"?Ii:Reflect.get(e.find(r=>Reflect.has(r,t))||{},t,n)},set({objects:e},t,n,r){const s=e.find(o=>Object.prototype.hasOwnProperty.call(o,t))||e[e.length-1],i=Object.getOwnPropertyDescriptor(s,t);return i?.set&&i?.get?i.set.call(r,n)||!0:Reflect.set(s,t,n)}};function Ii(){return Reflect.ownKeys(this).reduce((t,n)=>(t[n]=Reflect.get(this,n),t),{})}function Gn(e){let t=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,n=(r,s="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([i,{value:o,enumerable:a}])=>{if(a===!1||o===void 0||typeof o=="object"&&o!==null&&o.__v_skip)return;let l=s===""?i:`${s}.${i}`;typeof o=="object"&&o!==null&&o._x_interceptor?r[i]=o.initialize(e,l,i):t(o)&&o!==r&&!(o instanceof Element)&&n(o,l)})};return n(e)}function Un(e,t=()=>{}){let n={initialValue:void 0,_x_interceptor:!0,initialize(r,s,i){return e(this.initialValue,()=>Di(r,s),o=>vt(r,s,o),s,i)}};return t(n),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let s=n.initialize.bind(n);n.initialize=(i,o,a)=>{let l=r.initialize(i,o,a);return n.initialValue=l,s(i,o,a)}}else n.initialValue=r;return n}}function Di(e,t){return t.split(".").reduce((n,r)=>n[r],e)}function vt(e,t,n){if(typeof t=="string"&&(t=t.split(".")),t.length===1)e[t[0]]=n;else{if(t.length===0)throw error;return e[t[0]]||(e[t[0]]={}),vt(e[t[0]],t.slice(1),n)}}var zn={};function F(e,t){zn[e]=t}function St(e,t){let n=xi(t);return Object.entries(zn).forEach(([r,s])=>{Object.defineProperty(e,`$${r}`,{get(){return s(t,n)},enumerable:!1})}),e}function xi(e){let[t,n]=Jn(e),r={interceptor:Un,...t};return Gt(e,n),r}function ki(e,t,n,...r){try{return n(...r)}catch(s){Oe(s,e,t)}}function Oe(e,t,n=void 0){e=Object.assign(e??{message:"No error message given."},{el:t,expression:n}),console.warn(`Alpine Expression Error: ${e.message}

${n?'Expression: "'+n+`"

`:""}`,t),setTimeout(()=>{throw e},0)}var ze=!0;function Hn(e){let t=ze;ze=!1;let n=e();return ze=t,n}function te(e,t,n={}){let r;return T(e,t)(s=>r=s,n),r}function T(...e){return Kn(...e)}var Kn=qn;function Ai(e){Kn=e}function qn(e,t){let n={};St(n,e);let r=[n,...ue(e)],s=typeof t=="function"?Oi(r,t):Ti(r,t,e);return ki.bind(null,e,t,s)}function Oi(e,t){return(n=()=>{},{scope:r={},params:s=[]}={})=>{let i=t.apply($e([r,...e]),s);We(n,i)}}var st={};function Ci(e,t){if(st[e])return st[e];let n=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(e.trim())||/^(let|const)\s/.test(e.trim())?`(async()=>{ ${e} })()`:e,i=(()=>{try{let o=new n(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(o,"name",{value:`[Alpine] ${e}`}),o}catch(o){return Oe(o,t,e),Promise.resolve()}})();return st[e]=i,i}function Ti(e,t,n){let r=Ci(t,n);return(s=()=>{},{scope:i={},params:o=[]}={})=>{r.result=void 0,r.finished=!1;let a=$e([i,...e]);if(typeof r=="function"){let l=r(r,a).catch(c=>Oe(c,n,t));r.finished?(We(s,r.result,a,o,n),r.result=void 0):l.then(c=>{We(s,c,a,o,n)}).catch(c=>Oe(c,n,t)).finally(()=>r.result=void 0)}}}function We(e,t,n,r,s){if(ze&&typeof t=="function"){let i=t.apply(n,r);i instanceof Promise?i.then(o=>We(e,o,n,r)).catch(o=>Oe(o,s,t)):e(i)}else typeof t=="object"&&t instanceof Promise?t.then(i=>e(i)):e(t)}var Wt="x-";function pe(e=""){return Wt+e}function $i(e){Wt=e}var Ve={};function A(e,t){return Ve[e]=t,{before(n){if(!Ve[n]){console.warn(String.raw`Cannot find directive \`${n}\`. \`${e}\` will use the default order of execution`);return}const r=Y.indexOf(n);Y.splice(r>=0?r:Y.indexOf("DEFAULT"),0,e)}}}function Mi(e){return Object.keys(Ve).includes(e)}function Vt(e,t,n){if(t=Array.from(t),e._x_virtualDirectives){let i=Object.entries(e._x_virtualDirectives).map(([a,l])=>({name:a,value:l})),o=Wn(i);i=i.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),t=t.concat(i)}let r={};return t.map(Qn((i,o)=>r[i]=o)).filter(er).map(Pi(r,n)).sort(Ni).map(i=>Ri(e,i))}function Wn(e){return Array.from(e).map(Qn()).filter(t=>!er(t))}var Et=!1,De=new Map,Vn=Symbol();function Bi(e){Et=!0;let t=Symbol();Vn=t,De.set(t,[]);let n=()=>{for(;De.get(t).length;)De.get(t).shift()();De.delete(t)},r=()=>{Et=!1,n()};e(n),r()}function Jn(e){let t=[],n=a=>t.push(a),[r,s]=yi(e);return t.push(s),[{Alpine:Me,effect:r,cleanup:n,evaluateLater:T.bind(T,e),evaluate:te.bind(te,e)},()=>t.forEach(a=>a())]}function Ri(e,t){let n=()=>{},r=Ve[t.type]||n,[s,i]=Jn(e);Nn(e,t.original,i);let o=()=>{e._x_ignore||e._x_ignoreSelf||(r.inline&&r.inline(e,t,s),r=r.bind(r,e,t,s),Et?De.get(Vn).push(r):r())};return o.runCleanups=i,o}var Zn=(e,t)=>({name:n,value:r})=>(n.startsWith(e)&&(n=n.replace(e,t)),{name:n,value:r}),Xn=e=>e;function Qn(e=()=>{}){return({name:t,value:n})=>{let{name:r,value:s}=Yn.reduce((i,o)=>o(i),{name:t,value:n});return r!==t&&e(r,t),{name:r,value:s}}}var Yn=[];function Jt(e){Yn.push(e)}function er({name:e}){return tr().test(e)}var tr=()=>new RegExp(`^${Wt}([^:^.]+)\\b`);function Pi(e,t){return({name:n,value:r})=>{let s=n.match(tr()),i=n.match(/:([a-zA-Z0-9\-_:]+)/),o=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],a=t||e[n]||n;return{type:s?s[1]:null,value:i?i[1]:null,modifiers:o.map(l=>l.replace(".","")),expression:r,original:a}}}var It="DEFAULT",Y=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",It,"teleport"];function Ni(e,t){let n=Y.indexOf(e.type)===-1?It:e.type,r=Y.indexOf(t.type)===-1?It:t.type;return Y.indexOf(n)-Y.indexOf(r)}function ke(e,t,n={}){e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function se(e,t){if(typeof ShadowRoot=="function"&&e instanceof ShadowRoot){Array.from(e.children).forEach(s=>se(s,t));return}let n=!1;if(t(e,()=>n=!0),n)return;let r=e.firstElementChild;for(;r;)se(r,t),r=r.nextElementSibling}function R(e,...t){console.warn(`Alpine Warning: ${e}`,...t)}var un=!1;function Li(){un&&R("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),un=!0,document.body||R("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),ke(document,"alpine:init"),ke(document,"alpine:initializing"),Ht(),wi(t=>H(t,se)),Gt(t=>ye(t)),Pn((t,n)=>{Vt(t,n).forEach(r=>r())});let e=t=>!Xe(t.parentElement,!0);Array.from(document.querySelectorAll(ir().join(","))).filter(e).forEach(t=>{H(t)}),ke(document,"alpine:initialized"),setTimeout(()=>{Ui()})}var Zt=[],nr=[];function rr(){return Zt.map(e=>e())}function ir(){return Zt.concat(nr).map(e=>e())}function sr(e){Zt.push(e)}function or(e){nr.push(e)}function Xe(e,t=!1){return me(e,n=>{if((t?ir():rr()).some(s=>n.matches(s)))return!0})}function me(e,t){if(e){if(t(e))return e;if(e._x_teleportBack&&(e=e._x_teleportBack),!!e.parentElement)return me(e.parentElement,t)}}function ji(e){return rr().some(t=>e.matches(t))}var ar=[];function Fi(e){ar.push(e)}var Gi=1;function H(e,t=se,n=()=>{}){me(e,r=>r._x_ignore)||Bi(()=>{t(e,(r,s)=>{r._x_marker||(n(r,s),ar.forEach(i=>i(r,s)),Vt(r,r.attributes).forEach(i=>i()),r._x_ignore||(r._x_marker=Gi++),r._x_ignore&&s())})})}function ye(e,t=se){t(e,n=>{_i(n),Ln(n),delete n._x_marker})}function Ui(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([t,n,r])=>{Mi(n)||r.some(s=>{if(document.querySelector(s))return R(`found "${s}", but missing ${t} plugin`),!0})})}var Dt=[],Xt=!1;function Qt(e=()=>{}){return queueMicrotask(()=>{Xt||setTimeout(()=>{xt()})}),new Promise(t=>{Dt.push(()=>{e(),t()})})}function xt(){for(Xt=!1;Dt.length;)Dt.shift()()}function zi(){Xt=!0}function Yt(e,t){return Array.isArray(t)?dn(e,t.join(" ")):typeof t=="object"&&t!==null?Hi(e,t):typeof t=="function"?Yt(e,t()):dn(e,t)}function dn(e,t){let n=s=>s.split(" ").filter(i=>!e.classList.contains(i)).filter(Boolean),r=s=>(e.classList.add(...s),()=>{e.classList.remove(...s)});return t=t===!0?t="":t||"",r(n(t))}function Hi(e,t){let n=a=>a.split(" ").filter(Boolean),r=Object.entries(t).flatMap(([a,l])=>l?n(a):!1).filter(Boolean),s=Object.entries(t).flatMap(([a,l])=>l?!1:n(a)).filter(Boolean),i=[],o=[];return s.forEach(a=>{e.classList.contains(a)&&(e.classList.remove(a),o.push(a))}),r.forEach(a=>{e.classList.contains(a)||(e.classList.add(a),i.push(a))}),()=>{o.forEach(a=>e.classList.add(a)),i.forEach(a=>e.classList.remove(a))}}function Qe(e,t){return typeof t=="object"&&t!==null?Ki(e,t):qi(e,t)}function Ki(e,t){let n={};return Object.entries(t).forEach(([r,s])=>{n[r]=e.style[r],r.startsWith("--")||(r=Wi(r)),e.style.setProperty(r,s)}),setTimeout(()=>{e.style.length===0&&e.removeAttribute("style")}),()=>{Qe(e,n)}}function qi(e,t){let n=e.getAttribute("style",t);return e.setAttribute("style",t),()=>{e.setAttribute("style",n||"")}}function Wi(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function kt(e,t=()=>{}){let n=!1;return function(){n?t.apply(this,arguments):(n=!0,e.apply(this,arguments))}}A("transition",(e,{value:t,modifiers:n,expression:r},{evaluate:s})=>{typeof r=="function"&&(r=s(r)),r!==!1&&(!r||typeof r=="boolean"?Ji(e,n,t):Vi(e,r,t))});function Vi(e,t,n){lr(e,Yt,""),{enter:s=>{e._x_transition.enter.during=s},"enter-start":s=>{e._x_transition.enter.start=s},"enter-end":s=>{e._x_transition.enter.end=s},leave:s=>{e._x_transition.leave.during=s},"leave-start":s=>{e._x_transition.leave.start=s},"leave-end":s=>{e._x_transition.leave.end=s}}[n](t)}function Ji(e,t,n){lr(e,Qe);let r=!t.includes("in")&&!t.includes("out")&&!n,s=r||t.includes("in")||["enter"].includes(n),i=r||t.includes("out")||["leave"].includes(n);t.includes("in")&&!r&&(t=t.filter((w,_)=>_<t.indexOf("out"))),t.includes("out")&&!r&&(t=t.filter((w,_)=>_>t.indexOf("out")));let o=!t.includes("opacity")&&!t.includes("scale"),a=o||t.includes("opacity"),l=o||t.includes("scale"),c=a?0:1,u=l?ve(t,"scale",95)/100:1,d=ve(t,"delay",0)/1e3,f=ve(t,"origin","center"),y="opacity, transform",m=ve(t,"duration",150)/1e3,p=ve(t,"duration",75)/1e3,g="cubic-bezier(0.4, 0.0, 0.2, 1)";s&&(e._x_transition.enter.during={transformOrigin:f,transitionDelay:`${d}s`,transitionProperty:y,transitionDuration:`${m}s`,transitionTimingFunction:g},e._x_transition.enter.start={opacity:c,transform:`scale(${u})`},e._x_transition.enter.end={opacity:1,transform:"scale(1)"}),i&&(e._x_transition.leave.during={transformOrigin:f,transitionDelay:`${d}s`,transitionProperty:y,transitionDuration:`${p}s`,transitionTimingFunction:g},e._x_transition.leave.start={opacity:1,transform:"scale(1)"},e._x_transition.leave.end={opacity:c,transform:`scale(${u})`})}function lr(e,t,n={}){e._x_transition||(e._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(r=()=>{},s=()=>{}){At(e,t,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,s)},out(r=()=>{},s=()=>{}){At(e,t,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,s)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(e,t,n,r){const s=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let i=()=>s(n);if(t){e._x_transition&&(e._x_transition.enter||e._x_transition.leave)?e._x_transition.enter&&(Object.entries(e._x_transition.enter.during).length||Object.entries(e._x_transition.enter.start).length||Object.entries(e._x_transition.enter.end).length)?e._x_transition.in(n):i():e._x_transition?e._x_transition.in(n):i();return}e._x_hidePromise=e._x_transition?new Promise((o,a)=>{e._x_transition.out(()=>{},()=>o(r)),e._x_transitioning&&e._x_transitioning.beforeCancel(()=>a({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let o=cr(e);o?(o._x_hideChildren||(o._x_hideChildren=[]),o._x_hideChildren.push(e)):s(()=>{let a=l=>{let c=Promise.all([l._x_hidePromise,...(l._x_hideChildren||[]).map(a)]).then(([u])=>u?.());return delete l._x_hidePromise,delete l._x_hideChildren,c};a(e).catch(l=>{if(!l.isFromCancelledTransition)throw l})})})};function cr(e){let t=e.parentNode;if(t)return t._x_hidePromise?t:cr(t)}function At(e,t,{during:n,start:r,end:s}={},i=()=>{},o=()=>{}){if(e._x_transitioning&&e._x_transitioning.cancel(),Object.keys(n).length===0&&Object.keys(r).length===0&&Object.keys(s).length===0){i(),o();return}let a,l,c;Zi(e,{start(){a=t(e,r)},during(){l=t(e,n)},before:i,end(){a(),c=t(e,s)},after:o,cleanup(){l(),c()}})}function Zi(e,t){let n,r,s,i=kt(()=>{k(()=>{n=!0,r||t.before(),s||(t.end(),xt()),t.after(),e.isConnected&&t.cleanup(),delete e._x_transitioning})});e._x_transitioning={beforeCancels:[],beforeCancel(o){this.beforeCancels.push(o)},cancel:kt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();i()}),finish:i},k(()=>{t.start(),t.during()}),zi(),requestAnimationFrame(()=>{if(n)return;let o=Number(getComputedStyle(e).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,a=Number(getComputedStyle(e).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;o===0&&(o=Number(getComputedStyle(e).animationDuration.replace("s",""))*1e3),k(()=>{t.before()}),r=!0,requestAnimationFrame(()=>{n||(k(()=>{t.end()}),xt(),setTimeout(e._x_transitioning.finish,o+a),s=!0)})})}function ve(e,t,n){if(e.indexOf(t)===-1)return n;const r=e[e.indexOf(t)+1];if(!r||t==="scale"&&isNaN(r))return n;if(t==="duration"||t==="delay"){let s=r.match(/([0-9]+)ms/);if(s)return s[1]}return t==="origin"&&["top","right","left","center","bottom"].includes(e[e.indexOf(t)+2])?[r,e[e.indexOf(t)+2]].join(" "):r}var W=!1;function Z(e,t=()=>{}){return(...n)=>W?t(...n):e(...n)}function Xi(e){return(...t)=>W&&e(...t)}var ur=[];function Ye(e){ur.push(e)}function Qi(e,t){ur.forEach(n=>n(e,t)),W=!0,dr(()=>{H(t,(n,r)=>{r(n,()=>{})})}),W=!1}var Ot=!1;function Yi(e,t){t._x_dataStack||(t._x_dataStack=e._x_dataStack),W=!0,Ot=!0,dr(()=>{es(t)}),W=!1,Ot=!1}function es(e){let t=!1;H(e,(r,s)=>{se(r,(i,o)=>{if(t&&ji(i))return o();t=!0,s(i,o)})})}function dr(e){let t=oe;cn((n,r)=>{let s=t(n);return ge(s),()=>{}}),e(),cn(t)}function fr(e,t,n,r=[]){switch(e._x_bindings||(e._x_bindings=he({})),e._x_bindings[t]=n,t=r.includes("camel")?ls(t):t,t){case"value":ts(e,n);break;case"style":rs(e,n);break;case"class":ns(e,n);break;case"selected":case"checked":is(e,t,n);break;default:hr(e,t,n);break}}function ts(e,t){if(mr(e))e.attributes.value===void 0&&(e.value=t),window.fromModel&&(typeof t=="boolean"?e.checked=He(e.value)===t:e.checked=fn(e.value,t));else if(en(e))Number.isInteger(t)?e.value=t:!Array.isArray(t)&&typeof t!="boolean"&&![null,void 0].includes(t)?e.value=String(t):Array.isArray(t)?e.checked=t.some(n=>fn(n,e.value)):e.checked=!!t;else if(e.tagName==="SELECT")as(e,t);else{if(e.value===t)return;e.value=t===void 0?"":t}}function ns(e,t){e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedClasses=Yt(e,t)}function rs(e,t){e._x_undoAddedStyles&&e._x_undoAddedStyles(),e._x_undoAddedStyles=Qe(e,t)}function is(e,t,n){hr(e,t,n),os(e,t,n)}function hr(e,t,n){[null,void 0,!1].includes(n)&&us(t)?e.removeAttribute(t):(gr(t)&&(n=t),ss(e,t,n))}function ss(e,t,n){e.getAttribute(t)!=n&&e.setAttribute(t,n)}function os(e,t,n){e[t]!==n&&(e[t]=n)}function as(e,t){const n=[].concat(t).map(r=>r+"");Array.from(e.options).forEach(r=>{r.selected=n.includes(r.value)})}function ls(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function fn(e,t){return e==t}function He(e){return[1,"1","true","on","yes",!0].includes(e)?!0:[0,"0","false","off","no",!1].includes(e)?!1:e?!!e:null}var cs=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function gr(e){return cs.has(e)}function us(e){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(e)}function ds(e,t,n){return e._x_bindings&&e._x_bindings[t]!==void 0?e._x_bindings[t]:pr(e,t,n)}function fs(e,t,n,r=!0){if(e._x_bindings&&e._x_bindings[t]!==void 0)return e._x_bindings[t];if(e._x_inlineBindings&&e._x_inlineBindings[t]!==void 0){let s=e._x_inlineBindings[t];return s.extract=r,Hn(()=>te(e,s.expression))}return pr(e,t,n)}function pr(e,t,n){let r=e.getAttribute(t);return r===null?typeof n=="function"?n():n:r===""?!0:gr(t)?!![t,"true"].includes(r):r}function en(e){return e.type==="checkbox"||e.localName==="ui-checkbox"||e.localName==="ui-switch"}function mr(e){return e.type==="radio"||e.localName==="ui-radio"}function yr(e,t){var n;return function(){var r=this,s=arguments,i=function(){n=null,e.apply(r,s)};clearTimeout(n),n=setTimeout(i,t)}}function wr(e,t){let n;return function(){let r=this,s=arguments;n||(e.apply(r,s),n=!0,setTimeout(()=>n=!1,t))}}function _r({get:e,set:t},{get:n,set:r}){let s=!0,i,o=oe(()=>{let a=e(),l=n();if(s)r(ot(a)),s=!1;else{let c=JSON.stringify(a),u=JSON.stringify(l);c!==i?r(ot(a)):c!==u&&t(ot(l))}i=JSON.stringify(e()),JSON.stringify(n())});return()=>{ge(o)}}function ot(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function hs(e){(Array.isArray(e)?e:[e]).forEach(n=>n(Me))}var Q={},hn=!1;function gs(e,t){if(hn||(Q=he(Q),hn=!0),t===void 0)return Q[e];Q[e]=t,Gn(Q[e]),typeof t=="object"&&t!==null&&t.hasOwnProperty("init")&&typeof t.init=="function"&&Q[e].init()}function ps(){return Q}var br={};function ms(e,t){let n=typeof t!="function"?()=>t:t;return e instanceof Element?vr(e,n()):(br[e]=n,()=>{})}function ys(e){return Object.entries(br).forEach(([t,n])=>{Object.defineProperty(e,t,{get(){return(...r)=>n(...r)}})}),e}function vr(e,t,n){let r=[];for(;r.length;)r.pop()();let s=Object.entries(t).map(([o,a])=>({name:o,value:a})),i=Wn(s);return s=s.map(o=>i.find(a=>a.name===o.name)?{name:`x-bind:${o.name}`,value:`"${o.value}"`}:o),Vt(e,s,n).map(o=>{r.push(o.runCleanups),o()}),()=>{for(;r.length;)r.pop()()}}var Sr={};function ws(e,t){Sr[e]=t}function _s(e,t){return Object.entries(Sr).forEach(([n,r])=>{Object.defineProperty(e,n,{get(){return(...s)=>r.bind(t)(...s)},enumerable:!1})}),e}var bs={get reactive(){return he},get release(){return ge},get effect(){return oe},get raw(){return Tn},version:"3.14.9",flushAndStopDeferringMutations:Si,dontAutoEvaluateFunctions:Hn,disableEffectScheduling:pi,startObservingMutations:Ht,stopObservingMutations:jn,setReactivityEngine:mi,onAttributeRemoved:Nn,onAttributesAdded:Pn,closestDataStack:ue,skipDuringClone:Z,onlyDuringClone:Xi,addRootSelector:sr,addInitSelector:or,interceptClone:Ye,addScopeToNode:Te,deferMutations:vi,mapAttributes:Jt,evaluateLater:T,interceptInit:Fi,setEvaluator:Ai,mergeProxies:$e,extractProp:fs,findClosest:me,onElRemoved:Gt,closestRoot:Xe,destroyTree:ye,interceptor:Un,transition:At,setStyles:Qe,mutateDom:k,directive:A,entangle:_r,throttle:wr,debounce:yr,evaluate:te,initTree:H,nextTick:Qt,prefixed:pe,prefix:$i,plugin:hs,magic:F,store:gs,start:Li,clone:Yi,cloneNode:Qi,bound:ds,$data:Fn,watch:$n,walk:se,data:ws,bind:ms},Me=bs;function vs(e,t){const n=Object.create(null),r=e.split(",");for(let s=0;s<r.length;s++)n[r[s]]=!0;return s=>!!n[s]}var Ss=Object.freeze({}),Es=Object.prototype.hasOwnProperty,et=(e,t)=>Es.call(e,t),ne=Array.isArray,Ae=e=>Er(e)==="[object Map]",Is=e=>typeof e=="string",tn=e=>typeof e=="symbol",tt=e=>e!==null&&typeof e=="object",Ds=Object.prototype.toString,Er=e=>Ds.call(e),Ir=e=>Er(e).slice(8,-1),nn=e=>Is(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,xs=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},ks=xs(e=>e.charAt(0).toUpperCase()+e.slice(1)),Dr=(e,t)=>e!==t&&(e===e||t===t),Ct=new WeakMap,Se=[],G,re=Symbol("iterate"),Tt=Symbol("Map key iterate");function As(e){return e&&e._isEffect===!0}function Os(e,t=Ss){As(e)&&(e=e.raw);const n=$s(e,t);return t.lazy||n(),n}function Cs(e){e.active&&(xr(e),e.options.onStop&&e.options.onStop(),e.active=!1)}var Ts=0;function $s(e,t){const n=function(){if(!n.active)return e();if(!Se.includes(n)){xr(n);try{return Bs(),Se.push(n),G=n,e()}finally{Se.pop(),kr(),G=Se[Se.length-1]}}};return n.id=Ts++,n.allowRecurse=!!t.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=e,n.deps=[],n.options=t,n}function xr(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}var de=!0,rn=[];function Ms(){rn.push(de),de=!1}function Bs(){rn.push(de),de=!0}function kr(){const e=rn.pop();de=e===void 0?!0:e}function L(e,t,n){if(!de||G===void 0)return;let r=Ct.get(e);r||Ct.set(e,r=new Map);let s=r.get(n);s||r.set(n,s=new Set),s.has(G)||(s.add(G),G.deps.push(s),G.options.onTrack&&G.options.onTrack({effect:G,target:e,type:t,key:n}))}function V(e,t,n,r,s,i){const o=Ct.get(e);if(!o)return;const a=new Set,l=u=>{u&&u.forEach(d=>{(d!==G||d.allowRecurse)&&a.add(d)})};if(t==="clear")o.forEach(l);else if(n==="length"&&ne(e))o.forEach((u,d)=>{(d==="length"||d>=r)&&l(u)});else switch(n!==void 0&&l(o.get(n)),t){case"add":ne(e)?nn(n)&&l(o.get("length")):(l(o.get(re)),Ae(e)&&l(o.get(Tt)));break;case"delete":ne(e)||(l(o.get(re)),Ae(e)&&l(o.get(Tt)));break;case"set":Ae(e)&&l(o.get(re));break}const c=u=>{u.options.onTrigger&&u.options.onTrigger({effect:u,target:e,key:n,type:t,newValue:r,oldValue:s,oldTarget:i}),u.options.scheduler?u.options.scheduler(u):u()};a.forEach(c)}var Rs=vs("__proto__,__v_isRef,__isVue"),Ar=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(tn)),Ps=Or(),Ns=Or(!0),gn=Ls();function Ls(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const r=I(this);for(let i=0,o=this.length;i<o;i++)L(r,"get",i+"");const s=r[t](...n);return s===-1||s===!1?r[t](...n.map(I)):s}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){Ms();const r=I(this)[t].apply(this,n);return kr(),r}}),e}function Or(e=!1,t=!1){return function(r,s,i){if(s==="__v_isReactive")return!e;if(s==="__v_isReadonly")return e;if(s==="__v_raw"&&i===(e?t?Qs:Mr:t?Xs:$r).get(r))return r;const o=ne(r);if(!e&&o&&et(gn,s))return Reflect.get(gn,s,i);const a=Reflect.get(r,s,i);return(tn(s)?Ar.has(s):Rs(s))||(e||L(r,"get",s),t)?a:$t(a)?!o||!nn(s)?a.value:a:tt(a)?e?Br(a):ln(a):a}}var js=Fs();function Fs(e=!1){return function(n,r,s,i){let o=n[r];if(!e&&(s=I(s),o=I(o),!ne(n)&&$t(o)&&!$t(s)))return o.value=s,!0;const a=ne(n)&&nn(r)?Number(r)<n.length:et(n,r),l=Reflect.set(n,r,s,i);return n===I(i)&&(a?Dr(s,o)&&V(n,"set",r,s,o):V(n,"add",r,s)),l}}function Gs(e,t){const n=et(e,t),r=e[t],s=Reflect.deleteProperty(e,t);return s&&n&&V(e,"delete",t,void 0,r),s}function Us(e,t){const n=Reflect.has(e,t);return(!tn(t)||!Ar.has(t))&&L(e,"has",t),n}function zs(e){return L(e,"iterate",ne(e)?"length":re),Reflect.ownKeys(e)}var Hs={get:Ps,set:js,deleteProperty:Gs,has:Us,ownKeys:zs},Ks={get:Ns,set(e,t){return console.warn(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return console.warn(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},sn=e=>tt(e)?ln(e):e,on=e=>tt(e)?Br(e):e,an=e=>e,nt=e=>Reflect.getPrototypeOf(e);function Re(e,t,n=!1,r=!1){e=e.__v_raw;const s=I(e),i=I(t);t!==i&&!n&&L(s,"get",t),!n&&L(s,"get",i);const{has:o}=nt(s),a=r?an:n?on:sn;if(o.call(s,t))return a(e.get(t));if(o.call(s,i))return a(e.get(i));e!==s&&e.get(t)}function Pe(e,t=!1){const n=this.__v_raw,r=I(n),s=I(e);return e!==s&&!t&&L(r,"has",e),!t&&L(r,"has",s),e===s?n.has(e):n.has(e)||n.has(s)}function Ne(e,t=!1){return e=e.__v_raw,!t&&L(I(e),"iterate",re),Reflect.get(e,"size",e)}function pn(e){e=I(e);const t=I(this);return nt(t).has.call(t,e)||(t.add(e),V(t,"add",e,e)),this}function mn(e,t){t=I(t);const n=I(this),{has:r,get:s}=nt(n);let i=r.call(n,e);i?Tr(n,r,e):(e=I(e),i=r.call(n,e));const o=s.call(n,e);return n.set(e,t),i?Dr(t,o)&&V(n,"set",e,t,o):V(n,"add",e,t),this}function yn(e){const t=I(this),{has:n,get:r}=nt(t);let s=n.call(t,e);s?Tr(t,n,e):(e=I(e),s=n.call(t,e));const i=r?r.call(t,e):void 0,o=t.delete(e);return s&&V(t,"delete",e,void 0,i),o}function wn(){const e=I(this),t=e.size!==0,n=Ae(e)?new Map(e):new Set(e),r=e.clear();return t&&V(e,"clear",void 0,void 0,n),r}function Le(e,t){return function(r,s){const i=this,o=i.__v_raw,a=I(o),l=t?an:e?on:sn;return!e&&L(a,"iterate",re),o.forEach((c,u)=>r.call(s,l(c),l(u),i))}}function je(e,t,n){return function(...r){const s=this.__v_raw,i=I(s),o=Ae(i),a=e==="entries"||e===Symbol.iterator&&o,l=e==="keys"&&o,c=s[e](...r),u=n?an:t?on:sn;return!t&&L(i,"iterate",l?Tt:re),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function K(e){return function(...t){{const n=t[0]?`on key "${t[0]}" `:"";console.warn(`${ks(e)} operation ${n}failed: target is readonly.`,I(this))}return e==="delete"?!1:this}}function qs(){const e={get(i){return Re(this,i)},get size(){return Ne(this)},has:Pe,add:pn,set:mn,delete:yn,clear:wn,forEach:Le(!1,!1)},t={get(i){return Re(this,i,!1,!0)},get size(){return Ne(this)},has:Pe,add:pn,set:mn,delete:yn,clear:wn,forEach:Le(!1,!0)},n={get(i){return Re(this,i,!0)},get size(){return Ne(this,!0)},has(i){return Pe.call(this,i,!0)},add:K("add"),set:K("set"),delete:K("delete"),clear:K("clear"),forEach:Le(!0,!1)},r={get(i){return Re(this,i,!0,!0)},get size(){return Ne(this,!0)},has(i){return Pe.call(this,i,!0)},add:K("add"),set:K("set"),delete:K("delete"),clear:K("clear"),forEach:Le(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{e[i]=je(i,!1,!1),n[i]=je(i,!0,!1),t[i]=je(i,!1,!0),r[i]=je(i,!0,!0)}),[e,n,t,r]}var[Ws,Vs,pa,ma]=qs();function Cr(e,t){const n=e?Vs:Ws;return(r,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?r:Reflect.get(et(n,s)&&s in r?n:r,s,i)}var Js={get:Cr(!1)},Zs={get:Cr(!0)};function Tr(e,t,n){const r=I(n);if(r!==n&&t.call(e,r)){const s=Ir(e);console.warn(`Reactive ${s} contains both the raw and reactive versions of the same object${s==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var $r=new WeakMap,Xs=new WeakMap,Mr=new WeakMap,Qs=new WeakMap;function Ys(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function eo(e){return e.__v_skip||!Object.isExtensible(e)?0:Ys(Ir(e))}function ln(e){return e&&e.__v_isReadonly?e:Rr(e,!1,Hs,Js,$r)}function Br(e){return Rr(e,!0,Ks,Zs,Mr)}function Rr(e,t,n,r,s){if(!tt(e))return console.warn(`value cannot be made reactive: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=s.get(e);if(i)return i;const o=eo(e);if(o===0)return e;const a=new Proxy(e,o===2?r:n);return s.set(e,a),a}function I(e){return e&&I(e.__v_raw)||e}function $t(e){return!!(e&&e.__v_isRef===!0)}F("nextTick",()=>Qt);F("dispatch",e=>ke.bind(ke,e));F("watch",(e,{evaluateLater:t,cleanup:n})=>(r,s)=>{let i=t(r),a=$n(()=>{let l;return i(c=>l=c),l},s);n(a)});F("store",ps);F("data",e=>Fn(e));F("root",e=>Xe(e));F("refs",e=>(e._x_refs_proxy||(e._x_refs_proxy=$e(to(e))),e._x_refs_proxy));function to(e){let t=[];return me(e,n=>{n._x_refs&&t.push(n._x_refs)}),t}var at={};function Pr(e){return at[e]||(at[e]=0),++at[e]}function no(e,t){return me(e,n=>{if(n._x_ids&&n._x_ids[t])return!0})}function ro(e,t){e._x_ids||(e._x_ids={}),e._x_ids[t]||(e._x_ids[t]=Pr(t))}F("id",(e,{cleanup:t})=>(n,r=null)=>{let s=`${n}${r?`-${r}`:""}`;return io(e,s,t,()=>{let i=no(e,n),o=i?i._x_ids[n]:Pr(n);return r?`${n}-${o}-${r}`:`${n}-${o}`})});Ye((e,t)=>{e._x_id&&(t._x_id=e._x_id)});function io(e,t,n,r){if(e._x_id||(e._x_id={}),e._x_id[t])return e._x_id[t];let s=r();return e._x_id[t]=s,n(()=>{delete e._x_id[t]}),s}F("el",e=>e);Nr("Focus","focus","focus");Nr("Persist","persist","persist");function Nr(e,t,n){F(t,r=>R(`You can't use [$${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}A("modelable",(e,{expression:t},{effect:n,evaluateLater:r,cleanup:s})=>{let i=r(t),o=()=>{let u;return i(d=>u=d),u},a=r(`${t} = __placeholder`),l=u=>a(()=>{},{scope:{__placeholder:u}}),c=o();l(c),queueMicrotask(()=>{if(!e._x_model)return;e._x_removeModelListeners.default();let u=e._x_model.get,d=e._x_model.set,f=_r({get(){return u()},set(y){d(y)}},{get(){return o()},set(y){l(y)}});s(f)})});A("teleport",(e,{modifiers:t,expression:n},{cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&R("x-teleport can only be used on a <template> tag",e);let s=_n(n),i=e.content.cloneNode(!0).firstElementChild;e._x_teleport=i,i._x_teleportBack=e,e.setAttribute("data-teleport-template",!0),i.setAttribute("data-teleport-target",!0),e._x_forwardEvents&&e._x_forwardEvents.forEach(a=>{i.addEventListener(a,l=>{l.stopPropagation(),e.dispatchEvent(new l.constructor(l.type,l))})}),Te(i,{},e);let o=(a,l,c)=>{c.includes("prepend")?l.parentNode.insertBefore(a,l):c.includes("append")?l.parentNode.insertBefore(a,l.nextSibling):l.appendChild(a)};k(()=>{o(i,s,t),Z(()=>{H(i)})()}),e._x_teleportPutBack=()=>{let a=_n(n);k(()=>{o(e._x_teleport,a,t)})},r(()=>k(()=>{i.remove(),ye(i)}))});var so=document.createElement("div");function _n(e){let t=Z(()=>document.querySelector(e),()=>so)();return t||R(`Cannot find x-teleport element for selector: "${e}"`),t}var Lr=()=>{};Lr.inline=(e,{modifiers:t},{cleanup:n})=>{t.includes("self")?e._x_ignoreSelf=!0:e._x_ignore=!0,n(()=>{t.includes("self")?delete e._x_ignoreSelf:delete e._x_ignore})};A("ignore",Lr);A("effect",Z((e,{expression:t},{effect:n})=>{n(T(e,t))}));function Mt(e,t,n,r){let s=e,i=l=>r(l),o={},a=(l,c)=>u=>c(l,u);if(n.includes("dot")&&(t=oo(t)),n.includes("camel")&&(t=ao(t)),n.includes("passive")&&(o.passive=!0),n.includes("capture")&&(o.capture=!0),n.includes("window")&&(s=window),n.includes("document")&&(s=document),n.includes("debounce")){let l=n[n.indexOf("debounce")+1]||"invalid-wait",c=Je(l.split("ms")[0])?Number(l.split("ms")[0]):250;i=yr(i,c)}if(n.includes("throttle")){let l=n[n.indexOf("throttle")+1]||"invalid-wait",c=Je(l.split("ms")[0])?Number(l.split("ms")[0]):250;i=wr(i,c)}return n.includes("prevent")&&(i=a(i,(l,c)=>{c.preventDefault(),l(c)})),n.includes("stop")&&(i=a(i,(l,c)=>{c.stopPropagation(),l(c)})),n.includes("once")&&(i=a(i,(l,c)=>{l(c),s.removeEventListener(t,i,o)})),(n.includes("away")||n.includes("outside"))&&(s=document,i=a(i,(l,c)=>{e.contains(c.target)||c.target.isConnected!==!1&&(e.offsetWidth<1&&e.offsetHeight<1||e._x_isShown!==!1&&l(c))})),n.includes("self")&&(i=a(i,(l,c)=>{c.target===e&&l(c)})),(co(t)||jr(t))&&(i=a(i,(l,c)=>{uo(c,n)||l(c)})),s.addEventListener(t,i,o),()=>{s.removeEventListener(t,i,o)}}function oo(e){return e.replace(/-/g,".")}function ao(e){return e.toLowerCase().replace(/-(\w)/g,(t,n)=>n.toUpperCase())}function Je(e){return!Array.isArray(e)&&!isNaN(e)}function lo(e){return[" ","_"].includes(e)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function co(e){return["keydown","keyup"].includes(e)}function jr(e){return["contextmenu","click","mouse"].some(t=>e.includes(t))}function uo(e,t){let n=t.filter(i=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(i));if(n.includes("debounce")){let i=n.indexOf("debounce");n.splice(i,Je((n[i+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let i=n.indexOf("throttle");n.splice(i,Je((n[i+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.length===0||n.length===1&&bn(e.key).includes(n[0]))return!1;const s=["ctrl","shift","alt","meta","cmd","super"].filter(i=>n.includes(i));return n=n.filter(i=>!s.includes(i)),!(s.length>0&&s.filter(o=>((o==="cmd"||o==="super")&&(o="meta"),e[`${o}Key`])).length===s.length&&(jr(e.type)||bn(e.key).includes(n[0])))}function bn(e){if(!e)return[];e=lo(e);let t={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return t[e]=e,Object.keys(t).map(n=>{if(t[n]===e)return n}).filter(n=>n)}A("model",(e,{modifiers:t,expression:n},{effect:r,cleanup:s})=>{let i=e;t.includes("parent")&&(i=e.parentNode);let o=T(i,n),a;typeof n=="string"?a=T(i,`${n} = __placeholder`):typeof n=="function"&&typeof n()=="string"?a=T(i,`${n()} = __placeholder`):a=()=>{};let l=()=>{let f;return o(y=>f=y),vn(f)?f.get():f},c=f=>{let y;o(m=>y=m),vn(y)?y.set(f):a(()=>{},{scope:{__placeholder:f}})};typeof n=="string"&&e.type==="radio"&&k(()=>{e.hasAttribute("name")||e.setAttribute("name",n)});var u=e.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(e.type)||t.includes("lazy")?"change":"input";let d=W?()=>{}:Mt(e,u,t,f=>{c(lt(e,t,f,l()))});if(t.includes("fill")&&([void 0,null,""].includes(l())||en(e)&&Array.isArray(l())||e.tagName.toLowerCase()==="select"&&e.multiple)&&c(lt(e,t,{target:e},l())),e._x_removeModelListeners||(e._x_removeModelListeners={}),e._x_removeModelListeners.default=d,s(()=>e._x_removeModelListeners.default()),e.form){let f=Mt(e.form,"reset",[],y=>{Qt(()=>e._x_model&&e._x_model.set(lt(e,t,{target:e},l())))});s(()=>f())}e._x_model={get(){return l()},set(f){c(f)}},e._x_forceModelUpdate=f=>{f===void 0&&typeof n=="string"&&n.match(/\./)&&(f=""),window.fromModel=!0,k(()=>fr(e,"value",f)),delete window.fromModel},r(()=>{let f=l();t.includes("unintrusive")&&document.activeElement.isSameNode(e)||e._x_forceModelUpdate(f)})});function lt(e,t,n,r){return k(()=>{if(n instanceof CustomEvent&&n.detail!==void 0)return n.detail!==null&&n.detail!==void 0?n.detail:n.target.value;if(en(e))if(Array.isArray(r)){let s=null;return t.includes("number")?s=ct(n.target.value):t.includes("boolean")?s=He(n.target.value):s=n.target.value,n.target.checked?r.includes(s)?r:r.concat([s]):r.filter(i=>!fo(i,s))}else return n.target.checked;else{if(e.tagName.toLowerCase()==="select"&&e.multiple)return t.includes("number")?Array.from(n.target.selectedOptions).map(s=>{let i=s.value||s.text;return ct(i)}):t.includes("boolean")?Array.from(n.target.selectedOptions).map(s=>{let i=s.value||s.text;return He(i)}):Array.from(n.target.selectedOptions).map(s=>s.value||s.text);{let s;return mr(e)?n.target.checked?s=n.target.value:s=r:s=n.target.value,t.includes("number")?ct(s):t.includes("boolean")?He(s):t.includes("trim")?s.trim():s}}})}function ct(e){let t=e?parseFloat(e):null;return ho(t)?t:e}function fo(e,t){return e==t}function ho(e){return!Array.isArray(e)&&!isNaN(e)}function vn(e){return e!==null&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"}A("cloak",e=>queueMicrotask(()=>k(()=>e.removeAttribute(pe("cloak")))));or(()=>`[${pe("init")}]`);A("init",Z((e,{expression:t},{evaluate:n})=>typeof t=="string"?!!t.trim()&&n(t,{},!1):n(t,{},!1)));A("text",(e,{expression:t},{effect:n,evaluateLater:r})=>{let s=r(t);n(()=>{s(i=>{k(()=>{e.textContent=i})})})});A("html",(e,{expression:t},{effect:n,evaluateLater:r})=>{let s=r(t);n(()=>{s(i=>{k(()=>{e.innerHTML=i,e._x_ignoreSelf=!0,H(e),delete e._x_ignoreSelf})})})});Jt(Zn(":",Xn(pe("bind:"))));var Fr=(e,{value:t,modifiers:n,expression:r,original:s},{effect:i,cleanup:o})=>{if(!t){let l={};ys(l),T(e,r)(u=>{vr(e,u,s)},{scope:l});return}if(t==="key")return go(e,r);if(e._x_inlineBindings&&e._x_inlineBindings[t]&&e._x_inlineBindings[t].extract)return;let a=T(e,r);i(()=>a(l=>{l===void 0&&typeof r=="string"&&r.match(/\./)&&(l=""),k(()=>fr(e,t,l,n))})),o(()=>{e._x_undoAddedClasses&&e._x_undoAddedClasses(),e._x_undoAddedStyles&&e._x_undoAddedStyles()})};Fr.inline=(e,{value:t,modifiers:n,expression:r})=>{t&&(e._x_inlineBindings||(e._x_inlineBindings={}),e._x_inlineBindings[t]={expression:r,extract:!1})};A("bind",Fr);function go(e,t){e._x_keyExpression=t}sr(()=>`[${pe("data")}]`);A("data",(e,{expression:t},{cleanup:n})=>{if(po(e))return;t=t===""?"{}":t;let r={};St(r,e);let s={};_s(s,r);let i=te(e,t,{scope:s});(i===void 0||i===!0)&&(i={}),St(i,e);let o=he(i);Gn(o);let a=Te(e,o);o.init&&te(e,o.init),n(()=>{o.destroy&&te(e,o.destroy),a()})});Ye((e,t)=>{e._x_dataStack&&(t._x_dataStack=e._x_dataStack,t.setAttribute("data-has-alpine-state",!0))});function po(e){return W?Ot?!0:e.hasAttribute("data-has-alpine-state"):!1}A("show",(e,{modifiers:t,expression:n},{effect:r})=>{let s=T(e,n);e._x_doHide||(e._x_doHide=()=>{k(()=>{e.style.setProperty("display","none",t.includes("important")?"important":void 0)})}),e._x_doShow||(e._x_doShow=()=>{k(()=>{e.style.length===1&&e.style.display==="none"?e.removeAttribute("style"):e.style.removeProperty("display")})});let i=()=>{e._x_doHide(),e._x_isShown=!1},o=()=>{e._x_doShow(),e._x_isShown=!0},a=()=>setTimeout(o),l=kt(d=>d?o():i(),d=>{typeof e._x_toggleAndCascadeWithTransitions=="function"?e._x_toggleAndCascadeWithTransitions(e,d,o,i):d?a():i()}),c,u=!0;r(()=>s(d=>{!u&&d===c||(t.includes("immediate")&&(d?a():i()),l(d),c=d,u=!1)}))});A("for",(e,{expression:t},{effect:n,cleanup:r})=>{let s=yo(t),i=T(e,s.items),o=T(e,e._x_keyExpression||"index");e._x_prevKeys=[],e._x_lookup={},n(()=>mo(e,s,i,o)),r(()=>{Object.values(e._x_lookup).forEach(a=>k(()=>{ye(a),a.remove()})),delete e._x_prevKeys,delete e._x_lookup})});function mo(e,t,n,r){let s=o=>typeof o=="object"&&!Array.isArray(o),i=e;n(o=>{wo(o)&&o>=0&&(o=Array.from(Array(o).keys(),g=>g+1)),o===void 0&&(o=[]);let a=e._x_lookup,l=e._x_prevKeys,c=[],u=[];if(s(o))o=Object.entries(o).map(([g,w])=>{let _=Sn(t,w,g,o);r(h=>{u.includes(h)&&R("Duplicate key on x-for",e),u.push(h)},{scope:{index:g,..._}}),c.push(_)});else for(let g=0;g<o.length;g++){let w=Sn(t,o[g],g,o);r(_=>{u.includes(_)&&R("Duplicate key on x-for",e),u.push(_)},{scope:{index:g,...w}}),c.push(w)}let d=[],f=[],y=[],m=[];for(let g=0;g<l.length;g++){let w=l[g];u.indexOf(w)===-1&&y.push(w)}l=l.filter(g=>!y.includes(g));let p="template";for(let g=0;g<u.length;g++){let w=u[g],_=l.indexOf(w);if(_===-1)l.splice(g,0,w),d.push([p,g]);else if(_!==g){let h=l.splice(g,1)[0],v=l.splice(_-1,1)[0];l.splice(g,0,v),l.splice(_,0,h),f.push([h,v])}else m.push(w);p=w}for(let g=0;g<y.length;g++){let w=y[g];w in a&&(k(()=>{ye(a[w]),a[w].remove()}),delete a[w])}for(let g=0;g<f.length;g++){let[w,_]=f[g],h=a[w],v=a[_],E=document.createElement("div");k(()=>{v||R('x-for ":key" is undefined or invalid',i,_,a),v.after(E),h.after(v),v._x_currentIfEl&&v.after(v._x_currentIfEl),E.before(h),h._x_currentIfEl&&h.after(h._x_currentIfEl),E.remove()}),v._x_refreshXForScope(c[u.indexOf(_)])}for(let g=0;g<d.length;g++){let[w,_]=d[g],h=w==="template"?i:a[w];h._x_currentIfEl&&(h=h._x_currentIfEl);let v=c[_],E=u[_],S=document.importNode(i.content,!0).firstElementChild,D=he(v);Te(S,D,i),S._x_refreshXForScope=P=>{Object.entries(P).forEach(([M,ae])=>{D[M]=ae})},k(()=>{h.after(S),Z(()=>H(S))()}),typeof E=="object"&&R("x-for key cannot be an object, it must be a string or an integer",i),a[E]=S}for(let g=0;g<m.length;g++)a[m[g]]._x_refreshXForScope(c[u.indexOf(m[g])]);i._x_prevKeys=u})}function yo(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,s=e.match(r);if(!s)return;let i={};i.items=s[2].trim();let o=s[1].replace(n,"").trim(),a=o.match(t);return a?(i.item=o.replace(t,"").trim(),i.index=a[1].trim(),a[2]&&(i.collection=a[2].trim())):i.item=o,i}function Sn(e,t,n,r){let s={};return/^\[.*\]$/.test(e.item)&&Array.isArray(t)?e.item.replace("[","").replace("]","").split(",").map(o=>o.trim()).forEach((o,a)=>{s[o]=t[a]}):/^\{.*\}$/.test(e.item)&&!Array.isArray(t)&&typeof t=="object"?e.item.replace("{","").replace("}","").split(",").map(o=>o.trim()).forEach(o=>{s[o]=t[o]}):s[e.item]=t,e.index&&(s[e.index]=n),e.collection&&(s[e.collection]=r),s}function wo(e){return!Array.isArray(e)&&!isNaN(e)}function Gr(){}Gr.inline=(e,{expression:t},{cleanup:n})=>{let r=Xe(e);r._x_refs||(r._x_refs={}),r._x_refs[t]=e,n(()=>delete r._x_refs[t])};A("ref",Gr);A("if",(e,{expression:t},{effect:n,cleanup:r})=>{e.tagName.toLowerCase()!=="template"&&R("x-if can only be used on a <template> tag",e);let s=T(e,t),i=()=>{if(e._x_currentIfEl)return e._x_currentIfEl;let a=e.content.cloneNode(!0).firstElementChild;return Te(a,{},e),k(()=>{e.after(a),Z(()=>H(a))()}),e._x_currentIfEl=a,e._x_undoIf=()=>{k(()=>{ye(a),a.remove()}),delete e._x_currentIfEl},a},o=()=>{e._x_undoIf&&(e._x_undoIf(),delete e._x_undoIf)};n(()=>s(a=>{a?i():o()})),r(()=>e._x_undoIf&&e._x_undoIf())});A("id",(e,{expression:t},{evaluate:n})=>{n(t).forEach(s=>ro(e,s))});Ye((e,t)=>{e._x_ids&&(t._x_ids=e._x_ids)});Jt(Zn("@",Xn(pe("on:"))));A("on",Z((e,{value:t,modifiers:n,expression:r},{cleanup:s})=>{let i=r?T(e,r):()=>{};e.tagName.toLowerCase()==="template"&&(e._x_forwardEvents||(e._x_forwardEvents=[]),e._x_forwardEvents.includes(t)||e._x_forwardEvents.push(t));let o=Mt(e,t,n,a=>{i(()=>{},{scope:{$event:a},params:[a]})});s(()=>o())}));rt("Collapse","collapse","collapse");rt("Intersect","intersect","intersect");rt("Focus","trap","focus");rt("Mask","mask","mask");function rt(e,t,n){A(t,r=>R(`You can't use [x-${t}] without first installing the "${e}" plugin here: https://alpinejs.dev/plugins/${n}`,r))}Me.setEvaluator(qn);Me.setReactivityEngine({reactive:ln,effect:Os,release:Cs,raw:I});var _o=Me,Ur=_o;let En,In;const zr=new WeakMap,Bt=new WeakMap,Hr=new WeakMap,ut=new WeakMap,Rt=new WeakMap;let Pt={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Bt.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Hr.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return q(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&(t==="done"||t==="store")||t in e};function bo(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(In||(In=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(dt(this),t),q(zr.get(this))}:function(...t){return q(e.apply(dt(this),t))}:function(t,...n){const r=e.call(dt(this),t,...n);return Hr.set(r,t.sort?t.sort():[t]),q(r)}}function vo(e){return typeof e=="function"?bo(e):(e instanceof IDBTransaction&&(function(n){if(Bt.has(n))return;const r=new Promise(((s,i)=>{const o=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",l),n.removeEventListener("abort",l)},a=()=>{s(),o()},l=()=>{i(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",a),n.addEventListener("error",l),n.addEventListener("abort",l)}));Bt.set(n,r)})(e),t=e,(En||(En=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((n=>t instanceof n))?new Proxy(e,Pt):e);var t}function q(e){if(e instanceof IDBRequest)return(function(n){const r=new Promise(((s,i)=>{const o=()=>{n.removeEventListener("success",a),n.removeEventListener("error",l)},a=()=>{s(q(n.result)),o()},l=()=>{i(n.error),o()};n.addEventListener("success",a),n.addEventListener("error",l)}));return r.then((s=>{s instanceof IDBCursor&&zr.set(s,n)})).catch((()=>{})),Rt.set(r,n),r})(e);if(ut.has(e))return ut.get(e);const t=vo(e);return t!==e&&(ut.set(e,t),Rt.set(t,e)),t}const dt=e=>Rt.get(e);function So(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=q(o);return r&&o.addEventListener("upgradeneeded",(l=>{r(q(o.result),l.oldVersion,l.newVersion,q(o.transaction),l)})),n&&o.addEventListener("blocked",(l=>n(l.oldVersion,l.newVersion,l))),a.then((l=>{i&&l.addEventListener("close",(()=>i())),s&&l.addEventListener("versionchange",(c=>s(c.oldVersion,c.newVersion,c)))})).catch((()=>{})),a}const Eo=["get","getKey","getAll","getAllKeys","count"],Io=["put","add","delete","clear"],ft=new Map;function Dn(e,t){if(!(e instanceof IDBDatabase)||t in e||typeof t!="string")return;if(ft.get(t))return ft.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=Io.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!Eo.includes(n))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return ft.set(t,i),i}Pt=(e=>({...e,get:(t,n,r)=>Dn(t,n)||e.get(t,n,r),has:(t,n)=>!!Dn(t,n)||e.has(t,n)}))(Pt);const ht="not-the-news-db",gt=28;let Ee=null,Ie=null;const Do=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function Kr(){if(Ee)return Ee;if(Ie)return Ie;Ie=So(ht,gt,{upgrade(e,t){console.log(`[DB] Upgrading database from version ${t} to ${gt}`);const n=new Set(e.objectStoreNames);Do.forEach(r=>{let s;n.has(r.name)&&e.deleteObjectStore(r.name),s=e.createObjectStore(r.name,{keyPath:r.keyPath,...r.options||{}}),console.log(`[DB] Created/Recreated store: ${r.name}`),r.indexes&&r.indexes.forEach(i=>{s.createIndex(i.name,i.keyPath,i.options||{}),console.log(`[DB] Created index '${i.name}' on store '${r.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return Ee=await Ie,console.log(`[DB] Opened '${ht}', version ${gt}`),Ee}catch(e){throw console.error(`[DB] Failed to open database '${ht}':`,e),Ee=null,Ie=null,e}}async function $(e){let t=await Kr();return e(t)}const z=()=>navigator.onLine,Ce=window.location.origin;async function Be(e,t){return $(async n=>{try{await n.put("userSettings",{key:e,value:t,lastModified:new Date().toISOString()})}catch(r){console.error(`[DB] Failed to save sync metadata for key '${e}':`,r)}})}async function xo(e){return $(async t=>{const n={...e};n.id&&delete n.id;try{const r=t.transaction("pendingOperations","readwrite"),s=await r.store.add(n);return await r.done,s}catch(r){throw console.error("[DB] Error buffering operation:",r),r}})}async function fe(e){if(!e||typeof e.type!="string"||e.type==="simpleUpdate"&&(e.value===null||e.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",e);return}try{const t=await xo(e);console.log(`[DB] Operation buffered with ID: ${t}`,e);const{value:n}=await C("syncEnabled");if(z()&&n){console.log(`[DB] Attempting immediate sync for ${e.type} (ID: ${t}).`);const r=[{...e,id:t}],s=await fetch(`${Ce}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const a=await s.text();throw new Error(`HTTP error ${s.status} for immediate sync. Details: ${a}`)}const i=await s.json(),o=i.results?.find(a=>a.id===t);o?.status==="success"?(await $(a=>a.delete("pendingOperations",t)),console.log(`[DB] Successfully synced and removed immediate op ${t} (${e.type}).`),i.serverTime&&await Be("lastStateSync",i.serverTime),ce()):console.warn(`[DB] Immediate sync for op ${t} reported non-success by server:`,o)}else console.log(`[DB] ${z()?"Sync is disabled.":"Offline."} Buffering op ${t} for later batch sync.`)}catch(t){console.error(`[DB] Network error during immediate sync for ${e.type}. Will retry with batch sync.`,t)}}async function Nt(){const{value:e}=await C("syncEnabled");if(!z()||!e){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const t=await $(n=>n.getAll("pendingOperations")).catch(n=>(console.error("[DB] Error fetching pending operations:",n),null));if(!t||t.length===0){t&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${t.length} batched operations to /api/user-state.`);try{const n=await fetch(`${Ce}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error ${n.status}. Details: ${await n.text()}`);const r=await n.json();console.log("[DB] Batch sync successful. Server response:",r),r.results&&Array.isArray(r.results)?await $(async s=>{const i=s.transaction("pendingOperations","readwrite");for(const o of r.results)o.status==="success"&&o.id!==void 0?await i.store.delete(o.id):console.warn(`[DB] Op ${o.id??"N/A"} (${o.opType}) ${o.status}: ${o.reason||"N/A"}`);await i.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),r.serverTime&&await Be("lastStateSync",r.serverTime),ce()}catch(n){console.error("[DB] Error during batch synchronization:",n)}}let pt=!1,xn=0;const ko=500;async function Ao(e,t){if((await $(l=>l.getAll("pendingOperations")).catch(()=>[])).some(l=>l.key===e||l.type==="starDelta"&&e==="starred"||l.type==="readDelta"&&e==="read"||l.type==="simpleUpdate"&&l.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${e}' because local changes are pending synchronization.`),{key:e,status:"skipped_pending"};const{value:s,lastModified:i}=t.type==="array"?await ie(t.store):await C(e,t.store),o=i||"",a={"Content-Type":"application/json"};o&&(a["If-None-Match"]=o);try{const l=await fetch(`${Ce}/api/user-state/${e}`,{method:"GET",headers:a});if(l.status===304)return{key:e,status:304,timestamp:o};if(!l.ok)return console.error(`[DB] HTTP error for ${e}: ${l.status}`),{key:e,status:l.status};const c=await l.json();if(console.log(`[DB] New data received for ${e}.`),t.type==="array"){const u=c.value||[],d=s||[],f=new Set(u.map(g=>g.guid)),y=new Set(d.map(g=>g.guid)),m=u.filter(g=>!y.has(g.guid)),p=d.filter(g=>!f.has(g.guid));(m.length>0||p.length>0)&&await $(async g=>{const w=g.transaction(t.store,"readwrite");for(const _ of m)await w.store.put(_);for(const _ of p)await w.store.delete(_.id);await w.done})}else await Be(e,c.value);return{key:e,status:200,timestamp:c.lastModified}}catch(l){return console.error(`[DB] Failed to pull ${e}:`,l),{key:e,status:"error"}}}async function ce(){const{value:e}=await C("syncEnabled");if(!z()||!e){e&&console.log("[DB] Offline. Skipping user state pull.");return}if(pt)return;const t=Date.now();if(!(t-xn<ko)){xn=t,pt=!0,console.log("[DB] Pulling user state...");try{const n=Object.entries(J).filter(([,i])=>!i.localOnly),s=(await Promise.all(n.map(([i,o])=>Ao(i,o)))).reduce((i,o)=>o?.timestamp&&o.timestamp>i?o.timestamp:i,"");s&&await Be("lastStateSync",s)}catch(n){console.error("[DB] User state pull failed:",n)}finally{pt=!1,console.log("[DB] User state pull completed.")}}}async function qr(){return $(e=>e.getAll("feedItems")).catch(e=>(console.error("Failed to get all feed items:",e),[]))}async function Ke(e){const{value:t}=await C("syncEnabled");if(!z()||!t){t&&console.log("[DB] Offline. Skipping feed sync.");return}console.log("[DB] Fetching feed items from server.");try{const{value:n}=await C("lastFeedSync"),r=await fetch(`${Ce}/api/feed-guids?since=${n||""}`);if(r.status===304){console.log("[DB] Feed not modified.");return}if(!r.ok)throw new Error(`HTTP error ${r.status} for /api/feed-guids`);const{guids:s,serverTime:i}=await r.json(),o=new Set(s),a=await qr(),l=new Set(a.map(d=>d.guid)),c=[...o].filter(d=>!l.has(d)),u=[...l].filter(d=>!o.has(d));if(console.log(`[DB] New GUIDs: ${c.length}, Deleting: ${u.length}`),c.length>0){const f=[];for(let y=0;y<c.length;y+=50){const m=c.slice(y,y+50),p=await fetch(`${Ce}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:m})});p.ok?f.push(...await p.json()):console.error(`[DB] Failed to fetch a batch of feed items. Status: ${p.status}`)}await $(async y=>{const m=y.transaction("feedItems","readwrite");for(const p of f)p.guid&&await m.store.put(p);await m.done})}if(u.length>0){const d=new Map(a.map(f=>[f.guid,f.id]));await $(async f=>{const y=f.transaction("feedItems","readwrite");for(const m of u){const p=d.get(m);p!==void 0&&await y.store.delete(p)}await y.done})}i&&await Be("lastFeedSync",i),e?.loadFeedItemsFromDB?.(),e?.loadAndDisplayDeck?.(),e?.updateCounts?.()}catch(n){console.error("[DB] Failed to synchronize feed:",n)}}async function Wr(e){const{value:t}=await C("syncEnabled");if(!(!z()||!t)){console.log("[DB] Full sync initiated.");try{await ce(),await Ke(e),await Nt()}catch(n){console.error("[DB] Full sync failed:",n)}}}const J={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!0,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!0,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!0,default:!0},syncEnabled:{store:"userSettings",type:"simple",localOnly:!0,default:!0},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!0,default:[]},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0}};async function C(e,t="userSettings"){return $(async n=>{try{const r=await n.get(t,e);return{value:r?r.value:J[e]?.default||null,lastModified:r?.lastModified||null}}catch(r){return console.error(`Failed to load simple state for key '${e}':`,r),{value:J[e]?.default||null,lastModified:null}}})}async function j(e,t,n="userSettings"){await $(s=>s.put(n,{key:e,value:t,lastModified:new Date().toISOString()}));const r=J[e];r&&!r.localOnly&&await fe({type:"simpleUpdate",key:e,value:t,timestamp:new Date().toISOString()})}const Vr=e=>{switch(e){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function ie(e){return console.log(`ENTERING loadArrayState for ${e}`),$(async t=>{try{const n=await t.getAll(e);if(n.length>0&&(typeof n[0]=="string"||n[0].id===void 0)){console.log(`[DB] Migration required for '${e}'.`);const s=Vr(e),i=new Date().toISOString(),o=new Map;n.forEach(u=>{const d=typeof u=="string"?u:u.guid;d&&!o.has(d)&&o.set(d,u)});const l=Array.from(o.values()).map(u=>({guid:typeof u=="string"?u:u.guid,[s]:i})),c=t.transaction(e,"readwrite");await c.store.clear();for(const u of l)await c.store.put(u);return await c.done,console.log(`[DB] Migration complete for '${e}'.`),{value:await t.getAll(e)}}return{value:n||J[e]?.default||[]}}catch(n){return console.error(`Failed to load array state from store '${e}':`,n),{value:J[e]?.default||[]}}})}async function Oo(e,t,n){await $(async s=>{const i=s.transaction(e,"readwrite");if(!t||!t.guid){console.error("[DB] updateArrayState requires an item with a guid property.",t);return}const o=i.objectStore(e);if(n)await o.put(t);else{const a=await o.index("guid").get(t.guid);a?.id!==void 0&&await o.delete(a.id)}await i.done});const r=Object.entries(J).find(([,s])=>s.store===e);if(r&&!r[1].localOnly){let s="";e==="starred"&&(s="starDelta"),e==="read"&&(s="readDelta"),s&&await fe({type:s,guid:t.guid,action:n?"add":"remove",timestamp:t[Vr(e)]||new Date().toISOString()})}}async function Co(e,t){const{value:n}=await ie(e),r=new Set(n.map(o=>o.guid));await we(e,t);const s=new Set(t.map(o=>o.guid));[...r].filter(o=>!s.has(o)),[...s].filter(o=>!s.has(o));const i=Object.entries(J).find(([,o])=>o.store===e);!i||i[1].localOnly}async function we(e,t){return $(async n=>{const r=n.transaction(e,"readwrite");await r.store.clear();for(const s of t){const i=JSON.parse(JSON.stringify(s));delete i.id,await r.store.put(i)}await r.done})}const To=async e=>{const t=await fetch(`/api/user-state/${e}`);if(!t.ok)throw new Error(`Failed to load user state for key '${e}': ${t.status} ${t.statusText}`);return t.json()},$o=async(e,t)=>{const n=await fetch("/api/user-state",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{type:"simpleUpdate",key:e,value:t}])});if(!n.ok)throw new Error(`Failed to save user state for key '${e}': ${n.status} ${n.statusText}`);return n.json()};function Fe(e){const t=new Date,n=new Date(e),r=Math.floor((t-n)/1e3),s=336*60*60;if(r>s)return n.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const i=Math.floor(r/60),o=Math.floor(i/60),a=Math.floor(o/24);if(r<60)return"Just now";if(i<60)return`${i} minute${i!==1?"s":""} ago`;if(o<24)return`${o} hour${o!==1?"s":""} ago`;if(a<7)return`${a} day${a!==1?"s":""} ago`;const l=Math.floor(a/7);return`${l} week${l!==1?"s":""} ago`}function Mo(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function Jr(e,t){if(!e)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const r=new DOMParser().parseFromString(e.description||"","text/html"),s=r.querySelector("img"),i=s?.src||"";s?.remove();let o="";const a=r.querySelector(".source-url")||r.querySelector("a");a?(o=a.textContent.trim(),a.remove()):o=e.link?new URL(e.link).hostname:"";const l=r.body.innerHTML.trim(),c=Date.parse(e.pubDate)||0;return{guid:e.guid,image:i,title:e.title,link:e.link,pubDate:t(e.pubDate||""),description:l,source:o,timestamp:c}}function mt(e,t){if(console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),console.log(`ENTERING mapRawItems. rawList length: ${e.length}`),!Array.isArray(e))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const n=e.map(r=>Jr(r,t)).filter(r=>r!==null).sort((r,s)=>s.timestamp-r.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${n.length}`),n}async function Bo(e,t,n,r,s,i,o){console.log("ENTERING generateNewDeck");try{const l=h=>{if(!Array.isArray(h))return new Set;const v=h.map(E=>typeof E=="object"&&E.guid?E.guid:E);return new Set(v.filter(Boolean))},c=new Set(e.map(h=>h.guid)),u=new Set([...l(t)].filter(h=>c.has(h))),d=new Set([...l(n)].filter(h=>c.has(h))),f=new Set([...l(r)].filter(h=>c.has(h))),y=l(s);let m=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${m.length}`),o){case"read":m=e.filter(h=>u.has(h.guid));break;case"starred":m=e.filter(h=>d.has(h.guid));break;case"unread":default:m=e.filter(h=>!u.has(h.guid)&&!f.has(h.guid));break}if(o==="read"||o==="starred")return m.sort((h,v)=>v.timestamp-h.timestamp),console.log(`[generateNewDeck] Filtered items for ${o}: ${m.length}`),m;let p=[];const g=new Set,w=h=>p.length<10&&h&&!g.has(h.guid)?(p.push(h),g.add(h.guid),!0):!1,_=(h,v)=>{let E=0;for(const S of h){if(E>=v||p.length>=10)break;w(S)&&E++}};if(navigator.onLine){const h=Date.now(),v=x=>/<a\s+href=/i.test(x.description),E=x=>x.title?.includes("?"),S=x=>x.description?.length>=150&&x.description.substring(0,150).includes("?"),D=x=>{const N=x.description;return N?.length>=150&&N.substring(N.length-150).includes("?")},P=x=>x.image!=="",M=x=>x.description?.length>=750,ae=x=>x.description?.length<750,U=m.filter(x=>h-x.timestamp<=1440*60*1e3);_(U,2),console.log(`[generateNewDeck] After recentItems: ${p.length}`);const b=m.filter(v);_(b,1),console.log(`[generateNewDeck] After itemsWithLinks: ${p.length}`);const X=m.filter(E);_(X,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${p.length}`);const O=m.filter(S);_(O,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${p.length}`);const _e=m.filter(D);_(_e,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${p.length}`);const it=m.filter(P);_(it,1),console.log(`[generateNewDeck] After itemsWithImages: ${p.length}`);const si=m.filter(M);_(si,1),console.log(`[generateNewDeck] After longItems: ${p.length}`);const oi=m.filter(ae);_(oi,1),console.log(`[generateNewDeck] After shortItems: ${p.length}`);const ai=m.filter(x=>!g.has(x.guid)),li=Mo([...ai]);for(const x of li){if(p.length>=10)break;w(x)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${p.length}`),p.length<10){const x=e.filter(N=>f.has(N.guid)&&!u.has(N.guid)&&!g.has(N.guid));x.sort((N,ci)=>N.timestamp-ci.timestamp);for(const N of x){if(p.length>=10)break;w(N)}console.log(`[generateNewDeck] After resurfaceCandidates: ${p.length}`)}}else{let h=[...m];const v=b=>b.title?.includes("?"),E=b=>b.description?.length>=150&&b.description.substring(0,150).includes("?"),S=b=>{const X=b.description;return X?.length>=150&&X.substring(X.length-150).includes("?")},D=b=>/<a\s+href=/i.test(b.description),P=b=>b.image!=="";if(h=h.filter(b=>!v(b)),h=h.filter(b=>!(b.description&&E(b))),h=h.filter(b=>!(b.description&&S(b))),h=h.filter(b=>!D(b)),h=h.filter(b=>!P(b)),h.length<10){let b=m.filter(O=>!h.includes(O));const X=[O=>P(O),O=>D(O),O=>O.description&&S(O),O=>O.description&&E(O),O=>v(O)];for(const O of X){for(;h.length<10;){const _e=b.find(O);if(_e)h.push(_e),b=b.filter(it=>it!==_e);else break}if(h.length>=10)break}for(;h.length<10&&b.length>0;)h.push(b.shift())}const M=Date.now();p=h.filter(b=>M-b.timestamp<=1440*60*1e3).slice(0,2);const U=h.filter(b=>!p.includes(b));p=p.concat(U.slice(0,10-p.length))}if(p.length<10&&e.length>0){console.warn("[generateNewDeck] Deck is smaller than desired. Activating fallback to resurface oldest read/shuffled items.");const h=new Map(e.map(S=>[S.guid,S])),v=new Set(p.map(S=>S.guid)),E=e.filter(S=>(u.has(S.guid)||f.has(S.guid))&&!v.has(S.guid));E.sort((S,D)=>S.timestamp-D.timestamp);for(const S of E){if(p.length>=10)break;w(S)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${p.length}`),p.length<10){const S=e.filter(D=>!v.has(D.guid));S.sort((D,P)=>D.timestamp-P.timestamp);for(const D of S){if(p.length>=10)break;p.push(D),v.add(D.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${p.length}`)}}return p.sort((h,v)=>v.timestamp-h.timestamp),p}catch(a){return console.error("An error occurred during deck generation:",a),[]}}const Ro=()=>document.getElementById("sync-toggle"),Po=()=>document.getElementById("images-toggle"),No=()=>document.getElementById("theme-toggle"),Lo=()=>document.getElementById("theme-text"),jo=()=>document.getElementById("shuffle-count-display"),Fo=()=>document.getElementById("filter-selector"),Go=()=>document.querySelector("#ntn-title h2"),Uo=()=>document.getElementById("status-bar-message"),zo=()=>document.getElementById("main-settings"),Ho=()=>document.getElementById("rss-settings-block"),Ko=()=>document.getElementById("keywords-settings-block"),Zr=()=>document.getElementById("back-button"),qo=()=>{const e=document.querySelector("#rss-settings-block textarea");return console.log("[DEBUG] getRssFeedsTextarea called. Element:",e),e},Wo=()=>{const e=document.querySelector("#keywords-settings-block textarea");return console.log("[DEBUG] getKeywordsBlacklistTextarea called. Element:",e),e},Vo=()=>document.getElementById("configure-rss-feeds-btn"),Jo=()=>document.getElementById("configure-keyword-blacklist-btn"),Zo=()=>document.getElementById("save-keywords-btn"),Xo=()=>document.getElementById("save-rss-btn");function Qo(e,t=30){const n=e.split(" ");let r=[],s=[],i=0;for(const o of n){const a=o.length+(r.length>0?1:0);i+a<=t?(r.push(o),i+=a):s.push(o)}return[r.join(" "),s.join(" ")].filter(Boolean)}async function Yo(e){const t=Go();if(!t){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const n="NOT THE NEWS",r=Qo(e),s=t.style.overflow;t.style.overflow="visible";const i=o=>new Promise(a=>setTimeout(a,o));r.length>0&&(t.textContent=r[0],await i(1500)),r.length>1?(t.textContent=r.join(" "),await i(1500)):r.length===1&&await i(1500),t.textContent=n,t.style.overflow=s}const B=(()=>{let e;return(t,n="info")=>{const r=Uo();if(!r){console.warn("Message container not found. Cannot display status bar message.");return}clearTimeout(e),r.className=`message-container message-${n}`,r.textContent=t,r.style.display="block",e=setTimeout(()=>{r.style.display="none",r.textContent="",r.className="message-container"},3e3)}})();function ea(e){if(!e?.entries?.length||!e.read||!e.starred||!e.currentDeckGuids){console.warn("Attempted to update counts with an invalid app object. Skipping.");return}const t=new Set(e.read.map(d=>d.guid)),n=new Set(e.starred.map(d=>d.guid)),r=new Set(e.currentDeckGuids.map(d=>d.guid)),s=e.entries,i=s.length,o=s.filter(d=>t.has(d.guid)).length,a=s.filter(d=>n.has(d.guid)).length,l=s.filter(d=>r.has(d.guid)&&!t.has(d.guid)).length,c=Fo();if(!c)return;const u={all:i,read:o,starred:a,unread:l};Array.from(c.options).forEach(d=>{const f=d.text.split(" ")[0];d.text=`${f} (${u[d.value]??0})`})}function Xr(){window.scrollTo({top:0,behavior:"smooth"})}const ta=(()=>{let e,t=0;return(n="scroll-to-top")=>{const r=document.getElementById(n);if(!r)return;const s=()=>{const i=window.scrollY;r.classList.toggle("visible",i<t&&i>0),t=i,clearTimeout(e),e=setTimeout(()=>r.classList.remove("visible"),2e3)};window.addEventListener("scroll",s),r.addEventListener("click",i=>{i.preventDefault(),Xr()})}})();async function kn(){let e="",t=0;const n=document.querySelectorAll(".entry[data-guid]"),r=Array.from(n).find(s=>{const i=s.getBoundingClientRect();return i.top>=0&&i.bottom>0});if(r){const s=r.getBoundingClientRect();e=r.dataset.guid,t=s.top}await j("lastViewedItemId",e),await j("lastViewedItemOffset",t)}async function An(e){const t={main:zo(),rss:Ho(),keywords:Ko()},n=Zr();Object.values(t).forEach(s=>s&&(s.style.display="none")),n&&(n.style.display="none");const r=t[e.modalView];r&&(r.style.display="block",e.modalView!=="main"&&n&&(n.style.display="block"))}function Lt(e){if(typeof structuredClone=="function")try{return structuredClone(e)}catch(n){console.error("structuredClone failed, falling back to manual sanitization.",n)}const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const r=e[n];typeof r=="object"&&r!==null?Array.isArray(r)?t[n]=r.map(s=>Lt(s)):t[n]=Lt(r):typeof r!="function"&&(t[n]=r)}return t}async function jt(e,t,n){const r=e[n].some(u=>u.guid===t),s=r?"remove":"add",i=new Date().toISOString(),o=n.slice(0,-1),a={guid:t,[`${o}At`]:i};await Oo(n,a,s==="add"),s==="add"?e[n]=[...e[n],a]:e[n]=e[n].filter(u=>u.guid!==t),n==="read"?B(r?"Item unread.":"Item read.","info"):n==="starred"&&B(r?"Item unstarred.":"Item starred.","info"),typeof e.updateCounts=="function"&&e.updateCounts();const c={type:`${n}Delta`,guid:t,action:s,timestamp:i};await fe(c)}async function Qr(e,t,n){if(!Array.isArray(t))return[];if(!Array.isArray(e)||e.length===0)return t;const r=new Set(e.filter(i=>i&&i.guid).map(i=>i.guid.trim().toLowerCase())),s=720*60*60*1e3;return t.filter(i=>{if(!i||!i.guid)return!1;const o=String(i.guid).trim().toLowerCase();if(r.has(o))return!0;if(i.readAt){const a=new Date(i.readAt).getTime();if(!isNaN(a))return n-a<s}return!0})}async function Ft(e){const{value:t}=await ie("read");let n=!1,r=[];if(Array.isArray(t)){const i=new Date().toISOString();for(const o of t)typeof o=="string"&&o?(r.push({guid:o,readAt:i}),n=!0):typeof o=="object"&&o!==null&&typeof o.guid=="string"&&o.guid&&(o.readAt||(o.readAt=i,n=!0),r.push(o))}const s=await Qr(e,r,Date.now());if(s.length!==r.length&&(n=!0),n)try{await we("read",s),console.log(`Sanitized, pruned, or migrated read items. Original count: ${t.length}, New count: ${s.length}`)}catch(i){console.error("Error saving pruned read items:",i)}return s}async function Yr(){const{value:e}=await ie("currentDeckGuids");if(e&&e.length>0&&typeof e[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const n=new Date().toISOString(),r=e.map(s=>({guid:s,addedAt:n}));return await we("currentDeckGuids",r),console.log(`[loadCurrentDeck] Migration complete. Loaded ${r.length} objects.`),r}const t=Array.isArray(e)?e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid):[];return console.log(`[loadCurrentDeck] Loaded ${t.length} deck objects.`),t}async function ei(e){if(!Array.isArray(e)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const t=e.filter(n=>typeof n=="object"&&n!==null&&typeof n.guid=="string"&&n.guid);t.length!==e.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",t.length,"deck objects.");try{const n=t.map(r=>Lt(r));await Co("currentDeckGuids",n)}catch(n){console.error("[saveCurrentDeck] An error occurred while saving the deck:",n)}}async function ti(){const{value:e}=await C("shuffleCount"),{value:t}=await C("lastShuffleResetDate");return{shuffleCount:typeof e=="number"?e:2,lastShuffleResetDate:t||new Date().toDateString()}}async function Ze(e,t){await j("shuffleCount",e),await j("lastShuffleResetDate",t),await fe({type:"simpleUpdate",key:"shuffleCount",value:e}),await fe({type:"simpleUpdate",key:"lastShuffleResetDate",value:t})}async function ni(e,t){e.filterMode=t,await j("filterMode",t),await fe({type:"simpleUpdate",key:"filterMode",value:t})}async function ri(){const{value:e}=await C("filterMode");return e||"unread"}const na=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:Ft,loadCurrentDeck:Yr,loadFilterMode:ri,loadShuffleState:ti,pruneStaleRead:Qr,saveCurrentDeck:ei,saveShuffleState:Ze,setFilterMode:ni,toggleItemStateAndSync:jt},Symbol.toStringTag,{value:"Module"}));function ra(){document.dispatchEvent(new CustomEvent("app-data-ready",{bubbles:!0})),console.log("Dispatched 'app-data-ready' event.")}async function ii(e,t,n,r=()=>{}){const s=t();s&&s.addEventListener("change",async()=>{const i=e[n];await j(n,i),r(i)})}async function ia(e){await ii(e,Ro,"syncEnabled",async t=>{if(e.updateSyncStatusMessage(),t){if(console.log("Sync enabled, triggering full sync."),await Wr(e),!e.currentDeckGuids?.length&&e.entries?.length){console.log("Deck is empty after sync. Rebuilding from all available items.");const n=new Date().toISOString(),r=new Set(e.read.map(i=>i.guid)),s=new Set(e.shuffledOutItems.map(i=>i.guid));e.currentDeckGuids=e.entries.filter(i=>!r.has(i.guid)&&!s.has(i.guid)).map(i=>({guid:i.guid,addedAt:n})),await we("currentDeckGuids",e.currentDeckGuids),console.log(`Rebuilt deck with ${e.currentDeckGuids.length} items.`)}ra()}})}async function sa(e){await ii(e,Po,"imagesEnabled")}function oa(e){const t=document.documentElement,n=No(),r=Lo();if(!n||!r)return;const s=i=>{t.classList.remove("light","dark"),t.classList.add(i),n.checked=i==="dark",r.textContent=i};s(e.theme),n.addEventListener("change",async()=>{const i=n.checked?"dark":"light";e.theme=i,s(i),await j("theme",i)})}async function On(e,t,n,r,s){const i=t(),o=r();console.log(`[DEBUG] setupTextareaPanel for key: ${e}. configBtn:`,i,"saveBtn:",o),!(!i||!o)&&(i.addEventListener("click",async()=>{let a;if(e==="rssFeeds"||e==="keywordBlacklist")try{const c=await To(e);console.log(`[DEBUG] loadUserState response for ${e}:`,c),a=c.value}catch(c){console.error(`Error loading ${e} from server:`,c),a=e==="rssFeeds"?"":[]}else a=(await C(e)).value;console.log(`[DEBUG] Value before setting app input for ${e}:`,a);let l;if(e==="rssFeeds"&&a&&typeof a=="object"){let c=[];for(const u in a)if(typeof a[u]=="object")for(const d in a[u])Array.isArray(a[u][d])&&a[u][d].forEach(f=>{f&&f.url&&c.push(f.url)});l=c.join(`
`)}else l=Array.isArray(a)?a.filter(Boolean).sort().join(`
`):a||"";console.log(`[DEBUG] Content for ${e} input:`,l),console.log(`[DEBUG] Final content for ${e} input before assignment:`,l),console.log(`[DEBUG] Final content for ${e} input before assignment:`,l),s[`${e}Input`]=l,s.modalView=e}),o.addEventListener("click",async()=>{const c=(n()?.value??s[`${e}Input`]).split(/\r?\n/).map(u=>u.trim()).filter(Boolean);try{e==="rssFeeds"||e==="keywordBlacklist"?await $o(e,c):await j(e,c),s[`${e}Input`]=c.sort().join(`
`),B(`${e} saved.`,"success")}catch(u){console.error(u),B(`Error saving ${e}!`,"error")}}))}async function aa(e){console.log("[DEBUG] initConfigPanelListeners called."),Zr()?.addEventListener("click",()=>{e.modalView="main"}),await On("rssFeeds",Vo,qo,Xo,e),await On("keywordBlacklist",Jo,Wo,Zo,e)}let Ge;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),Ge=e;const t=document.getElementById("install-button");t&&(t.style.display="block",t.addEventListener("click",()=>{Ge.prompt(),Ge.userChoice.then(n=>{n.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),Ge=null})}))});const la="modulepreload",ca=function(e){return"/"+e},Cn={},ua=function(t,n,r){let s=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");s=l(n.map(c=>{if(c=ca(c),c in Cn)return;Cn[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":la,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((y,m)=>{f.addEventListener("load",y),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})},da=10,Ue=2,le=e=>typeof e=="object"&&e.guid?e.guid:e,xe=async(e,t,n,r,s,i="unread",o=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:e.length,readItemsCount:t.length,starredItemsCount:n.length,shuffledOutItemsCount:r.length,shuffleCount:s,filterMode:i,lastShuffleResetDate:o}),!Array.isArray(e)||e.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),console.log("manageDailyDeck: END (skipped)"),{deck:[],currentDeckGuids:[],shuffledOutGuids:r||[],shuffleCount:s||Ue,lastShuffleResetDate:o||new Date().toDateString()};const a=e,l=Array.isArray(t)?t:[],c=Array.isArray(n)?n:[],u=Array.isArray(r)?r:[],{loadCurrentDeck:d}=await ua(async()=>{const{loadCurrentDeck:M}=await Promise.resolve().then(()=>na);return{loadCurrentDeck:M}},void 0),f=await d();console.log("manageDailyDeck: Loaded currentDeckItems count:",f.length);const y=new Set(l.map(le)),m=new Set(c.map(le)),p=new Set(u.map(le));new Set(f.map(le)),console.log(`[deckManager] DEBUG: allItems count: ${a.length}`),console.log(`[deckManager] DEBUG: readGuids count: ${y.size}`),console.log(`[deckManager] DEBUG: shuffledOutGuids count: ${p.size}`),console.log(`[deckManager] DEBUG: currentDeck count: ${f.length}`);const g=new Date().toDateString(),w=o!==g,_=f.filter(M=>!y.has(le(M))),h=_.length===0;console.log("manageDailyDeck: isDeckEffectivelyEmpty:",h,"visibleItemsInCurrentDeck count:",_.length);let v=[],E=f,S=u,D=s||Ue,P=o||g;console.log("manageDailyDeck: Condition check:",{isNewDay:w,isDeckEffectivelyEmpty:h,filterModeIsNotUnread:i!=="unread"});{console.log(`[deckManager] Resetting deck. Reason: New Day (${w}), Deck Effectively Empty (${h}), or Filter Mode Changed (${i}).`);const M=await Bo(a,l,c,u,f,da,i);console.log("manageDailyDeck: generateNewDeck returned count:",M.length);const ae=new Date().toISOString();E=(M||[]).map(U=>({guid:U.guid,addedAt:ae})),v=(M||[]).map(U=>({...U,isRead:y.has(U.guid),isStarred:m.has(U.guid)})),await ei(E),w?(S=[],await we("shuffledOutGuids",[]),D=Ue,await Ze(D,g),P=g,await j("lastShuffleResetDate",g)):h&&i==="unread"&&(D=Math.min(D+1,Ue),await Ze(D,o))}return console.log(`[deckManager] Deck management complete. Final deck size: ${v.length}.`),console.log("manageDailyDeck: END"),{deck:v,currentDeckGuids:E,shuffledOutGuids:S,shuffleCount:D,lastShuffleResetDate:P}};async function fa(e){if(console.log("[deckManager] processShuffle called."),e.shuffleCount<=0){B("No shuffles left for today!","error");return}const t=e.deck.map(c=>c.guid),n=(e.shuffledOutItems||e.shuffledOutGuids||[]).map(le),r=new Set(n),s=new Set([...r,...t]),i=new Date().toISOString(),o=Array.from(s).map(c=>({guid:c,shuffledAt:i}));e.shuffledOutItems=o,e.shuffledOutGuids=o,e.shuffleCount--,await we("shuffledOutGuids",o),await Ze(e.shuffleCount,e.lastShuffleResetDate);const a=jo();a&&(a.textContent=e.shuffleCount);const l=await xe(e.entries,e.read,e.starred,e.shuffledOutItems,e.shuffleCount,e.filterMode,e.lastShuffleResetDate);e.deck=l.deck,e.currentDeckGuids=l.currentDeckGuids,Yo("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${e.shuffleCount}.`)}function ha(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,modalView:"main",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,openUrlsInNewTabEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutItems:[],errorMessage:"",isOnline:z(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",rssSaveMessage:"",keywordSaveMessage:"",_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,initApp:async function(){if(!window.appInitialized)try{console.log("Starting app initialization..."),this.progressMessage="Connecting to database...",this.db=await Kr(),console.log("Database initialized"),this.progressMessage="Loading settings...",await this._loadInitialState(),console.log("Initial state loaded"),this.progressMessage="Initializing UI components...",oa(this),ia(this),sa(this),console.log("[DEBUG] Calling initConfigPanelListeners..."),this.$nextTick(()=>{aa(this)}),ta(),console.log("UI components initialized"),this.progressMessage="Loading existing data...",await this.loadFeedItemsFromDB(),this.entries=mt(Object.values(this.feedItems),Fe)||[],await this._loadAndManageAllData(),this.updateAllUI(),console.log("Initial UI rendered from local cache."),this.loading=!1,this.progressMessage="",console.log("App is visible. Proceeding with background sync."),this.isOnline&&this.syncEnabled&&await this.performBackgroundSync(),this._initComplete=!0,window.appInitialized=!0,this._setupWatchers(),this._setupEventListeners(),this._initObservers(),this._startPeriodicSync(),await this.$nextTick(),this._initScrollObserver(),console.log("App initialization and background sync complete.");try{B("App ready","success")}catch{console.log("Status bar not ready yet, but initialization complete")}this.updateSyncStatusMessage()}catch(e){console.error("Initialization failed:",e),this.errorMessage=`Could not load feed: ${e.message}`,this.progressMessage=`Error: ${e.message}`,this.loading=!1}},performBackgroundSync:async function(){if(!(this._isSyncing||!this.isOnline||!this.syncEnabled)){this._isSyncing=!0,console.log("[Sync] Starting background sync...");try{await Nt(),await ce(),await Ke(this),await this.loadFeedItemsFromDB(),await this._reconcileAndRefreshUI(),console.log("[Sync] Background sync completed successfully.")}catch(e){console.error("[Sync] Background sync failed:",e),B("Background sync failed","error")}finally{this._isSyncing=!1}}},_reconcileAndRefreshUI:async function(){console.log("[UI] Reconciling UI after sync...");const e=5;this.read=await Ft(Object.values(this.feedItems)),this.starred=(await ie("starred")).value||[];const n=(await xe(this.entries,this.read,this.starred,this.shuffledOutItems,this.shuffleCount,this.filterMode,this.lastShuffleResetDate)).deck,r=new Set(n.map(l=>l.guid)),s=this.deck.filter(l=>r.has(l.guid)&&!l.isStale).length;console.log(`[UI] Active items in current view: ${s}. Threshold: ${e}`);let i=null,o=0;const a=document.querySelector("#items");if(a){const l=Array.from(a.querySelectorAll(".item-card:not(.is-stale)"));for(const c of l){const u=c.getBoundingClientRect();if(u.top>=0&&u.top<window.innerHeight){i=c,o=u.top;break}}}if(s<=e){if(console.log("[UI] Active items below threshold. Performing immediate, anchored refresh."),this.deck=n,i){await this.$nextTick();const l=document.querySelector(`[data-guid="${i.dataset.guid}"]`);if(l){const u=l.getBoundingClientRect().top-o;console.log(`[UI] Restoring scroll position. Offset: ${u}px`),window.scrollBy(0,u)}}}else{console.log("[UI] Active items above threshold. Performing deferred update.");const l=new Set(this.deck.map(d=>d.guid));let c=[];for(const d of this.deck)if(r.has(d.guid))c.push(d);else{d.isStale=!0,c.push(d);const f=document.querySelector(`[data-guid="${d.guid}"]`);f&&this.staleItemObserver&&this.staleItemObserver.observe(f)}const u=n.filter(d=>!l.has(d.guid));if(this.deck=[...u,...c],i){await this.$nextTick();const f=i.getBoundingClientRect().top-o;f!==0&&(console.log(`[UI] Restoring scroll position. Offset: ${f}px`),window.scrollBy(0,f))}}},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(e=>{e.forEach(t=>{if(!t.isIntersecting){const n=t.target.dataset.guid;console.log(`[Observer] Stale item ${n} is off-screen. Removing.`),this.deck=this.deck.filter(r=>r.guid!==n),this.staleItemObserver.unobserve(t.target)}})},{root:null,threshold:0})},updateSyncStatusMessage:function(){const e=z();let t="",n=!1;e?this.syncEnabled||(t="Sync is disabled.",n=!0):(t="Offline.",n=!0),this.syncStatusMessage=t,this.showSyncStatus=n},loadAndDisplayDeck:async function(){try{console.log("Loading and displaying deck...");const e=this.currentDeckGuids.map(i=>i.guid),t=[],n=new Set(this.read.map(i=>i.guid)),r=new Set(this.starred.map(i=>i.guid)),s=new Set;for(const i of e){if(typeof i!="string"||!i)continue;const o=this.feedItems[i];if(o&&o.guid&&!s.has(o.guid)){const a=Jr(o,Fe);a.isRead=n.has(a.guid),a.isStarred=r.has(a.guid),t.push(a),s.add(a.guid)}}this.deck=Array.isArray(t)?t.sort((i,o)=>o.timestamp-i.timestamp):[],console.log(`Deck loaded with ${this.deck.length} items`)}catch(e){console.error("Error loading deck:",e),this.deck=[]}},loadFeedItemsFromDB:async function(){try{if(console.log("Loading feed items from database..."),!this.db){console.warn("Database not available"),this.entries=[],this.feedItems={};return}const e=await qr();console.log(`Retrieved ${e.length} raw items from DB`),this.feedItems={};const t=[],n=new Set;e.forEach(r=>{r&&r.guid&&!n.has(r.guid)&&(this.feedItems[r.guid]=r,t.push(r),n.add(r.guid))}),this.entries=mt(t,Fe)||[],console.log(`Processed ${this.entries.length} unique entries`)}catch(e){console.error("Error loading feed items from DB:",e),this.entries=[],this.feedItems={}}},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const e=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}`;if(this.entries.length>0&&e===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let t=[];const n=new Map(this.read.map(i=>[i.guid,i.readAt])),r=new Map(this.starred.map(i=>[i.guid,i.starredAt]));switch(this.filterMode){case"unread":t=this.deck.filter(i=>!i.isStale&&!n.has(i.guid));break;case"all":t=this.entries;break;case"read":t=this.entries.filter(i=>n.has(i.guid)).sort((i,o)=>new Date(n.get(o.guid)).getTime()-new Date(n.get(i.guid)).getTime());break;case"starred":t=this.entries.filter(i=>r.has(i.guid)).sort((i,o)=>new Date(r.get(o.guid)).getTime()-new Date(r.get(i.guid)).getTime());break}this.filterMode!=="unread"&&(t=t.map(i=>({...i,isRead:n.has(i.guid),isStarred:r.has(i.guid)})));const s=(this.keywordBlacklistInput??"").split(/\r?\n/).map(i=>i.trim().toLowerCase()).filter(i=>i.length>0);return s.length>0&&(t=t.filter(i=>{const o=`${i.title} ${i.description}`.toLowerCase();return!s.some(a=>o.includes(a))})),this._cachedFilteredEntries=t,this._lastFilterHash=e,t},isStarred:function(e){return this.starred.some(t=>t.guid===e)},isRead:function(e){return this.read.some(t=>t.guid===e)},toggleStar:async function(e){try{await jt(this,e,"starred"),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage()}catch(t){console.error("Error toggling star:",t),B("Error updating star status","error")}},toggleRead:async function(e){try{await jt(this,e,"read"),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage()}catch(t){console.error("Error toggling read:",t),B("Error updating read status","error")}},processShuffle:async function(){try{await fa(this),await this.loadAndDisplayDeck(),this.updateCounts()}catch(e){console.error("Error processing shuffle:",e),B("Error shuffling items","error")}},saveRssFeeds:async function(){const e={},t="Uncategorized",n="Default";e[t]={},e[t][n]=[],this.rssFeedsInput.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).forEach(s=>{e[t][n].push({url:s})}),await j("rssFeeds",e),B("RSS Feeds saved!","success"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...",await Wr(this),await this.loadFeedItemsFromDB();const r=await xe(this.entries,this.read,this.starred,this.shuffledOutItems,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=r.deck,this.currentDeckGuids=r.currentDeckGuids,this.progressMessage="",this.loading=!1},async saveKeywordBlacklist(){try{const e=this.keywordBlacklistInput.split(/\r?\n/).map(t=>t.trim()).filter(Boolean);await j("keywordBlacklist",e),this.keywordSaveMessage="Keywords saved!",B("Keyword Blacklist saved!","success"),this.updateCounts()}catch(e){console.error("Error saving keyword blacklist:",e),B("Error saving keywords","error")}},updateCounts:function(){try{ea(this)}catch(e){console.error("Error updating counts:",e)}},scrollToTop:function(){try{Xr()}catch(e){console.error("Error scrolling to top:",e)}},_loadInitialState:async function(){try{const[e,t,n,r,s]=await Promise.all([C("syncEnabled"),C("imagesEnabled"),C("openUrlsInNewTabEnabled"),ri(),C("theme","userSettings")]);this.syncEnabled=e.value??!0,this.imagesEnabled=t.value??!0,this.openUrlsInNewTabEnabled=n.value??!0,this.filterMode=r,this.theme=s.value??"dark",this.isOnline=z();const[i,o]=await Promise.all([C("rssFeeds"),C("keywordBlacklist")]);let a=[];if(i.value&&typeof i.value=="object"){for(const l in i.value)if(typeof i.value[l]=="object")for(const c in i.value[l])Array.isArray(i.value[l][c])&&i.value[l][c].forEach(u=>{u&&u.url&&a.push(u.url)})}this.rssFeedsInput=a.join(`
`),this.keywordBlacklistInput=Array.isArray(o.value)?o.value.join(`
`):""}catch(e){console.error("Error loading initial state:",e),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){try{console.log("Loading and managing all data...");const[e,t,n,r]=await Promise.all([ie("starred"),ie("shuffledOutGuids"),Yr(),ti()]),s=[];if(Array.isArray(e.value))for(const a of e.value){const l=typeof a=="string"?a:a?.guid;l&&s.push({guid:l,starredAt:a?.starredAt||new Date().toISOString()})}this.starred=[...new Map(s.map(a=>[a.guid,a])).values()];const i=[];if(Array.isArray(t.value))for(const a of t.value){const l=typeof a=="string"?a:a?.guid;l&&i.push({guid:l,shuffledAt:a?.shuffledAt||new Date().toISOString()})}this.shuffledOutItems=[...new Map(i.map(a=>[a.guid,a])).values()],this.currentDeckGuids=Array.isArray(n)?n:[],this.shuffleCount=r.shuffleCount||0,this.lastShuffleResetDate=r.lastShuffleResetDate,this.read=await Ft(Object.values(this.feedItems)),console.log(`Loaded ${this.read.length} read items`),this.entries.length===0&&Object.keys(this.feedItems).length>0&&(this.entries=mt(Object.values(this.feedItems),Fe)||[]);const o=await xe(this.entries,this.read,this.starred,this.shuffledOutItems,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=o.deck,this.currentDeckGuids=o.currentDeckGuids,this.shuffledOutItems=o.shuffledOutGuids,this.shuffleCount=o.shuffleCount,this.lastShuffleResetDate=o.lastShuffleResetDate,await this.loadAndDisplayDeck(),console.log("Data management complete - final deck size:",this.deck.length)}catch(e){console.error("Error loading and managing data:",e),this.starred=[],tis.shuffledOutItems=[],this.currentDeckGuids=[],this.shuffleCount=0,this.read=[],this.deck=[]}},updateAllUI:function(){try{this.updateCounts()}catch(e){console.error("Error updating UI:",e)}},_setupWatchers:function(){this._initComplete&&(this.$watch("openSettings",async e=>{e?(this.modalView="main",await An(this)):await kn()}),this.$watch("openUrlsInNewTabEnabled",()=>{this.$nextTick(()=>{document.querySelectorAll(".itemdescription").forEach(e=>this.handleEntryLinks(e))})}),this.$watch("modalView",async()=>An(this)),this.$watch("filterMode",async e=>{if(this._initComplete)try{if(await ni(this,e),e==="unread"){const t=await xe(this.entries,this.read,this.starred,this.shuffledOutItems,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=t.deck,this.currentDeckGuids=t.currentDeckGuids}this.scrollToTop()}catch(t){console.error("Error in filterMode watcher:",t)}}))},_setupEventListeners:function(){document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this._initComplete&&this.performBackgroundSync()});const e=async()=>{if(!(!this.syncEnabled||!this.isOnline))try{await Ke(this),await ce(),await this._loadAndManageAllData(),this.deckManaged=!0}catch(t){console.error("Background sync failed:",t)}};window.addEventListener("online",async()=>{if(this.isOnline=!0,this.updateSyncStatusMessage(),this.syncEnabled)try{await Nt(),await e()}catch(t){console.error("Error handling online event:",t)}}),window.addEventListener("offline",()=>{this.isOnline=!1,this.updateSyncStatusMessage()}),window.addEventListener("beforeunload",()=>{try{this.filterMode==="unread"&&!this.openSettings&&kn()}catch(t){console.error("Error saving scroll position on beforeunload:",t)}})},_startPeriodicSync:function(){let e=Date.now();const t=()=>e=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(s=>{document.addEventListener(s,t,!0)});const n=300*1e3,r=60*1e3;setInterval(async()=>{const s=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||document.read||s-e>r))try{await Ke(this),await ce(),await this._loadAndManageAllData(),this.deckManaged=!0}catch(i){console.error("Periodic sync failed:",i)}},n)},_initScrollObserver:function(){try{const e=new IntersectionObserver(async s=>{},{root:document.querySelector("#items"),rootMargin:"0px",threshold:.1}),t=document.querySelector("#items");if(!t){console.warn("Feed container not found for scroll observer");return}const n=()=>{t.querySelectorAll("[data-guid]").forEach(s=>{e.observe(s)})};n(),new MutationObserver(()=>{e.disconnect(),n()}).observe(t,{childList:!0,subtree:!0}),this.scrollObserver=e}catch(e){console.error("Error initializing scroll observer:",e)}},handleEntryLinks:function(e){if(e)try{e.querySelectorAll("a").forEach(t=>{t.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")):t.removeAttribute("target"))})}catch(t){console.error("Error handling entry links:",t)}}}}Ur.data("rssApp",ha);Ur.start();
