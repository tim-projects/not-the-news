/* empty css              */(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();const Or="modulepreload",Tr=function(t){return"/"+t},On={},C=function(n,s,r){let i=Promise.resolve();if(s&&s.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=c(s.map(u=>{if(u=Tr(u),u in On)return;On[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":Or,d||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),d)return new Promise((y,b)=>{g.addEventListener("load",y),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return n().catch(o)})};var xt=!1,Ot=!1,de=[],Tt=-1;function Cr(t){Mr(t)}function Mr(t){de.includes(t)||de.push(t),Pr()}function $r(t){let n=de.indexOf(t);n!==-1&&n>Tt&&de.splice(n,1)}function Pr(){!Ot&&!xt&&(xt=!0,queueMicrotask(Rr))}function Rr(){xt=!1,Ot=!0;for(let t=0;t<de.length;t++)de[t](),Tt=t;de.length=0,Tt=-1,Ot=!1}var ve,pe,ke,Jn,Ct=!0;function Gr(t){Ct=!1,t(),Ct=!0}function Br(t){ve=t.reactive,ke=t.release,pe=n=>t.effect(n,{scheduler:s=>{Ct?Cr(s):s()}}),Jn=t.raw}function Tn(t){pe=t}function Lr(t){let n=()=>{};return[r=>{let i=pe(r);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach(o=>o())}),t._x_effects.add(i),n=()=>{i!==void 0&&(t._x_effects.delete(i),ke(i))},i},()=>{n()}]}function Yn(t,n){let s=!0,r,i=pe(()=>{let o=t();JSON.stringify(o),s?r=o:queueMicrotask(()=>{n(o,r),r=o}),s=!1});return()=>ke(i)}var Xn=[],Qn=[],Zn=[];function Fr(t){Zn.push(t)}function Zt(t,n){typeof n=="function"?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(n)):(n=t,Qn.push(n))}function es(t){Xn.push(t)}function ts(t,n,s){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[n]||(t._x_attributeCleanups[n]=[]),t._x_attributeCleanups[n].push(s)}function ns(t,n){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach(([s,r])=>{(n===void 0||n.includes(s))&&(r.forEach(i=>i()),delete t._x_attributeCleanups[s])})}function jr(t){for(t._x_effects?.forEach($r);t._x_cleanups?.length;)t._x_cleanups.pop()()}var en=new MutationObserver(rn),tn=!1;function nn(){en.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),tn=!0}function ss(){Nr(),en.disconnect(),tn=!1}var Ie=[];function Nr(){let t=en.takeRecords();Ie.push(()=>t.length>0&&rn(t));let n=Ie.length;queueMicrotask(()=>{if(Ie.length===n)for(;Ie.length>0;)Ie.shift()()})}function x(t){if(!tn)return t();ss();let n=t();return nn(),n}var sn=!1,Xe=[];function Ur(){sn=!0}function zr(){sn=!1,rn(Xe),Xe=[]}function rn(t){if(sn){Xe=Xe.concat(t);return}let n=[],s=new Set,r=new Map,i=new Map;for(let o=0;o<t.length;o++)if(!t[o].target._x_ignoreMutationObserver&&(t[o].type==="childList"&&(t[o].removedNodes.forEach(a=>{a.nodeType===1&&a._x_marker&&s.add(a)}),t[o].addedNodes.forEach(a=>{if(a.nodeType===1){if(s.has(a)){s.delete(a);return}a._x_marker||n.push(a)}})),t[o].type==="attributes")){let a=t[o].target,l=t[o].attributeName,c=t[o].oldValue,u=()=>{r.has(a)||r.set(a,[]),r.get(a).push({name:l,value:a.getAttribute(l)})},d=()=>{i.has(a)||i.set(a,[]),i.get(a).push(l)};a.hasAttribute(l)&&c===null?u():a.hasAttribute(l)?(d(),u()):d()}i.forEach((o,a)=>{ns(a,o)}),r.forEach((o,a)=>{Xn.forEach(l=>l(a,o))});for(let o of s)n.some(a=>a.contains(o))||Qn.forEach(a=>a(o));for(let o of n)o.isConnected&&Zn.forEach(a=>a(o));n=null,s=null,r=null,i=null}function rs(t){return Be(_e(t))}function Ge(t,n,s){return t._x_dataStack=[n,..._e(s||t)],()=>{t._x_dataStack=t._x_dataStack.filter(r=>r!==n)}}function _e(t){return t._x_dataStack?t._x_dataStack:typeof ShadowRoot=="function"&&t instanceof ShadowRoot?_e(t.host):t.parentNode?_e(t.parentNode):[]}function Be(t){return new Proxy({objects:t},Vr)}var Vr={ownKeys({objects:t}){return Array.from(new Set(t.flatMap(n=>Object.keys(n))))},has({objects:t},n){return n==Symbol.unscopables?!1:t.some(s=>Object.prototype.hasOwnProperty.call(s,n)||Reflect.has(s,n))},get({objects:t},n,s){return n=="toJSON"?Wr:Reflect.get(t.find(r=>Reflect.has(r,n))||{},n,s)},set({objects:t},n,s,r){const i=t.find(a=>Object.prototype.hasOwnProperty.call(a,n))||t[t.length-1],o=Object.getOwnPropertyDescriptor(i,n);return o?.set&&o?.get?o.set.call(r,s)||!0:Reflect.set(i,n,s)}};function Wr(){return Reflect.ownKeys(this).reduce((n,s)=>(n[s]=Reflect.get(this,s),n),{})}function is(t){let n=r=>typeof r=="object"&&!Array.isArray(r)&&r!==null,s=(r,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(r)).forEach(([o,{value:a,enumerable:l}])=>{if(l===!1||a===void 0||typeof a=="object"&&a!==null&&a.__v_skip)return;let c=i===""?o:`${i}.${o}`;typeof a=="object"&&a!==null&&a._x_interceptor?r[o]=a.initialize(t,c,o):n(a)&&a!==r&&!(a instanceof Element)&&s(a,c)})};return s(t)}function os(t,n=()=>{}){let s={initialValue:void 0,_x_interceptor:!0,initialize(r,i,o){return t(this.initialValue,()=>Kr(r,i),a=>Mt(r,i,a),i,o)}};return n(s),r=>{if(typeof r=="object"&&r!==null&&r._x_interceptor){let i=s.initialize.bind(s);s.initialize=(o,a,l)=>{let c=r.initialize(o,a,l);return s.initialValue=c,i(o,a,l)}}else s.initialValue=r;return s}}function Kr(t,n){return n.split(".").reduce((s,r)=>s[r],t)}function Mt(t,n,s){if(typeof n=="string"&&(n=n.split(".")),n.length===1)t[n[0]]=s;else{if(n.length===0)throw error;return t[n[0]]||(t[n[0]]={}),Mt(t[n[0]],n.slice(1),s)}}var as={};function V(t,n){as[t]=n}function $t(t,n){let s=Hr(n);return Object.entries(as).forEach(([r,i])=>{Object.defineProperty(t,`$${r}`,{get(){return i(n,s)},enumerable:!1})}),t}function Hr(t){let[n,s]=hs(t),r={interceptor:os,...n};return Zt(t,s),r}function qr(t,n,s,...r){try{return s(...r)}catch(i){Pe(i,t,n)}}function Pe(t,n,s=void 0){t=Object.assign(t??{message:"No error message given."},{el:n,expression:s}),console.warn(`Alpine Expression Error: ${t.message}

${s?'Expression: "'+s+`"

`:""}`,n),setTimeout(()=>{throw t},0)}var He=!0;function ls(t){let n=He;He=!1;let s=t();return He=n,s}function fe(t,n,s={}){let r;return P(t,n)(i=>r=i,s),r}function P(...t){return cs(...t)}var cs=us;function Jr(t){cs=t}function us(t,n){let s={};$t(s,t);let r=[s,..._e(t)],i=typeof n=="function"?Yr(r,n):Qr(r,n,t);return qr.bind(null,t,n,i)}function Yr(t,n){return(s=()=>{},{scope:r={},params:i=[]}={})=>{let o=n.apply(Be([r,...t]),i);Qe(s,o)}}var gt={};function Xr(t,n){if(gt[t])return gt[t];let s=Object.getPrototypeOf(async function(){}).constructor,r=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t,o=(()=>{try{let a=new s(["__self","scope"],`with (scope) { __self.result = ${r} }; __self.finished = true; return __self.result;`);return Object.defineProperty(a,"name",{value:`[Alpine] ${t}`}),a}catch(a){return Pe(a,n,t),Promise.resolve()}})();return gt[t]=o,o}function Qr(t,n,s){let r=Xr(n,s);return(i=()=>{},{scope:o={},params:a=[]}={})=>{r.result=void 0,r.finished=!1;let l=Be([o,...t]);if(typeof r=="function"){let c=r(r,l).catch(u=>Pe(u,s,n));r.finished?(Qe(i,r.result,l,a,s),r.result=void 0):c.then(u=>{Qe(i,u,l,a,s)}).catch(u=>Pe(u,s,n)).finally(()=>r.result=void 0)}}}function Qe(t,n,s,r,i){if(He&&typeof n=="function"){let o=n.apply(s,r);o instanceof Promise?o.then(a=>Qe(t,a,s,r)).catch(a=>Pe(a,i,n)):t(o)}else typeof n=="object"&&n instanceof Promise?n.then(o=>t(o)):t(n)}var on="x-";function De(t=""){return on+t}function Zr(t){on=t}var Ze={};function T(t,n){return Ze[t]=n,{before(s){if(!Ze[s]){console.warn(String.raw`Cannot find directive \`${s}\`. \`${t}\` will use the default order of execution`);return}const r=ue.indexOf(s);ue.splice(r>=0?r:ue.indexOf("DEFAULT"),0,t)}}}function ei(t){return Object.keys(Ze).includes(t)}function an(t,n,s){if(n=Array.from(n),t._x_virtualDirectives){let o=Object.entries(t._x_virtualDirectives).map(([l,c])=>({name:l,value:c})),a=ds(o);o=o.map(l=>a.find(c=>c.name===l.name)?{name:`x-bind:${l.name}`,value:`"${l.value}"`}:l),n=n.concat(o)}let r={};return n.map(ps((o,a)=>r[o]=a)).filter(ws).map(si(r,s)).sort(ri).map(o=>ni(t,o))}function ds(t){return Array.from(t).map(ps()).filter(n=>!ws(n))}var Pt=!1,Te=new Map,fs=Symbol();function ti(t){Pt=!0;let n=Symbol();fs=n,Te.set(n,[]);let s=()=>{for(;Te.get(n).length;)Te.get(n).shift()();Te.delete(n)},r=()=>{Pt=!1,s()};t(s),r()}function hs(t){let n=[],s=l=>n.push(l),[r,i]=Lr(t);return n.push(i),[{Alpine:Le,effect:r,cleanup:s,evaluateLater:P.bind(P,t),evaluate:fe.bind(fe,t)},()=>n.forEach(l=>l())]}function ni(t,n){let s=()=>{},r=Ze[n.type]||s,[i,o]=hs(t);ts(t,n.original,o);let a=()=>{t._x_ignore||t._x_ignoreSelf||(r.inline&&r.inline(t,n,i),r=r.bind(r,t,n,i),Pt?Te.get(fs).push(r):r())};return a.runCleanups=o,a}var gs=(t,n)=>({name:s,value:r})=>(s.startsWith(t)&&(s=s.replace(t,n)),{name:s,value:r}),ms=t=>t;function ps(t=()=>{}){return({name:n,value:s})=>{let{name:r,value:i}=ys.reduce((o,a)=>a(o),{name:n,value:s});return r!==n&&t(r,n),{name:r,value:i}}}var ys=[];function ln(t){ys.push(t)}function ws({name:t}){return Ss().test(t)}var Ss=()=>new RegExp(`^${on}([^:^.]+)\\b`);function si(t,n){return({name:s,value:r})=>{let i=s.match(Ss()),o=s.match(/:([a-zA-Z0-9\-_:]+)/),a=s.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],l=n||t[s]||s;return{type:i?i[1]:null,value:o?o[1]:null,modifiers:a.map(c=>c.replace(".","")),expression:r,original:l}}}var Rt="DEFAULT",ue=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Rt,"teleport"];function ri(t,n){let s=ue.indexOf(t.type)===-1?Rt:t.type,r=ue.indexOf(n.type)===-1?Rt:n.type;return ue.indexOf(s)-ue.indexOf(r)}function Me(t,n,s={}){t.dispatchEvent(new CustomEvent(n,{detail:s,bubbles:!0,composed:!0,cancelable:!0}))}function me(t,n){if(typeof ShadowRoot=="function"&&t instanceof ShadowRoot){Array.from(t.children).forEach(i=>me(i,n));return}let s=!1;if(n(t,()=>s=!0),s)return;let r=t.firstElementChild;for(;r;)me(r,n),r=r.nextElementSibling}function L(t,...n){console.warn(`Alpine Warning: ${t}`,...n)}var Cn=!1;function ii(){Cn&&L("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Cn=!0,document.body||L("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Me(document,"alpine:init"),Me(document,"alpine:initializing"),nn(),Fr(n=>X(n,me)),Zt(n=>Ae(n)),es((n,s)=>{an(n,s).forEach(r=>r())});let t=n=>!rt(n.parentElement,!0);Array.from(document.querySelectorAll(vs().join(","))).filter(t).forEach(n=>{X(n)}),Me(document,"alpine:initialized"),setTimeout(()=>{ci()})}var cn=[],_s=[];function bs(){return cn.map(t=>t())}function vs(){return cn.concat(_s).map(t=>t())}function ks(t){cn.push(t)}function Ds(t){_s.push(t)}function rt(t,n=!1){return Ee(t,s=>{if((n?vs():bs()).some(i=>s.matches(i)))return!0})}function Ee(t,n){if(t){if(n(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),!!t.parentElement)return Ee(t.parentElement,n)}}function oi(t){return bs().some(n=>t.matches(n))}var Es=[];function ai(t){Es.push(t)}var li=1;function X(t,n=me,s=()=>{}){Ee(t,r=>r._x_ignore)||ti(()=>{n(t,(r,i)=>{r._x_marker||(s(r,i),Es.forEach(o=>o(r,i)),an(r,r.attributes).forEach(o=>o()),r._x_ignore||(r._x_marker=li++),r._x_ignore&&i())})})}function Ae(t,n=me){n(t,s=>{jr(s),ns(s),delete s._x_marker})}function ci(){[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach(([n,s,r])=>{ei(s)||r.some(i=>{if(document.querySelector(i))return L(`found "${i}", but missing ${n} plugin`),!0})})}var Gt=[],un=!1;function dn(t=()=>{}){return queueMicrotask(()=>{un||setTimeout(()=>{Bt()})}),new Promise(n=>{Gt.push(()=>{t(),n()})})}function Bt(){for(un=!1;Gt.length;)Gt.shift()()}function ui(){un=!0}function fn(t,n){return Array.isArray(n)?Mn(t,n.join(" ")):typeof n=="object"&&n!==null?di(t,n):typeof n=="function"?fn(t,n()):Mn(t,n)}function Mn(t,n){let s=i=>i.split(" ").filter(o=>!t.classList.contains(o)).filter(Boolean),r=i=>(t.classList.add(...i),()=>{t.classList.remove(...i)});return n=n===!0?n="":n||"",r(s(n))}function di(t,n){let s=l=>l.split(" ").filter(Boolean),r=Object.entries(n).flatMap(([l,c])=>c?s(l):!1).filter(Boolean),i=Object.entries(n).flatMap(([l,c])=>c?!1:s(l)).filter(Boolean),o=[],a=[];return i.forEach(l=>{t.classList.contains(l)&&(t.classList.remove(l),a.push(l))}),r.forEach(l=>{t.classList.contains(l)||(t.classList.add(l),o.push(l))}),()=>{a.forEach(l=>t.classList.add(l)),o.forEach(l=>t.classList.remove(l))}}function it(t,n){return typeof n=="object"&&n!==null?fi(t,n):hi(t,n)}function fi(t,n){let s={};return Object.entries(n).forEach(([r,i])=>{s[r]=t.style[r],r.startsWith("--")||(r=gi(r)),t.style.setProperty(r,i)}),setTimeout(()=>{t.style.length===0&&t.removeAttribute("style")}),()=>{it(t,s)}}function hi(t,n){let s=t.getAttribute("style",n);return t.setAttribute("style",n),()=>{t.setAttribute("style",s||"")}}function gi(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Lt(t,n=()=>{}){let s=!1;return function(){s?n.apply(this,arguments):(s=!0,t.apply(this,arguments))}}T("transition",(t,{value:n,modifiers:s,expression:r},{evaluate:i})=>{typeof r=="function"&&(r=i(r)),r!==!1&&(!r||typeof r=="boolean"?pi(t,s,n):mi(t,r,n))});function mi(t,n,s){As(t,fn,""),{enter:i=>{t._x_transition.enter.during=i},"enter-start":i=>{t._x_transition.enter.start=i},"enter-end":i=>{t._x_transition.enter.end=i},leave:i=>{t._x_transition.leave.during=i},"leave-start":i=>{t._x_transition.leave.start=i},"leave-end":i=>{t._x_transition.leave.end=i}}[s](n)}function pi(t,n,s){As(t,it);let r=!n.includes("in")&&!n.includes("out")&&!s,i=r||n.includes("in")||["enter"].includes(s),o=r||n.includes("out")||["leave"].includes(s);n.includes("in")&&!r&&(n=n.filter((m,p)=>p<n.indexOf("out"))),n.includes("out")&&!r&&(n=n.filter((m,p)=>p>n.indexOf("out")));let a=!n.includes("opacity")&&!n.includes("scale"),l=a||n.includes("opacity"),c=a||n.includes("scale"),u=l?0:1,d=c?xe(n,"scale",95)/100:1,h=xe(n,"delay",0)/1e3,g=xe(n,"origin","center"),y="opacity, transform",b=xe(n,"duration",150)/1e3,S=xe(n,"duration",75)/1e3,f="cubic-bezier(0.4, 0.0, 0.2, 1)";i&&(t._x_transition.enter.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:y,transitionDuration:`${b}s`,transitionTimingFunction:f},t._x_transition.enter.start={opacity:u,transform:`scale(${d})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"}),o&&(t._x_transition.leave.during={transformOrigin:g,transitionDelay:`${h}s`,transitionProperty:y,transitionDuration:`${S}s`,transitionTimingFunction:f},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:u,transform:`scale(${d})`})}function As(t,n,s={}){t._x_transition||(t._x_transition={enter:{during:s,start:s,end:s},leave:{during:s,start:s,end:s},in(r=()=>{},i=()=>{}){Ft(t,n,{during:this.enter.during,start:this.enter.start,end:this.enter.end},r,i)},out(r=()=>{},i=()=>{}){Ft(t,n,{during:this.leave.during,start:this.leave.start,end:this.leave.end},r,i)}})}window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,n,s,r){const i=document.visibilityState==="visible"?requestAnimationFrame:setTimeout;let o=()=>i(s);if(n){t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(s):o():t._x_transition?t._x_transition.in(s):o();return}t._x_hidePromise=t._x_transition?new Promise((a,l)=>{t._x_transition.out(()=>{},()=>a(r)),t._x_transitioning&&t._x_transitioning.beforeCancel(()=>l({isFromCancelledTransition:!0}))}):Promise.resolve(r),queueMicrotask(()=>{let a=Is(t);a?(a._x_hideChildren||(a._x_hideChildren=[]),a._x_hideChildren.push(t)):i(()=>{let l=c=>{let u=Promise.all([c._x_hidePromise,...(c._x_hideChildren||[]).map(l)]).then(([d])=>d?.());return delete c._x_hidePromise,delete c._x_hideChildren,u};l(t).catch(c=>{if(!c.isFromCancelledTransition)throw c})})})};function Is(t){let n=t.parentNode;if(n)return n._x_hidePromise?n:Is(n)}function Ft(t,n,{during:s,start:r,end:i}={},o=()=>{},a=()=>{}){if(t._x_transitioning&&t._x_transitioning.cancel(),Object.keys(s).length===0&&Object.keys(r).length===0&&Object.keys(i).length===0){o(),a();return}let l,c,u;yi(t,{start(){l=n(t,r)},during(){c=n(t,s)},before:o,end(){l(),u=n(t,i)},after:a,cleanup(){c(),u()}})}function yi(t,n){let s,r,i,o=Lt(()=>{x(()=>{s=!0,r||n.before(),i||(n.end(),Bt()),n.after(),t.isConnected&&n.cleanup(),delete t._x_transitioning})});t._x_transitioning={beforeCancels:[],beforeCancel(a){this.beforeCancels.push(a)},cancel:Lt(function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();o()}),finish:o},x(()=>{n.start(),n.during()}),ui(),requestAnimationFrame(()=>{if(s)return;let a=Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s",""))*1e3,l=Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""))*1e3;a===0&&(a=Number(getComputedStyle(t).animationDuration.replace("s",""))*1e3),x(()=>{n.before()}),r=!0,requestAnimationFrame(()=>{s||(x(()=>{n.end()}),Bt(),setTimeout(t._x_transitioning.finish,a+l),i=!0)})})}function xe(t,n,s){if(t.indexOf(n)===-1)return s;const r=t[t.indexOf(n)+1];if(!r||n==="scale"&&isNaN(r))return s;if(n==="duration"||n==="delay"){let i=r.match(/([0-9]+)ms/);if(i)return i[1]}return n==="origin"&&["top","right","left","center","bottom"].includes(t[t.indexOf(n)+2])?[r,t[t.indexOf(n)+2]].join(" "):r}var se=!1;function oe(t,n=()=>{}){return(...s)=>se?n(...s):t(...s)}function wi(t){return(...n)=>se&&t(...n)}var xs=[];function ot(t){xs.push(t)}function Si(t,n){xs.forEach(s=>s(t,n)),se=!0,Os(()=>{X(n,(s,r)=>{r(s,()=>{})})}),se=!1}var jt=!1;function _i(t,n){n._x_dataStack||(n._x_dataStack=t._x_dataStack),se=!0,jt=!0,Os(()=>{bi(n)}),se=!1,jt=!1}function bi(t){let n=!1;X(t,(r,i)=>{me(r,(o,a)=>{if(n&&oi(o))return a();n=!0,i(o,a)})})}function Os(t){let n=pe;Tn((s,r)=>{let i=n(s);return ke(i),()=>{}}),t(),Tn(n)}function Ts(t,n,s,r=[]){switch(t._x_bindings||(t._x_bindings=ve({})),t._x_bindings[n]=s,n=r.includes("camel")?Oi(n):n,n){case"value":vi(t,s);break;case"style":Di(t,s);break;case"class":ki(t,s);break;case"selected":case"checked":Ei(t,n,s);break;default:Cs(t,n,s);break}}function vi(t,n){if(Ps(t))t.attributes.value===void 0&&(t.value=n),window.fromModel&&(typeof n=="boolean"?t.checked=qe(t.value)===n:t.checked=$n(t.value,n));else if(hn(t))Number.isInteger(n)?t.value=n:!Array.isArray(n)&&typeof n!="boolean"&&![null,void 0].includes(n)?t.value=String(n):Array.isArray(n)?t.checked=n.some(s=>$n(s,t.value)):t.checked=!!n;else if(t.tagName==="SELECT")xi(t,n);else{if(t.value===n)return;t.value=n===void 0?"":n}}function ki(t,n){t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedClasses=fn(t,n)}function Di(t,n){t._x_undoAddedStyles&&t._x_undoAddedStyles(),t._x_undoAddedStyles=it(t,n)}function Ei(t,n,s){Cs(t,n,s),Ii(t,n,s)}function Cs(t,n,s){[null,void 0,!1].includes(s)&&Ci(n)?t.removeAttribute(n):(Ms(n)&&(s=n),Ai(t,n,s))}function Ai(t,n,s){t.getAttribute(n)!=s&&t.setAttribute(n,s)}function Ii(t,n,s){t[n]!==s&&(t[n]=s)}function xi(t,n){const s=[].concat(n).map(r=>r+"");Array.from(t.options).forEach(r=>{r.selected=s.includes(r.value)})}function Oi(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function $n(t,n){return t==n}function qe(t){return[1,"1","true","on","yes",!0].includes(t)?!0:[0,"0","false","off","no",!1].includes(t)?!1:t?!!t:null}var Ti=new Set(["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","shadowrootclonable","shadowrootdelegatesfocus","shadowrootserializable"]);function Ms(t){return Ti.has(t)}function Ci(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}function Mi(t,n,s){return t._x_bindings&&t._x_bindings[n]!==void 0?t._x_bindings[n]:$s(t,n,s)}function $i(t,n,s,r=!0){if(t._x_bindings&&t._x_bindings[n]!==void 0)return t._x_bindings[n];if(t._x_inlineBindings&&t._x_inlineBindings[n]!==void 0){let i=t._x_inlineBindings[n];return i.extract=r,ls(()=>fe(t,i.expression))}return $s(t,n,s)}function $s(t,n,s){let r=t.getAttribute(n);return r===null?typeof s=="function"?s():s:r===""?!0:Ms(n)?!![n,"true"].includes(r):r}function hn(t){return t.type==="checkbox"||t.localName==="ui-checkbox"||t.localName==="ui-switch"}function Ps(t){return t.type==="radio"||t.localName==="ui-radio"}function Rs(t,n){var s;return function(){var r=this,i=arguments,o=function(){s=null,t.apply(r,i)};clearTimeout(s),s=setTimeout(o,n)}}function Gs(t,n){let s;return function(){let r=this,i=arguments;s||(t.apply(r,i),s=!0,setTimeout(()=>s=!1,n))}}function Bs({get:t,set:n},{get:s,set:r}){let i=!0,o,a=pe(()=>{let l=t(),c=s();if(i)r(mt(l)),i=!1;else{let u=JSON.stringify(l),d=JSON.stringify(c);u!==o?r(mt(l)):u!==d&&n(mt(c))}o=JSON.stringify(t()),JSON.stringify(s())});return()=>{ke(a)}}function mt(t){return typeof t=="object"?JSON.parse(JSON.stringify(t)):t}function Pi(t){(Array.isArray(t)?t:[t]).forEach(s=>s(Le))}var le={},Pn=!1;function Ri(t,n){if(Pn||(le=ve(le),Pn=!0),n===void 0)return le[t];le[t]=n,is(le[t]),typeof n=="object"&&n!==null&&n.hasOwnProperty("init")&&typeof n.init=="function"&&le[t].init()}function Gi(){return le}var Ls={};function Bi(t,n){let s=typeof n!="function"?()=>n:n;return t instanceof Element?Fs(t,s()):(Ls[t]=s,()=>{})}function Li(t){return Object.entries(Ls).forEach(([n,s])=>{Object.defineProperty(t,n,{get(){return(...r)=>s(...r)}})}),t}function Fs(t,n,s){let r=[];for(;r.length;)r.pop()();let i=Object.entries(n).map(([a,l])=>({name:a,value:l})),o=ds(i);return i=i.map(a=>o.find(l=>l.name===a.name)?{name:`x-bind:${a.name}`,value:`"${a.value}"`}:a),an(t,i,s).map(a=>{r.push(a.runCleanups),a()}),()=>{for(;r.length;)r.pop()()}}var js={};function Fi(t,n){js[t]=n}function ji(t,n){return Object.entries(js).forEach(([s,r])=>{Object.defineProperty(t,s,{get(){return(...i)=>r.bind(n)(...i)},enumerable:!1})}),t}var Ni={get reactive(){return ve},get release(){return ke},get effect(){return pe},get raw(){return Jn},version:"3.14.9",flushAndStopDeferringMutations:zr,dontAutoEvaluateFunctions:ls,disableEffectScheduling:Gr,startObservingMutations:nn,stopObservingMutations:ss,setReactivityEngine:Br,onAttributeRemoved:ts,onAttributesAdded:es,closestDataStack:_e,skipDuringClone:oe,onlyDuringClone:wi,addRootSelector:ks,addInitSelector:Ds,interceptClone:ot,addScopeToNode:Ge,deferMutations:Ur,mapAttributes:ln,evaluateLater:P,interceptInit:ai,setEvaluator:Jr,mergeProxies:Be,extractProp:$i,findClosest:Ee,onElRemoved:Zt,closestRoot:rt,destroyTree:Ae,interceptor:os,transition:Ft,setStyles:it,mutateDom:x,directive:T,entangle:Bs,throttle:Gs,debounce:Rs,evaluate:fe,initTree:X,nextTick:dn,prefixed:De,prefix:Zr,plugin:Pi,magic:V,store:Ri,start:ii,clone:_i,cloneNode:Si,bound:Mi,$data:rs,watch:Yn,walk:me,data:Fi,bind:Bi},Le=Ni;function Ui(t,n){const s=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)s[r[i]]=!0;return i=>!!s[i]}var zi=Object.freeze({}),Vi=Object.prototype.hasOwnProperty,at=(t,n)=>Vi.call(t,n),he=Array.isArray,$e=t=>Ns(t)==="[object Map]",Wi=t=>typeof t=="string",gn=t=>typeof t=="symbol",lt=t=>t!==null&&typeof t=="object",Ki=Object.prototype.toString,Ns=t=>Ki.call(t),Us=t=>Ns(t).slice(8,-1),mn=t=>Wi(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Hi=t=>{const n=Object.create(null);return s=>n[s]||(n[s]=t(s))},qi=Hi(t=>t.charAt(0).toUpperCase()+t.slice(1)),zs=(t,n)=>t!==n&&(t===t||n===n),Nt=new WeakMap,Oe=[],H,ge=Symbol("iterate"),Ut=Symbol("Map key iterate");function Ji(t){return t&&t._isEffect===!0}function Yi(t,n=zi){Ji(t)&&(t=t.raw);const s=Zi(t,n);return n.lazy||s(),s}function Xi(t){t.active&&(Vs(t),t.options.onStop&&t.options.onStop(),t.active=!1)}var Qi=0;function Zi(t,n){const s=function(){if(!s.active)return t();if(!Oe.includes(s)){Vs(s);try{return to(),Oe.push(s),H=s,t()}finally{Oe.pop(),Ws(),H=Oe[Oe.length-1]}}};return s.id=Qi++,s.allowRecurse=!!n.allowRecurse,s._isEffect=!0,s.active=!0,s.raw=t,s.deps=[],s.options=n,s}function Vs(t){const{deps:n}=t;if(n.length){for(let s=0;s<n.length;s++)n[s].delete(t);n.length=0}}var be=!0,pn=[];function eo(){pn.push(be),be=!1}function to(){pn.push(be),be=!0}function Ws(){const t=pn.pop();be=t===void 0?!0:t}function U(t,n,s){if(!be||H===void 0)return;let r=Nt.get(t);r||Nt.set(t,r=new Map);let i=r.get(s);i||r.set(s,i=new Set),i.has(H)||(i.add(H),H.deps.push(i),H.options.onTrack&&H.options.onTrack({effect:H,target:t,type:n,key:s}))}function re(t,n,s,r,i,o){const a=Nt.get(t);if(!a)return;const l=new Set,c=d=>{d&&d.forEach(h=>{(h!==H||h.allowRecurse)&&l.add(h)})};if(n==="clear")a.forEach(c);else if(s==="length"&&he(t))a.forEach((d,h)=>{(h==="length"||h>=r)&&c(d)});else switch(s!==void 0&&c(a.get(s)),n){case"add":he(t)?mn(s)&&c(a.get("length")):(c(a.get(ge)),$e(t)&&c(a.get(Ut)));break;case"delete":he(t)||(c(a.get(ge)),$e(t)&&c(a.get(Ut)));break;case"set":$e(t)&&c(a.get(ge));break}const u=d=>{d.options.onTrigger&&d.options.onTrigger({effect:d,target:t,key:s,type:n,newValue:r,oldValue:i,oldTarget:o}),d.options.scheduler?d.options.scheduler(d):d()};l.forEach(u)}var no=Ui("__proto__,__v_isRef,__isVue"),Ks=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(gn)),so=Hs(),ro=Hs(!0),Rn=io();function io(){const t={};return["includes","indexOf","lastIndexOf"].forEach(n=>{t[n]=function(...s){const r=E(this);for(let o=0,a=this.length;o<a;o++)U(r,"get",o+"");const i=r[n](...s);return i===-1||i===!1?r[n](...s.map(E)):i}}),["push","pop","shift","unshift","splice"].forEach(n=>{t[n]=function(...s){eo();const r=E(this)[n].apply(this,s);return Ws(),r}}),t}function Hs(t=!1,n=!1){return function(r,i,o){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_raw"&&o===(t?n?_o:Xs:n?So:Ys).get(r))return r;const a=he(r);if(!t&&a&&at(Rn,i))return Reflect.get(Rn,i,o);const l=Reflect.get(r,i,o);return(gn(i)?Ks.has(i):no(i))||(t||U(r,"get",i),n)?l:zt(l)?!a||!mn(i)?l.value:l:lt(l)?t?Qs(l):_n(l):l}}var oo=ao();function ao(t=!1){return function(s,r,i,o){let a=s[r];if(!t&&(i=E(i),a=E(a),!he(s)&&zt(a)&&!zt(i)))return a.value=i,!0;const l=he(s)&&mn(r)?Number(r)<s.length:at(s,r),c=Reflect.set(s,r,i,o);return s===E(o)&&(l?zs(i,a)&&re(s,"set",r,i,a):re(s,"add",r,i)),c}}function lo(t,n){const s=at(t,n),r=t[n],i=Reflect.deleteProperty(t,n);return i&&s&&re(t,"delete",n,void 0,r),i}function co(t,n){const s=Reflect.has(t,n);return(!gn(n)||!Ks.has(n))&&U(t,"has",n),s}function uo(t){return U(t,"iterate",he(t)?"length":ge),Reflect.ownKeys(t)}var fo={get:so,set:oo,deleteProperty:lo,has:co,ownKeys:uo},ho={get:ro,set(t,n){return console.warn(`Set operation on key "${String(n)}" failed: target is readonly.`,t),!0},deleteProperty(t,n){return console.warn(`Delete operation on key "${String(n)}" failed: target is readonly.`,t),!0}},yn=t=>lt(t)?_n(t):t,wn=t=>lt(t)?Qs(t):t,Sn=t=>t,ct=t=>Reflect.getPrototypeOf(t);function je(t,n,s=!1,r=!1){t=t.__v_raw;const i=E(t),o=E(n);n!==o&&!s&&U(i,"get",n),!s&&U(i,"get",o);const{has:a}=ct(i),l=r?Sn:s?wn:yn;if(a.call(i,n))return l(t.get(n));if(a.call(i,o))return l(t.get(o));t!==i&&t.get(n)}function Ne(t,n=!1){const s=this.__v_raw,r=E(s),i=E(t);return t!==i&&!n&&U(r,"has",t),!n&&U(r,"has",i),t===i?s.has(t):s.has(t)||s.has(i)}function Ue(t,n=!1){return t=t.__v_raw,!n&&U(E(t),"iterate",ge),Reflect.get(t,"size",t)}function Gn(t){t=E(t);const n=E(this);return ct(n).has.call(n,t)||(n.add(t),re(n,"add",t,t)),this}function Bn(t,n){n=E(n);const s=E(this),{has:r,get:i}=ct(s);let o=r.call(s,t);o?Js(s,r,t):(t=E(t),o=r.call(s,t));const a=i.call(s,t);return s.set(t,n),o?zs(n,a)&&re(s,"set",t,n,a):re(s,"add",t,n),this}function Ln(t){const n=E(this),{has:s,get:r}=ct(n);let i=s.call(n,t);i?Js(n,s,t):(t=E(t),i=s.call(n,t));const o=r?r.call(n,t):void 0,a=n.delete(t);return i&&re(n,"delete",t,void 0,o),a}function Fn(){const t=E(this),n=t.size!==0,s=$e(t)?new Map(t):new Set(t),r=t.clear();return n&&re(t,"clear",void 0,void 0,s),r}function ze(t,n){return function(r,i){const o=this,a=o.__v_raw,l=E(a),c=n?Sn:t?wn:yn;return!t&&U(l,"iterate",ge),a.forEach((u,d)=>r.call(i,c(u),c(d),o))}}function Ve(t,n,s){return function(...r){const i=this.__v_raw,o=E(i),a=$e(o),l=t==="entries"||t===Symbol.iterator&&a,c=t==="keys"&&a,u=i[t](...r),d=s?Sn:n?wn:yn;return!n&&U(o,"iterate",c?Ut:ge),{next(){const{value:h,done:g}=u.next();return g?{value:h,done:g}:{value:l?[d(h[0]),d(h[1])]:d(h),done:g}},[Symbol.iterator](){return this}}}}function ee(t){return function(...n){{const s=n[0]?`on key "${n[0]}" `:"";console.warn(`${qi(t)} operation ${s}failed: target is readonly.`,E(this))}return t==="delete"?!1:this}}function go(){const t={get(o){return je(this,o)},get size(){return Ue(this)},has:Ne,add:Gn,set:Bn,delete:Ln,clear:Fn,forEach:ze(!1,!1)},n={get(o){return je(this,o,!1,!0)},get size(){return Ue(this)},has:Ne,add:Gn,set:Bn,delete:Ln,clear:Fn,forEach:ze(!1,!0)},s={get(o){return je(this,o,!0)},get size(){return Ue(this,!0)},has(o){return Ne.call(this,o,!0)},add:ee("add"),set:ee("set"),delete:ee("delete"),clear:ee("clear"),forEach:ze(!0,!1)},r={get(o){return je(this,o,!0,!0)},get size(){return Ue(this,!0)},has(o){return Ne.call(this,o,!0)},add:ee("add"),set:ee("set"),delete:ee("delete"),clear:ee("clear"),forEach:ze(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=Ve(o,!1,!1),s[o]=Ve(o,!0,!1),n[o]=Ve(o,!1,!0),r[o]=Ve(o,!0,!0)}),[t,s,n,r]}var[mo,po,Ea,Aa]=go();function qs(t,n){const s=t?po:mo;return(r,i,o)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?r:Reflect.get(at(s,i)&&i in r?s:r,i,o)}var yo={get:qs(!1)},wo={get:qs(!0)};function Js(t,n,s){const r=E(s);if(r!==s&&n.call(t,r)){const i=Us(t);console.warn(`Reactive ${i} contains both the raw and reactive versions of the same object${i==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Ys=new WeakMap,So=new WeakMap,Xs=new WeakMap,_o=new WeakMap;function bo(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vo(t){return t.__v_skip||!Object.isExtensible(t)?0:bo(Us(t))}function _n(t){return t&&t.__v_isReadonly?t:Zs(t,!1,fo,yo,Ys)}function Qs(t){return Zs(t,!0,ho,wo,Xs)}function Zs(t,n,s,r,i){if(!lt(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&!(n&&t.__v_isReactive))return t;const o=i.get(t);if(o)return o;const a=vo(t);if(a===0)return t;const l=new Proxy(t,a===2?r:s);return i.set(t,l),l}function E(t){return t&&E(t.__v_raw)||t}function zt(t){return!!(t&&t.__v_isRef===!0)}V("nextTick",()=>dn);V("dispatch",t=>Me.bind(Me,t));V("watch",(t,{evaluateLater:n,cleanup:s})=>(r,i)=>{let o=n(r),l=Yn(()=>{let c;return o(u=>c=u),c},i);s(l)});V("store",Gi);V("data",t=>rs(t));V("root",t=>rt(t));V("refs",t=>(t._x_refs_proxy||(t._x_refs_proxy=Be(ko(t))),t._x_refs_proxy));function ko(t){let n=[];return Ee(t,s=>{s._x_refs&&n.push(s._x_refs)}),n}var pt={};function er(t){return pt[t]||(pt[t]=0),++pt[t]}function Do(t,n){return Ee(t,s=>{if(s._x_ids&&s._x_ids[n])return!0})}function Eo(t,n){t._x_ids||(t._x_ids={}),t._x_ids[n]||(t._x_ids[n]=er(n))}V("id",(t,{cleanup:n})=>(s,r=null)=>{let i=`${s}${r?`-${r}`:""}`;return Ao(t,i,n,()=>{let o=Do(t,s),a=o?o._x_ids[s]:er(s);return r?`${s}-${a}-${r}`:`${s}-${a}`})});ot((t,n)=>{t._x_id&&(n._x_id=t._x_id)});function Ao(t,n,s,r){if(t._x_id||(t._x_id={}),t._x_id[n])return t._x_id[n];let i=r();return t._x_id[n]=i,s(()=>{delete t._x_id[n]}),i}V("el",t=>t);tr("Focus","focus","focus");tr("Persist","persist","persist");function tr(t,n,s){V(n,r=>L(`You can't use [$${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}T("modelable",(t,{expression:n},{effect:s,evaluateLater:r,cleanup:i})=>{let o=r(n),a=()=>{let d;return o(h=>d=h),d},l=r(`${n} = __placeholder`),c=d=>l(()=>{},{scope:{__placeholder:d}}),u=a();c(u),queueMicrotask(()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let d=t._x_model.get,h=t._x_model.set,g=Bs({get(){return d()},set(y){h(y)}},{get(){return a()},set(y){c(y)}});i(g)})});T("teleport",(t,{modifiers:n,expression:s},{cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-teleport can only be used on a <template> tag",t);let i=jn(s),o=t.content.cloneNode(!0).firstElementChild;t._x_teleport=o,o._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),o.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach(l=>{o.addEventListener(l,c=>{c.stopPropagation(),t.dispatchEvent(new c.constructor(c.type,c))})}),Ge(o,{},t);let a=(l,c,u)=>{u.includes("prepend")?c.parentNode.insertBefore(l,c):u.includes("append")?c.parentNode.insertBefore(l,c.nextSibling):c.appendChild(l)};x(()=>{a(o,i,n),oe(()=>{X(o)})()}),t._x_teleportPutBack=()=>{let l=jn(s);x(()=>{a(t._x_teleport,l,n)})},r(()=>x(()=>{o.remove(),Ae(o)}))});var Io=document.createElement("div");function jn(t){let n=oe(()=>document.querySelector(t),()=>Io)();return n||L(`Cannot find x-teleport element for selector: "${t}"`),n}var nr=()=>{};nr.inline=(t,{modifiers:n},{cleanup:s})=>{n.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,s(()=>{n.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore})};T("ignore",nr);T("effect",oe((t,{expression:n},{effect:s})=>{s(P(t,n))}));function Vt(t,n,s,r){let i=t,o=c=>r(c),a={},l=(c,u)=>d=>u(c,d);if(s.includes("dot")&&(n=xo(n)),s.includes("camel")&&(n=Oo(n)),s.includes("passive")&&(a.passive=!0),s.includes("capture")&&(a.capture=!0),s.includes("window")&&(i=window),s.includes("document")&&(i=document),s.includes("debounce")){let c=s[s.indexOf("debounce")+1]||"invalid-wait",u=et(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Rs(o,u)}if(s.includes("throttle")){let c=s[s.indexOf("throttle")+1]||"invalid-wait",u=et(c.split("ms")[0])?Number(c.split("ms")[0]):250;o=Gs(o,u)}return s.includes("prevent")&&(o=l(o,(c,u)=>{u.preventDefault(),c(u)})),s.includes("stop")&&(o=l(o,(c,u)=>{u.stopPropagation(),c(u)})),s.includes("once")&&(o=l(o,(c,u)=>{c(u),i.removeEventListener(n,o,a)})),(s.includes("away")||s.includes("outside"))&&(i=document,o=l(o,(c,u)=>{t.contains(u.target)||u.target.isConnected!==!1&&(t.offsetWidth<1&&t.offsetHeight<1||t._x_isShown!==!1&&c(u))})),s.includes("self")&&(o=l(o,(c,u)=>{u.target===t&&c(u)})),(Co(n)||sr(n))&&(o=l(o,(c,u)=>{Mo(u,s)||c(u)})),i.addEventListener(n,o,a),()=>{i.removeEventListener(n,o,a)}}function xo(t){return t.replace(/-/g,".")}function Oo(t){return t.toLowerCase().replace(/-(\w)/g,(n,s)=>s.toUpperCase())}function et(t){return!Array.isArray(t)&&!isNaN(t)}function To(t){return[" ","_"].includes(t)?t:t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase()}function Co(t){return["keydown","keyup"].includes(t)}function sr(t){return["contextmenu","click","mouse"].some(n=>t.includes(n))}function Mo(t,n){let s=n.filter(o=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(o));if(s.includes("debounce")){let o=s.indexOf("debounce");s.splice(o,et((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.includes("throttle")){let o=s.indexOf("throttle");s.splice(o,et((s[o+1]||"invalid-wait").split("ms")[0])?2:1)}if(s.length===0||s.length===1&&Nn(t.key).includes(s[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter(o=>s.includes(o));return s=s.filter(o=>!i.includes(o)),!(i.length>0&&i.filter(a=>((a==="cmd"||a==="super")&&(a="meta"),t[`${a}Key`])).length===i.length&&(sr(t.type)||Nn(t.key).includes(s[0])))}function Nn(t){if(!t)return[];t=To(t);let n={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return n[t]=t,Object.keys(n).map(s=>{if(n[s]===t)return s}).filter(s=>s)}T("model",(t,{modifiers:n,expression:s},{effect:r,cleanup:i})=>{let o=t;n.includes("parent")&&(o=t.parentNode);let a=P(o,s),l;typeof s=="string"?l=P(o,`${s} = __placeholder`):typeof s=="function"&&typeof s()=="string"?l=P(o,`${s()} = __placeholder`):l=()=>{};let c=()=>{let g;return a(y=>g=y),Un(g)?g.get():g},u=g=>{let y;a(b=>y=b),Un(y)?y.set(g):l(()=>{},{scope:{__placeholder:g}})};typeof s=="string"&&t.type==="radio"&&x(()=>{t.hasAttribute("name")||t.setAttribute("name",s)});var d=t.tagName.toLowerCase()==="select"||["checkbox","radio"].includes(t.type)||n.includes("lazy")?"change":"input";let h=se?()=>{}:Vt(t,d,n,g=>{u(yt(t,n,g,c()))});if(n.includes("fill")&&([void 0,null,""].includes(c())||hn(t)&&Array.isArray(c())||t.tagName.toLowerCase()==="select"&&t.multiple)&&u(yt(t,n,{target:t},c())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=h,i(()=>t._x_removeModelListeners.default()),t.form){let g=Vt(t.form,"reset",[],y=>{dn(()=>t._x_model&&t._x_model.set(yt(t,n,{target:t},c())))});i(()=>g())}t._x_model={get(){return c()},set(g){u(g)}},t._x_forceModelUpdate=g=>{g===void 0&&typeof s=="string"&&s.match(/\./)&&(g=""),window.fromModel=!0,x(()=>Ts(t,"value",g)),delete window.fromModel},r(()=>{let g=c();n.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate(g)})});function yt(t,n,s,r){return x(()=>{if(s instanceof CustomEvent&&s.detail!==void 0)return s.detail!==null&&s.detail!==void 0?s.detail:s.target.value;if(hn(t))if(Array.isArray(r)){let i=null;return n.includes("number")?i=wt(s.target.value):n.includes("boolean")?i=qe(s.target.value):i=s.target.value,s.target.checked?r.includes(i)?r:r.concat([i]):r.filter(o=>!$o(o,i))}else return s.target.checked;else{if(t.tagName.toLowerCase()==="select"&&t.multiple)return n.includes("number")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return wt(o)}):n.includes("boolean")?Array.from(s.target.selectedOptions).map(i=>{let o=i.value||i.text;return qe(o)}):Array.from(s.target.selectedOptions).map(i=>i.value||i.text);{let i;return Ps(t)?s.target.checked?i=s.target.value:i=r:i=s.target.value,n.includes("number")?wt(i):n.includes("boolean")?qe(i):n.includes("trim")?i.trim():i}}})}function wt(t){let n=t?parseFloat(t):null;return Po(n)?n:t}function $o(t,n){return t==n}function Po(t){return!Array.isArray(t)&&!isNaN(t)}function Un(t){return t!==null&&typeof t=="object"&&typeof t.get=="function"&&typeof t.set=="function"}T("cloak",t=>queueMicrotask(()=>x(()=>t.removeAttribute(De("cloak")))));Ds(()=>`[${De("init")}]`);T("init",oe((t,{expression:n},{evaluate:s})=>typeof n=="string"?!!n.trim()&&s(n,{},!1):s(n,{},!1)));T("text",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.textContent=o})})})});T("html",(t,{expression:n},{effect:s,evaluateLater:r})=>{let i=r(n);s(()=>{i(o=>{x(()=>{t.innerHTML=o,t._x_ignoreSelf=!0,X(t),delete t._x_ignoreSelf})})})});ln(gs(":",ms(De("bind:"))));var rr=(t,{value:n,modifiers:s,expression:r,original:i},{effect:o,cleanup:a})=>{if(!n){let c={};Li(c),P(t,r)(d=>{Fs(t,d,i)},{scope:c});return}if(n==="key")return Ro(t,r);if(t._x_inlineBindings&&t._x_inlineBindings[n]&&t._x_inlineBindings[n].extract)return;let l=P(t,r);o(()=>l(c=>{c===void 0&&typeof r=="string"&&r.match(/\./)&&(c=""),x(()=>Ts(t,n,c,s))})),a(()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()})};rr.inline=(t,{value:n,modifiers:s,expression:r})=>{n&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[n]={expression:r,extract:!1})};T("bind",rr);function Ro(t,n){t._x_keyExpression=n}ks(()=>`[${De("data")}]`);T("data",(t,{expression:n},{cleanup:s})=>{if(Go(t))return;n=n===""?"{}":n;let r={};$t(r,t);let i={};ji(i,r);let o=fe(t,n,{scope:i});(o===void 0||o===!0)&&(o={}),$t(o,t);let a=ve(o);is(a);let l=Ge(t,a);a.init&&fe(t,a.init),s(()=>{a.destroy&&fe(t,a.destroy),l()})});ot((t,n)=>{t._x_dataStack&&(n._x_dataStack=t._x_dataStack,n.setAttribute("data-has-alpine-state",!0))});function Go(t){return se?jt?!0:t.hasAttribute("data-has-alpine-state"):!1}T("show",(t,{modifiers:n,expression:s},{effect:r})=>{let i=P(t,s);t._x_doHide||(t._x_doHide=()=>{x(()=>{t.style.setProperty("display","none",n.includes("important")?"important":void 0)})}),t._x_doShow||(t._x_doShow=()=>{x(()=>{t.style.length===1&&t.style.display==="none"?t.removeAttribute("style"):t.style.removeProperty("display")})});let o=()=>{t._x_doHide(),t._x_isShown=!1},a=()=>{t._x_doShow(),t._x_isShown=!0},l=()=>setTimeout(a),c=Lt(h=>h?a():o(),h=>{typeof t._x_toggleAndCascadeWithTransitions=="function"?t._x_toggleAndCascadeWithTransitions(t,h,a,o):h?l():o()}),u,d=!0;r(()=>i(h=>{!d&&h===u||(n.includes("immediate")&&(h?l():o()),c(h),u=h,d=!1)}))});T("for",(t,{expression:n},{effect:s,cleanup:r})=>{let i=Lo(n),o=P(t,i.items),a=P(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},s(()=>Bo(t,i,o,a)),r(()=>{Object.values(t._x_lookup).forEach(l=>x(()=>{Ae(l),l.remove()})),delete t._x_prevKeys,delete t._x_lookup})});function Bo(t,n,s,r){let i=a=>typeof a=="object"&&!Array.isArray(a),o=t;s(a=>{Fo(a)&&a>=0&&(a=Array.from(Array(a).keys(),f=>f+1)),a===void 0&&(a=[]);let l=t._x_lookup,c=t._x_prevKeys,u=[],d=[];if(i(a))a=Object.entries(a).map(([f,m])=>{let p=zn(n,m,f,a);r(_=>{d.includes(_)&&L("Duplicate key on x-for",t),d.push(_)},{scope:{index:f,...p}}),u.push(p)});else for(let f=0;f<a.length;f++){let m=zn(n,a[f],f,a);r(p=>{d.includes(p)&&L("Duplicate key on x-for",t),d.push(p)},{scope:{index:f,...m}}),u.push(m)}let h=[],g=[],y=[],b=[];for(let f=0;f<c.length;f++){let m=c[f];d.indexOf(m)===-1&&y.push(m)}c=c.filter(f=>!y.includes(f));let S="template";for(let f=0;f<d.length;f++){let m=d[f],p=c.indexOf(m);if(p===-1)c.splice(f,0,m),h.push([S,f]);else if(p!==f){let _=c.splice(f,1)[0],O=c.splice(p-1,1)[0];c.splice(f,0,O),c.splice(p,0,_),g.push([_,O])}else b.push(m);S=m}for(let f=0;f<y.length;f++){let m=y[f];m in l&&(x(()=>{Ae(l[m]),l[m].remove()}),delete l[m])}for(let f=0;f<g.length;f++){let[m,p]=g[f],_=l[m],O=l[p],M=document.createElement("div");x(()=>{O||L('x-for ":key" is undefined or invalid',o,p,l),O.after(M),_.after(O),O._x_currentIfEl&&O.after(O._x_currentIfEl),M.before(_),_._x_currentIfEl&&_.after(_._x_currentIfEl),M.remove()}),O._x_refreshXForScope(u[d.indexOf(p)])}for(let f=0;f<h.length;f++){let[m,p]=h[f],_=m==="template"?o:l[m];_._x_currentIfEl&&(_=_._x_currentIfEl);let O=u[p],M=d[p],j=document.importNode(o.content,!0).firstElementChild,Q=ve(O);Ge(j,Q,o),j._x_refreshXForScope=W=>{Object.entries(W).forEach(([w,G])=>{Q[w]=G})},x(()=>{_.after(j),oe(()=>X(j))()}),typeof M=="object"&&L("x-for key cannot be an object, it must be a string or an integer",o),l[M]=j}for(let f=0;f<b.length;f++)l[b[f]]._x_refreshXForScope(u[d.indexOf(b[f])]);o._x_prevKeys=d})}function Lo(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,s=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(r);if(!i)return;let o={};o.items=i[2].trim();let a=i[1].replace(s,"").trim(),l=a.match(n);return l?(o.item=a.replace(n,"").trim(),o.index=l[1].trim(),l[2]&&(o.collection=l[2].trim())):o.item=a,o}function zn(t,n,s,r){let i={};return/^\[.*\]$/.test(t.item)&&Array.isArray(n)?t.item.replace("[","").replace("]","").split(",").map(a=>a.trim()).forEach((a,l)=>{i[a]=n[l]}):/^\{.*\}$/.test(t.item)&&!Array.isArray(n)&&typeof n=="object"?t.item.replace("{","").replace("}","").split(",").map(a=>a.trim()).forEach(a=>{i[a]=n[a]}):i[t.item]=n,t.index&&(i[t.index]=s),t.collection&&(i[t.collection]=r),i}function Fo(t){return!Array.isArray(t)&&!isNaN(t)}function ir(){}ir.inline=(t,{expression:n},{cleanup:s})=>{let r=rt(t);r._x_refs||(r._x_refs={}),r._x_refs[n]=t,s(()=>delete r._x_refs[n])};T("ref",ir);T("if",(t,{expression:n},{effect:s,cleanup:r})=>{t.tagName.toLowerCase()!=="template"&&L("x-if can only be used on a <template> tag",t);let i=P(t,n),o=()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let l=t.content.cloneNode(!0).firstElementChild;return Ge(l,{},t),x(()=>{t.after(l),oe(()=>X(l))()}),t._x_currentIfEl=l,t._x_undoIf=()=>{x(()=>{Ae(l),l.remove()}),delete t._x_currentIfEl},l},a=()=>{t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)};s(()=>i(l=>{l?o():a()})),r(()=>t._x_undoIf&&t._x_undoIf())});T("id",(t,{expression:n},{evaluate:s})=>{s(n).forEach(i=>Eo(t,i))});ot((t,n)=>{t._x_ids&&(n._x_ids=t._x_ids)});ln(gs("@",ms(De("on:"))));T("on",oe((t,{value:n,modifiers:s,expression:r},{cleanup:i})=>{let o=r?P(t,r):()=>{};t.tagName.toLowerCase()==="template"&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(n)||t._x_forwardEvents.push(n));let a=Vt(t,n,s,l=>{o(()=>{},{scope:{$event:l},params:[l]})});i(()=>a())}));ut("Collapse","collapse","collapse");ut("Intersect","intersect","intersect");ut("Focus","trap","focus");ut("Mask","mask","mask");function ut(t,n,s){T(n,r=>L(`You can't use [x-${n}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${s}`,r))}Le.setEvaluator(us);Le.setReactivityEngine({reactive:_n,effect:Yi,release:Xi,raw:E});var jo=Le,tt=jo;const No=(t,n)=>n.some(s=>t instanceof s);let Vn,Wn;function Uo(){return Vn||(Vn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zo(){return Wn||(Wn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const or=new WeakMap,Wt=new WeakMap,ar=new WeakMap,St=new WeakMap,bn=new WeakMap;function Vo(t){const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",a)},o=()=>{s(ne(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",a)});return n.then(s=>{s instanceof IDBCursor&&or.set(s,t)}).catch(()=>{}),bn.set(n,t),n}function Wo(t){if(Wt.has(t))return;const n=new Promise((s,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",a),t.removeEventListener("abort",a)},o=()=>{s(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",a),t.addEventListener("abort",a)});Wt.set(t,n)}let Kt={get(t,n,s){if(t instanceof IDBTransaction){if(n==="done")return Wt.get(t);if(n==="objectStoreNames")return t.objectStoreNames||ar.get(t);if(n==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return ne(t[n])},set(t,n,s){return t[n]=s,!0},has(t,n){return t instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in t}};function Ko(t){Kt=t(Kt)}function Ho(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...s){const r=t.call(_t(this),n,...s);return ar.set(r,n.sort?n.sort():[n]),ne(r)}:zo().includes(t)?function(...n){return t.apply(_t(this),n),ne(or.get(this))}:function(...n){return ne(t.apply(_t(this),n))}}function qo(t){return typeof t=="function"?Ho(t):(t instanceof IDBTransaction&&Wo(t),No(t,Uo())?new Proxy(t,Kt):t)}function ne(t){if(t instanceof IDBRequest)return Vo(t);if(St.has(t))return St.get(t);const n=qo(t);return n!==t&&(St.set(t,n),bn.set(n,t)),n}const _t=t=>bn.get(t);function Jo(t,n,{blocked:s,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(t,n),l=ne(a);return r&&a.addEventListener("upgradeneeded",c=>{r(ne(a.result),c.oldVersion,c.newVersion,ne(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{o&&c.addEventListener("close",()=>o()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const Yo=["get","getKey","getAll","getAllKeys","count"],Xo=["put","add","delete","clear"],bt=new Map;function Kn(t,n){if(!(t instanceof IDBDatabase&&!(n in t)&&typeof n=="string"))return;if(bt.get(n))return bt.get(n);const s=n.replace(/FromIndex$/,""),r=n!==s,i=Xo.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Yo.includes(s)))return;const o=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&c.done]))[0]};return bt.set(n,o),o}Ko(t=>({...t,get:(n,s,r)=>Kn(n,s)||t.get(n,s,r),has:(n,s)=>!!Kn(n,s)||t.has(n,s)}));const vt="not-the-news-db",kt=29;let te=null,we=null;const Qo=[{name:"feedItems",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"starred",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"read",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"currentDeckGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"shuffledOutGuids",keyPath:"id",options:{autoIncrement:!0},indexes:[{name:"guid",keyPath:"guid",options:{unique:!0}}]},{name:"userSettings",keyPath:"key"},{name:"pendingOperations",keyPath:"id",options:{autoIncrement:!0}}];async function nt(){if(te)return te;if(we)return we;we=Jo(vt,kt,{upgrade(t,n){console.log(`[DB] Upgrading database from version ${n} to ${kt}`);const s=new Set(t.objectStoreNames);Qo.forEach(r=>{let i;s.has(r.name)&&t.deleteObjectStore(r.name),i=t.createObjectStore(r.name,{keyPath:r.keyPath,...r.options||{}}),console.log(`[DB] Created/Recreated store: ${r.name}`),r.indexes&&r.indexes.forEach(o=>{i.createIndex(o.name,o.keyPath,o.options||{}),console.log(`[DB] Created index '${o.name}' on store '${r.name}'`)})})},blocked(){console.warn("[DB] Database upgrade blocked. Please close all other tabs with this site open.")},blocking(){console.warn("[DB] Database blocking other tabs.")}});try{return te=await we,console.log(`[DB] Opened '${vt}', version ${kt}`),te}catch(t){throw console.error(`[DB] Failed to open database '${vt}':`,t),te=null,we=null,t}}async function lr(){te&&(te.close(),te=null,we=null,console.log("[DB] Database connection closed."))}async function $(t){let n=await nt();return t(n)}const Y=()=>navigator.onLine,Re=window.location.origin;async function Fe(t,n,s){return $(async r=>{try{const i=s||new Date().toISOString();await r.put("userSettings",{key:t,value:n,lastModified:i})}catch(i){console.error(`[DB] Failed to save sync metadata for key '${t}':`,i)}})}async function Zo(t){return $(async n=>{const s={...t};s.id&&delete s.id;try{const r=n.transaction("pendingOperations","readwrite"),i=await r.store.add(s);return await r.done,i}catch(r){throw console.error("[DB] Error buffering operation:",r),r}})}async function N(t){if(!t||typeof t.type!="string"||t.type==="simpleUpdate"&&(t.value===null||t.value===void 0)){console.warn("[DB] Skipping invalid or empty operation:",t);return}try{const n=await Zo(t);console.log(`[DB] Operation buffered with ID: ${n}`,t);const{value:s}=await D("syncEnabled");if(Y()&&s){console.log(`[DB] Attempting immediate sync for ${t.type} (ID: ${n}).`);const r=[{...t,id:n}],i=await fetch(`${Re}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok){const l=await i.text();throw new Error(`HTTP error ${i.status} for immediate sync. Details: ${l}`)}const o=await i.json(),a=o.results?.find(l=>l.id===n);a?.status==="success"?(await $(l=>l.delete("pendingOperations",n)),console.log(`[DB] Successfully synced and removed immediate op ${n} (${t.type}).`),o.serverTime&&await Fe("lastStateSync",o.serverTime),q()):console.warn(`[DB] Immediate sync for op ${n} reported non-success by server:`,a)}else console.log(`[DB] ${Y()?"Sync is disabled.":"Offline."} Buffering op ${n} for later batch sync.`)}catch(n){console.error(`[DB] Network error during immediate sync for ${t.type}. Will retry with batch sync.`,n)}}async function ce(){const{value:t}=await D("syncEnabled");if(!Y()||!t){console.log("[DB] Offline or sync is disabled. Skipping batch sync.");return}const n=await $(s=>s.getAll("pendingOperations")).catch(s=>(console.error("[DB] Error fetching pending operations:",s),null));if(!n||n.length===0){n&&console.log("[DB] No pending operations.");return}console.log(`[DB] Sending ${n.length} batched operations to /api/user-state.`);try{const s=await fetch(`${Re}/api/user-state`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!s.ok)throw new Error(`HTTP error ${s.status}. Details: ${await s.text()}`);const r=await s.json();console.log("[DB] Batch sync successful. Server response:",r),r.results&&Array.isArray(r.results)?await $(async i=>{const o=i.transaction("pendingOperations","readwrite");for(const a of r.results)a.status==="success"&&a.id!==void 0?await o.store.delete(a.id):console.warn(`[DB] Op ${a.id??"N/A"} (${a.opType}) ${a.status}: ${a.reason||"N/A"}`);await o.done}):console.warn("[DB] Server response invalid; cannot clear buffered operations."),r.serverTime&&await Fe("lastStateSync",r.serverTime),q()}catch(s){console.error("[DB] Error during batch synchronization:",s)}}let Dt=!1,Hn=0;const ea=500;async function qn(t,n,s=!1){if(!s&&(await $(u=>u.getAll("pendingOperations")).catch(()=>[])).some(u=>u.key===t||u.type==="starDelta"&&t==="starred"||u.type==="readDelta"&&t==="read"||u.type==="simpleUpdate"&&u.key==="currentDeckGuids"))return console.log(`[DB] Skipping pull for '${t}' because local changes are pending synchronization.`),{key:t,status:"skipped_pending"};const{value:r,lastModified:i}=n.type==="array"?await ie(n.store):await D(t,n.store),o=i||"",a={"Content-Type":"application/json"};o&&!s&&(a["If-None-Match"]=o);try{const l=await fetch(`${Re}/api/user-state/${t}`,{method:"GET",headers:a});if(l.status===304&&!s)return{key:t,status:304,timestamp:o};if(!l.ok)return console.error(`[DB] HTTP error for ${t}: ${l.status}`),{key:t,status:l.status};const c=await l.json();if(console.log(`[DB Sync] Received data for ${t}:`,c.value),n.type==="array"){const u=c.value||[],d=r||[],h=new Set(u.map(S=>S.guid)),g=new Set(d.map(S=>S.guid)),y=s?u:u.filter(S=>!g.has(S.guid)),b=s?[]:d.filter(S=>!h.has(S.guid));(y.length>0||b.length>0||s)&&await $(async S=>{const f=S.transaction(n.store,"readwrite");s&&await f.store.clear();for(const m of y)await f.store.put(m);for(const m of b)s||await f.store.delete(m.id);await f.done})}else await Fe(t,c.value,c.lastModified);return{key:t,status:200,timestamp:c.lastModified}}catch(l){return console.error(`[DB] Failed to pull ${t}:`,l),{key:t,status:"error"}}}async function q(t=!1){if(!Y())return;let{value:n}=await D("syncEnabled");if(!n&&!t){console.log("[DB] Sync is disabled locally. Checking for remote status...");const r=z.syncEnabled;(await qn("syncEnabled",r,!1)).status===200&&(n=(await D("syncEnabled")).value)}if(!n&&!t||Dt&&!t)return;const s=Date.now();if(!(!t&&s-Hn<ea)){Hn=s,Dt=!0,console.log(`[DB] Pulling user state (force=${t})...`);try{const r=Object.entries(z).filter(([a,l])=>!l.localOnly&&a!=="syncEnabled"),o=(await Promise.all(r.map(([a,l])=>qn(a,l,t)))).reduce((a,l)=>l?.timestamp&&l.timestamp>a?l.timestamp:a,"");o&&await Fe("lastStateSync",o)}catch(r){console.error("[DB] User state pull failed:",r)}finally{Dt=!1,console.log("[DB] User state pull completed.")}}}async function vn(){return $(t=>t.getAll("feedItems")).catch(t=>(console.error("Failed to get all feed items:",t),[]))}async function Se(t){const{value:n}=await D("syncEnabled");if(!Y()||!n)return n&&console.log("[DB] Offline. Skipping feed sync."),!0;console.log("[DB] Fetching feed items from server.");try{const{value:s}=await D("lastFeedSync"),r=await fetch(`${Re}/api/feed-guids?since=${s||""}`);if(r.status===304)return console.log("[DB] Feed not modified."),!0;if(!r.ok)throw new Error(`HTTP error ${r.status} for /api/feed-guids`);const i=await r.json();console.log("[DB] /api/feed-guids response:",i);const{guids:o,serverTime:a}=i,l=new Set(o),c=await vn(),u=new Set(c.map(b=>b.guid)),d=[...l].filter(b=>!u.has(b));console.log(`[DB] GUIDs to fetch: ${d.length}`,d);const h=[...u].filter(b=>!l.has(b));console.log(`[DB] New GUIDs: ${d.length}, Deleting: ${h.length}`);const g=d.length;let y=0;if(d.length>0){const S=[];for(let f=0;f<d.length;f+=50){const m=d.slice(f,f+50),p=await fetch(`${Re}/api/feed-items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guids:m})});if(p.ok){const _=await p.json();console.log(`[DB] Fetched batch of ${_.length} items:`,_),S.push(..._),y+=_.length,t&&(t.progressMessage=`Fetching feed content... (${y}/${g})`)}else return console.error(`[DB] Failed to fetch a batch of feed items. Status: ${p.status}`),!1}await $(async f=>{const m=f.transaction("feedItems","readwrite");for(const p of S)p.guid&&await m.store.put(p);await m.done})}if(h.length>0){const b=new Map(c.map(S=>[S.guid,S.id]));await $(async S=>{const f=S.transaction("feedItems","readwrite");for(const m of h){const p=b.get(m);p!==void 0&&await f.store.delete(p)}await f.done})}return a&&await Fe("lastFeedSync",a),t?.loadFeedItemsFromDB?.(),t?.loadAndDisplayDeck?.(),t?.updateCounts?.(),!0}catch(s){return console.error("[DB] Failed to synchronize feed:",s),!1}}async function kn(t){const{value:n}=await D("syncEnabled");if(!Y()||!n)return!0;console.log("[DB] Full sync initiated.");try{return await ce(),await q(),await Se(t)}catch(s){return console.error("[DB] Full sync failed:",s),!1}}const z={starred:{store:"starred",type:"array",localOnly:!1,default:[]},read:{store:"read",type:"array",localOnly:!1,default:[]},currentDeckGuids:{store:"currentDeckGuids",type:"array",localOnly:!1,default:[]},shuffledOutGuids:{store:"shuffledOutGuids",type:"array",localOnly:!1,default:[]},lastStateSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},lastFeedSync:{store:"userSettings",type:"simple",localOnly:!1,default:0},openUrlsInNewTabEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},imagesEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},syncEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},theme:{store:"userSettings",type:"simple",localOnly:!1,default:"dark"},themeStyle:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleLight:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},themeStyleDark:{store:"userSettings",type:"simple",localOnly:!1,default:"original"},customCss:{store:"userSettings",type:"simple",localOnly:!1,default:""},fontSize:{store:"userSettings",type:"simple",localOnly:!0,default:100},feedWidth:{store:"userSettings",type:"simple",localOnly:!0,default:50},feedLastModified:{store:"userSettings",type:"simple",localOnly:!0,default:0},rssFeeds:{store:"userSettings",type:"simple",localOnly:!1,default:{}},keywordBlacklist:{store:"userSettings",type:"simple",localOnly:!1,default:[]},shuffleCount:{store:"userSettings",type:"simple",localOnly:!1,default:2},lastShuffleResetDate:{store:"userSettings",type:"simple",localOnly:!1,default:null},shadowsEnabled:{store:"userSettings",type:"simple",localOnly:!1,default:!0},pregeneratedOnlineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null},pregeneratedOfflineDeck:{store:"userSettings",type:"simple",localOnly:!0,default:null}};async function D(t,n="userSettings"){return $(async s=>{try{const r=await s.get(n,t);return{value:r?r.value:z[t]?.default||null,lastModified:r?.lastModified||null}}catch(r){return console.error(`Failed to load simple state for key '${t}':`,r),{value:z[t]?.default||null,lastModified:null}}})}async function F(t,n,s="userSettings"){await $(i=>i.put(s,{key:t,value:n,lastModified:new Date().toISOString()}));const r=z[t];r&&!r.localOnly&&await N({type:"simpleUpdate",key:t,value:n,timestamp:new Date().toISOString()})}const cr=t=>{switch(t){case"starred":return"starredAt";case"read":return"readAt";case"currentDeckGuids":return"addedAt";case"shuffledOutGuids":return"shuffledAt";default:return"updatedAt"}};async function ie(t){return console.log(`ENTERING loadArrayState for ${t}`),$(async n=>{try{const s=await n.getAll(t);if(s.length>0&&(typeof s[0]=="string"||s[0].id===void 0)){console.log(`[DB] Migration required for '${t}'.`);const i=cr(t),o=new Date().toISOString(),a=new Map;s.forEach(d=>{const h=typeof d=="string"?d:d.guid;h&&!a.has(h)&&a.set(h,d)});const c=Array.from(a.values()).map(d=>({guid:typeof d=="string"?d:d.guid,[i]:o})),u=n.transaction(t,"readwrite");await u.store.clear();for(const d of c)await u.store.put(d);return await u.done,console.log(`[DB] Migration complete for '${t}'.`),{value:await n.getAll(t)}}return{value:s||z[t]?.default||[]}}catch(s){return console.error(`Failed to load array state from store '${t}':`,s),{value:z[t]?.default||[]}}})}async function ur(t,n){return $(s=>s.getFromIndex(t,"guid",n)).catch(s=>{console.error(`Error finding item by GUID '${n}' in store '${t}':`,s)})}async function Dn(t,n,s){await $(async i=>{const o=i.transaction(t,"readwrite");if(!n||!n.guid){console.error("[DB] updateArrayState requires an item with a guid property.",n);return}const a=o.objectStore(t);if(s)await a.put(n);else{const l=await a.index("guid").get(n.guid);l?.id!==void 0&&await a.delete(l.id)}await o.done});const r=Object.entries(z).find(([,i])=>i.store===t);if(r&&!r[1].localOnly){let i="";t==="starred"&&(i="starDelta"),t==="read"&&(i="readDelta"),i&&await N({type:i,guid:n.guid,action:s?"add":"remove",timestamp:n[cr(t)]||new Date().toISOString()})}}async function dt(t,n){const{value:s}=await ie(t),r=new Set(s.map(u=>u.guid));await ye(t,n);const i=new Set(n.map(u=>u.guid)),o=[...r].filter(u=>!i.has(u)),a=[...i].filter(u=>!i.has(u)),l=Object.entries(z).find(([,u])=>u.store===t);if(!l||l[1].localOnly)return;let c="";if(t==="starred"&&(c="starDelta"),t==="read"&&(c="readDelta"),!c){await N({type:"simpleUpdate",key:l[0],value:n,timestamp:new Date().toISOString()});return}if(o.length>0){console.log(`[DB] Queuing ${o.length} 'remove' operations for '${t}'.`);for(const u of o)await N({type:c,guid:u,action:"remove",timestamp:new Date().toISOString()})}if(a.length>0){console.log(`[DB] Queuing ${a.length} 'add' operations for '${t}'.`);for(const u of a)await N({type:c,guid:u,action:"add",timestamp:new Date().toISOString()})}}async function dr(t,n){if(!Array.isArray(t)||!Array.isArray(n)){console.warn("[DB] pruneStaleReadItems skipped due to invalid input.");return}const s=new Set(n.map(a=>a.guid)),r=720*60*60*1e3,i=Date.now(),o=t.filter(a=>{if(s.has(a.guid))return!0;const l=new Date(a.readAt).getTime();return i-l<r});if(o.length<t.length){const a=t.length-o.length;console.log(`[DB] Pruning ${a} stale read items.`),await dt("read",o)}else console.log("[DB] No stale read items to prune.")}async function ye(t,n){return $(async s=>{const r=s.transaction(t,"readwrite");await r.store.clear();for(const i of n){const o=JSON.parse(JSON.stringify(i));delete o.id,await r.store.put(o)}await r.done})}const B=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:z,findByGuid:ur,loadArrayState:ie,loadSimpleState:D,overwriteArrayAndSyncChanges:dt,pruneStaleReadItems:dr,queueAndAttemptSyncOperation:N,saveArrayState:ye,saveSimpleState:F,updateArrayState:Dn},Symbol.toStringTag,{value:"Module"})),ta=Object.freeze(Object.defineProperty({__proto__:null,USER_STATE_DEFS:z,closeDb:lr,findByGuid:ur,getAllFeedItems:vn,initDb:nt,loadArrayState:ie,loadSimpleState:D,overwriteArrayAndSyncChanges:dt,performFeedSync:Se,performFullSync:kn,processPendingOperations:ce,pruneStaleReadItems:dr,pullUserState:q,queueAndAttemptSyncOperation:N,saveArrayState:ye,saveSimpleState:F,updateArrayState:Dn,withDb:$},Symbol.toStringTag,{value:"Module"}));function Ht(t){const n=new Date,s=new Date(t),r=Math.floor((n.getTime()-s.getTime())/1e3),i=336*60*60;if(r>i)return s.toLocaleString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});const o=Math.floor(r/60),a=Math.floor(o/60),l=Math.floor(a/24);if(r<60)return"Just now";if(o<60)return`${o} minute${o!==1?"s":""} ago`;if(a<24)return`${a} hour${a!==1?"s":""} ago`;if(l<7)return`${l} day${l!==1?"s":""} ago`;const c=Math.floor(l/7);return`${c} week${c!==1?"s":""} ago`}function qt(t){for(let n=t.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[t[n],t[s]]=[t[s],t[n]]}return t}function Je(t){const n=[];if(!t)return n;if(Array.isArray(t))t.forEach(s=>{typeof s=="string"&&s.trim()?n.push(s.trim()):s&&typeof s=="object"&&s.url&&n.push(s.url.trim())});else if(typeof t=="object")for(const s in t){const r=t[s];if(r&&typeof r=="object")for(const i in r){const o=r[i];Array.isArray(o)&&o.forEach(a=>{a&&a.url&&n.push(a.url.trim())})}}return n}function En(t,n){if(!t)return console.warn("mapRawItem received an undefined or null item. Returning null."),null;const r=new DOMParser().parseFromString(t.description||"","text/html"),i=r.querySelectorAll("img");let o="";if(i.length===1){const d=i[0];d.classList.add("title-image"),o=d.src||"",d.remove()}else i.forEach(d=>{d.setAttribute("loading","lazy"),d.setAttribute("onload","this.classList.add('loaded')")});let a="";const l=r.querySelector(".source-url")||r.querySelector("a");l?(a=l.textContent?.trim()||"",l.remove()):a=t.link?new URL(t.link).hostname:"";const c=r.body.innerHTML.trim(),u=Date.parse(t.pubDate)||0;return{guid:t.guid,image:o,title:t.title,link:t.link,pubDate:n(t.pubDate||""),description:c,source:a,timestamp:u}}function fr(t,n){if(console.log(`ENTERING mapRawItems. rawList length: ${t.length}`),!Array.isArray(t))return console.warn("mapRawItems received a non-array input. Returning empty array."),[];const s=t.map(r=>En(r,n)).filter(r=>r!==null).sort((r,i)=>i.timestamp-r.timestamp);return console.log(`EXITING mapRawItems. Returning length: ${s.length}`),s}async function hr(t,n,s,r,i){console.log("ENTERING generateNewDeck with filterMode:",i),console.log("generateNewDeck: allFeedItems count:",t.length),console.log("generateNewDeck: readItems count:",n.length);try{const a=f=>{if(!Array.isArray(f))return new Set;const m=f.map(p=>typeof p=="object"&&"guid"in p&&p.guid?p.guid:p);return new Set(m.filter(p=>typeof p=="string"&&!!p))},l=new Set(t.map(f=>f.guid)),c=new Set([...a(n)].filter(f=>l.has(f))),u=new Set([...a(s)].filter(f=>l.has(f))),d=new Set([...a(r)].filter(f=>l.has(f)));console.log(`[generateNewDeck] readGuidsSet size: ${c.size}`),console.log(`[generateNewDeck] shuffledOutGuidsSet size: ${d.size}`);let h=[];switch(console.log(`[generateNewDeck] Initial filteredItems count: ${h.length}`),i){case"read":h=t.filter(f=>c.has(f.guid));break;case"starred":h=t.filter(f=>u.has(f.guid));break;default:h=t.filter(f=>!c.has(f.guid)&&!d.has(f.guid)),h.length===0&&(console.log("generateNewDeck: No unread/unshuffled items found, trying all unshuffled items."),h=t.filter(f=>!d.has(f.guid))),h.length===0&&(console.log("generateNewDeck: No unshuffled items found, trying all unread items."),h=t.filter(f=>!c.has(f.guid))),h.length===0&&(console.log("generateNewDeck: Absolutely no filter matches, using all items."),h=[...t]);break}if(console.log("generateNewDeck: Final filteredItems count:",h.length),i==="read"||i==="starred")return h.sort((f,m)=>m.timestamp-f.timestamp),console.log(`[generateNewDeck] Filtered items for ${i}: ${h.length}`),h;let g=[];const y=new Set,b=f=>g.length<10&&f&&!y.has(f.guid)?(g.push(f),y.add(f.guid),!0):!1,S=(f,m)=>{let p=0;for(const _ of f){if(p>=m||g.length>=10)break;b(_)&&p++}};if(navigator.onLine){const f=Date.now(),m=I=>/<a\s+href=/i.test(I.description),p=I=>I.title?.includes("?"),_=I=>I.description?.length>=150&&I.description.substring(0,150).includes("?"),O=I=>{const R=I.description;return R?.length>=150&&R.substring(R.length-150).includes("?")},M=I=>I.image!=="",j=I=>I.description?.length>=750,Q=I=>I.description?.length<750,W=h.filter(I=>f-I.timestamp<=1440*60*1e3);S(W,2),console.log(`[generateNewDeck] After recentItems: ${g.length}`);const w=h.filter(m);S(w,1),console.log(`[generateNewDeck] After itemsWithLinks: ${g.length}`);const G=h.filter(p);S(G,1),console.log(`[generateNewDeck] After itemsWithQuestionTitle: ${g.length}`);const A=h.filter(_);S(A,1),console.log(`[generateNewDeck] After itemsWithQuestionFirst150: ${g.length}`);const K=h.filter(O);S(K,1),console.log(`[generateNewDeck] After itemsWithQuestionLast150: ${g.length}`);const k=h.filter(M);S(k,1),console.log(`[generateNewDeck] After itemsWithImages: ${g.length}`);const ht=h.filter(j);S(ht,1),console.log(`[generateNewDeck] After longItems: ${g.length}`);const ae=h.filter(Q);S(ae,1),console.log(`[generateNewDeck] After shortItems: ${g.length}`);const Ar=h.filter(I=>!y.has(I.guid)),Ir=qt([...Ar]);for(const I of Ir){if(g.length>=10)break;b(I)}if(console.log(`[generateNewDeck] After shuffledRemaining: ${g.length}`),g.length<10){const I=t.filter(R=>d.has(R.guid)&&!c.has(R.guid)&&!y.has(R.guid));I.sort((R,Z)=>R.timestamp-Z.timestamp);for(const R of I){if(g.length>=10)break;b(R)}if(console.log(`[generateNewDeck] After resurfaceCandidates: ${g.length}`),g.length<10){const R=t.filter(Z=>!y.has(Z.guid));R.sort((Z,xr)=>Z.timestamp-xr.timestamp);for(const Z of R){if(g.length>=10)break;g.push(Z),y.add(Z.guid)}console.log(`[generateNewDeck] After remainingAllItems: ${g.length}`)}}}else{let f=[...h];const m=w=>w.title?.includes("?"),p=w=>w.description?.length>=150&&w.description.substring(0,150).includes("?"),_=w=>{const G=w.description;return G?.length>=150&&G.substring(G.length-150).includes("?")},O=w=>/<a\s+href=/i.test(w.description),M=w=>w.image!=="";if(f=f.filter(w=>!m(w)),f=f.filter(w=>!(w.description&&p(w))),f=f.filter(w=>!(w.description&&_(w))),f=f.filter(w=>!O(w)),f=f.filter(w=>!M(w)),f.length<10){let w=h.filter(A=>!f.includes(A));const G=[A=>M(A),A=>O(A),A=>A.description&&_(A),A=>A.description&&p(A),A=>m(A)];for(const A of G){for(;f.length<10;){const K=w.find(A);if(K)f.push(K),w=w.filter(k=>k!==K);else break}if(f.length>=10)break}for(;f.length<10&&w.length>0;)f.push(w.shift())}const j=Date.now();g=f.filter(w=>j-w.timestamp<=1440*60*1e3).slice(0,2);const W=f.filter(w=>!g.includes(w));g=g.concat(W.slice(0,10-g.length))}return qt([...g])}catch(o){return console.error("An error occurred during deck generation:",o),[]}}const na=Object.freeze(Object.defineProperty({__proto__:null,formatDate:Ht,generateNewDeck:hr,mapRawItem:En,mapRawItems:fr,parseRssFeedsConfig:Je,shuffleArray:qt},Symbol.toStringTag,{value:"Module"}));function Jt(t){if(typeof structuredClone=="function")try{return structuredClone(t)}catch(s){console.error("structuredClone failed, falling back to manual sanitization.",s)}const n={};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s];typeof r=="object"&&r!==null?Array.isArray(r)?n[s]=r.map(i=>Jt(i)):n[s]=Jt(r):typeof r!="function"&&(n[s]=r)}return n}async function Yt(t,n,s){const i=t[s].some(u=>u.guid===n)?"remove":"add",o=new Date().toISOString(),a=s==="read"?{guid:n,readAt:o}:{guid:n,starredAt:o};await Dn(s,a,i==="add"),i==="add"?s==="read"?t.read=[...t.read,a]:t.starred=[...t.starred,a]:s==="read"?t.read=t.read.filter(u=>u.guid!==n):t.starred=t.starred.filter(u=>u.guid!==n),typeof t.updateCounts=="function"&&t.updateCounts();const c={type:`${s}Delta`,guid:n,action:i,timestamp:o};await N(c)}async function gr(t,n,s){if(!Array.isArray(n))return[];if(!Array.isArray(t)||t.length===0)return n;const r=new Set(t.filter(o=>o&&o.guid).map(o=>String(o.guid).trim().toLowerCase())),i=720*60*60*1e3;return n.filter(o=>{if(!o||!o.guid)return!1;const a=String(o.guid).trim().toLowerCase();if(r.has(a))return!0;if(o.readAt){const l=new Date(o.readAt).getTime();if(!isNaN(l))return s-l<i}return!0})}async function mr(t){const{value:n}=await ie("read");let s=!1,r=[];if(Array.isArray(n)){const o=new Date().toISOString();for(const a of n)typeof a=="string"&&a?(r.push({guid:a,readAt:o}),s=!0):typeof a=="object"&&a!==null&&typeof a.guid=="string"&&a.guid&&(a.readAt||(a.readAt=o,s=!0),r.push(a))}const i=await gr(t,r,Date.now());if(i.length!==r.length&&(s=!0),s)try{await ye("read",i),console.log(`Sanitized, pruned, or migrated read items. Original count: ${n.length}, New count: ${i.length}`)}catch(o){console.error("Error saving pruned read items:",o)}return i}async function pr(){const{value:t}=await ie("currentDeckGuids");if(t&&t.length>0&&typeof t[0]=="string"){console.log("[loadCurrentDeck] Migrating legacy string-based deck data...");const s=new Date().toISOString(),r=t.map(i=>({guid:i,addedAt:s}));return await ye("currentDeckGuids",r),console.log(`[loadCurrentDeck] Migration complete. Loaded ${r.length} objects.`),r}const n=Array.isArray(t)?t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid):[];return console.log(`[loadCurrentDeck] Loaded ${n.length} deck objects.`),n}async function An(t){if(!Array.isArray(t)){console.error("[saveCurrentDeck] Invalid input: expected an array of objects.");return}const n=t.filter(s=>typeof s=="object"&&s!==null&&typeof s.guid=="string"&&s.guid);n.length!==t.length&&console.warn("[saveCurrentDeck] Filtered out invalid items from the generated deck."),console.log("[saveCurrentDeck] Saving",n.length,"deck objects.");try{const s=n.map(r=>Jt(r));await dt("currentDeckGuids",s)}catch(s){console.error("[saveCurrentDeck] An error occurred while saving the deck:",s)}}async function yr(){const{value:t}=await D("shuffleCount"),{value:n}=await D("lastShuffleResetDate");return{shuffleCount:typeof t=="number"?t:2,lastShuffleResetDate:n||null}}async function st(t,n){await F("shuffleCount",t),await F("lastShuffleResetDate",n),await N({type:"simpleUpdate",key:"shuffleCount",value:t,timestamp:new Date().toISOString()}),await N({type:"simpleUpdate",key:"lastShuffleResetDate",value:n,timestamp:new Date().toISOString()})}async function wr(t,n){t.filterMode=n,await F("filterMode",n),await N({type:"simpleUpdate",key:"filterMode",value:n,timestamp:new Date().toISOString()})}async function Sr(){const{value:t}=await D("filterMode");return t||"unread"}const Xt=Object.freeze(Object.defineProperty({__proto__:null,loadAndPruneReadItems:mr,loadCurrentDeck:pr,loadFilterMode:Sr,loadShuffleState:yr,pruneStaleRead:gr,saveCurrentDeck:An,saveShuffleState:st,setFilterMode:wr,toggleItemStateAndSync:Yt},Symbol.toStringTag,{value:"Module"})),sa=()=>document.getElementById("sync-toggle"),ra=()=>document.getElementById("images-toggle"),ia=()=>document.getElementById("open-urls-in-new-tab-toggle"),oa=()=>document.getElementById("shadows-toggle"),aa=()=>document.getElementById("shuffle-count-display"),la=()=>document.getElementById("filter-selector"),ca=()=>document.querySelector("#ntn-title h2");function ua(t,n=30){const s=t.split(" ");let r=[],i=[],o=0;for(const a of s){const l=a.length+(r.length>0?1:0);o+l<=n?(r.push(a),o+=l):i.push(a)}return[r.join(" "),i.join(" ")].filter(Boolean)}async function _r(t){const n=ca();if(!n){console.warn("displayTemporaryMessageInTitle: 'ntn-title h2' element not found.");return}const s="NOT THE NEWS",r=ua(t),i=n.style.overflow;n.style.overflow="visible";const o=a=>new Promise(l=>setTimeout(l,a));r.length>0&&(n.textContent=r[0],await o(1500)),r.length>1?(n.textContent=r.join(" "),await o(1500)):r.length===1&&await o(1500),n.textContent=s,n.style.overflow=i}let Et;function v(t,n){console.log(`[Status] ${n}`),Et&&clearTimeout(Et),t.syncStatusMessage=n;const s=()=>{t.showSyncStatus=!0,Et=setTimeout(()=>{t.showSyncStatus=!1,setTimeout(()=>{t.showSyncStatus||(t.syncStatusMessage="")},300)},5e3)};t.$nextTick?t.$nextTick(s):s()}let At;function br(t,n,s=null){At&&clearTimeout(At),t.undoItemGuid=n,t.undoItemIndex=s,t.showUndo=!0,t.undoTimerActive=!1;const r=()=>{t.undoTimerActive=!0,At=setTimeout(()=>{t.showUndo=!1,t.undoTimerActive=!1,setTimeout(()=>{t.showUndo||(t.undoItemGuid=null)},500)},5e3)};t.$nextTick?t.$nextTick(r):setTimeout(r,10)}function Qt(t){const n=document.getElementById("main-settings"),s=document.getElementById("rss-settings-block"),r=document.getElementById("keywords-settings-block"),i=document.getElementById("css-settings-block"),o=document.getElementById("advanced-settings-block");if(!n||!s||!r||!i||!o)return console.warn("One or more settings panels not found."),Promise.resolve();switch(n.style.display="none",s.style.display="none",r.style.display="none",i.style.display="none",o.style.display="none",t.modalView){case"main":n.style.display="block";break;case"rss":s.style.display="block";break;case"keywords":r.style.display="block";break;case"css":i.style.display="block";break;case"advanced":o.style.display="block";break;default:console.warn("Unknown modalView:",t.modalView),n.style.display="block"}return Promise.resolve()}async function vr(t){if(!t?.entries?.length||!t.read||!t.starred||!t.currentDeckGuids){console.warn("Attempted to update counts with an invalid app object. Skipping.");return}const n=new Set(t.read.map(h=>h.guid)),s=new Set(t.starred.map(h=>h.guid)),r=new Set(t.currentDeckGuids.map(h=>h.guid)),i=t.entries,o=i.length,a=i.filter(h=>n.has(h.guid)).length,l=i.filter(h=>s.has(h.guid)).length,c=i.filter(h=>r.has(h.guid)&&!n.has(h.guid)).length,u=la();if(!u)return;const d={all:o,read:a,starred:l,unread:c};Array.from(u.options).forEach(h=>{const g=h.text.split(" ")[0];h.text=`${g} (${d[h.value]??0})`})}function In(){window.scrollTo({top:0,behavior:"smooth"})}let kr=!1;function da(t){kr=t}const Dr=(()=>{let t,n=0;return(s="scroll-to-top")=>{const r=document.getElementById(s);if(!r)return;const i=()=>{if(kr){r.classList.remove("visible"),n=window.scrollY;return}const o=window.scrollY;r.classList.toggle("visible",o<n&&o>0),n=o,clearTimeout(t),t=setTimeout(()=>r.classList.remove("visible"),2e3)};window.addEventListener("scroll",i),r.addEventListener("click",o=>{o.preventDefault(),In()})}})();async function Ce(){let t="",n=0;const s=document.querySelectorAll(".entry[data-guid]"),r=Array.from(s).find(i=>i.getBoundingClientRect().bottom>0);if(r){const i=r.getBoundingClientRect();t=r.dataset.guid||"",n=i.top}await F("lastViewedItemId",t),await F("lastViewedItemOffset",n)}const fa=Object.freeze(Object.defineProperty({__proto__:null,attachScrollToTopHandler:Dr,createStatusBarMessage:v,displayTemporaryMessageInTitle:_r,manageSettingsPanelVisibility:Qt,saveCurrentScrollPosition:Ce,scrollToTop:In,setKeyboardScrolling:da,showUndoNotification:br,updateCounts:vr},Symbol.toStringTag,{value:"Module"})),ha={syncEnabled:"Auto-Sync",imagesEnabled:"Images",openUrlsInNewTabEnabled:"Open in New Tab",shadowsEnabled:"Shadows"};async function ft(t,n,s,r=()=>{}){const i=n();i&&i.addEventListener("change",async()=>{const o=t[s];await F(s,o);const a=ha[s]||s;v(t,`${a} ${o?"Enabled":"Disabled"}.`),r(o)})}async function ga(t){await ft(t,sa,"syncEnabled",async n=>{if(t.updateSyncStatusMessage?.(),n&&(v(t,"Kicking off a new sync"),console.log("Sync enabled, triggering full sync."),await kn(t)?v(t,"Sync complete!"):v(t,"Sync finished with some issues."),!t.currentDeckGuids?.length&&t.entries?.length)){console.log("Deck is empty after sync. Rebuilding from all available items.");const r=new Date().toISOString(),i=new Set(t.read?.map(a=>a.guid)),o=new Set(t.shuffledOutGuids?.map(a=>a.guid));t.currentDeckGuids=t.entries.filter(a=>!i.has(a.guid)&&!o.has(a.guid)).map(a=>({guid:a.guid,addedAt:r})),await ye("currentDeckGuids",t.currentDeckGuids),console.log(`Rebuilt deck with ${t.currentDeckGuids.length} items.`)}})}async function ma(t){await ft(t,ra,"imagesEnabled")}async function pa(t){await ft(t,oa,"shadowsEnabled")}async function ya(t){await ft(t,ia,"openUrlsInNewTabEnabled")}async function wa(t){window.requestAnimationFrame(async()=>{const{value:n}=await D("lastViewedItemId"),{value:s}=await D("lastViewedItemOffset");if(!n||!t.deck?.length)return;if(t.deck.some(i=>i.guid===n)){const i=document.querySelector(`.entry[data-guid="${n}"]`);i&&(i.scrollIntoView({behavior:"auto",block:"start"}),typeof s=="number"&&s!==0&&window.scrollTo({top:window.scrollY-s,behavior:"auto"}))}})}let We;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),We=t;const n=document.getElementById("install-button");n&&(n.style.display="block",n.addEventListener("click",()=>{We.prompt(),We.userChoice.then(s=>{s.outcome==="accepted"?console.log("PWA installed"):console.log("PWA installation dismissed"),We=null})}))});const Ke=2,J=t=>typeof t=="object"&&t.guid?t.guid:t,Ye=async(t,n,s,r,i,o="unread",a=null)=>{if(console.log("manageDailyDeck: START"),console.log("manageDailyDeck: Input params:",{entriesCount:t.length,readItemsCount:n.length,starredItemsCount:s.length,shuffledOutItemsCount:r.length,shuffleCount:i,filterMode:o,lastShuffleResetDate:a}),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),console.log("[deckManager] DEBUG: Array.isArray(entries):",Array.isArray(t),"entries.length:",t.length),!Array.isArray(t)||t.length===0)return console.log("[deckManager] Skipping deck management: entries is empty."),console.log("manageDailyDeck: END (skipped)"),{deck:[],currentDeckGuids:[],shuffledOutGuids:Array.isArray(r)?r:[],shuffleCount:typeof i=="number"?i:Ke,lastShuffleResetDate:typeof a=="string"?a:new Date().toDateString()};const l=t,c=Array.isArray(n)?n:[],u=Array.isArray(s)?s:[],d=Array.isArray(r)?r:[],{loadCurrentDeck:h}=await C(async()=>{const{loadCurrentDeck:k}=await Promise.resolve().then(()=>Xt);return{loadCurrentDeck:k}},void 0),g=await h();console.log("manageDailyDeck: Loaded currentDeckItems count:",g.length);const y=new Set(c.map(J)),b=new Set(u.map(J)),S=new Set(d.map(J)),f=new Map(t.map(k=>[k.guid,k]));let m=g.map(k=>f.get(J(k))).filter(k=>!!k);const p=new Date().toDateString(),_=a!==p,O=!g||g.length===0||m.length===0,M=O||m.every(k=>y.has(k.guid)||S.has(k.guid)),j=!O&&m.every(k=>y.has(k.guid)),Q=!O&&m.every(k=>S.has(k.guid));console.log("manageDailyDeck: Deck Status:",{isDeckEmpty:O,isDeckEffectivelyEmpty:M,allItemsInDeckRead:j,allItemsInDeckShuffled:Q,existingDeckCount:m.length,currentDeckItemsCount:g.length});let W=m,w=g,G=d,A=typeof i=="number"?i:Ke,K=a||p;if(console.log("manageDailyDeck: Condition check:",{isNewDay:_,isDeckEffectivelyEmpty:M,filterModeIsNotUnread:o!=="unread",entriesCount:t.length}),_||M||o!=="unread"||g.length===0&&t.length>0){console.log(`[deckManager] Resetting deck. Reason: New Day (${_}), Deck Effectively Empty (${M}), Filter Mode Changed (${o}), or Initial Load (${g.length===0}).`),!_&&g.length>0&&M&&o==="unread"&&(Q||(console.log("[deckManager] Automatically incrementing (refunding) shuffleCount due to deck cleared by reading."),A++,await st(A,K)));const k=await hr(l,c,u,d,o);console.log("manageDailyDeck: generateNewDeck returned count:",k.length);const ht=new Date().toISOString();w=(k||[]).map(ae=>({guid:ae.guid,addedAt:ht})),W=(k||[]).map(ae=>({...ae,isRead:y.has(ae.guid),isStarred:b.has(ae.guid)})),await An(w),_&&(G=[],await ye("shuffledOutGuids",[]),A=Ke,await st(A,p),K=p,await F("lastShuffleResetDate",p))}else W=m.map(k=>({...k,isRead:y.has(k.guid),isStarred:b.has(k.guid)}));return console.log(`[deckManager] Deck management complete. Final deck size: ${W.length}.`),console.log("manageDailyDeck: END"),{deck:W||[],currentDeckGuids:w||[],shuffledOutGuids:G||[],shuffleCount:typeof A=="number"?A:Ke,lastShuffleResetDate:typeof K=="string"?K:new Date().toDateString()}};async function Sa(t){if(console.log("[deckManager] processShuffle called."),t.shuffleCount<=0){v(t,"No shuffles left for today!");return}const n=t.deck.map(y=>y.guid);console.log(`[deckManager] processShuffle: Visible GUIDs to shuffle out: ${n.length}`,n);const s=(t.shuffledOutGuids||[]).map(J).map(y=>({guid:y,shuffledAt:new Date().toISOString()})),r=new Set(s.map(J)),i=new Set([...r,...n]),o=new Date().toISOString(),a=Array.from(i).map(y=>({guid:y,shuffledAt:o}));t.shuffledOutGuids=a,t.shuffleCount--;const{overwriteArrayAndSyncChanges:l}=await C(async()=>{const{overwriteArrayAndSyncChanges:y}=await Promise.resolve().then(()=>B);return{overwriteArrayAndSyncChanges:y}},void 0);await l("shuffledOutGuids",a),await st(t.shuffleCount,t.lastShuffleResetDate??new Date().toDateString());const c=aa();c&&(c.textContent=t.shuffleCount.toString());const u=t.isOnline,d=u?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck",h=t[d];let g;if(h&&h.length>0){console.log(`[deckManager] Consuming pre-generated ${u?"ONLINE":"OFFLINE"} deck.`),t.currentDeckGuids=h,t[d]=null;const{saveSimpleState:y}=await C(async()=>{const{saveSimpleState:m}=await Promise.resolve().then(()=>B);return{saveSimpleState:m}},void 0);await y(d,null);const b=new Map(t.entries.map(m=>[m.guid,m])),S=new Set(t.read.map(J)),f=new Set(t.starred.map(J));t.deck=h.map(m=>b.get(J(m))).filter(m=>!!m).map(m=>({...m,isRead:S.has(m.guid),isStarred:f.has(m.guid)})),await An(t.currentDeckGuids),g={deck:t.deck,currentDeckGuids:t.currentDeckGuids,shuffledOutGuids:t.shuffledOutGuids,shuffleCount:t.shuffleCount,lastShuffleResetDate:t.lastShuffleResetDate}}else console.log("[deckManager] No pre-generated deck found. Falling back to manual generation."),g=await Ye(t.entries,t.read,t.starred,t.shuffledOutGuids,t.shuffleCount,t.filterMode,t.lastShuffleResetDate),t.deck=g.deck,t.currentDeckGuids=g.currentDeckGuids,t.shuffledOutGuids=g.shuffledOutGuids,t.shuffleCount=g.shuffleCount,t.lastShuffleResetDate=g.lastShuffleResetDate;t.deck.length>0&&t.selectItem(t.deck[0].guid),_r("Feed shuffled!"),console.log(`[deckManager] Deck shuffled. Remaining shuffles: ${t.shuffleCount}.`),t.pregenerateDecks()}const _a=1e4;async function It(t,n){const s=Date.now();if(t.selectedGuid&&t.selectedTimestamp&&s-t.selectedTimestamp>_a){console.log("[Navigation] Selection is old (>10s). Reselecting current item.");const i=t.selectedGuid;t.selectedGuid=null,t.$nextTick(()=>{t.selectedGuid=i})}else{const{setKeyboardScrolling:i}=await C(async()=>{const{setKeyboardScrolling:o}=await Promise.resolve().then(()=>fa);return{setKeyboardScrolling:o}},void 0);i(!0),await ba(t,n),setTimeout(()=>i(!1),1e3)}}async function Er(t,n){const s=t.target;if(s.tagName==="INPUT"||s.tagName==="TEXTAREA"||s.isContentEditable)return;const r=t.key,i=t.ctrlKey||t.metaKey;if(n.openSettings){if(["j","k","s","L","i","o","Enter","r","m","t","u","p"," ","ArrowUp","ArrowDown"].includes(r)&&!i){if(r==="Enter"&&["BUTTON","SELECT","A","INPUT","TEXTAREA"].includes(s.tagName))return;t.preventDefault()}const o=document.querySelector(".modal-content");if(!o)return;const l=Array.from(o.querySelectorAll('button, select, input, textarea, [tabindex]:not([tabindex="-1"])')).filter(h=>{const g=window.getComputedStyle(h);return g.display!=="none"&&g.visibility!=="hidden"&&h.offsetParent!==null});if(l.length===0)return;const c=l[0],u=l[l.length-1],d=l.indexOf(document.activeElement);if(r==="Tab"&&(t.shiftKey?document.activeElement===c&&(t.preventDefault(),u.focus()):document.activeElement===u&&(t.preventDefault(),c.focus())),r==="ArrowDown"||r==="j"&&!i){t.preventDefault();const h=(d+1)%l.length;l[h].focus()}if(r==="ArrowUp"||r==="k"&&!i){t.preventDefault();const h=(d-1+l.length)%l.length;l[h].focus()}if(s.tagName==="INPUT"&&s.type==="range"&&(r==="ArrowLeft"||r==="ArrowRight"||r==="h"&&!i||r==="l"&&!i)){t.preventDefault();const h=parseFloat(s.step)||1,g=parseFloat(s.value),b=r==="ArrowRight"||r==="l"?g+h:g-h;s.value=b.toString(),s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0}))}r==="Enter"&&s.tagName!=="SELECT"&&(t.preventDefault(),s.click()),r==="Escape"&&(n.openSettings=!1);return}if(n.openShortcuts&&r!=="?"&&r!=="Escape"&&!(r==="k"&&i)){["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"," ","j","k"].includes(r)&&t.preventDefault();return}switch(r){case"j":case"ArrowDown":t.preventDefault(),await It(n,1);break;case"k":i?(t.preventDefault(),n.openShortcuts=!n.openShortcuts):(t.preventDefault(),await It(n,-1));break;case"ArrowUp":t.preventDefault(),await It(n,-1);break;case"l":case"ArrowRight":n.selectedGuid&&(t.preventDefault(),n.selectedSubElement==="item"?n.selectedSubElement="read":n.selectedSubElement==="read"?n.selectedSubElement="star":n.selectedSubElement==="star"&&(n.selectedSubElement="play"));break;case"h":case"ArrowLeft":n.selectedGuid&&(t.preventDefault(),n.selectedSubElement==="play"?n.selectedSubElement="star":n.selectedSubElement==="star"?n.selectedSubElement="read":n.selectedSubElement==="read"&&(n.selectedSubElement="item"));break;case"p":n.selectedGuid&&(t.preventDefault(),n.speakItem(n.selectedGuid));break;case" ":case"n":e.preventDefault(),n.selectedGuid?await n.toggleRead(n.selectedGuid):n.filteredEntries.length>0&&(n.selectedGuid=n.filteredEntries[0].guid,xn(n.selectedGuid,n));break;case"s":case"L":n.selectedGuid&&(t.preventDefault(),await n.toggleStar(n.selectedGuid));break;case"i":t.preventDefault(),n.imagesEnabled=!n.imagesEnabled,v(n,`Images ${n.imagesEnabled?"Enabled":"Disabled"}.`),C(()=>Promise.resolve().then(()=>ta),void 0).then(o=>{o.saveSimpleState("imagesEnabled",n.imagesEnabled)});break;case"o":case"Enter":if(n.selectedGuid)if(t.preventDefault(),n.selectedSubElement==="read")await n.toggleRead(n.selectedGuid);else if(n.selectedSubElement==="star")await n.toggleStar(n.selectedGuid);else if(n.selectedSubElement==="play")n.speakItem(n.selectedGuid);else{const o=n.filteredEntries.find(a=>a.guid===n.selectedGuid);o?.link&&window.open(o.link,"_blank","noopener,noreferrer")}break;case"r":case"m":n.selectedGuid&&(t.preventDefault(),await n.toggleRead(n.selectedGuid));break;case"t":t.preventDefault(),n.scrollToTop();break;case"u":t.preventDefault(),await n.undoMarkRead();break;case"?":t.preventDefault(),n.openShortcuts?n.openShortcuts=!1:n.openShortcuts=!0;break;case"Escape":n.openShortcuts?(t.preventDefault(),n.openShortcuts=!1):n.openSettings?(t.preventDefault(),n.openSettings=!1):n.selectedGuid&&(t.preventDefault(),n.selectedGuid=null);break;case"z":isCtrlOrCmd&&(t.preventDefault(),await n.undoMarkRead());break}}async function ba(t,n){const s=t.filteredEntries;if(s.length!==0){if(t.selectedGuid){let i=s.findIndex(o=>o.guid===t.selectedGuid)+n;i>=s.length&&(i=s.length-1),i<0&&(i=0),t.selectedGuid=s[i].guid}else{const r=t.lastSelectedGuid,i=r?s.findIndex(o=>o.guid===r):-1;if(i===-1)t.selectedGuid=s[0].guid;else{let o=i+n;o>=s.length&&(o=s.length-1),o<0&&(o=0),t.selectedGuid=s[o].guid}}xn(t.selectedGuid,t)}}function xn(t,n){if(t){if(n.filteredEntries.length>0&&n.filteredEntries[0].guid===t){n.scrollToTop();return}setTimeout(()=>{const s=document.querySelector(`.entry[data-guid="${t}"]`);if(s){const r=document.querySelector("#header"),i=r?r.getBoundingClientRect().height:0,a=s.getBoundingClientRect().top+window.pageYOffset-i-20;window.scrollTo({top:a,behavior:"smooth"})}},10)}}const va=Object.freeze(Object.defineProperty({__proto__:null,handleKeyboardShortcuts:Er,scrollSelectedIntoView:xn},Symbol.toStringTag,{value:"Module"}));function ka(){return{loading:!0,progressMessage:"Initializing...",deck:[],feedItems:{},filterMode:"unread",openSettings:!1,openShortcuts:!1,modalView:"main",shuffleCount:0,syncEnabled:!0,imagesEnabled:!0,openUrlsInNewTabEnabled:!0,shadowsEnabled:!0,rssFeedsInput:"",keywordBlacklistInput:"",entries:[],read:[],starred:[],currentDeckGuids:[],shuffledOutGuids:[],pregeneratedOnlineDeck:null,pregeneratedOfflineDeck:null,errorMessage:"",isOnline:Y(),deckManaged:!1,syncStatusMessage:"",showSyncStatus:!1,theme:"dark",themeStyle:"original",themeStyleLight:"original",themeStyleDark:"original",customCss:"",fontSize:100,feedWidth:50,showUndo:!1,undoTimerActive:!1,undoItemGuid:null,undoItemIndex:null,selectedGuid:null,selectedSubElement:"item",selectedTimestamp:null,lastSelectedGuid:null,starredGuid:null,readingGuid:null,speakingGuid:null,_lastFilterHash:"",_cachedFilteredEntries:null,scrollObserver:null,imageObserver:null,db:null,_initComplete:!1,staleItemObserver:null,_isSyncing:!1,lastShuffleResetDate:null,initApp:async function(){try{if(this.progressMessage="Connecting to database...",this.db=await nt(),this.progressMessage="Loading settings...",await this._loadInitialState(),this._initImageObserver(),this.isOnline){this.progressMessage="Syncing latest content...",await ce(),await q();const t=await Se(this);await this._loadAndManageAllData(),t?v(this,"Initial sync complete!"):v(this,"Sync finished with some issues. Check console for details.")}else this.progressMessage="Offline mode. Loading local data...",await this._loadAndManageAllData();this.progressMessage="Applying user preferences...",ga(this),ma(this),pa(this),ya(this),Dr(),this.$nextTick(()=>{wa(this)}),this.progressMessage="Setting up app watchers...",this._setupWatchers(),this._setupEventListeners(),this._startPeriodicSync(),this._initScrollObserver(),this._initObservers(),this.deck.length===0?(this.entries.length>0?this.progressMessage="Fetching and building your feed...":this.progressMessage="No feed items found. Please configure your RSS feeds.",await new Promise(t=>setTimeout(t,1e3))):this.selectedGuid||this.selectItem(this.deck[0].guid),this.loading=!1,await this.updateSyncStatusMessage()}catch(t){console.error("Initialization failed:",t),this.errorMessage=`Could not load feed: ${t.message}`,this.progressMessage=`Error: ${t.message}`,v(this,`Could not load feed: ${t.message}`)}},performBackgroundSync:async function(){if(!(!this.syncEnabled||!this.isOnline)){console.log("Performing immediate background sync..."),this.progressMessage="Syncing...",this.loading=!0;try{await ce();const t=await Se(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,this.progressMessage="",this.loading=!1,console.log("Immediate background sync complete."),t?v(this,"Sync complete!"):v(this,"Sync finished with errors.")}catch(t){console.error("Immediate background sync failed:",t),this.progressMessage="Sync Failed!",this.loading=!1,v(this,`Sync failed: ${t.message}`)}}},updateSyncStatusMessage:async function(){Y()?this.syncEnabled?(this.showSyncStatus=!1,this.syncStatusMessage=""):(this.syncStatusMessage="Sync is disabled.",this.showSyncStatus=!0):(this.syncStatusMessage="Offline.",this.showSyncStatus=!0)},loadAndDisplayDeck:async function(){let t=this.currentDeckGuids;Array.isArray(t)||(t=[]),console.log(`[loadAndDisplayDeck] Processing ${t.length} GUIDs for display`),console.log(`[loadAndDisplayDeck] feedItems contains ${Object.keys(this.feedItems).length} items`);const n=[],s=new Set(this.read.map(l=>l.guid)),r=new Set(this.starred.map(l=>l.guid)),i=new Set;let o=0,a=0;for(const l of t){const c=l.guid;if(typeof c!="string"||!c)continue;const u=this.feedItems[c];if(u&&u.guid&&!i.has(u.guid)){const d=En(u,Ht);d&&(d.isRead=s.has(d.guid),d.isStarred=r.has(d.guid),n.push(d),i.add(d.guid),o++)}else a++,a<=3&&console.log(`[loadAndDisplayDeck] MISSING: GUID ${c} not found in feedItems`)}console.log(`[loadAndDisplayDeck] Found ${o} items, Missing ${a} items`),this.deck=Array.isArray(n)?n:[],console.log(`[loadAndDisplayDeck] Final deck size: ${this.deck.length}`)},loadFeedItemsFromDB:async function(){if(!this.db){this.entries=[],this.feedItems={};return}const t=await vn();this.feedItems={};const n=[],s=new Set;t.forEach(r=>{r&&r.guid&&!s.has(r.guid)&&(this.feedItems[r.guid]=r,n.push(r),s.add(r.guid))}),this.entries=fr(n,Ht)||[]},get filteredEntries(){Array.isArray(this.deck)||(this.deck=[]);const t=this.deck.length>0?this.deck[0].guid.substring(0,8):"empty",n=`${this.entries.length}-${this.filterMode}-${this.read.length}-${this.starred.length}-${this.imagesEnabled}-${this.currentDeckGuids.length}-${this.deck.length}-${this.keywordBlacklistInput}-${t}`;if(this.entries.length>0&&n===this._lastFilterHash&&this._cachedFilteredEntries!==null)return this._cachedFilteredEntries;let s=[];const r=new Map(this.read.map(a=>[a.guid,a.readAt])),i=new Map(this.starred.map(a=>[a.guid,a.starredAt]));switch(this.filterMode){case"unread":s=this.deck.filter(a=>!r.has(a.guid));break;case"all":s=this.entries;break;case"read":s=this.entries.filter(a=>r.has(a.guid)).sort((a,l)=>new Date(r.get(l.guid)||0).getTime()-new Date(r.get(a.guid)||0).getTime());break;case"starred":s=this.entries.filter(a=>i.has(a.guid)).sort((a,l)=>new Date(i.get(l.guid)||0).getTime()-new Date(i.get(a.guid)||0).getTime());break}s=s.map(a=>({...a,isRead:r.has(a.guid),isStarred:i.has(a.guid)}));const o=(this.keywordBlacklistInput??"").split(/\r?\n/).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0);return o.length>0&&(s=s.filter(a=>{const l=`${a.title} ${a.description}`.toLowerCase();return!o.some(c=>l.includes(c))})),this._cachedFilteredEntries=s,this._lastFilterHash=n,s},isStarred:function(t){return this.starred.some(n=>n.guid===t)},isRead:function(t){return this.read.some(n=>n.guid===t)},toggleStar:async function(t){!this.starred.some(s=>s.guid===t)&&(this.starredGuid=t,setTimeout(()=>{this.starredGuid===t&&(this.starredGuid=null)},1e3)),await Yt(this,t,"starred")},speakItem:function(t){if(this.speakingGuid===t){window.speechSynthesis.cancel(),this.speakingGuid=null;return}const n=this.entries.find(o=>o.guid===t);if(!n)return;window.speechSynthesis.cancel(),this.speakingGuid=t;const s=n.description.replace(/<[^>]*>?/gm," "),r=`${n.title}. ${s}`,i=new SpeechSynthesisUtterance(r);i.onend=()=>{this.speakingGuid===t&&(this.speakingGuid=null)},utterror.onerror=()=>{this.speakingGuid=null},window.speechSynthesis.speak(i)},toggleRead:async function(t){this.speakingGuid===t&&(window.speechSynthesis.cancel(),this.speakingGuid=null);const n=this.isRead(t),s=this.selectedGuid===t;let r=null;if(!n&&s&&this.filterMode==="unread"){const o=this.filteredEntries.findIndex(a=>a.guid===t);o!==-1&&o<this.filteredEntries.length-1&&(r=this.filteredEntries[o+1].guid)}n||(this.readingGuid=t,await new Promise(o=>setTimeout(o,500)),this.readingGuid=null);let i=null;if(await Yt(this,t,"read"),this.deck=this.deck.map(o=>o.guid===t?{...o,isRead:!n}:o),this.entries=this.entries.map(o=>o.guid===t?{...o,isRead:!n}:o),this.filterMode==="unread"&&!n){i=this.currentDeckGuids.findIndex(a=>a.guid===t),i===-1&&(i=null),this.deck=this.deck.filter(a=>a.guid!==t),this.currentDeckGuids=this.currentDeckGuids.filter(a=>a.guid!==t);const{saveCurrentDeck:o}=await C(async()=>{const{saveCurrentDeck:a}=await Promise.resolve().then(()=>Xt);return{saveCurrentDeck:a}},void 0);await o(this.currentDeckGuids),r?this.$nextTick(()=>{this.selectItem(r)}):s&&(this.selectedGuid=null)}else if(this.filterMode==="unread"&&n&&!this.currentDeckGuids.some(o=>o.guid===t)){const o={guid:t,addedAt:new Date().toISOString()};this.undoItemIndex!==null&&this.undoItemIndex>=0?this.currentDeckGuids.splice(this.undoItemIndex,0,o):this.currentDeckGuids.push(o);const{saveCurrentDeck:a}=await C(async()=>{const{saveCurrentDeck:l}=await Promise.resolve().then(()=>Xt);return{saveCurrentDeck:l}},void 0);await a(this.currentDeckGuids)}if(this.updateCounts(),await this._reconcileAndRefreshUI(),this.updateSyncStatusMessage(),!n&&this.filterMode!=="all"&&br(this,t,i),this.filterMode==="unread"&&this.deck.length===0){console.log("[toggleRead] Deck is empty, initiating refresh process."),this.progressMessage="Generating new deck...",this.loading=!0;try{await this._loadAndManageAllData(),this.deck=[...this.deck],this.deck.length>0&&this.selectItem(this.deck[0].guid)}catch(o){console.error("[toggleRead] Error during deck refresh:",o)}finally{this.loading=!1,this.progressMessage=""}console.log("[toggleRead] Deck refresh process completed. Deck size:",this.deck.length)}},undoMarkRead:async function(){if(!this.undoItemGuid)return;const t=this.undoItemGuid;this.showUndo=!1,await this.toggleRead(t),this.undoItemGuid=null,this.undoItemIndex=null},selectItem:function(t){if(this.selectedGuid===t){this.openShortcuts&&(this.openShortcuts=!1);return}this.selectedGuid=t,this.openShortcuts&&(this.openShortcuts=!1),C(()=>Promise.resolve().then(()=>va),void 0).then(n=>{n.scrollSelectedIntoView(t,this)})},processShuffle:async function(){await Sa(this),this.updateCounts()},loadRssFeeds:async function(){try{const t=await D("rssFeeds");this.rssFeedsInput=Je(t.value).join(`
`)}catch(t){console.error("Error loading RSS feeds:",t)}},loadKeywordBlacklist:async function(){const{loadSimpleState:t}=await C(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>B);return{loadSimpleState:s}},void 0),{value:n}=await t("keywordBlacklist");this.keywordBlacklistInput=Array.isArray(n)?n.join(`
`):""},loadCustomCss:async function(){const{loadSimpleState:t}=await C(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>B);return{loadSimpleState:s}},void 0),{value:n}=await t("customCss");this.customCss=typeof n=="string"&&n.trim()!==""?n:this.generateCustomCssTemplate(),this.applyCustomCss()},saveRssFeeds:async function(){const t=this.rssFeedsInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean);try{await F("rssFeeds",t),this.rssFeedsInput=t.join(`
`),v(this,"RSS Feeds saved!"),this.loading=!0,this.progressMessage="Saving feeds and performing full sync...";const n=await kn(this);await this.loadFeedItemsFromDB();const s=await Ye(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=s.deck,this.currentDeckGuids=s.currentDeckGuids,this.shuffledOutGuids=s.shuffledOutGuids,this.shuffleCount=s.shuffleCount,this.lastShuffleResetDate=s.lastShuffleResetDate,await this.loadAndDisplayDeck(),this.progressMessage="",this.loading=!1,n||v(this,"Feeds saved, but sync finished with errors.")}catch(n){console.error("Error saving RSS feeds:",n),v(this,`Failed to save RSS feeds: ${n.message}`),this.loading=!1}},saveKeywordBlacklist:async function(){const t=this.keywordBlacklistInput.split(/\r?\n/).map(n=>n.trim()).filter(Boolean).sort();try{await F("keywordBlacklist",t),this.keywordBlacklistInput=t.join(`
`),v(this,"Keyword Blacklist saved!"),this.updateCounts()}catch(n){console.error("Error saving keyword blacklist:",n),v(this,`Failed to save keyword blacklist: ${n.message}`)}},saveCustomCss:async function(){try{await F("customCss",this.customCss),this.applyCustomCss(),v(this,"Custom CSS saved!")}catch(t){console.error("Error saving custom CSS:",t),v(this,`Failed to save custom CSS: ${t.message}`)}},resetCustomCss:async function(){confirm("Reset Custom CSS to default template? This will overwrite your current customizations.")&&(this.customCss=this.generateCustomCssTemplate(),await this.saveCustomCss(),v(this,"Custom CSS reset to template!"))},generateCustomCssTemplate:function(){const t=getComputedStyle(document.documentElement),n=["--bg","--fg","--primary","--secondary","--card-bg","--card-border","--card-shadow-color","--fg-muted","--border-radius"];let s=`/* Custom CSS Template - Current theme: ${this.theme} ${this.themeStyle} */
:root {
`;return n.forEach(r=>{const i=t.getPropertyValue(r).trim();i&&(s+=`  ${r}: ${i};
`)}),s+=`}

/* Add custom styles below */
`,s},applyCustomCss:function(){let t=document.getElementById("custom-user-css");t||(t=document.createElement("style"),t.id="custom-user-css",document.head.appendChild(t)),t.textContent=this.customCss},loadThemeStyle:async function(){const{loadSimpleState:t}=await C(async()=>{const{loadSimpleState:r}=await Promise.resolve().then(()=>B);return{loadSimpleState:r}},void 0),[,n,s]=await Promise.all([t("themeStyle"),t("themeStyleLight"),t("themeStyleDark")]);this.themeStyleLight=typeof n.value=="string"?n.value:"original",this.themeStyleDark=typeof s.value=="string"?s.value:"original",this.theme==="light"?this.themeStyle=this.themeStyleLight:this.themeStyle=this.themeStyleDark,this.applyThemeStyle()},updateThemeAndStyle:async function(t,n){console.log(`Updating theme to ${n} and style to ${t}`),this.theme=n,this.themeStyle=t;const s=document.documentElement;s.classList.remove("light","dark"),s.classList.add(n),localStorage.setItem("theme",n);const{saveSimpleState:r}=await C(async()=>{const{saveSimpleState:i}=await Promise.resolve().then(()=>B);return{saveSimpleState:i}},void 0);await r("theme",n),n==="light"?(this.themeStyleLight=t,await r("themeStyleLight",t)):(this.themeStyleDark=t,await r("themeStyleDark",t)),await r("themeStyle",t),this.applyThemeStyle(),v(this,`Theme set to ${n} (${t}).`)},saveThemeStyle:async function(){const{saveSimpleState:t}=await C(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>B);return{saveSimpleState:n}},void 0);this.theme==="light"?(this.themeStyleLight=this.themeStyle,await t("themeStyleLight",this.themeStyleLight)):(this.themeStyleDark=this.themeStyle,await t("themeStyleDark",this.themeStyleDark)),await t("themeStyle",this.themeStyle),this.applyThemeStyle()},applyThemeStyle:function(){const t=document.documentElement;t.classList.remove("light","dark"),t.classList.add(this.theme);const n=Array.from(t.classList).filter(s=>s.startsWith("theme-"));t.classList.remove(...n),this.themeStyle!=="original"&&t.classList.add(`theme-${this.themeStyle}`)},loadFontSize:async function(){const{loadSimpleState:t}=await C(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>B);return{loadSimpleState:s}},void 0),{value:n}=await t("fontSize");this.fontSize=typeof n=="number"?n:100,this.applyFontSize()},saveFontSize:async function(){const{saveSimpleState:t}=await C(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>B);return{saveSimpleState:n}},void 0);await t("fontSize",this.fontSize),this.applyFontSize()},applyFontSize:function(){document.documentElement.style.setProperty("--font-scale",(this.fontSize/100).toString())},loadFeedWidth:async function(){const{loadSimpleState:t}=await C(async()=>{const{loadSimpleState:s}=await Promise.resolve().then(()=>B);return{loadSimpleState:s}},void 0),{value:n}=await t("feedWidth");this.feedWidth=typeof n=="number"?n:50,this.applyFeedWidth()},saveFeedWidth:async function(){const{saveSimpleState:t}=await C(async()=>{const{saveSimpleState:n}=await Promise.resolve().then(()=>B);return{saveSimpleState:n}},void 0);await t("feedWidth",this.feedWidth),this.applyFeedWidth()},applyFeedWidth:function(){document.documentElement.style.setProperty("--feed-width",`${this.feedWidth}%`)},updateCounts:async function(){vr(this)},scrollToTop:function(){In()},observeImage:function(t){this.imageObserver&&this.imageObserver.observe(t)},_initImageObserver:function(){this.imageObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(n.isIntersecting){const s=n.target;s.dataset.src&&(s.src=s.dataset.src,this.imageObserver?.unobserve(s))}})},{root:null,rootMargin:"50% 0px",threshold:.01})},resetApplicationData:async function(){console.log("resetApplicationData called.");const t=confirm("Are you sure you want to reset the application? This will clear all local data, cache, and unregister the service worker.");if(console.log("User confirmed reset:",t),!t){console.log("Reset cancelled by user.");return}this.loading=!0,this.progressMessage="Resetting application data...";try{if(console.log("Closing database connection..."),await lr(),console.log("Unregistering service workers..."),"serviceWorker"in navigator){const s=await navigator.serviceWorker.getRegistrations();for(const r of s)await r.unregister(),console.log("Service Worker unregistered:",r.scope)}console.log("Service workers unregistered."),console.log("Clearing feed and progress IndexedDB object stores...");try{const s=await nt(),r=["read","starred","currentDeckGuids","shuffledOutGuids","feedItems","pendingOperations"],i=s.transaction([...r,"userSettings"],"readwrite");await Promise.all(r.map(a=>(console.log(`Clearing object store: ${a}`),i.objectStore(a).clear()))),console.log("Clearing sync metadata from userSettings...");const o=i.objectStore("userSettings");await Promise.all([o.delete("lastFeedSync"),o.delete("lastStateSync")]),await i.done,console.log("Specific IndexedDB object stores and sync metadata cleared.")}catch(s){console.error("Error clearing IndexedDB stores:",s)}console.log("localStorage is preserved."),console.log("DEBUG: About to make fetch call to /api/admin/reset-app");const n=await fetch("/api/admin/reset-app",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.message||"Failed to reset backend data.")}console.log("Backend application data reset successfully."),v(this,"Application reset complete! Reloading..."),await q(!0),setTimeout(()=>{window.location.reload()},1e3)}catch(n){console.error("Error during application reset:",n),this.errorMessage=`Failed to reset application: ${n.message}`,v(this,`Failed to reset application: ${n.message}`),this.loading=!1}},backupConfig:async function(){console.log("backupConfig called.");try{this.progressMessage="Fetching configuration for backup...",console.log("Fetching config for backup from:","/api/admin/config-backup");const t=await fetch("/api/admin/config-backup",{method:"GET",credentials:"include"});if(!t.ok){const o=await t.json();throw new Error(o.message||"Failed to fetch config for backup.")}const n=await t.json(),s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`not-the-news-config-backup-${new Date().toISOString().replace(/:/g,"-").split(".")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),v(this,"Configuration backed up successfully!")}catch(t){console.error("Error during config backup:",t),v(this,`Failed to backup configuration: ${t.message}`)}finally{this.progressMessage=""}},restoreConfig:async function(t){if(!confirm("Are you sure you want to restore configuration? This will overwrite your current settings and reload the application."))return;const n=t.target.files?.[0];if(!n){v(this,"No file selected for restoration.");return}this.loading=!0,this.progressMessage="Restoring configuration...";try{const s=await new Promise((o,a)=>{const l=new FileReader;l.onload=c=>o(c.target?.result),l.onerror=c=>a(c),l.readAsText(n)}),r=JSON.parse(s),i=await fetch("/api/admin/config-restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),credentials:"include"});if(!i.ok){const o=await i.json();throw new Error(o.message||"Failed to restore backend data.")}console.log("Backend configuration restored successfully."),v(this,"Configuration restored successfully! Reloading..."),setTimeout(()=>{window.location.reload()},1e3)}catch(s){console.error("Error during config restoration:",s),v(this,`Failed to restore configuration: ${s.message}`),this.loading=!1}finally{t.target.value=""}},_loadInitialState:async function(){try{const[t,n,s,r,i]=await Promise.all([D("syncEnabled"),D("imagesEnabled"),D("openUrlsInNewTabEnabled"),Sr(),D("theme")]);this.syncEnabled=t.value??!0,this.imagesEnabled=n.value??!0,this.openUrlsInNewTabEnabled=s.value??!0,this.filterMode=r,this.theme=i.value??"dark",localStorage.setItem("theme",this.theme),this.isOnline=Y();const[o,a]=await Promise.all([D("rssFeeds"),D("keywordBlacklist")]);this.rssFeedsInput=Je(o.value).join(`
`),this.keywordBlacklistInput=Array.isArray(a.value)?a.value.join(`
`):"",await this.loadCustomCss(),await this.loadThemeStyle(),await this.loadFontSize(),await this.loadFeedWidth();const[l,c]=await Promise.all([D("pregeneratedOnlineDeck"),D("pregeneratedOfflineDeck")]);this.pregeneratedOnlineDeck=l.value,this.pregeneratedOfflineDeck=c.value}catch(t){console.error("Error loading initial state:",t),this.syncEnabled=!0,this.imagesEnabled=!0,this.openUrlsInNewTabEnabled=!0,this.filterMode="unread",this.theme="dark",this.rssFeedsInput="",this.keywordBlacklistInput=""}},_loadAndManageAllData:async function(){console.log("_loadAndManageAllData: START"),this.progressMessage="Loading saved feed items...",await this.loadFeedItemsFromDB(),console.log(`_loadAndManageAllData: After loadFeedItemsFromDB. Entries: ${this.entries.length}`),this.progressMessage="Loading user state from storage...";const[t,n,s,r]=await Promise.all([ie("starred"),ie("shuffledOutGuids"),pr(),yr()]);console.log("_loadAndManageAllData: Loaded starred state:",t.value),this.starred=Array.isArray(t.value)?t.value:[],this.shuffledOutGuids=Array.isArray(n.value)?n.value:[],this.currentDeckGuids=Array.isArray(s)?s:[],console.log("_loadAndManageAllData: Loaded currentDeckGuids:",this.currentDeckGuids.slice(0,3),typeof this.currentDeckGuids[0]),this.shuffleCount=r.shuffleCount,this.lastShuffleResetDate=r.lastShuffleResetDate,this.progressMessage="Pruning read items...",this.read=await mr(Object.values(this.feedItems)),console.log(`_loadAndManageAllData: After loadAndPruneReadItems. Read count: ${this.read.length}`),console.log("[deckManager] Starting deck management with all data loaded."),this.progressMessage="Organizing your deck...",console.log("_loadAndManageAllData: Before manageDailyDeck",{readCount:this.read.length,currentDeckGuidsCount:this.currentDeckGuids.length,shuffleCount:this.shuffleCount});const i=await Ye(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate);this.deck=i.deck,this.currentDeckGuids=i.currentDeckGuids,this.shuffledOutGuids=i.shuffledOutGuids,this.shuffleCount=i.shuffleCount,this.lastShuffleResetDate=i.lastShuffleResetDate,console.log("_loadAndManageAllData: After manageDailyDeck. Deck size:",this.deck.length),this.progressMessage="Displaying your feed...",await this.loadAndDisplayDeck(),console.log("_loadAndManageAllData: After loadAndDisplayDeck. Final Deck size:",this.deck.length),this.updateAllUI(),console.log("_loadAndManageAllData: END")},updateAllUI:async function(){await this.updateCounts()},_reconcileAndRefreshUI:async function(){console.log("[UI] _reconcileAndRefreshUI: Initiating UI reconciliation and refresh."),await this.loadAndDisplayDeck(),this.updateAllUI(),console.log("[UI] _reconcileAndRefreshUI: Completed UI reconciliation and refresh.")},_initObservers:function(){this.staleItemObserver=new IntersectionObserver(t=>{t.forEach(n=>{if(!n.isIntersecting){const s=n.target.dataset.guid;console.log(`[Observer] Stale item ${s} is off-screen. Removing.`),this.deck=this.deck.filter(r=>r.guid!==s),this.staleItemObserver?.unobserve(n.target)}})},{root:null,threshold:0})},_setupWatchers:function(){this.$watch("openShortcuts",async t=>{const n=window.innerWidth<1024;t?(n||document.body.classList.add("no-scroll"),await Ce()):(document.body.classList.remove("no-scroll"),document.body.style.overflow="")}),this.$watch("openSettings",async t=>{const n=window.innerWidth<1024;if(t){n||document.body.classList.add("no-scroll"),this.modalView="main",await Qt(this),this.$nextTick(()=>{document.querySelector(".modal-content")?.querySelector("button, select, input, textarea")?.focus()});const[s,r]=await Promise.all([D("rssFeeds"),D("keywordBlacklist")]);this.rssFeedsInput=Je(s.value).join(`
`),Array.isArray(r.value)?this.keywordBlacklistInput=r.value.filter(Boolean).sort().join(`
`):typeof r.value=="string"?this.keywordBlacklistInput=r.value.split(/\r?\n/).filter(Boolean).sort().join(`
`):this.keywordBlacklistInput="",await Ce()}else document.body.classList.remove("no-scroll"),document.body.style.overflow="",await Ce()}),this.$watch("openUrlsInNewTabEnabled",()=>{document.querySelectorAll(".itemdescription").forEach(t=>this.handleEntryLinks(t))}),this.$watch("modalView",async()=>Qt(this)),this.$watch("filterMode",async t=>{await wr(this,t),t==="unread"&&await Ye(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,this.shuffleCount,this.filterMode,this.lastShuffleResetDate),this.scrollToTop()}),this.$watch("shadowsEnabled",t=>{document.body.classList.toggle("no-shadows",!t)}),document.body.classList.toggle("no-shadows",!this.shadowsEnabled),this.$watch("entries",()=>this.updateCounts()),this.$watch("read",()=>this.updateCounts()),this.$watch("starred",()=>this.updateCounts()),this.$watch("currentDeckGuids",()=>this.updateCounts()),this.$watch("selectedGuid",t=>{t?(this.lastSelectedGuid=t,this.selectedTimestamp=Date.now(),this.selectedSubElement="item"):(this.selectedTimestamp=null,this.selectedSubElement="item")})},_setupEventListeners:function(){const t=async()=>{if(!this.syncEnabled||!this.isOnline)return;console.log("Performing periodic background sync..."),await ce();const s=await Se(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Background sync complete. Success: ${s}`)};window.addEventListener("online",async()=>{if(this.isOnline=!0,await this.updateSyncStatusMessage(),this.syncEnabled)try{await ce(),await t()}catch(s){console.error("Error handling online event:",s)}}),window.addEventListener("offline",async()=>{this.isOnline=!1,await this.updateSyncStatusMessage()});let n;window.addEventListener("scroll",()=>{clearTimeout(n),n=setTimeout(()=>{Ce()},1e3)},{passive:!0}),window.addEventListener("keydown",s=>{Er(s,this)}),window.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"&&this.selectedGuid){console.log("[Visibility] App returned to foreground. Redrawing selection animation.");const s=this.selectedGuid;this.selectedGuid=null,this.$nextTick(()=>{this.selectedGuid=s})}})},_startPeriodicSync:function(){let t=Date.now();const n=()=>t=Date.now();["mousemove","mousedown","keydown","scroll","click","visibilitychange","focus"].forEach(i=>{document.addEventListener(i,n,!0),i==="focus"&&window.addEventListener(i,n,!0),i==="visibilitychange"&&document.addEventListener(i,n,!0)});const s=300*1e3,r=60*1e3;setInterval(async()=>{const i=Date.now();if(!(!this.isOnline||this.openSettings||!this.syncEnabled||i-t>r)){console.log("Starting scheduled background sync...");try{await ce();const o=await Se(this);await q(),await this._loadAndManageAllData(),this.deckManaged=!0,console.log(`Scheduled sync complete. Success: ${o}`),await this.pregenerateDecks()}catch(o){console.error("Periodic sync failed:",o)}}},s)},_initScrollObserver:function(){const t=new IntersectionObserver(async()=>{},{root:document.querySelector("#feed-container"),rootMargin:"0px",threshold:.1}),n=document.querySelector("#feed-container");if(!n)return;const s=()=>{n.querySelectorAll("[data-guid]").forEach(i=>{t.observe(i)})};s(),new MutationObserver(()=>{t.disconnect(),s()}).observe(n,{childList:!0,subtree:!0}),this.scrollObserver=t},handleEntryLinks:function(t){t&&t.querySelectorAll("a").forEach(n=>{n.hostname!==window.location.hostname&&(this.openUrlsInNewTabEnabled?(n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer")):n.removeAttribute("target"))})},pregenerateDecks:async function(){if(!this._isPregenerating){this._isPregenerating=!0,console.log("[Background] Starting pre-generation of decks...");try{await this._generateAndSavePregeneratedDeck(!0),await this._generateAndSavePregeneratedDeck(!1),console.log("[Background] Deck pre-generation completed.")}catch(t){console.error("[Background] Deck pre-generation failed:",t)}finally{this._isPregenerating=!1}}},_generateAndSavePregeneratedDeck:async function(t){const{generateNewDeck:n}=await C(async()=>{const{generateNewDeck:l}=await Promise.resolve().then(()=>na);return{generateNewDeck:l}},void 0),{saveSimpleState:s}=await C(async()=>{const{saveSimpleState:l}=await Promise.resolve().then(()=>B);return{saveSimpleState:l}},void 0),r=await n(Array.from(this.entries),this.read,this.starred,this.shuffledOutGuids,"unread",t),i=new Date().toISOString(),o=(r||[]).map(l=>({guid:l.guid,addedAt:i})),a=t?"pregeneratedOnlineDeck":"pregeneratedOfflineDeck";this[a]=o,await s(a,o),console.log(`[Background] Pregenerated ${t?"ONLINE":"OFFLINE"} deck saved. Size: ${o.length}`)},$nextTick:function(t){return tt.nextTick(t)},$watch:function(t,n){return tt.watch(this,t,n)}}}tt.data("rssApp",ka);tt.start();
